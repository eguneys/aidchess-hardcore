var Re=Object.defineProperty;var He=(e,t,s)=>t in e?Re(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var D=(e,t,s)=>(He(e,typeof t!="symbol"?t+"":t,s),s);import{a as M,b as $,h as te,o as Ve,k as Je,s as q,c as g,m as Q,F as Le,S as ae,d as W,l as Qe,T as Ze,i as Y,t as he,j as se,e as ue,f as Ie}from"./index-8dd89830.js";import{C as Ke,G as Ae}from"./ctrl-c87021e3.js";import{N as et,F as tt,R as ke,a as de,i as Z}from"./store-00e80bbf.js";var st=Object.defineProperty,rt=(e,t,s)=>t in e?st(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,m=(e,t,s)=>(rt(e,typeof t!="symbol"?t+"":t,s),s);const U=e=>e[0](),H=(e,t)=>typeof t=="function"?e[1](t):e[1](s=>t),x=class{constructor(e,t){m(this,"x"),m(this,"y"),this.x=e,this.y=t}static get unit(){return new x(1,1)}static get zero(){return new x(0,0)}get vs(){return[this.x,this.y]}get mul_inverse(){return new x(1/this.x,1/this.y)}get inverse(){return new x(-this.x,-this.y)}get half(){return new x(this.x/2,this.y/2)}get length_squared(){return this.x*this.x+this.y*this.y}get length(){return Math.sqrt(this.length_squared)}get normalize(){return this.length===0?x.zero:this.scale(1/this.length)}get perpendicular(){return new x(-this.y,this.x)}get clone(){return new x(this.x,this.y)}get angle(){return Math.atan2(this.y,this.x)}get round(){return x.make(Math.round(this.x),Math.round(this.y))}get floor(){return x.make(Math.floor(this.x),Math.floor(this.y))}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}project_to(e){let t=e.length_squared,s=this.dot(e);return x.make(s*e.x/t,s*e.y/t)}distance(e){return this.sub(e).length}addy(e){return x.make(this.x,this.y+e)}add_angle(e){return x.from_angle(this.angle+e)}scale(e){let{clone:t}=this;return t.scale_in(e)}scale_in(e){return this.x*=e,this.y*=e,this}add(e){let{clone:t}=this;return t.add_in(e)}add_in(e){return this.x+=e.x,this.y+=e.y,this}sub(e){let{clone:t}=this;return t.sub_in(e)}sub_in(e){return this.x-=e.x,this.y-=e.y,this}mul(e){let{clone:t}=this;return t.mul_in(e)}mul_in(e){return this.x*=e.x,this.y*=e.y,this}div(e){let{clone:t}=this;return t.div_in(e)}div_in(e){return this.x/=e.x,this.y/=e.y,this}set_in(e,t=this.y){return this.x=e,this.y=t,this}};let b=x;m(b,"from_angle",e=>new x(Math.cos(e),Math.sin(e))),m(b,"make",(e,t)=>new x(e,t));const F=class{constructor(e,t,s,r,n,i){m(this,"array_t"),m(this,"a"),m(this,"b"),m(this,"c"),m(this,"d"),m(this,"tx"),m(this,"ty"),this.a=e,this.b=t,this.c=s,this.d=r,this.tx=n,this.ty=i,this.array_t=new Float32Array([e,t,0,s,r,0,n,i,1])}static get identity(){return new F(1,0,0,1,0,0)}static get unit(){return F.identity}get clone(){let{a:e,b:t,c:s,d:r,tx:n,ty:i}=this;return new F(e,t,s,r,n,i)}get inverse(){let{a:e,b:t,c:s,d:r,tx:n,ty:i}=this,l=e*r-t*s,o=r/l,h=-t/l,d=-s/l,a=e/l,p=(s*i-r*n)/l,k=-(e*i-t*n)/l;return new F(o,h,d,a,p,k)}rotate_in(e){let t=Math.cos(e),s=Math.sin(e),r=this.a*t-this.b*s,n=this.a*s+this.b*t,i=this.c*t-this.d*s,l=this.c*s+this.d*t,o=this.tx*t-this.ty*s,h=this.tx*s+this.ty*t;return this.a=r,this.b=n,this.c=i,this.d=l,this.tx=o,this.ty=h,this}rotate(e){let{clone:t}=this;return t.rotate_in(e),t}scale(e,t){let s=this.a*e,r=this.b,n=this.c,i=this.d*t,l=this.tx,o=this.ty;return new F(s,r,n,i,l,o)}translate_in(e,t){this.a,this.b,this.c,this.d;let s=e+this.tx,r=t+this.ty;return this.tx=s,this.ty=r,this}translate(e,t){let{clone:s}=this;return s.translate_in(e,t),s}scale_in(e,t){return this.a=e,this.d=t,this}mVec2(e){let t=this.a,s=this.b,r=this.c,n=this.d,i=this.tx,l=this.ty,o=t*e.x+r*e.y+i,h=s*e.x+n*e.y+l;return b.make(o,h)}mul_in(e){let{a:t,b:s,c:r,d:n,tx:i,ty:l}=this;this.a=e.a*t+e.b*r,this.b=e.a*s+e.b*n,this.c=e.c*t+e.d*r,this.d=e.c*s+e.d*n,this.tx=e.tx*t+e.ty*r+i,this.ty=e.tx*s+e.ty*n+l}set_in(e){let{a:t,b:s,c:r,d:n,tx:i,ty:l}=e;this.a=t,this.b=s,this.c=r,this.d=n,this.tx=i,this.ty=l}transform_in(e,t,s,r=b.unit.half){this.a=Math.cos(t)*e.x,this.b=Math.sin(t)*e.x,this.c=-Math.sin(t)*e.y,this.d=Math.cos(t)*e.y,this.tx=s.x-(r.x*this.a+r.y*this.c),this.ty=s.y-(r.x*this.b+r.y*this.d)}};let nt=F;m(nt,"projection",(e,t)=>{let s=0,r=0,n=1/e*2,i=-1/t*2,l=-1,o=1;return new F(n,s,r,i,l,o)});const re=class{constructor(e,t){m(this,"o"),m(this,"r"),this.o=e,this.r=t}static get unit(){return re.make(0,0,1)}scale(e){return re.make(this.o.x,this.o.y,this.r*e)}copy_in(e){return this.r=e.r,this.o=e.o,this}add_o_in(e){return this.o.add_in(e),this}};let it=re;m(it,"make",(e,t,s)=>new re(b.make(e,t),s));const Te=class{constructor(t,s){this.a=t,this.b=s}get center(){return this.b.add(this.a).half}get parallel(){return this.b.sub(this.a).normalize}get normal(){return this.parallel.perpendicular}get angle(){return this.b.sub(this.a).angle}get radius(){return this.length/2}get length(){return this.b.sub(this.a).length}segments(t,s){return t.map((r,n)=>this.a.add(this.normal.scale(s[n]).add(this.parallel.scale(this.length*r))))}};let ot=Te;m(ot,"make",(e,t,s,r)=>new Te(b.make(e,t),b.make(s,r)));const V=class{constructor(e){this.vertices=e}static get unit(){return V.make(0,0,1,1)}get vs(){let{x:e,y:t,w:s,h:r}=this;return[e,t,s,r]}get x1(){return this.vertices[0].x}get y1(){return this.vertices[0].y}get x2(){return this.vertices[2].x}get y2(){return this.vertices[2].y}get x(){return this.x1}get y(){return this.y1}get w(){return this.x2-this.x1}get h(){return this.y2-this.y1}get center(){return b.make(this.x+this.w/2,this.y+this.h/2)}get vertexData(){return new Float32Array(this.vertices.flatMap(e=>e.vs))}get indices(){return new Uint16Array([0,1,2,0,2,3])}larger(e){return V.make(this.x-e,this.y-e,this.w+e,this.h+e)}transform(e){return new V(this.vertices.map(t=>e.mVec2(t)))}};let lt=V;m(lt,"make",(e,t,s,r)=>new V([b.make(e,t),b.make(e+s,t),b.make(e+s,t+r),b.make(e,t+r)]));let ne=class De{constructor(){m(this,"m_rect"),m(this,"_$ref"),m(this,"_$clear_bounds"),this._$clear_bounds=M(void 0,{equals:!1}),this._$ref=M(),this.m_rect=$(()=>{var t;return U(this._$clear_bounds),(t=this.$ref)==null?void 0:t.getBoundingClientRect()})}static get make(){return new De}get $ref(){return U(this._$ref)}set $ref(t){H(this._$ref,t)}get_normal_at_abs_pos(t){let{size:s,orig:r}=this;if(s&&r)return t.sub(r).div(s)}get size(){let{rect:t}=this;if(t)return b.make(t.width,t.height)}get orig(){let{rect:t}=this;if(t)return b.make(t.x,t.y)}get rect(){return this.m_rect()}$clear_bounds(){H(this._$clear_bounds,void 0)}};function at(e){var t;return e.clientX!==void 0&&e.clientY!==void 0?[e.clientX,e.clientY]:(t=e.targetTouches)!=null&&t[0]?[e.targetTouches[0].clientX,e.targetTouches[0].clientY]:[0,0]}class qe{}m(qe,"init",(e,t=document)=>{const s=f=>{let S=at(f);return S?b.make(S[0],S[1]):b.zero};let{_onDragStart:r,_onDragMove:n,_onDragEnd:i,_onContextMenu:l,_onWheel:o}=e;const h=f=>{r==null||r(s(f),f.buttons===2||f.button===2)},d=f=>{n==null||n(s(f))},a=f=>{i==null||i(s(f))},p=f=>{l&&(f.preventDefault(),l())},k=f=>{o&&(o(Math.sign(f.deltaY)),f.preventDefault())};return t.addEventListener("wheel",k,{passive:!1}),t.addEventListener("touchstart",h,{capture:!0,passive:!1}),t.addEventListener("mousedown",h,{capture:!0,passive:!1}),t.addEventListener("contextmenu",p),document.addEventListener("mousemove",d),document.addEventListener("mouseup",a),document.addEventListener("touchmove",d),document.addEventListener("touchend",a),()=>{t.removeEventListener("wheel",k),t.removeEventListener("touchstart",h),t.removeEventListener("mousedown",h),t.removeEventListener("contextmenu",p),document.removeEventListener("mousemove",d),document.removeEventListener("mouseup",a),document.removeEventListener("touchmove",d),document.removeEventListener("touchend",a)}});const _e=(e,t)=>{te(Ve(()=>t.$ref,s=>{s&&Je(ht(e,s))}))},ht=(e,t)=>{let{on_wheel:s}=e;return qe.init({_onWheel(r){s(r)}},t)},ie=e=>t=>setTimeout(()=>e.$ref=t),Be="abcdefgh".split(""),me="87654321".split("");me.slice(0).reverse();const ct="wb".split(""),ut="rkqbnp".split("");ct.flatMap(e=>ut.map(t=>`${e}${t}`));const pe=Be.flatMap(e=>me.map(t=>`${e}${t}`)),dt=new Map(pe.map(e=>{let[t,s]=e.split(""),r=Be.indexOf(t),n=me.indexOf(s);return[e,b.make(r,n)]})),je=e=>{let t=dt.get(e);return(t.x+t.y)%2===0},_t=e=>!je(e);pe.filter(je);pe.filter(_t);const Fe=class{constructor(t){m(this,"released_positions"),this.free=t,this.released_positions=new Map}acquire_pos(t,s,r=!1){let n=this.released_positions.get(t);if(!r&&n&&n.length>0)return n.sort((i,l)=>l.distance(s)-i.distance(s)),n.pop();{let i=this.free.pop();return i.x=s.x,i.y=s.y,i}}reset_fix_all(){for(let t of this.released_positions.values())t.forEach(s=>this.free.push(s));this.released_positions=new Map}release_pos(t,s){let r=this.released_positions.get(t);r||(r=[],this.released_positions.set(t,r)),r.push(s)}};let ft=Fe;m(ft,"make",e=>new Fe(e));var mt=Object.defineProperty,pt=(e,t,s)=>t in e?mt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,E=(e,t,s)=>(pt(e,typeof t!="symbol"?t+"":t,s),s);function vt(e,t,s){let r=s.length,n=t.length,i=r,l=0,o=0,h=t[n-1].nextSibling,d=null;for(;l<n||o<i;){if(t[l]===s[o]){l++,o++;continue}for(;t[n-1]===s[i-1];)n--,i--;if(n===l){const a=i<r?o?s[o-1].nextSibling:s[i-o]:h;for(;o<i;)e.insertBefore(s[o++],a)}else if(i===o)for(;l<n;)(!d||!d.has(t[l]))&&t[l].remove(),l++;else if(t[l]===s[i-1]&&s[o]===t[n-1]){const a=t[--n].nextSibling;e.insertBefore(s[o++],t[l++].nextSibling),e.insertBefore(s[--i],a),t[n]=s[i]}else{if(!d){d=new Map;let p=o;for(;p<i;)d.set(s[p],p++)}const a=d.get(t[l]);if(a!=null)if(o<a&&a<i){let p=l,k=1,f;for(;++p<n&&p<i&&!((f=d.get(t[p]))==null||f!==a+k);)k++;if(k>a-o){const S=t[l];for(;o<a;)e.insertBefore(s[o++],S)}else e.replaceChild(s[o++],t[l++])}else l++;else t[l++].remove()}}}const we="_$DX_DELEGATE";function J(e,t,s){const r=document.createElement("template");r.innerHTML=e;let n=r.content.firstChild;return s&&(n=n.firstChild),n}function gt(e,t=window.document){const s=t[we]||(t[we]=new Set);for(let r=0,n=e.length;r<n;r++){const i=e[r];s.has(i)||(s.add(i),t.addEventListener(i,yt))}}function Ce(e,t){t==null?e.removeAttribute("class"):e.className=t}function A(e,t,s,r){if(s!==void 0&&!r&&(r=[]),typeof t!="function")return oe(e,t,r,s);W(n=>oe(e,t(),n,s),r)}function yt(e){const t=`$$${e.type}`;let s=e.composedPath&&e.composedPath()[0]||e.target;for(e.target!==s&&Object.defineProperty(e,"target",{configurable:!0,value:s}),Object.defineProperty(e,"currentTarget",{configurable:!0,get(){return s||document}}),q.registry&&!q.done&&(q.done=!0,document.querySelectorAll("[id^=pl-]").forEach(r=>r.remove()));s!==null;){const r=s[t];if(r&&!s.disabled){const n=s[`${t}Data`];if(n!==void 0?r.call(s,n,e):r.call(s,e),e.cancelBubble)return}s=s.host&&s.host!==s&&s.host instanceof Node?s.host:s.parentNode}}function oe(e,t,s,r,n){for(q.context&&!s&&(s=[...e.childNodes]);typeof s=="function";)s=s();if(t===s)return s;const i=typeof t,l=r!==void 0;if(e=l&&s[0]&&s[0].parentNode||e,i==="string"||i==="number"){if(q.context)return s;if(i==="number"&&(t=t.toString()),l){let o=s[0];o&&o.nodeType===3?o.data=t:o=document.createTextNode(t),s=P(e,s,r,o)}else s!==""&&typeof s=="string"?s=e.firstChild.data=t:s=e.textContent=t}else if(t==null||i==="boolean"){if(q.context)return s;s=P(e,s,r)}else{if(i==="function")return W(()=>{let o=t();for(;typeof o=="function";)o=o();s=oe(e,o,s,r)}),()=>s;if(Array.isArray(t)){const o=[],h=s&&Array.isArray(s);if(fe(o,t,s,n))return W(()=>s=oe(e,o,s,r,!0)),()=>s;if(q.context){if(!o.length)return s;for(let d=0;d<o.length;d++)if(o[d].parentNode)return s=o}if(o.length===0){if(s=P(e,s,r),l)return s}else h?s.length===0?Ee(e,o,r):vt(e,s,o):(s&&P(e),Ee(e,o));s=o}else if(t instanceof Node){if(q.context&&t.parentNode)return s=l?[t]:t;if(Array.isArray(s)){if(l)return s=P(e,s,r,t);P(e,s,null,t)}else s==null||s===""||!e.firstChild?e.appendChild(t):e.replaceChild(t,e.firstChild);s=t}}return s}function fe(e,t,s,r){let n=!1;for(let i=0,l=t.length;i<l;i++){let o=t[i],h=s&&s[i];if(o instanceof Node)e.push(o);else if(!(o==null||o===!0||o===!1))if(Array.isArray(o))n=fe(e,o,h)||n;else if(typeof o=="function")if(r){for(;typeof o=="function";)o=o();n=fe(e,Array.isArray(o)?o:[o],Array.isArray(h)?h:[h])||n}else e.push(o),n=!0;else{const d=String(o);h&&h.nodeType===3&&h.data===d?e.push(h):e.push(document.createTextNode(d))}}return n}function Ee(e,t,s){for(let r=0,n=t.length;r<n;r++)e.insertBefore(t[r],s)}function P(e,t,s,r){if(s===void 0)return e.textContent="";const n=r||document.createTextNode("");if(t.length){let i=!1;for(let l=t.length-1;l>=0;l--){const o=t[l];if(n!==o){const h=o.parentNode===e;!i&&!l?h?e.replaceChild(n,o):e.insertBefore(n,s):h&&o.remove()}else i=!0}}else e.insertBefore(n,s);return[n]}class bt{constructor(){E(this,"a_moves"),this.a_moves=Ge.make(this)}get tree(){return this.a_moves.tree}set moves(t){this.a_moves.moves=t}set on_path(t){this.a_moves.on_path=t}}const Oe=class{constructor(e){E(this,"m_tree"),E(this,"_moves"),E(this,"_hover_path"),E(this,"_on_path"),this.replay=e;let t=M(void 0,{equals:!1});this._hover_path=t;let s=M(void 0,{equals:!1});this._on_path=s;let r=M([]);this._moves=r;let n=$(Qe(r[0],Pe.make));function i(o){return $(()=>{let h=n().filter(a=>a.base===o),d=h.length>1;return h.map(a=>{let p=i(a.path)(),k;p.length>0&&(k=[p[0],p.slice(1)]);let f=a.ply%2===0,S=Math.ceil(a.ply/2)+(f?"...":"."),B=d||!f,j=$(()=>U(s)===a.path),w=$(()=>{var v;return((v=U(s))==null?void 0:v.slice(0,a.path.length))===a.path}),c=$(()=>U(t)===a.path),u=$(()=>{var v;return((v=U(t))==null?void 0:v.slice(0,a.path.length))===a.path}),y=$(()=>["move",j()?"on_hi":"",w()?"on_hi_sub":"",c()?"hi":"",u()?"hi_sub":""].join(" "));return{get klass(){return y()},a_move:a,index:S,show_index:B,main_children_and_rest:k}})})}let l=i("");this.m_tree=l}set on_path(e){H(this._on_path,e)}set hover_path(e){H(this._hover_path,t=>e)}get tree(){return this.m_tree()}set moves(e){H(this._moves,e)}};let Ge=Oe;E(Ge,"make",e=>new Oe(e));const ze=class{constructor(e){E(this,"ply"),E(this,"path"),E(this,"base"),E(this,"move"),E(this,"comments"),E(this,"klass");let t=e.match(/([^ ]*) ([^ ]*) \{([^\}]*)\}/),s,r,n,i;if(t){r=t[1],n=t[2];let[h,d,a]=t[3].match(/^(__[^\_]*__)?(.*)$/);s=a,i=(d==null?void 0:d.substring(2,d.length-2))||""}else[r,n]=e.split(" "),i="";let l=r.length===2?"":r.slice(0,-2),o=r.length/2;this.path=r,this.ply=o,this.base=l,this.move=n,this.comments=s,this.klass=i}};let Pe=ze;E(Pe,"make",e=>new ze(e));const xt=J('<div class="chessreplay"><div class="moves"></div></div>'),$t=J('<div class="lines"><div class="line"></div></div>'),kt=J('<div class="line"></div>'),wt=J('<div class="index"></div>'),Se=J("<div></div>");function Ue(e){let t=new bt;te(()=>{t.moves=e.moves}),te(()=>{t.on_path=e.on_path});const s=n=>{t.a_moves.hover_path=n},r=n=>{var i;t.a_moves.on_path=n,(i=e.on_click)==null||i.call(e,n)};return(()=>{const n=xt.cloneNode(!0),i=n.firstChild;return A(i,g(Le,{get each(){return t.tree},children:l=>[g(K,Q({on_click:r,on_hover:s},l)),g(I,{on_click:r,on_hover:s,get mcr(){return l.main_children_and_rest}})]})),n})()}const I=e=>e.mcr?g(ae,{get when(){return e.mcr[1].length},get fallback(){return[g(K,Q({get on_click(){return e.on_click},get on_hover(){return e.on_hover}},()=>e.mcr[0])),g(I,{get on_click(){return e.on_click},get on_hover(){return e.on_hover},get mcr(){return e.mcr[0].main_children_and_rest}})]},get children(){const t=$t.cloneNode(!0),s=t.firstChild;return A(s,g(K,Q({get on_click(){return e.on_click},get on_hover(){return e.on_hover}},()=>e.mcr[0])),null),A(s,g(I,{get on_click(){return e.on_click},get on_hover(){return e.on_hover},get mcr(){return e.mcr[0].main_children_and_rest}}),null),A(t,g(Le,{get each(){return e.mcr[1]},children:r=>(()=>{const n=kt.cloneNode(!0);return A(n,g(K,Q({get on_click(){return e.on_click},get on_hover(){return e.on_hover}},r)),null),A(n,g(I,{get on_click(){return e.on_click},get on_hover(){return e.on_hover},get mcr(){return r.main_children_and_rest}}),null),n})()}),null),t}}):[],K=e=>[(()=>{const t=Se.cloneNode(!0);return t.$$mouseover=s=>e.on_hover(e.a_move.path),t.addEventListener("mouseleave",s=>e.on_hover(void 0)),t.$$click=s=>e.on_click(e.a_move.path),A(t,g(ae,{get when(){return e.show_index},get children(){const s=wt.cloneNode(!0);return A(s,()=>e.index),s}}),null),A(t,()=>e.a_move.move,null),W(()=>Ce(t,e.klass+e.a_move.klass)),t})(),(()=>{const t=Se.cloneNode(!0);return A(t,()=>e.a_move.comments),W(()=>Ce(t,["comment",e.a_move.klass].join(" "))),t})()];gt(["click","mouseover"]);let Me=new Ke({emit(e){O.ai.local_eval(e),e.depth>=ee&&O.ai.crunch_one()}}),Ne=10,ee=16;const Ct=(e,t)=>{let[s,r]=tt.apply(e);return s.fen===t?[""]:r.filter(([n,i])=>i.fen===t).map(n=>n[0])},le=class{constructor(){D(this,"path_depths");D(this,"root");D(this,"nb_crunch");D(this,"on_root_changed");D(this,"on_crunch_done")}local_eval(t){Ct(this.root.root,t.fen).forEach(r=>{this.path_depths.set(r,t.depth),t.pvs.forEach(n=>{let i=r;n.cp/100,n.depth;let l=n.moves.slice(0,4);for(let o of l){if(this.root.node_at_path(i).children.find(a=>a.uci===o))break;i=this.root.add_move(i,o,void 0)}})}),this.on_root_changed()}crunch_one(){if(this.nb_crunch++,this.nb_crunch===Ne&&(Me.stop(),this.on_crunch_done()),this.nb_crunch>Ne)return;let t=!1;et.breadfirst(this.root.root,(s,r)=>{let n=this.path_depths.get(s);if(!n||n<ee){let l=this.root.root.node_list(s).map((o,h)=>({ply:h,uci:o.uci,fen:o.fen,san:""}));return t=!0,Me.start("",l),!0}return!1}),t||(console.log("here"),setTimeout(()=>this.on_crunch_done()))}};let O=le;D(O,"ai",new le),D(O,"make",(t,s,r)=>{let{ai:n}=le;n.root=t,n.nb_crunch=0,n.path_depths=new Map;let i=t.flat_export[1].map(l=>l[0]);return i.forEach(l=>n.path_depths.set(l,ee)),t.root.child_paths.filter(l=>l.length%4===2).forEach(l=>n.path_depths.delete(l)),i.length>0&&n.path_depths.set("",ee),n.on_root_changed=s,n.on_crunch_done=r,n.crunch_one(),n});const Et=he('<div class="guess-app"></div>'),St=he('<div class="opening-prep-scene"><div class="board"></div><div class="table"><div class="info"></div><div class="replay"></div><div class="controls"><button>Delete move</button><button>Delete Siblings</button></div><div class="action"></div></div></div>'),Mt=he('<button class="primary">Compare AI</button>'),Nt=he('<div class="opening-prep-scene"><div class="board"></div><div class="table"><div class="info">1. Build your opening repertoire as a preset</div><div class="replay"></div><div class="controls"><button>Delete variation</button></div><div class="action"><div>2. Create a challenge</div><h3> Select a color </h3><div class="packs colors"><div class="pack"><span> White </span></div><div class="pack"><span> Black </span></div><div class="pack"><span> Random </span></div></div><button class="primary">Start Game</button></div></div></div>'),Ot=()=>[g(Ze,{children:" aidchess.com - Guess Lines "}),(()=>{const e=Et.cloneNode(!0);return Y(e,g(ae,{when:!0,get fallback(){return g(At,{on_start:t=>{}})},get children(){return g(Lt,{})}})),e})()],Lt=()=>{const[e,t]=M(""),[s,r]=M(ke.make(),{equals:!1}),[n,i]=M(de.get_replay(),{equals:!1}),[l,o]=M(!1),h=()=>{o(!0);const c=O.make(s(),()=>{},()=>{let[u,y]=ke.diff_trees(n(),c.root),v=u.filter(_=>_.length%4===2),C=u.filter(_=>_.length%4===0),N=y.filter(_=>_.length%4===0);i(_=>(C.forEach(L=>_.delete_path(L)),_)),i(_=>(N.forEach(L=>{let X=c.root.node_at_path(L);_.add_move(Z(L),X.uci)}),_)),r(n().clone),r(_=>(v.forEach(L=>_.delete_children(L)),_)),o(!1)})},d=$(()=>n().node_at_path(e())),a=$(()=>{let c=n().root.child_paths,u=s().moves().map(v=>{let[C,N,_]=v.split(" ");return c.includes(C)?_="{__base child__}":_="{__base__}",[C,N,_].join(" ")}),y=n().moves().filter(v=>!u.find(C=>C.split(" ")[0]===v.split(" ")[0])).map(v=>{let[C,N,_]=v.split(" ");return _="{__ghost__}",[C,N,_].join(" ")});return[...u,...y]});$(()=>n().chess(e()));const p=$(()=>n().fen(e())),k=c=>{let u;i(y=>(u=y.add_move(e(),c),y)),u&&t(u)},f=()=>{let c=e();r(u=>(u.delete_path(e()),u)),i(u=>(u.delete_path(e()),u)),t(Z(c))},S=()=>{e(),r(c=>(c.delete_siblings(e()),c)),i(c=>(c.delete_siblings(e()),c))};let B=ne.make,j=ne.make;return _e({on_wheel:c=>{var u;if(c<0)t(y=>Z(y));else{const y=(u=d())==null?void 0:u.children[0];y&&t(v=>v+y.id)}}},B),(()=>{const c=St.cloneNode(!0),u=c.firstChild,y=u.nextSibling,v=y.firstChild,C=v.nextSibling,N=C.nextSibling,_=N.firstChild,L=_.nextSibling,X=N.nextSibling,R=ie(B);typeof R=="function"&&se(R,u),Y(u,g(Ae,{glyphs:[],get fen(){return p()},isBlack:!1,onUserMove:k}));const G=ie(j);return typeof G=="function"&&se(G,C),Y(C,g(Ue,{get moves(){return a()},get on_path(){return e()},on_click:z=>t(z)})),_.$$click=f,L.$$click=S,Y(X,g(ae,{get when(){return l()},get fallback(){return(()=>{const z=Mt.cloneNode(!0);return z.$$click=h,z})()},children:"Comparing..."})),c})()},At=e=>{const[t,s]=M(""),[r,n]=M(de.get_replay(),{equals:!1});te(()=>{de.set_replay(r())});const i=$(()=>r().node_at_path(t())),l=$(()=>r().moves());$(()=>r().chess(t()));const o=$(()=>r().fen(t())),h=w=>{let c;n(u=>(c=u.add_move(t(),w),u)),c&&s(c)},d=()=>{let w;n(c=>(w=c.delete_variation(t()),c)),w!==void 0&&s(w)},[a,p]=M(),k=()=>{e.on_start(a())};let f=ne.make,S=ne.make;const B=w=>{var c;if(w<0)s(u=>Z(u));else{const u=(c=i())==null?void 0:c.children[0];u&&s(y=>y+u.id)}};_e({on_wheel:B},f),_e({on_wheel:B},S);const j=w=>a()===w?"primary selected":"primary";return(()=>{const w=Nt.cloneNode(!0),c=w.firstChild,u=c.nextSibling,y=u.firstChild,v=y.nextSibling,C=v.nextSibling,N=C.firstChild,_=C.nextSibling,L=_.firstChild,X=L.nextSibling,R=X.nextSibling,G=R.firstChild,z=G.firstChild,ce=G.nextSibling,Ye=ce.firstChild,ve=ce.nextSibling,We=ve.firstChild,Xe=R.nextSibling,ge=ie(f);typeof ge=="function"&&se(ge,c),Y(c,g(Ae,{glyphs:[],get fen(){return o()},isBlack:!1,onUserMove:h}));const ye=ie(S);return typeof ye=="function"&&se(ye,v),Y(v,g(Ue,{get moves(){return l()},get on_path(){return t()},on_click:T=>s(T)})),N.$$click=d,G.$$click=()=>p("w"),ce.$$click=()=>p("b"),ve.$$click=()=>p(),Xe.$$click=k,W(T=>{const be=j("w"),xe=j("b"),$e=j(void 0);return be!==T._v$&&ue(z,T._v$=be),xe!==T._v$2&&ue(Ye,T._v$2=xe),$e!==T._v$3&&ue(We,T._v$3=$e),T},{_v$:void 0,_v$2:void 0,_v$3:void 0}),w})()};Ie(["click"]);export{Ot as default};
