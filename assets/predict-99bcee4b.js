var Qt=Object.defineProperty;var Jt=(e,t,s)=>t in e?Qt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var z=(e,t,s)=>(Jt(e,typeof t!="symbol"?t+"":t,s),s);import{c as F,T as Zt,i as se,S as pt,t as Le,a as X,b as I,j as ge,h as es,d as ts,e as qe,f as ss}from"./index-fa40aec7.js";import{C as ns,G as _t}from"./ctrl-e0179c1f.js";import{N as rs,F as is,R as st,a as Fe,i as Ge}from"./store-dbbc54ee.js";const M={};function Re(e){M.context=e}function ls(){return{...M.context,id:`${M.context.id}${M.context.count++}-`,count:0}}const os=(e,t)=>e===t,as=Symbol("solid-proxy"),cs=Symbol("solid-track"),be={equals:os};let vt=yt;const W=1,ye=2,mt={owned:null,cleanups:null,context:null,owner:null};var w=null;let K=null,x=null,C=null,G=null,Ie=0;function Be(e,t){const s=x,n=w,r=e.length===0,i=r?mt:{owned:null,cleanups:null,context:null,owner:t||n},l=r?e:()=>e(()=>ne(()=>Ye(i)));w=i,x=null;try{return ce(l,!0)}finally{x=s,w=n}}function de(e,t){t=t?Object.assign({},be,t):be;const s={value:e,observers:null,observerSlots:null,comparator:t.equals||void 0},n=r=>(typeof r=="function"&&(r=r(s.value)),bt(s,r));return[gt.bind(s),n]}function le(e,t,s){const n=We(e,t,!1,W);ae(n)}function nt(e,t,s){vt=ds;const n=We(e,t,!1,W),r=rt&&wt(w,rt.id);r&&(n.suspense=r),n.user=!0,G?G.push(n):ae(n)}function q(e,t,s){s=s?Object.assign({},be,s):be;const n=We(e,t,!0,0);return n.observers=null,n.observerSlots=null,n.comparator=s.equals||void 0,ae(n),gt.bind(n)}function ne(e){let t,s=x;return x=null,t=e(),x=s,t}function us(e){return w===null||(w.cleanups===null?w.cleanups=[e]:w.cleanups.push(e)),e}let rt;function gt(){const e=K;if(this.sources&&(this.state||e))if(this.state===W||e)ae(this);else{const t=C;C=null,ce(()=>$e(this),!1),C=t}if(x){const t=this.observers?this.observers.length:0;x.sources?(x.sources.push(this),x.sourceSlots.push(t)):(x.sources=[this],x.sourceSlots=[t]),this.observers?(this.observers.push(x),this.observerSlots.push(x.sources.length-1)):(this.observers=[x],this.observerSlots=[x.sources.length-1])}return this.value}function bt(e,t,s){let n=e.value;return(!e.comparator||!e.comparator(n,t))&&(e.value=t,e.observers&&e.observers.length&&ce(()=>{for(let r=0;r<e.observers.length;r+=1){const i=e.observers[r],l=K&&K.running;l&&K.disposed.has(i),(l&&!i.tState||!l&&!i.state)&&(i.pure?C.push(i):G.push(i),i.observers&&xt(i)),l||(i.state=W)}if(C.length>1e6)throw C=[],new Error},!1)),t}function ae(e){if(!e.fn)return;Ye(e);const t=w,s=x,n=Ie;x=w=e,hs(e,e.value,n),x=s,w=t}function hs(e,t,s){let n;try{n=e.fn(t)}catch(r){e.pure&&(e.state=W),$t(r)}(!e.updatedAt||e.updatedAt<=s)&&(e.updatedAt!=null&&"observers"in e?bt(e,n):e.value=n,e.updatedAt=s)}function We(e,t,s,n=W,r){const i={fn:e,state:n,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:w,context:null,pure:s};return w===null||w!==mt&&(w.owned?w.owned.push(i):w.owned=[i]),i}function xe(e){const t=K;if(e.state===0||t)return;if(e.state===ye||t)return $e(e);if(e.suspense&&ne(e.suspense.inFallback))return e.suspense.effects.push(e);const s=[e];for(;(e=e.owner)&&(!e.updatedAt||e.updatedAt<Ie);)(e.state||t)&&s.push(e);for(let n=s.length-1;n>=0;n--)if(e=s[n],e.state===W||t)ae(e);else if(e.state===ye||t){const r=C;C=null,ce(()=>$e(e,s[0]),!1),C=r}}function ce(e,t){if(C)return e();let s=!1;t||(C=[]),G?s=!0:G=[],Ie++;try{const n=e();return fs(s),n}catch(n){C||(G=null),$t(n)}}function fs(e){if(C&&(yt(C),C=null),e)return;const t=G;G=null,t.length&&ce(()=>vt(t),!1)}function yt(e){for(let t=0;t<e.length;t++)xe(e[t])}function ds(e){let t,s=0;for(t=0;t<e.length;t++){const n=e[t];n.user?e[s++]=n:xe(n)}for(M.context&&Re(),t=0;t<s;t++)xe(e[t])}function $e(e,t){const s=K;e.state=0;for(let n=0;n<e.sources.length;n+=1){const r=e.sources[n];r.sources&&(r.state===W||s?r!==t&&xe(r):(r.state===ye||s)&&$e(r,t))}}function xt(e){const t=K;for(let s=0;s<e.observers.length;s+=1){const n=e.observers[s];(!n.state||t)&&(n.state=ye,n.pure?C.push(n):G.push(n),n.observers&&xt(n))}}function Ye(e){let t;if(e.sources)for(;e.sources.length;){const s=e.sources.pop(),n=e.sourceSlots.pop(),r=s.observers;if(r&&r.length){const i=r.pop(),l=s.observerSlots.pop();n<r.length&&(i.sourceSlots[l]=n,r[n]=i,s.observerSlots[n]=l)}}if(e.owned){for(t=0;t<e.owned.length;t++)Ye(e.owned[t]);e.owned=null}if(e.cleanups){for(t=0;t<e.cleanups.length;t++)e.cleanups[t]();e.cleanups=null}e.state=0,e.context=null}function ps(e){return e instanceof Error||typeof e=="string"?e:new Error("Unknown error")}function $t(e){throw e=ps(e),e}function wt(e,t){return e?e.context&&e.context[t]!==void 0?e.context[t]:wt(e.owner,t):void 0}const _s=Symbol("fallback");function it(e){for(let t=0;t<e.length;t++)e[t]()}function kt(e,t,s={}){let n=[],r=[],i=[],l=0,o=t.length>1?[]:null;return us(()=>it(i)),()=>{let u=e()||[],c,a;return u[cs],ne(()=>{let _=u.length,p,y,L,O,d,h,f,v,m;if(_===0)l!==0&&(it(i),i=[],n=[],r=[],l=0,o&&(o=[])),s.fallback&&(n=[_s],r[0]=Be(N=>(i[0]=N,s.fallback())),l=1);else if(l===0){for(r=new Array(_),a=0;a<_;a++)n[a]=u[a],r[a]=Be(g);l=_}else{for(L=new Array(_),O=new Array(_),o&&(d=new Array(_)),h=0,f=Math.min(l,_);h<f&&n[h]===u[h];h++);for(f=l-1,v=_-1;f>=h&&v>=h&&n[f]===u[v];f--,v--)L[v]=r[f],O[v]=i[f],o&&(d[v]=o[f]);for(p=new Map,y=new Array(v+1),a=v;a>=h;a--)m=u[a],c=p.get(m),y[a]=c===void 0?-1:c,p.set(m,a);for(c=h;c<=f;c++)m=n[c],a=p.get(m),a!==void 0&&a!==-1?(L[a]=r[c],O[a]=i[c],o&&(d[a]=o[c]),a=y[a],p.set(m,a)):i[c]();for(a=h;a<_;a++)a in L?(r[a]=L[a],i[a]=O[a],o&&(o[a]=d[a],o[a](a))):r[a]=Be(g);r=r.slice(0,l=_),n=u.slice(0)}return r});function g(_){if(i[a]=_,o){const[p,y]=de(a);return o[a]=y,t(u[a],p)}return t(u[a])}}}let vs=!1;function U(e,t){if(vs&&M.context){const s=M.context;Re(ls());const n=ne(()=>e(t||{}));return Re(s),n}return ne(()=>e(t||{}))}function fe(){return!0}const ms={get(e,t,s){return t===as?s:e.get(t)},has(e,t){return e.has(t)},set:fe,deleteProperty:fe,getOwnPropertyDescriptor(e,t){return{configurable:!0,enumerable:!0,get(){return e.get(t)},set:fe,deleteProperty:fe}},ownKeys(e){return e.keys()}};function Pe(e){return(e=typeof e=="function"?e():e)==null?{}:e}function pe(...e){return new Proxy({get(t){for(let s=e.length-1;s>=0;s--){const n=Pe(e[s])[t];if(n!==void 0)return n}},has(t){for(let s=e.length-1;s>=0;s--)if(t in Pe(e[s]))return!0;return!1},keys(){const t=[];for(let s=0;s<e.length;s++)t.push(...Object.keys(Pe(e[s])));return[...new Set(t)]}},ms)}function St(e){const t="fallback"in e&&{fallback:()=>e.fallback};return q(kt(()=>e.each,e.children,t||void 0))}function Et(e){let t=!1;const s=e.keyed,n=q(()=>e.when,void 0,{equals:(r,i)=>t?r===i:!r==!i});return q(()=>{const r=n();if(r){const i=e.children,l=typeof i=="function"&&i.length>0;return t=s||l,l?ne(()=>i(r)):i}return e.fallback})}const gs=(e,t)=>e===t,we={equals:gs};let Ct=Lt;const J=1,ke=2,bs={owned:null,cleanups:null,context:null,owner:null};var T=null;let Q=null,E=null,A=null,R=null,Ve=0;function lt(e,t){t=t?Object.assign({},we,t):we;const s={value:e,observers:null,observerSlots:null,comparator:t.equals||void 0},n=r=>(typeof r=="function"&&(r=r(s.value)),Mt(s,r));return[Nt.bind(s),n]}function ys(e,t,s){Ct=Es;const n=Tt(e,t,!1,J),r=ot&&jt(T,ot.id);r&&(n.suspense=r),n.user=!0,R?R.push(n):Oe(n)}function xs(e,t,s){s=s?Object.assign({},we,s):we;const n=Tt(e,t,!0,0);return n.observers=null,n.observerSlots=null,n.comparator=s.equals||void 0,Oe(n),Nt.bind(n)}function At(e){let t,s=E;return E=null,t=e(),E=s,t}function $s(e,t,s){const n=Array.isArray(e);let r,i=s&&s.defer;return l=>{let o;if(n){o=Array(e.length);for(let c=0;c<e.length;c++)o[c]=e[c]()}else o=e();if(i){i=!1;return}const u=At(()=>t(o,r,l));return r=o,u}}function ws(e){return T===null||(T.cleanups===null?T.cleanups=[e]:T.cleanups.push(e)),e}let ot;function Nt(){const e=Q;if(this.sources&&(this.state||e))if(this.state===J||e)Oe(this);else{const t=A;A=null,De(()=>Ee(this),!1),A=t}if(E){const t=this.observers?this.observers.length:0;E.sources?(E.sources.push(this),E.sourceSlots.push(t)):(E.sources=[this],E.sourceSlots=[t]),this.observers?(this.observers.push(E),this.observerSlots.push(E.sources.length-1)):(this.observers=[E],this.observerSlots=[E.sources.length-1])}return this.value}function Mt(e,t,s){let n=e.value;return(!e.comparator||!e.comparator(n,t))&&(e.value=t,e.observers&&e.observers.length&&De(()=>{for(let r=0;r<e.observers.length;r+=1){const i=e.observers[r],l=Q&&Q.running;l&&Q.disposed.has(i),(l&&!i.tState||!l&&!i.state)&&(i.pure?A.push(i):R.push(i),i.observers&&Ot(i)),l||(i.state=J)}if(A.length>1e6)throw A=[],new Error},!1)),t}function Oe(e){if(!e.fn)return;Dt(e);const t=T,s=E,n=Ve;E=T=e,ks(e,e.value,n),E=s,T=t}function ks(e,t,s){let n;try{n=e.fn(t)}catch(r){e.pure&&(e.state=J),Ut(r)}(!e.updatedAt||e.updatedAt<=s)&&(e.updatedAt!=null&&"observers"in e?Mt(e,n):e.value=n,e.updatedAt=s)}function Tt(e,t,s,n=J,r){const i={fn:e,state:n,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:T,context:null,pure:s};return T===null||T!==bs&&(T.owned?T.owned.push(i):T.owned=[i]),i}function Se(e){const t=Q;if(e.state===0||t)return;if(e.state===ke||t)return Ee(e);if(e.suspense&&At(e.suspense.inFallback))return e.suspense.effects.push(e);const s=[e];for(;(e=e.owner)&&(!e.updatedAt||e.updatedAt<Ve);)(e.state||t)&&s.push(e);for(let n=s.length-1;n>=0;n--)if(e=s[n],e.state===J||t)Oe(e);else if(e.state===ke||t){const r=A;A=null,De(()=>Ee(e,s[0]),!1),A=r}}function De(e,t){if(A)return e();let s=!1;t||(A=[]),R?s=!0:R=[],Ve++;try{const n=e();return Ss(s),n}catch(n){A||(R=null),Ut(n)}}function Ss(e){if(A&&(Lt(A),A=null),e)return;const t=R;R=null,t.length&&De(()=>Ct(t),!1)}function Lt(e){for(let t=0;t<e.length;t++)Se(e[t])}function Es(e){let t,s=0;for(t=0;t<e.length;t++){const n=e[t];n.user?e[s++]=n:Se(n)}for(t=0;t<s;t++)Se(e[t])}function Ee(e,t){const s=Q;e.state=0;for(let n=0;n<e.sources.length;n+=1){const r=e.sources[n];r.sources&&(r.state===J||s?r!==t&&Se(r):(r.state===ke||s)&&Ee(r,t))}}function Ot(e){const t=Q;for(let s=0;s<e.observers.length;s+=1){const n=e.observers[s];(!n.state||t)&&(n.state=ke,n.pure?A.push(n):R.push(n),n.observers&&Ot(n))}}function Dt(e){let t;if(e.sources)for(;e.sources.length;){const s=e.sources.pop(),n=e.sourceSlots.pop(),r=s.observers;if(r&&r.length){const i=r.pop(),l=s.observerSlots.pop();n<r.length&&(i.sourceSlots[l]=n,r[n]=i,s.observerSlots[n]=l)}}if(e.owned){for(t=0;t<e.owned.length;t++)Dt(e.owned[t]);e.owned=null}if(e.cleanups){for(t=0;t<e.cleanups.length;t++)e.cleanups[t]();e.cleanups=null}e.state=0,e.context=null}function Cs(e){return e instanceof Error||typeof e=="string"?e:new Error("Unknown error")}function Ut(e){throw e=Cs(e),e}function jt(e,t){return e?e.context&&e.context[t]!==void 0?e.context[t]:jt(e.owner,t):void 0}var As=Object.defineProperty,Ns=(e,t,s)=>t in e?As(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,b=(e,t,s)=>(Ns(e,typeof t!="symbol"?t+"":t,s),s);const te=e=>e[0](),re=(e,t)=>typeof t=="function"?e[1](t):e[1](s=>t),S=class{constructor(e,t){b(this,"x"),b(this,"y"),this.x=e,this.y=t}static get unit(){return new S(1,1)}static get zero(){return new S(0,0)}get vs(){return[this.x,this.y]}get mul_inverse(){return new S(1/this.x,1/this.y)}get inverse(){return new S(-this.x,-this.y)}get half(){return new S(this.x/2,this.y/2)}get length_squared(){return this.x*this.x+this.y*this.y}get length(){return Math.sqrt(this.length_squared)}get normalize(){return this.length===0?S.zero:this.scale(1/this.length)}get perpendicular(){return new S(-this.y,this.x)}get clone(){return new S(this.x,this.y)}get angle(){return Math.atan2(this.y,this.x)}get round(){return S.make(Math.round(this.x),Math.round(this.y))}get floor(){return S.make(Math.floor(this.x),Math.floor(this.y))}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}project_to(e){let t=e.length_squared,s=this.dot(e);return S.make(s*e.x/t,s*e.y/t)}distance(e){return this.sub(e).length}addy(e){return S.make(this.x,this.y+e)}add_angle(e){return S.from_angle(this.angle+e)}scale(e){let{clone:t}=this;return t.scale_in(e)}scale_in(e){return this.x*=e,this.y*=e,this}add(e){let{clone:t}=this;return t.add_in(e)}add_in(e){return this.x+=e.x,this.y+=e.y,this}sub(e){let{clone:t}=this;return t.sub_in(e)}sub_in(e){return this.x-=e.x,this.y-=e.y,this}mul(e){let{clone:t}=this;return t.mul_in(e)}mul_in(e){return this.x*=e.x,this.y*=e.y,this}div(e){let{clone:t}=this;return t.div_in(e)}div_in(e){return this.x/=e.x,this.y/=e.y,this}set_in(e,t=this.y){return this.x=e,this.y=t,this}};let k=S;b(k,"from_angle",e=>new S(Math.cos(e),Math.sin(e))),b(k,"make",(e,t)=>new S(e,t));const V=class{constructor(e,t,s,n,r,i){b(this,"array_t"),b(this,"a"),b(this,"b"),b(this,"c"),b(this,"d"),b(this,"tx"),b(this,"ty"),this.a=e,this.b=t,this.c=s,this.d=n,this.tx=r,this.ty=i,this.array_t=new Float32Array([e,t,0,s,n,0,r,i,1])}static get identity(){return new V(1,0,0,1,0,0)}static get unit(){return V.identity}get clone(){let{a:e,b:t,c:s,d:n,tx:r,ty:i}=this;return new V(e,t,s,n,r,i)}get inverse(){let{a:e,b:t,c:s,d:n,tx:r,ty:i}=this,l=e*n-t*s,o=n/l,u=-t/l,c=-s/l,a=e/l,g=(s*i-n*r)/l,_=-(e*i-t*r)/l;return new V(o,u,c,a,g,_)}rotate_in(e){let t=Math.cos(e),s=Math.sin(e),n=this.a*t-this.b*s,r=this.a*s+this.b*t,i=this.c*t-this.d*s,l=this.c*s+this.d*t,o=this.tx*t-this.ty*s,u=this.tx*s+this.ty*t;return this.a=n,this.b=r,this.c=i,this.d=l,this.tx=o,this.ty=u,this}rotate(e){let{clone:t}=this;return t.rotate_in(e),t}scale(e,t){let s=this.a*e,n=this.b,r=this.c,i=this.d*t,l=this.tx,o=this.ty;return new V(s,n,r,i,l,o)}translate_in(e,t){this.a,this.b,this.c,this.d;let s=e+this.tx,n=t+this.ty;return this.tx=s,this.ty=n,this}translate(e,t){let{clone:s}=this;return s.translate_in(e,t),s}scale_in(e,t){return this.a=e,this.d=t,this}mVec2(e){let t=this.a,s=this.b,n=this.c,r=this.d,i=this.tx,l=this.ty,o=t*e.x+n*e.y+i,u=s*e.x+r*e.y+l;return k.make(o,u)}mul_in(e){let{a:t,b:s,c:n,d:r,tx:i,ty:l}=this;this.a=e.a*t+e.b*n,this.b=e.a*s+e.b*r,this.c=e.c*t+e.d*n,this.d=e.c*s+e.d*r,this.tx=e.tx*t+e.ty*n+i,this.ty=e.tx*s+e.ty*r+l}set_in(e){let{a:t,b:s,c:n,d:r,tx:i,ty:l}=e;this.a=t,this.b=s,this.c=n,this.d=r,this.tx=i,this.ty=l}transform_in(e,t,s,n=k.unit.half){this.a=Math.cos(t)*e.x,this.b=Math.sin(t)*e.x,this.c=-Math.sin(t)*e.y,this.d=Math.cos(t)*e.y,this.tx=s.x-(n.x*this.a+n.y*this.c),this.ty=s.y-(n.x*this.b+n.y*this.d)}};let Ms=V;b(Ms,"projection",(e,t)=>{let s=0,n=0,r=1/e*2,i=-1/t*2,l=-1,o=1;return new V(r,s,n,i,l,o)});const Ce=class{constructor(e,t){b(this,"o"),b(this,"r"),this.o=e,this.r=t}static get unit(){return Ce.make(0,0,1)}scale(e){return Ce.make(this.o.x,this.o.y,this.r*e)}copy_in(e){return this.r=e.r,this.o=e.o,this}add_o_in(e){return this.o.add_in(e),this}};let Ts=Ce;b(Ts,"make",(e,t,s)=>new Ce(k.make(e,t),s));const qt=class{constructor(t,s){this.a=t,this.b=s}get center(){return this.b.add(this.a).half}get parallel(){return this.b.sub(this.a).normalize}get normal(){return this.parallel.perpendicular}get angle(){return this.b.sub(this.a).angle}get radius(){return this.length/2}get length(){return this.b.sub(this.a).length}segments(t,s){return t.map((n,r)=>this.a.add(this.normal.scale(s[r]).add(this.parallel.scale(this.length*n))))}};let Ls=qt;b(Ls,"make",(e,t,s,n)=>new qt(k.make(e,t),k.make(s,n)));const ie=class{constructor(e){this.vertices=e}static get unit(){return ie.make(0,0,1,1)}get vs(){let{x:e,y:t,w:s,h:n}=this;return[e,t,s,n]}get x1(){return this.vertices[0].x}get y1(){return this.vertices[0].y}get x2(){return this.vertices[2].x}get y2(){return this.vertices[2].y}get x(){return this.x1}get y(){return this.y1}get w(){return this.x2-this.x1}get h(){return this.y2-this.y1}get center(){return k.make(this.x+this.w/2,this.y+this.h/2)}get vertexData(){return new Float32Array(this.vertices.flatMap(e=>e.vs))}get indices(){return new Uint16Array([0,1,2,0,2,3])}larger(e){return ie.make(this.x-e,this.y-e,this.w+e,this.h+e)}transform(e){return new ie(this.vertices.map(t=>e.mVec2(t)))}};let Os=ie;b(Os,"make",(e,t,s,n)=>new ie([k.make(e,t),k.make(e+s,t),k.make(e+s,t+n),k.make(e,t+n)]));let oe=class{constructor(){b(this,"m_rect"),b(this,"_$ref"),b(this,"_$clear_bounds"),this._$clear_bounds=lt(void 0,{equals:!1}),this._$ref=lt(),this.m_rect=xs(()=>{var t;return te(this._$clear_bounds),(t=this.$ref)==null?void 0:t.getBoundingClientRect()})}static get make(){return new oe}get $ref(){return te(this._$ref)}set $ref(t){re(this._$ref,t)}get_normal_at_abs_pos(t){let{size:s,orig:n}=this;if(s&&n)return t.sub(n).div(s)}get size(){let{rect:t}=this;if(t)return k.make(t.width,t.height)}get orig(){let{rect:t}=this;if(t)return k.make(t.x,t.y)}get rect(){return this.m_rect()}$clear_bounds(){re(this._$clear_bounds,void 0)}};function Ds(e){var t;return e.clientX!==void 0&&e.clientY!==void 0?[e.clientX,e.clientY]:(t=e.targetTouches)!=null&&t[0]?[e.targetTouches[0].clientX,e.targetTouches[0].clientY]:[0,0]}class Bt{}b(Bt,"init",(e,t=document)=>{const s=p=>{let y=Ds(p);return y?k.make(y[0],y[1]):k.zero};let{_onDragStart:n,_onDragMove:r,_onDragEnd:i,_onContextMenu:l,_onWheel:o}=e;const u=p=>{n==null||n(s(p),p.buttons===2||p.button===2)},c=p=>{r==null||r(s(p))},a=p=>{i==null||i(s(p))},g=p=>{l&&(p.preventDefault(),l())},_=p=>{o&&(o(Math.sign(p.deltaY)),p.preventDefault())};return t.addEventListener("wheel",_,{passive:!1}),t.addEventListener("touchstart",u,{capture:!0,passive:!1}),t.addEventListener("mousedown",u,{capture:!0,passive:!1}),t.addEventListener("contextmenu",g),document.addEventListener("mousemove",c),document.addEventListener("mouseup",a),document.addEventListener("touchmove",c),document.addEventListener("touchend",a),()=>{t.removeEventListener("wheel",_),t.removeEventListener("touchstart",u),t.removeEventListener("mousedown",u),t.removeEventListener("contextmenu",g),document.removeEventListener("mousemove",c),document.removeEventListener("mouseup",a),document.removeEventListener("touchmove",c),document.removeEventListener("touchend",a)}});const Ae=(e,t)=>{ys($s(()=>t.$ref,s=>{s&&ws(Us(e,s))}))},Us=(e,t)=>{let{on_wheel:s}=e;return Bt.init({_onWheel(n){s(n)}},t)},Ne=e=>t=>setTimeout(()=>e.$ref=t),Pt="abcdefgh".split(""),Xe="87654321".split("");Xe.slice(0).reverse();const js="wb".split(""),qs="rkqbnp".split("");js.flatMap(e=>qs.map(t=>`${e}${t}`));const He=Pt.flatMap(e=>Xe.map(t=>`${e}${t}`)),Bs=new Map(He.map(e=>{let[t,s]=e.split(""),n=Pt.indexOf(t),r=Xe.indexOf(s);return[e,k.make(n,r)]})),Ft=e=>{let t=Bs.get(e);return(t.x+t.y)%2===0},Ps=e=>!Ft(e);He.filter(Ft);He.filter(Ps);const Gt=class{constructor(t){b(this,"released_positions"),this.free=t,this.released_positions=new Map}acquire_pos(t,s,n=!1){let r=this.released_positions.get(t);if(!n&&r&&r.length>0)return r.sort((i,l)=>l.distance(s)-i.distance(s)),r.pop();{let i=this.free.pop();return i.x=s.x,i.y=s.y,i}}reset_fix_all(){for(let t of this.released_positions.values())t.forEach(s=>this.free.push(s));this.released_positions=new Map}release_pos(t,s){let n=this.released_positions.get(t);n||(n=[],this.released_positions.set(t,n)),n.push(s)}};let Fs=Gt;b(Fs,"make",e=>new Gt(e));var Gs=Object.defineProperty,Rs=(e,t,s)=>t in e?Gs(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,D=(e,t,s)=>(Rs(e,typeof t!="symbol"?t+"":t,s),s);function zs(e,t,s){let n=s.length,r=t.length,i=n,l=0,o=0,u=t[r-1].nextSibling,c=null;for(;l<r||o<i;){if(t[l]===s[o]){l++,o++;continue}for(;t[r-1]===s[i-1];)r--,i--;if(r===l){const a=i<n?o?s[o-1].nextSibling:s[i-o]:u;for(;o<i;)e.insertBefore(s[o++],a)}else if(i===o)for(;l<r;)(!c||!c.has(t[l]))&&t[l].remove(),l++;else if(t[l]===s[i-1]&&s[o]===t[r-1]){const a=t[--r].nextSibling;e.insertBefore(s[o++],t[l++].nextSibling),e.insertBefore(s[--i],a),t[r]=s[i]}else{if(!c){c=new Map;let g=o;for(;g<i;)c.set(s[g],g++)}const a=c.get(t[l]);if(a!=null)if(o<a&&a<i){let g=l,_=1,p;for(;++g<r&&g<i&&!((p=c.get(t[g]))==null||p!==a+_);)_++;if(_>a-o){const y=t[l];for(;o<a;)e.insertBefore(s[o++],y)}else e.replaceChild(s[o++],t[l++])}else l++;else t[l++].remove()}}}const at="_$DX_DELEGATE";function ue(e,t,s){const n=document.createElement("template");n.innerHTML=e;let r=n.content.firstChild;return s&&(r=r.firstChild),r}function Is(e,t=window.document){const s=t[at]||(t[at]=new Set);for(let n=0,r=e.length;n<r;n++){const i=e[n];s.has(i)||(s.add(i),t.addEventListener(i,Ws))}}function ct(e,t){t==null?e.removeAttribute("class"):e.className=t}function B(e,t,s,n){if(s!==void 0&&!n&&(n=[]),typeof t!="function")return Me(e,t,n,s);le(r=>Me(e,t(),r,s),n)}function Ws(e){const t=`$$${e.type}`;let s=e.composedPath&&e.composedPath()[0]||e.target;for(e.target!==s&&Object.defineProperty(e,"target",{configurable:!0,value:s}),Object.defineProperty(e,"currentTarget",{configurable:!0,get(){return s||document}}),M.registry&&!M.done&&(M.done=!0,document.querySelectorAll("[id^=pl-]").forEach(n=>n.remove()));s!==null;){const n=s[t];if(n&&!s.disabled){const r=s[`${t}Data`];if(r!==void 0?n.call(s,r,e):n.call(s,e),e.cancelBubble)return}s=s.host&&s.host!==s&&s.host instanceof Node?s.host:s.parentNode}}function Me(e,t,s,n,r){for(M.context&&!s&&(s=[...e.childNodes]);typeof s=="function";)s=s();if(t===s)return s;const i=typeof t,l=n!==void 0;if(e=l&&s[0]&&s[0].parentNode||e,i==="string"||i==="number"){if(M.context)return s;if(i==="number"&&(t=t.toString()),l){let o=s[0];o&&o.nodeType===3?o.data=t:o=document.createTextNode(t),s=ee(e,s,n,o)}else s!==""&&typeof s=="string"?s=e.firstChild.data=t:s=e.textContent=t}else if(t==null||i==="boolean"){if(M.context)return s;s=ee(e,s,n)}else{if(i==="function")return le(()=>{let o=t();for(;typeof o=="function";)o=o();s=Me(e,o,s,n)}),()=>s;if(Array.isArray(t)){const o=[],u=s&&Array.isArray(s);if(ze(o,t,s,r))return le(()=>s=Me(e,o,s,n,!0)),()=>s;if(M.context){if(!o.length)return s;for(let c=0;c<o.length;c++)if(o[c].parentNode)return s=o}if(o.length===0){if(s=ee(e,s,n),l)return s}else u?s.length===0?ut(e,o,n):zs(e,s,o):(s&&ee(e),ut(e,o));s=o}else if(t instanceof Node){if(M.context&&t.parentNode)return s=l?[t]:t;if(Array.isArray(s)){if(l)return s=ee(e,s,n,t);ee(e,s,null,t)}else s==null||s===""||!e.firstChild?e.appendChild(t):e.replaceChild(t,e.firstChild);s=t}}return s}function ze(e,t,s,n){let r=!1;for(let i=0,l=t.length;i<l;i++){let o=t[i],u=s&&s[i];if(o instanceof Node)e.push(o);else if(!(o==null||o===!0||o===!1))if(Array.isArray(o))r=ze(e,o,u)||r;else if(typeof o=="function")if(n){for(;typeof o=="function";)o=o();r=ze(e,Array.isArray(o)?o:[o],Array.isArray(u)?u:[u])||r}else e.push(o),r=!0;else{const c=String(o);u&&u.nodeType===3&&u.data===c?e.push(u):e.push(document.createTextNode(c))}}return r}function ut(e,t,s){for(let n=0,r=t.length;n<r;n++)e.insertBefore(t[n],s)}function ee(e,t,s,n){if(s===void 0)return e.textContent="";const r=n||document.createTextNode("");if(t.length){let i=!1;for(let l=t.length-1;l>=0;l--){const o=t[l];if(r!==o){const u=o.parentNode===e;!i&&!l?u?e.replaceChild(r,o):e.insertBefore(r,s):u&&o.remove()}else i=!0}}else e.insertBefore(r,s);return[r]}class Ys{constructor(){D(this,"a_moves"),this.a_moves=zt.make(this)}get tree(){return this.a_moves.tree}set moves(t){this.a_moves.moves=t}set on_path(t){this.a_moves.on_path=t}}const Rt=class{constructor(e){D(this,"m_tree"),D(this,"_moves"),D(this,"_hover_path"),D(this,"_on_path"),this.replay=e;let t=de(void 0,{equals:!1});this._hover_path=t;let s=de(void 0,{equals:!1});this._on_path=s;let n=de([]);this._moves=n;let r=q(kt(n[0],Wt.make));function i(o){return q(()=>{let u=r().filter(a=>a.base===o),c=u.length>1;return u.map(a=>{let g=i(a.path)(),_;g.length>0&&(_=[g[0],g.slice(1)]);let p=a.ply%2===0,y=Math.ceil(a.ply/2)+(p?"...":"."),L=c||!p,O=q(()=>te(s)===a.path),d=q(()=>{var m;return((m=te(s))==null?void 0:m.slice(0,a.path.length))===a.path}),h=q(()=>te(t)===a.path),f=q(()=>{var m;return((m=te(t))==null?void 0:m.slice(0,a.path.length))===a.path}),v=q(()=>["move",O()?"on_hi":"",d()?"on_hi_sub":"",h()?"hi":"",f()?"hi_sub":""].join(" "));return{get klass(){return v()},a_move:a,index:y,show_index:L,main_children_and_rest:_}})})}let l=i("");this.m_tree=l}set on_path(e){re(this._on_path,e)}set hover_path(e){re(this._hover_path,t=>e)}get tree(){return this.m_tree()}set moves(e){re(this._moves,e)}};let zt=Rt;D(zt,"make",e=>new Rt(e));const It=class{constructor(e){D(this,"ply"),D(this,"path"),D(this,"base"),D(this,"move"),D(this,"comments"),D(this,"klass");let t=e.match(/([^ ]*) ([^ ]*) \{([^\}]*)\}/),s,n,r,i;if(t){n=t[1],r=t[2];let[u,c,a]=t[3].match(/^(__[^\_]*__)?(.*)$/);s=a,i=(c==null?void 0:c.substring(2,c.length-2))||""}else[n,r]=e.split(" "),i="";let l=n.length===2?"":n.slice(0,-2),o=n.length/2;this.path=n,this.ply=o,this.base=l,this.move=r,this.comments=s,this.klass=i}};let Wt=It;D(Wt,"make",e=>new It(e));const Vs=ue('<div class="chessreplay"><div class="moves"></div></div>'),Xs=ue('<div class="lines"><div class="line"></div></div>'),Hs=ue('<div class="line"></div>'),Ks=ue('<div class="index"></div>'),ht=ue("<div></div>");function Yt(e){let t=new Ys;nt(()=>{t.moves=e.moves}),nt(()=>{t.on_path=e.on_path});const s=r=>{t.a_moves.hover_path=r},n=r=>{var i;t.a_moves.on_path=r,(i=e.on_click)==null||i.call(e,r)};return(()=>{const r=Vs.cloneNode(!0),i=r.firstChild;return B(i,U(St,{get each(){return t.tree},children:l=>[U(ve,pe({on_click:n,on_hover:s},l)),U(_e,{on_click:n,on_hover:s,get mcr(){return l.main_children_and_rest}})]})),r})()}const _e=e=>e.mcr?U(Et,{get when(){return e.mcr[1].length},get fallback(){return[U(ve,pe({get on_click(){return e.on_click},get on_hover(){return e.on_hover}},()=>e.mcr[0])),U(_e,{get on_click(){return e.on_click},get on_hover(){return e.on_hover},get mcr(){return e.mcr[0].main_children_and_rest}})]},get children(){const t=Xs.cloneNode(!0),s=t.firstChild;return B(s,U(ve,pe({get on_click(){return e.on_click},get on_hover(){return e.on_hover}},()=>e.mcr[0])),null),B(s,U(_e,{get on_click(){return e.on_click},get on_hover(){return e.on_hover},get mcr(){return e.mcr[0].main_children_and_rest}}),null),B(t,U(St,{get each(){return e.mcr[1]},children:n=>(()=>{const r=Hs.cloneNode(!0);return B(r,U(ve,pe({get on_click(){return e.on_click},get on_hover(){return e.on_hover}},n)),null),B(r,U(_e,{get on_click(){return e.on_click},get on_hover(){return e.on_hover},get mcr(){return n.main_children_and_rest}}),null),r})()}),null),t}}):[],ve=e=>[(()=>{const t=ht.cloneNode(!0);return t.$$mouseover=s=>e.on_hover(e.a_move.path),t.addEventListener("mouseleave",s=>e.on_hover(void 0)),t.$$click=s=>e.on_click(e.a_move.path),B(t,U(Et,{get when(){return e.show_index},get children(){const s=Ks.cloneNode(!0);return B(s,()=>e.index),s}}),null),B(t,()=>e.a_move.move,null),le(()=>ct(t,e.klass+e.a_move.klass)),t})(),(()=>{const t=ht.cloneNode(!0);return B(t,()=>e.a_move.comments),le(()=>ct(t,["comment",e.a_move.klass].join(" "))),t})()];Is(["click","mouseover"]);let ft=new ns({emit(e){H.ai.local_eval(e),e.depth>=me&&H.ai.crunch_one()}}),dt=10,me=16;const Qs=(e,t)=>{let[s,n]=is.apply(e);return s.fen===t?[""]:n.filter(([r,i])=>i.fen===t).map(r=>r[0])},Te=class{constructor(){z(this,"path_depths");z(this,"root");z(this,"nb_crunch");z(this,"on_root_changed");z(this,"on_crunch_done")}local_eval(t){Qs(this.root.root,t.fen).forEach(n=>{this.path_depths.set(n,t.depth),t.pvs.forEach(r=>{let i=n;r.cp/100,r.depth;let l=r.moves.slice(0,4);for(let o of l){if(this.root.node_at_path(i).children.find(a=>a.uci===o))break;i=this.root.add_move(i,o,void 0)}})}),this.on_root_changed()}crunch_one(){this.nb_crunch++,this.nb_crunch===dt&&(ft.stop(),this.on_crunch_done()),!(this.nb_crunch>dt)&&rs.breadfirst(this.root.root,(t,s)=>{let n=this.path_depths.get(t);if(!n||n<me){let i=this.root.root.node_list(t).map((l,o)=>({ply:o,uci:l.uci,fen:l.fen,san:""}));return ft.start("",i),!0}return!1})}};let H=Te;z(H,"ai",new Te),z(H,"make",(t,s,n)=>{let{ai:r}=Te;r.root=t,r.nb_crunch=0,r.path_depths=new Map;let i=t.flat_export[1].map(l=>l[0]);return i.forEach(l=>r.path_depths.set(l,me)),t.root.child_paths.filter(l=>l.length%4===2).forEach(l=>r.path_depths.delete(l)),i.length>0&&r.path_depths.set("",me),r.on_root_changed=s,r.on_crunch_done=n,r.crunch_one(),r});const Js=Le('<div class="guess-app"></div>'),Zs=Le('<div class="opening-prep-scene"><div class="board"></div><div class="table"><div class="info"></div><div class="replay"></div><div class="controls"><button>Delete variation</button></div><div class="action"></div></div></div>'),en=Le('<button class="primary">Compare AI</button>'),tn=Le('<div class="opening-prep-scene"><div class="board"></div><div class="table"><div class="info">1. Build your opening repertoire as a preset</div><div class="replay"></div><div class="controls"><button>Delete variation</button></div><div class="action"><div>2. Create a challenge</div><h3> Select a color </h3><div class="packs colors"><div class="pack"><span> White </span></div><div class="pack"><span> Black </span></div><div class="pack"><span> Random </span></div></div><button class="primary">Start Game</button></div></div></div>'),fn=()=>[F(Zt,{children:" aidchess.com - Guess Lines "}),(()=>{const e=Js.cloneNode(!0);return se(e,F(pt,{when:!0,get fallback(){return F(nn,{on_start:t=>{}})},get children(){return F(sn,{})}})),e})()],sn=()=>{const[e,t]=X(""),[s,n]=X(st.make(),{equals:!1}),[r,i]=X(Fe.get_replay(),{equals:!1}),[l,o]=X(!1),u=()=>{o(!0);const d=H.make(s(),()=>{},()=>{let[h,f]=st.diff_trees(r(),d.root),v=h.filter($=>$.length%4===2),m=h.filter($=>$.length%4===0),N=f.filter($=>$.length%4===0);i($=>(m.forEach(j=>$.delete_path(j)),$)),i($=>(N.forEach(j=>{let Z=d.root.node_at_path(j);$.add_move(Ge(j),Z.uci)}),$)),n(r().clone),n($=>(v.forEach(j=>$.delete_children(j)),$)),o(!1)})},c=I(()=>r().node_at_path(e())),a=I(()=>{let d=s().moves().map(f=>{let[v,m,N]=f.split(" ");return N="{__base__}",[v,m,N].join(" ")}),h=r().moves().filter(f=>!d.find(v=>v.split(" ")[0]===f.split(" ")[0])).map(f=>{let[v,m,N]=f.split(" ");return N="{__ghost__}",[v,m,N].join(" ")});return[...d,...h]});I(()=>r().chess(e()));const g=I(()=>r().fen(e())),_=d=>{let h;i(f=>(h=f.add_move(e(),d),f)),h&&t(h)},p=()=>{let d;i(h=>(d=h.delete_variation(e()),h)),d!==void 0&&t(d)};let y=oe.make,L=oe.make;const O=d=>{var h;if(d<0)t(f=>Ge(f));else{const f=(h=c())==null?void 0:h.children[0];f&&t(v=>v+f.id)}};return Ae({on_wheel:O},y),Ae({on_wheel:O},L),(()=>{const d=Zs.cloneNode(!0),h=d.firstChild,f=h.nextSibling,v=f.firstChild,m=v.nextSibling,N=m.nextSibling,$=N.firstChild,j=N.nextSibling,Z=Ne(y);typeof Z=="function"&&ge(Z,h),se(h,F(_t,{glyphs:[],get fen(){return g()},isBlack:!1,onUserMove:_}));const he=Ne(L);return typeof he=="function"&&ge(he,m),se(m,F(Yt,{get moves(){return a()},get on_path(){return e()},on_click:Y=>t(Y)})),$.$$click=p,se(j,F(pt,{get when(){return l()},get fallback(){return(()=>{const Y=en.cloneNode(!0);return Y.$$click=u,Y})()},children:"Comparing..."})),d})()},nn=e=>{const[t,s]=X(""),[n,r]=X(Fe.get_replay(),{equals:!1});es(()=>{Fe.set_replay(n())});const i=I(()=>n().node_at_path(t())),l=I(()=>n().moves());I(()=>n().chess(t()));const o=I(()=>n().fen(t())),u=d=>{let h;r(f=>(h=f.add_move(t(),d),f)),h&&s(h)},c=()=>{let d;r(h=>(d=h.delete_variation(t()),h)),d!==void 0&&s(d)},[a,g]=X(),_=()=>{e.on_start(a())};let p=oe.make,y=oe.make;const L=d=>{var h;if(d<0)s(f=>Ge(f));else{const f=(h=i())==null?void 0:h.children[0];f&&s(v=>v+f.id)}};Ae({on_wheel:L},p),Ae({on_wheel:L},y);const O=d=>a()===d?"primary selected":"primary";return(()=>{const d=tn.cloneNode(!0),h=d.firstChild,f=h.nextSibling,v=f.firstChild,m=v.nextSibling,N=m.nextSibling,$=N.firstChild,j=N.nextSibling,Z=j.firstChild,he=Z.nextSibling,Y=he.nextSibling,Ue=Y.firstChild,Vt=Ue.firstChild,je=Ue.nextSibling,Xt=je.firstChild,Ke=je.nextSibling,Ht=Ke.firstChild,Kt=Y.nextSibling,Qe=Ne(p);typeof Qe=="function"&&ge(Qe,h),se(h,F(_t,{glyphs:[],get fen(){return o()},isBlack:!1,onUserMove:u}));const Je=Ne(y);return typeof Je=="function"&&ge(Je,m),se(m,F(Yt,{get moves(){return l()},get on_path(){return t()},on_click:P=>s(P)})),$.$$click=c,Ue.$$click=()=>g("w"),je.$$click=()=>g("b"),Ke.$$click=()=>g(),Kt.$$click=_,ts(P=>{const Ze=O("w"),et=O("b"),tt=O(void 0);return Ze!==P._v$&&qe(Vt,P._v$=Ze),et!==P._v$2&&qe(Xt,P._v$2=et),tt!==P._v$3&&qe(Ht,P._v$3=tt),P},{_v$:void 0,_v$2:void 0,_v$3:void 0}),d})()};ss(["click"]);export{fn as default};
