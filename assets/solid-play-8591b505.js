import{a as E,h as O,i as w,c as _,m as L,b as v,F as j,S as T,f as U,t as M,d as D,e as C,o as Z,k as I}from"./index-71b767f4.js";const tt=M('<div class="chessreplay"><div class="moves"></div></div>'),et=M('<div class="lines"></div>'),st=M('<div class="line"></div>'),it=M('<div class="index"></div>'),F=M("<div></div>");function pt(t){const[e,s]=E(),i=a=>s(a),[n,r]=E(""),h=a=>{var l;r(a),(l=t.on_click)==null||l.call(t,a)};return O(()=>r(t.on_path)),(()=>{const a=tt.cloneNode(!0),l=a.firstChild;return w(l,_(W,L({path:""},t,{on_click:h,on_hover:i,get hover_path(){return e()},get on_path(){return n()}}))),a})()}function A(t){let e=t.move.split(" ")[0];return[_(nt,t),_(W,L(t,{path:e}))]}function W(t){let e=()=>t.moves.filter(i=>{let n=i.split(" ")[0];return n.startsWith(t.path)&&n.length===t.path.length+2});const s=v(()=>e().length>1);return _(T,{get when(){return s()},get fallback(){return _(j,{get each(){return e()},children:i=>_(A,L(t,{get is_branch(){return s()},move:i}))})},get children(){const i=et.cloneNode(!0);return w(i,_(j,{get each(){return e()},children:n=>(()=>{const r=st.cloneNode(!0);return w(r,_(A,L(t,{get is_branch(){return s()},move:n}))),r})()})),i}})}const nt=t=>{let e=t.move,s=e.match(/([^ ]*) ([^ ]*) \{([^\}]*)\}/),i,n,r,h;if(s){n=s[1],r=s[2];let[c,g,Q]=s[3].match(/^(__[^\_]*__)?(.*)$/);i=Q,h=(g==null?void 0:g.substring(2,g.length-2))||""}else[n,r]=e.split(" "),h="";n.length===2||n.slice(0,-2);let a=n.length/2,l=a%2===0,y=Math.ceil(a/2)+(l?"...":"."),x=t.is_branch||!l,p=v(()=>t.on_path),f=v(()=>t.hover_path),d=v(()=>p()===n),k=v(()=>{var c;return((c=p())==null?void 0:c.slice(0,n.length))===n}),V=v(()=>f()===n),J=v(()=>{var c;return((c=f())==null?void 0:c.slice(0,n.length))===n}),K=v(()=>["move",d()?"on_hi":"",k()?"on_hi_sub":"",V()?"hi":"",J()?"hi_sub":""].join(" "));return[(()=>{const c=F.cloneNode(!0);return c.$$mouseover=g=>t.on_hover(n),c.addEventListener("mouseleave",g=>t.on_hover(void 0)),c.$$click=g=>t.on_click(n),w(c,_(T,{when:x,get children(){const g=it.cloneNode(!0);return w(g,y),g}}),null),w(c,r,null),D(()=>C(c,K()+h)),c})(),(()=>{const c=F.cloneNode(!0);return w(c,i),D(()=>C(c,["comment",h].join(" "))),c})()]};U(["click","mouseover"]);var rt=Object.defineProperty,ht=(t,e,s)=>e in t?rt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,o=(t,e,s)=>(ht(t,typeof e!="symbol"?e+"":e,s),s);const S=t=>t[0](),Y=(t,e)=>typeof e=="function"?t[1](e):t[1](s=>e),m=class{constructor(t,e){o(this,"x"),o(this,"y"),this.x=t,this.y=e}static get unit(){return new m(1,1)}static get zero(){return new m(0,0)}get vs(){return[this.x,this.y]}get mul_inverse(){return new m(1/this.x,1/this.y)}get inverse(){return new m(-this.x,-this.y)}get half(){return new m(this.x/2,this.y/2)}get length_squared(){return this.x*this.x+this.y*this.y}get length(){return Math.sqrt(this.length_squared)}get normalize(){return this.length===0?m.zero:this.scale(1/this.length)}get perpendicular(){return new m(-this.y,this.x)}get clone(){return new m(this.x,this.y)}get angle(){return Math.atan2(this.y,this.x)}get round(){return m.make(Math.round(this.x),Math.round(this.y))}get floor(){return m.make(Math.floor(this.x),Math.floor(this.y))}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}project_to(t){let e=t.length_squared,s=this.dot(t);return m.make(s*t.x/e,s*t.y/e)}distance(t){return this.sub(t).length}addy(t){return m.make(this.x,this.y+t)}add_angle(t){return m.from_angle(this.angle+t)}scale(t){let{clone:e}=this;return e.scale_in(t)}scale_in(t){return this.x*=t,this.y*=t,this}add(t){let{clone:e}=this;return e.add_in(t)}add_in(t){return this.x+=t.x,this.y+=t.y,this}sub(t){let{clone:e}=this;return e.sub_in(t)}sub_in(t){return this.x-=t.x,this.y-=t.y,this}mul(t){let{clone:e}=this;return e.mul_in(t)}mul_in(t){return this.x*=t.x,this.y*=t.y,this}div(t){let{clone:e}=this;return e.div_in(t)}div_in(t){return this.x/=t.x,this.y/=t.y,this}set_in(t,e=this.y){return this.x=t,this.y=e,this}};let u=m;o(u,"from_angle",t=>new m(Math.cos(t),Math.sin(t))),o(u,"make",(t,e)=>new m(t,e));const b=class{constructor(t,e,s,i,n,r){o(this,"array_t"),o(this,"a"),o(this,"b"),o(this,"c"),o(this,"d"),o(this,"tx"),o(this,"ty"),this.a=t,this.b=e,this.c=s,this.d=i,this.tx=n,this.ty=r,this.array_t=new Float32Array([t,e,0,s,i,0,n,r,1])}static get identity(){return new b(1,0,0,1,0,0)}static get unit(){return b.identity}get clone(){let{a:t,b:e,c:s,d:i,tx:n,ty:r}=this;return new b(t,e,s,i,n,r)}get inverse(){let{a:t,b:e,c:s,d:i,tx:n,ty:r}=this,h=t*i-e*s,a=i/h,l=-e/h,y=-s/h,x=t/h,p=(s*r-i*n)/h,f=-(t*r-e*n)/h;return new b(a,l,y,x,p,f)}rotate_in(t){let e=Math.cos(t),s=Math.sin(t),i=this.a*e-this.b*s,n=this.a*s+this.b*e,r=this.c*e-this.d*s,h=this.c*s+this.d*e,a=this.tx*e-this.ty*s,l=this.tx*s+this.ty*e;return this.a=i,this.b=n,this.c=r,this.d=h,this.tx=a,this.ty=l,this}rotate(t){let{clone:e}=this;return e.rotate_in(t),e}scale(t,e){let s=this.a*t,i=this.b,n=this.c,r=this.d*e,h=this.tx,a=this.ty;return new b(s,i,n,r,h,a)}translate_in(t,e){this.a,this.b,this.c,this.d;let s=t+this.tx,i=e+this.ty;return this.tx=s,this.ty=i,this}translate(t,e){let{clone:s}=this;return s.translate_in(t,e),s}scale_in(t,e){return this.a=t,this.d=e,this}mVec2(t){let e=this.a,s=this.b,i=this.c,n=this.d,r=this.tx,h=this.ty,a=e*t.x+i*t.y+r,l=s*t.x+n*t.y+h;return u.make(a,l)}mul_in(t){let{a:e,b:s,c:i,d:n,tx:r,ty:h}=this;this.a=t.a*e+t.b*i,this.b=t.a*s+t.b*n,this.c=t.c*e+t.d*i,this.d=t.c*s+t.d*n,this.tx=t.tx*e+t.ty*i+r,this.ty=t.tx*s+t.ty*n+h}set_in(t){let{a:e,b:s,c:i,d:n,tx:r,ty:h}=t;this.a=e,this.b=s,this.c=i,this.d=n,this.tx=r,this.ty=h}transform_in(t,e,s,i=u.unit.half){this.a=Math.cos(e)*t.x,this.b=Math.sin(e)*t.x,this.c=-Math.sin(e)*t.y,this.d=Math.cos(e)*t.y,this.tx=s.x-(i.x*this.a+i.y*this.c),this.ty=s.y-(i.x*this.b+i.y*this.d)}};let at=b;o(at,"projection",(t,e)=>{let s=0,i=0,n=1/t*2,r=-1/e*2,h=-1,a=1;return new b(n,s,i,r,h,a)});const q=class{constructor(t,e){o(this,"o"),o(this,"r"),this.o=t,this.r=e}static get unit(){return q.make(0,0,1)}scale(t){return q.make(this.o.x,this.o.y,this.r*t)}copy_in(t){return this.r=t.r,this.o=t.o,this}add_o_in(t){return this.o.add_in(t),this}};let ot=q;o(ot,"make",(t,e,s)=>new q(u.make(t,e),s));const B=class{constructor(t,e){this.a=t,this.b=e}get center(){return this.b.add(this.a).half}get parallel(){return this.b.sub(this.a).normalize}get normal(){return this.parallel.perpendicular}get angle(){return this.b.sub(this.a).angle}get radius(){return this.length/2}get length(){return this.b.sub(this.a).length}segments(t,e){return t.map((s,i)=>this.a.add(this.normal.scale(e[i]).add(this.parallel.scale(this.length*s))))}};let lt=B;o(lt,"make",(t,e,s,i)=>new B(u.make(t,e),u.make(s,i)));const $=class{constructor(t){this.vertices=t}static get unit(){return $.make(0,0,1,1)}get vs(){let{x:t,y:e,w:s,h:i}=this;return[t,e,s,i]}get x1(){return this.vertices[0].x}get y1(){return this.vertices[0].y}get x2(){return this.vertices[2].x}get y2(){return this.vertices[2].y}get x(){return this.x1}get y(){return this.y1}get w(){return this.x2-this.x1}get h(){return this.y2-this.y1}get center(){return u.make(this.x+this.w/2,this.y+this.h/2)}get vertexData(){return new Float32Array(this.vertices.flatMap(t=>t.vs))}get indices(){return new Uint16Array([0,1,2,0,2,3])}larger(t){return $.make(this.x-t,this.y-t,this.w+t,this.h+t)}transform(t){return new $(this.vertices.map(e=>t.mVec2(e)))}};let ct=$;o(ct,"make",(t,e,s,i)=>new $([u.make(t,e),u.make(t+s,e),u.make(t+s,e+i),u.make(t,e+i)]));class P{constructor(){o(this,"m_rect"),o(this,"_$ref"),o(this,"_$clear_bounds"),this._$clear_bounds=E(void 0,{equals:!1}),this._$ref=E(),this.m_rect=v(()=>{var e;return S(this._$clear_bounds),(e=this.$ref)==null?void 0:e.getBoundingClientRect()})}static get make(){return new P}get $ref(){return S(this._$ref)}set $ref(e){Y(this._$ref,e)}get_normal_at_abs_pos(e){let{size:s,orig:i}=this;if(s&&i)return e.sub(i).div(s)}get size(){let{rect:e}=this;if(e)return u.make(e.width,e.height)}get orig(){let{rect:e}=this;if(e)return u.make(e.x,e.y)}get rect(){return this.m_rect()}$clear_bounds(){Y(this._$clear_bounds,void 0)}}function ut(t){var e;return t.clientX!==void 0&&t.clientY!==void 0?[t.clientX,t.clientY]:(e=t.targetTouches)!=null&&e[0]?[t.targetTouches[0].clientX,t.targetTouches[0].clientY]:[0,0]}class X{}o(X,"init",(t,e=document)=>{const s=d=>{let k=ut(d);return k?u.make(k[0],k[1]):u.zero};let{_onDragStart:i,_onDragMove:n,_onDragEnd:r,_onContextMenu:h,_onWheel:a}=t;const l=d=>{i==null||i(s(d),d.buttons===2||d.button===2)},y=d=>{n==null||n(s(d))},x=d=>{r==null||r(s(d))},p=d=>{h&&(d.preventDefault(),h())},f=d=>{a&&(a(Math.sign(d.deltaY)),d.preventDefault())};return e.addEventListener("wheel",f,{passive:!1}),e.addEventListener("touchstart",l,{capture:!0,passive:!1}),e.addEventListener("mousedown",l,{capture:!0,passive:!1}),e.addEventListener("contextmenu",p),document.addEventListener("mousemove",y),document.addEventListener("mouseup",x),document.addEventListener("touchmove",y),document.addEventListener("touchend",x),()=>{e.removeEventListener("wheel",f),e.removeEventListener("touchstart",l),e.removeEventListener("mousedown",l),e.removeEventListener("contextmenu",p),document.removeEventListener("mousemove",y),document.removeEventListener("mouseup",x),document.removeEventListener("touchmove",y),document.removeEventListener("touchend",x)}});const ft=(t,e)=>{O(Z(()=>e.$ref,s=>{s&&I(dt(t,s))}))},dt=(t,e)=>{let{on_wheel:s}=t;return X.init({_onWheel(i){s(i)}},e)},bt=t=>e=>setTimeout(()=>t.$ref=e),G="abcdefgh".split(""),z="87654321".split("");z.slice(0).reverse();const mt="wb".split(""),gt="rkqbnp".split("");mt.flatMap(t=>gt.map(e=>`${t}${e}`));const N=G.flatMap(t=>z.map(e=>`${t}${e}`)),vt=new Map(N.map(t=>{let[e,s]=t.split(""),i=G.indexOf(e),n=z.indexOf(s);return[t,u.make(i,n)]})),H=t=>{let e=vt.get(t);return(e.x+e.y)%2===0},_t=t=>!H(t);N.filter(H);N.filter(_t);const R=class{constructor(t){o(this,"released_positions"),this.free=t,this.released_positions=new Map}acquire_pos(t,e,s=!1){let i=this.released_positions.get(t);if(!s&&i&&i.length>0)return i.sort((n,r)=>r.distance(e)-n.distance(e)),i.pop();{let n=this.free.pop();return n.x=e.x,n.y=e.y,n}}reset_fix_all(){for(let t of this.released_positions.values())t.forEach(e=>this.free.push(e));this.released_positions=new Map}release_pos(t,e){let s=this.released_positions.get(t);s||(s=[],this.released_positions.set(t,s)),s.push(e)}};let yt=R;o(yt,"make",t=>new R(t));export{pt as K,P as S,ft as c,bt as l};
