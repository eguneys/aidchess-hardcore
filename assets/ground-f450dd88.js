import{a as nn,h as pe,o as he,j as on,t as rn}from"./index-97627c47.js";import{k as g,a as Ce,p as w,o as te,c as qe,d as I,i as tn,f as xe,b as cn,s as oe,e as E,g as De,t as q,h as ce,j as F,l as ln,m as sn,n as x,r as an,q as Ae,u as dn}from"./util-2d6699b1.js";import{C as un}from"./chess-ece2668e.js";const $=(e,n)=>Math.abs(e-n),fn=e=>(n,o,r,i)=>$(n,r)<2&&(e==="white"?i===o+1||o<=1&&i===o+2&&n===r:i===o-1||o>=6&&i===o-2&&n===r),ze=(e,n,o,r)=>{const i=$(e,o),t=$(n,r);return i===1&&t===2||i===2&&t===1},Oe=(e,n,o,r)=>$(e,o)===$(n,r),Ke=(e,n,o,r)=>e===o||n===r,Te=(e,n,o,r)=>Oe(e,n,o,r)||Ke(e,n,o,r),pn=(e,n,o)=>(r,i,t,c)=>$(r,t)<2&&$(i,c)<2||o&&i===c&&i===(e==="white"?0:7)&&(r===4&&(t===2&&n.includes(0)||t===6&&n.includes(7))||n.includes(t));function hn(e,n){const o=n==="white"?"1":"8",r=[];for(const[i,t]of e)i[1]===o&&t.color===n&&t.role==="rook"&&r.push(g(i)[0]);return r}function Ne(e,n,o){const r=e.get(n);if(!r)return[];const i=g(n),t=r.role,c=t==="pawn"?fn(r.color):t==="knight"?ze:t==="bishop"?Oe:t==="rook"?Ke:t==="queen"?Te:pn(r.color,hn(e,r.color),o);return Ce.filter(l=>(i[0]!==l[0]||i[1]!==l[1])&&c(i[0],i[1],l[0],l[1])).map(w)}function m(e,...n){e&&setTimeout(()=>e(...n),1)}function gn(e){e.orientation=te(e.orientation),e.animation.current=e.draggable.current=e.selected=void 0}function mn(e,n){for(const[o,r]of n)r?e.pieces.set(o,r):e.pieces.delete(o)}function vn(e,n){if(e.check=void 0,n===!0&&(n=e.turnColor),n)for(const[o,r]of e.pieces)r.role==="king"&&r.color===n&&(e.check=o)}function bn(e,n,o,r){K(e),e.premovable.current=[n,o],m(e.premovable.events.set,n,o,r)}function O(e){e.premovable.current&&(e.premovable.current=void 0,m(e.premovable.events.unset))}function wn(e,n,o){O(e),e.predroppable.current={role:n,key:o},m(e.predroppable.events.set,n,o)}function K(e){const n=e.predroppable;n.current&&(n.current=void 0,m(n.events.unset))}function yn(e,n,o){if(!e.autoCastle)return!1;const r=e.pieces.get(n);if(!r||r.role!=="king")return!1;const i=g(n),t=g(o);if(i[1]!==0&&i[1]!==7||i[1]!==t[1])return!1;i[0]===4&&!e.pieces.has(o)&&(t[0]===6?o=w([7,t[1]]):t[0]===2&&(o=w([0,t[1]])));const c=e.pieces.get(o);return!c||c.color!==r.color||c.role!=="rook"?!1:(e.pieces.delete(n),e.pieces.delete(o),i[0]<t[0]?(e.pieces.set(w([6,t[1]]),r),e.pieces.set(w([5,t[1]]),c)):(e.pieces.set(w([2,t[1]]),r),e.pieces.set(w([3,t[1]]),c)),!0)}function $e(e,n,o){const r=e.pieces.get(n),i=e.pieces.get(o);if(n===o||!r)return!1;const t=i&&i.color!==r.color?i:void 0;return o===e.selected&&y(e),m(e.events.move,n,o,t),yn(e,n,o)||(e.pieces.set(o,r),e.pieces.delete(n)),e.lastMove=[n,o],e.check=void 0,m(e.events.change),t||!0}function le(e,n,o,r){if(e.pieces.has(o))if(r)e.pieces.delete(o);else return!1;return m(e.events.dropNewPiece,n,o),e.pieces.set(o,n),e.lastMove=[o],e.check=void 0,m(e.events.change),e.movable.dests=void 0,e.turnColor=te(e.turnColor),!0}function Ee(e,n,o){const r=$e(e,n,o);return r&&(e.movable.dests=void 0,e.turnColor=te(e.turnColor),e.animation.current=void 0),r}function He(e,n,o){if(se(e,n,o)){const r=Ee(e,n,o);if(r){const i=e.hold.stop();y(e);const t={premove:!1,ctrlKey:e.stats.ctrlKey,holdTime:i};return r!==!0&&(t.captured=r),m(e.movable.events.after,n,o,t),!0}}else if(Pn(e,n,o))return bn(e,n,o,{ctrlKey:e.stats.ctrlKey}),y(e),!0;return y(e),!1}function Le(e,n,o,r){const i=e.pieces.get(n);i&&(kn(e,n,o)||r)?(e.pieces.delete(n),le(e,i,o,r),m(e.movable.events.afterNewPiece,i.role,o,{premove:!1,predrop:!1})):i&&Sn(e,n,o)?wn(e,i.role,o):(O(e),K(e)),e.pieces.delete(n),y(e)}function re(e,n,o){if(m(e.events.select,n),e.selected){if(e.selected===n&&!e.draggable.enabled){y(e),e.hold.cancel();return}else if((e.selectable.enabled||o)&&e.selected!==n&&He(e,e.selected,n)){e.stats.dragged=!1;return}}(e.selectable.enabled||e.draggable.enabled)&&(We(e,n)||ae(e,n))&&(Re(e,n),e.hold.start())}function Re(e,n){e.selected=n,ae(e,n)?e.premovable.dests=Ne(e.pieces,n,e.premovable.castle):e.premovable.dests=void 0}function y(e){e.selected=void 0,e.premovable.dests=void 0,e.hold.cancel()}function We(e,n){const o=e.pieces.get(n);return!!o&&(e.movable.color==="both"||e.movable.color===o.color&&e.turnColor===o.color)}const se=(e,n,o)=>{var r,i;return n!==o&&We(e,n)&&(e.movable.free||!!(!((i=(r=e.movable.dests)===null||r===void 0?void 0:r.get(n))===null||i===void 0)&&i.includes(o)))};function kn(e,n,o){const r=e.pieces.get(n);return!!r&&(n===o||!e.pieces.has(o))&&(e.movable.color==="both"||e.movable.color===r.color&&e.turnColor===r.color)}function ae(e,n){const o=e.pieces.get(n);return!!o&&e.premovable.enabled&&e.movable.color===o.color&&e.turnColor!==o.color}const Pn=(e,n,o)=>n!==o&&ae(e,n)&&Ne(e.pieces,n,e.premovable.castle).includes(o);function Sn(e,n,o){const r=e.pieces.get(n),i=e.pieces.get(o);return!!r&&(!i||i.color!==e.movable.color)&&e.predroppable.enabled&&(r.role!=="pawn"||o[1]!=="1"&&o[1]!=="8")&&e.movable.color===r.color&&e.turnColor!==r.color}function Mn(e,n){const o=e.pieces.get(n);return!!o&&e.draggable.enabled&&(e.movable.color==="both"||e.movable.color===o.color&&(e.turnColor===o.color||e.premovable.enabled))}function Cn(e){const n=e.premovable.current;if(!n)return!1;const o=n[0],r=n[1];let i=!1;if(se(e,o,r)){const t=Ee(e,o,r);if(t){const c={premove:!0};t!==!0&&(c.captured=t),m(e.movable.events.after,o,r,c),i=!0}}return O(e),i}function qn(e,n){const o=e.predroppable.current;let r=!1;if(!o)return!1;if(n(o)){const i={role:o.role,color:e.movable.color};le(e,i,o.key)&&(m(e.movable.events.afterNewPiece,o.role,o.key,{premove:!1,predrop:!0}),r=!0)}return K(e),r}function de(e){O(e),K(e),y(e)}function ge(e){e.movable.color=e.movable.dests=e.animation.current=void 0,de(e)}function H(e,n,o){let r=Math.floor(8*(e[0]-o.left)/o.width);n||(r=7-r);let i=7-Math.floor(8*(e[1]-o.top)/o.height);return n||(i=7-i),r>=0&&r<8&&i>=0&&i<8?w([r,i]):void 0}function xn(e,n,o,r){const i=g(e),t=Ce.filter(s=>Te(i[0],i[1],s[0],s[1])||ze(i[0],i[1],s[0],s[1])),l=t.map(s=>qe(w(s),o,r)).map(s=>I(n,s)),[,a]=l.reduce((s,p,d)=>s[0]<p?s:[p,d],[l[0],0]);return w(t[a])}const v=e=>e.orientation==="white",_e="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",Dn={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king"},An={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};function Be(e){e==="start"&&(e=_e);const n=new Map;let o=7,r=0;for(const i of e)switch(i){case" ":case"[":return n;case"/":if(--o,o<0)return n;r=0;break;case"~":{const t=n.get(w([r-1,o]));t&&(t.promoted=!0);break}default:{const t=i.charCodeAt(0);if(t<57)r+=t-48;else{const c=i.toLowerCase();n.set(w([r,o]),{role:Dn[c],color:i===c?"black":"white"}),++r}}}return n}function zn(e){return tn.map(n=>xe.map(o=>{const r=e.get(o+n);if(r){let i=An[r.role];return r.color==="white"&&(i=i.toUpperCase()),r.promoted&&(i+="~"),i}else return"1"}).join("")).join("/").replace(/1{2,}/g,n=>n.length.toString())}function je(e,n){n.animation&&(ue(e.animation,n.animation),(e.animation.duration||0)<70&&(e.animation.enabled=!1))}function Ie(e,n){var o,r,i;if(!((o=n.movable)===null||o===void 0)&&o.dests&&(e.movable.dests=void 0),!((r=n.drawable)===null||r===void 0)&&r.autoShapes&&(e.drawable.autoShapes=[]),ue(e,n),n.fen&&(e.pieces=Be(n.fen),e.drawable.shapes=((i=n.drawable)===null||i===void 0?void 0:i.shapes)||[]),"check"in n&&vn(e,n.check||!1),"lastMove"in n&&!n.lastMove?e.lastMove=void 0:n.lastMove&&(e.lastMove=n.lastMove),e.selected&&Re(e,e.selected),je(e,n),!e.movable.rookCastle&&e.movable.dests){const t=e.movable.color==="white"?"1":"8",c="e"+t,l=e.movable.dests.get(c),a=e.pieces.get(c);if(!l||!a||a.role!=="king")return;e.movable.dests.set(c,l.filter(s=>!(s==="a"+t&&l.includes("c"+t))&&!(s==="h"+t&&l.includes("g"+t))))}}function ue(e,n){for(const o in n)Object.prototype.hasOwnProperty.call(n,o)&&(Object.prototype.hasOwnProperty.call(e,o)&&me(e[o])&&me(n[o])?ue(e[o],n[o]):e[o]=n[o])}function me(e){if(typeof e!="object"||e===null)return!1;const n=Object.getPrototypeOf(e);return n===Object.prototype||n===null}const N=(e,n)=>n.animation.enabled?Tn(e,n):A(e,n);function A(e,n){const o=e(n);return n.dom.redraw(),o}const J=(e,n)=>({key:e,pos:g(e),piece:n}),On=(e,n)=>n.sort((o,r)=>I(e.pos,o.pos)-I(e.pos,r.pos))[0];function Kn(e,n){const o=new Map,r=[],i=new Map,t=[],c=[],l=new Map;let a,s,p;for(const[d,b]of e)l.set(d,J(d,b));for(const d of cn)a=n.pieces.get(d),s=l.get(d),a?s?oe(a,s.piece)||(t.push(s),c.push(J(d,a))):c.push(J(d,a)):s&&t.push(s);for(const d of c)s=On(d,t.filter(b=>oe(d.piece,b.piece))),s&&(p=[s.pos[0]-d.pos[0],s.pos[1]-d.pos[1]],o.set(d.key,p.concat(p)),r.push(s.key));for(const d of t)r.includes(d.key)||i.set(d.key,d.piece);return{anims:o,fadings:i}}function Fe(e,n){const o=e.animation.current;if(o===void 0){e.dom.destroyed||e.dom.redrawNow();return}const r=1-(n-o.start)*o.frequency;if(r<=0)e.animation.current=void 0,e.dom.redrawNow();else{const i=Nn(r);for(const t of o.plan.anims.values())t[2]=t[0]*i,t[3]=t[1]*i;e.dom.redrawNow(!0),requestAnimationFrame((t=performance.now())=>Fe(e,t))}}function Tn(e,n){const o=new Map(n.pieces),r=e(n),i=Kn(o,n);if(i.anims.size||i.fadings.size){const t=n.animation.current&&n.animation.current.start;n.animation.current={start:performance.now(),frequency:1/n.animation.duration,plan:i},t||Fe(n,performance.now())}else n.dom.redraw();return r}const Nn=e=>e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1,$n=["green","red","blue","yellow"];function En(e,n){if(n.touches&&n.touches.length>1)return;n.stopPropagation(),n.preventDefault(),n.ctrlKey?y(e):de(e);const o=E(n),r=H(o,v(e),e.dom.bounds());r&&(e.drawable.current={orig:r,pos:o,brush:Wn(n),snapToValidMove:e.drawable.defaultSnapToValidMove},Ve(e))}function Ve(e){requestAnimationFrame(()=>{const n=e.drawable.current;if(n){const o=H(n.pos,v(e),e.dom.bounds());o||(n.snapToValidMove=!1);const r=n.snapToValidMove?xn(n.orig,n.pos,v(e),e.dom.bounds()):o;r!==n.mouseSq&&(n.mouseSq=r,n.dest=r!==n.orig?r:void 0,e.dom.redrawNow()),Ve(e)}})}function Hn(e,n){e.drawable.current&&(e.drawable.current.pos=E(n))}function Ln(e){const n=e.drawable.current;n&&(n.mouseSq&&_n(e.drawable,n),Ze(e))}function Ze(e){e.drawable.current&&(e.drawable.current=void 0,e.dom.redraw())}function Rn(e){e.drawable.shapes.length&&(e.drawable.shapes=[],e.dom.redraw(),Ge(e.drawable))}function Wn(e){var n;const o=(e.shiftKey||e.ctrlKey)&&De(e),r=e.altKey||e.metaKey||((n=e.getModifierState)===null||n===void 0?void 0:n.call(e,"AltGraph"));return $n[(o?1:0)+(r?2:0)]}function _n(e,n){const o=i=>i.orig===n.orig&&i.dest===n.dest,r=e.shapes.find(o);r&&(e.shapes=e.shapes.filter(i=>!o(i))),(!r||r.brush!==n.brush)&&e.shapes.push({orig:n.orig,dest:n.dest,brush:n.brush}),Ge(e)}function Ge(e){e.onChange&&e.onChange(e.shapes)}function Bn(e,n){if(!n.isTrusted||n.button!==void 0&&n.button!==0||n.touches&&n.touches.length>1)return;const o=e.dom.bounds(),r=E(n),i=H(r,v(e),o);if(!i)return;const t=e.pieces.get(i),c=e.selected;!c&&e.drawable.enabled&&(e.drawable.eraseOnClick||!t||t.color!==e.turnColor)&&Rn(e),n.cancelable!==!1&&(!n.touches||e.blockTouchScroll||t||c||jn(e,r))&&n.preventDefault();const l=!!e.premovable.current,a=!!e.predroppable.current;e.stats.ctrlKey=n.ctrlKey,e.selected&&se(e,e.selected,i)?N(d=>re(d,i),e):re(e,i);const s=e.selected===i,p=Ye(e,i);if(t&&p&&s&&Mn(e,i)){e.draggable.current={orig:i,piece:t,origPos:r,pos:r,started:e.draggable.autoDistance&&e.stats.dragged,element:p,previouslySelected:c,originTarget:n.target,keyHasChanged:!1},p.cgDragging=!0,p.classList.add("dragging");const d=e.dom.elements.ghost;d&&(d.className=`ghost ${t.color} ${t.role}`,q(d,F(o)(g(i),v(e))),ce(d,!0)),fe(e)}else l&&O(e),a&&K(e);e.dom.redraw()}function jn(e,n){const o=v(e),r=e.dom.bounds(),i=Math.pow(r.width/8,2);for(const t of e.pieces.keys()){const c=qe(t,o,r);if(I(c,n)<=i)return!0}return!1}function In(e,n,o,r){const i="a0";e.pieces.set(i,n),e.dom.redraw();const t=E(o);e.draggable.current={orig:i,piece:n,origPos:t,pos:t,started:!0,element:()=>Ye(e,i),originTarget:o.target,newPiece:!0,force:!!r,keyHasChanged:!1},fe(e)}function fe(e){requestAnimationFrame(()=>{var n;const o=e.draggable.current;if(!o)return;!((n=e.animation.current)===null||n===void 0)&&n.plan.anims.has(o.orig)&&(e.animation.current=void 0);const r=e.pieces.get(o.orig);if(!r||!oe(r,o.piece))U(e);else if(!o.started&&I(o.pos,o.origPos)>=Math.pow(e.draggable.distance,2)&&(o.started=!0),o.started){if(typeof o.element=="function"){const t=o.element();if(!t)return;t.cgDragging=!0,t.classList.add("dragging"),o.element=t}const i=e.dom.bounds();q(o.element,[o.pos[0]-i.left-i.width/16,o.pos[1]-i.top-i.height/16]),o.keyHasChanged||(o.keyHasChanged=o.orig!==H(o.pos,v(e),i))}fe(e)})}function Fn(e,n){e.draggable.current&&(!n.touches||n.touches.length<2)&&(e.draggable.current.pos=E(n))}function Vn(e,n){const o=e.draggable.current;if(!o)return;if(n.type==="touchend"&&n.cancelable!==!1&&n.preventDefault(),n.type==="touchend"&&o.originTarget!==n.target&&!o.newPiece){e.draggable.current=void 0;return}O(e),K(e);const r=E(n)||o.pos,i=H(r,v(e),e.dom.bounds());i&&o.started&&o.orig!==i?o.newPiece?Le(e,o.orig,i,o.force):(e.stats.ctrlKey=n.ctrlKey,He(e,o.orig,i)&&(e.stats.dragged=!0)):o.newPiece?e.pieces.delete(o.orig):e.draggable.deleteOnDropOff&&!i&&(e.pieces.delete(o.orig),m(e.events.change)),(o.orig===o.previouslySelected||o.keyHasChanged)&&(o.orig===i||!i)?y(e):e.selectable.enabled||y(e),Ue(e),e.draggable.current=void 0,e.dom.redraw()}function U(e){const n=e.draggable.current;n&&(n.newPiece&&e.pieces.delete(n.orig),e.draggable.current=void 0,y(e),Ue(e),e.dom.redraw())}function Ue(e){const n=e.dom.elements;n.ghost&&ce(n.ghost,!1)}function Ye(e,n){let o=e.dom.elements.board.firstChild;for(;o;){if(o.cgKey===n&&o.tagName==="PIECE")return o;o=o.nextSibling}}function Zn(e,n){e.exploding={stage:1,keys:n},e.dom.redraw(),setTimeout(()=>{ve(e,2),setTimeout(()=>ve(e,void 0),120)},120)}function ve(e,n){e.exploding&&(n?e.exploding.stage=n:e.exploding=void 0,e.dom.redraw())}function Gn(e,n){function o(){gn(e),n()}return{set(r){r.orientation&&r.orientation!==e.orientation&&o(),je(e,r),(r.fen?N:A)(i=>Ie(i,r),e)},state:e,getFen:()=>zn(e.pieces),toggleOrientation:o,setPieces(r){N(i=>mn(i,r),e)},selectSquare(r,i){r?N(t=>re(t,r,i),e):e.selected&&(y(e),e.dom.redraw())},move(r,i){N(t=>$e(t,r,i),e)},newPiece(r,i){N(t=>le(t,r,i),e)},playPremove(){if(e.premovable.current){if(N(Cn,e))return!0;e.dom.redraw()}return!1},playPredrop(r){if(e.predroppable.current){const i=qn(e,r);return e.dom.redraw(),i}return!1},cancelPremove(){A(O,e)},cancelPredrop(){A(K,e)},cancelMove(){A(r=>{de(r),U(r)},e)},stop(){A(r=>{ge(r),U(r)},e)},explode(r){Zn(e,r)},setAutoShapes(r){A(i=>i.drawable.autoShapes=r,e)},setShapes(r){A(i=>i.drawable.shapes=r,e)},getKeyAtDomPos(r){return H(r,v(e),e.dom.bounds())},redrawAll:n,dragNewPiece(r,i,t){In(e,r,i,t)},destroy(){ge(e),e.dom.unbind&&e.dom.unbind(),e.dom.destroyed=!0}}}function Un(){return{pieces:Be(_e),orientation:"white",turnColor:"white",coordinates:!0,ranksPosition:"right",autoCastle:!0,viewOnly:!1,disableContextMenu:!1,addPieceZIndex:!1,blockTouchScroll:!1,pieceKey:!1,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200},movable:{free:!0,color:"both",showDests:!0,events:{},rookCastle:!0},premovable:{enabled:!0,showDests:!0,castle:!0,events:{}},predroppable:{enabled:!1,events:{}},draggable:{enabled:!0,distance:3,autoDistance:!0,showGhost:!0,deleteOnDropOff:!1},dropmode:{active:!1},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{},drawable:{enabled:!0,visible:!0,defaultSnapToValidMove:!0,eraseOnClick:!0,shapes:[],autoShapes:[],brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15}},prevSvgHash:""},hold:ln()}}function ie(e,n,o){const r=new Map,i=[];for(const l of e)r.set(l.hash,!1);let t=n.firstChild,c;for(;t;)c=t.getAttribute("cgHash"),r.has(c)?r.set(c,!0):i.push(t),t=t.nextSibling;for(const l of i)n.removeChild(l);for(const l of e)r.get(l.hash)||n.appendChild(o(l))}function P(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function Yn(e,n,o){const r=e.drawable,i=r.current,t=i&&i.mouseSq?i:void 0,c=new Map,l=e.dom.bounds(),a=r.autoShapes.filter(u=>!u.piece);for(const u of r.shapes.concat(a).concat(t?[t]:[]))u.dest&&c.set(u.dest,(c.get(u.dest)||0)+1);const s=r.shapes.concat(a).map(u=>({shape:u,current:!1,hash:be(u,c,!1,l)}));t&&s.push({shape:t,current:!0,hash:be(t,c,!0,l)});const p=s.map(u=>u.hash).join(";");if(p===e.drawable.prevSvgHash)return;e.drawable.prevSvgHash=p;const d=n.querySelector("defs"),b=n.querySelector("g"),T=o.querySelector("g");Qn(r,s,d),ie(s.filter(u=>!u.shape.customSvg),b,u=>we(e,u,r.brushes,c,l)),ie(s.filter(u=>u.shape.customSvg),T,u=>we(e,u,r.brushes,c,l))}function Qn(e,n,o){const r=new Map;let i;for(const l of n)l.shape.dest&&(i=e.brushes[l.shape.brush],l.shape.modifiers&&(i=Qe(i,l.shape.modifiers)),r.set(i.key,i));const t=new Set;let c=o.firstChild;for(;c;)t.add(c.getAttribute("cgKey")),c=c.nextSibling;for(const[l,a]of r.entries())t.has(l)||o.appendChild(io(a))}function be({orig:e,dest:n,brush:o,piece:r,modifiers:i,customSvg:t},c,l,a){return[a.width,a.height,l,e,n,o,n&&(c.get(n)||0)>1,r&&Xn(r),i&&Jn(i),t&&eo(t)].filter(s=>s).join(",")}function Xn(e){return[e.color,e.role,e.scale].filter(n=>n).join(",")}function Jn(e){return""+(e.lineWidth||"")}function eo(e){let n=0;for(let o=0;o<e.length;o++)n=(n<<5)-n+e.charCodeAt(o)>>>0;return"custom-"+n.toString()}function we(e,{shape:n,current:o,hash:r},i,t,c){let l;const a=ye(g(n.orig),e.orientation);if(n.customSvg)l=no(n.customSvg,a,c);else if(n.dest){let s=i[n.brush];n.modifiers&&(s=Qe(s,n.modifiers)),l=ro(s,a,ye(g(n.dest),e.orientation),o,(t.get(n.dest)||0)>1,c)}else l=oo(i[n.brush],a,o,c);return l.setAttribute("cgHash",r),l}function no(e,n,o){const[r,i]=Y(n,o),t=z(P("g"),{transform:`translate(${r},${i})`}),c=z(P("svg"),{width:1,height:1,viewBox:"0 0 100 100"});return t.appendChild(c),c.innerHTML=e,t}function oo(e,n,o,r){const i=Y(n,r),t=to(),c=(r.width+r.height)/(4*Math.max(r.width,r.height));return z(P("circle"),{stroke:e.color,"stroke-width":t[o?0:1],fill:"none",opacity:Xe(e,o),cx:i[0],cy:i[1],r:c-t[1]/2})}function ro(e,n,o,r,i,t){const c=lo(i&&!r),l=Y(n,t),a=Y(o,t),s=a[0]-l[0],p=a[1]-l[1],d=Math.atan2(p,s),b=Math.cos(d)*c,T=Math.sin(d)*c;return z(P("line"),{stroke:e.color,"stroke-width":co(e,r),"stroke-linecap":"round","marker-end":"url(#arrowhead-"+e.key+")",opacity:Xe(e,r),x1:l[0],y1:l[1],x2:a[0]-b,y2:a[1]-T})}function io(e){const n=z(P("marker"),{id:"arrowhead-"+e.key,orient:"auto",markerWidth:4,markerHeight:8,refX:2.05,refY:2.01});return n.appendChild(z(P("path"),{d:"M0,0 V4 L3,2 Z",fill:e.color})),n.setAttribute("cgKey",e.key),n}function z(e,n){for(const o in n)Object.prototype.hasOwnProperty.call(n,o)&&e.setAttribute(o,n[o]);return e}function ye(e,n){return n==="white"?e:[7-e[0],7-e[1]]}function Qe(e,n){return{color:e.color,opacity:Math.round(e.opacity*10)/10,lineWidth:Math.round(n.lineWidth||e.lineWidth),key:[e.key,n.lineWidth].filter(o=>o).join("")}}function to(){return[3/64,4/64]}function co(e,n){return(e.lineWidth||10)*(n?.85:1)/64}function Xe(e,n){return(e.opacity||1)*(n?.9:1)}function lo(e){return(e?20:10)/64}function Y(e,n){const o=Math.min(1,n.width/n.height),r=Math.min(1,n.height/n.width);return[(e[0]-3.5)*o,(3.5-e[1])*r]}function so(e,n){e.innerHTML="",e.classList.add("cg-wrap");for(const a of sn)e.classList.toggle("orientation-"+a,n.orientation===a);e.classList.toggle("manipulable",!n.viewOnly);const o=x("cg-container");e.appendChild(o);const r=x("cg-board");o.appendChild(r);let i,t,c;if(n.drawable.visible&&(i=z(P("svg"),{class:"cg-shapes",viewBox:"-4 -4 8 8",preserveAspectRatio:"xMidYMid slice"}),i.appendChild(P("defs")),i.appendChild(P("g")),t=z(P("svg"),{class:"cg-custom-svgs",viewBox:"-3.5 -3.5 8 8",preserveAspectRatio:"xMidYMid slice"}),t.appendChild(P("g")),c=x("cg-auto-pieces"),o.appendChild(i),o.appendChild(t),o.appendChild(c)),n.coordinates){const a=n.orientation==="black"?" black":"",s=n.ranksPosition==="left"?" left":"";o.appendChild(ke(an,"ranks"+a+s)),o.appendChild(ke(xe,"files"+a))}let l;return n.draggable.enabled&&n.draggable.showGhost&&(l=x("piece","ghost"),ce(l,!1),o.appendChild(l)),{board:r,container:o,wrap:e,ghost:l,svg:i,customSvg:t,autoPieces:c}}function ke(e,n){const o=x("coords",n);let r;for(const i of e)r=x("coord"),r.textContent=i,o.appendChild(r);return o}function ao(e,n){if(!e.dropmode.active)return;O(e),K(e);const o=e.dropmode.piece;if(o){e.pieces.set("a0",o);const r=E(n),i=r&&H(r,v(e),e.dom.bounds());i&&Le(e,"a0",i)}e.dom.redraw()}function uo(e,n){const o=e.dom.elements.board;if("ResizeObserver"in window&&new ResizeObserver(n).observe(e.dom.elements.wrap),(e.disableContextMenu||e.drawable.enabled)&&o.addEventListener("contextmenu",i=>i.preventDefault()),e.viewOnly)return;const r=po(e);o.addEventListener("touchstart",r,{passive:!1}),o.addEventListener("mousedown",r,{passive:!1})}function fo(e,n){const o=[];if("ResizeObserver"in window||o.push(B(document.body,"chessground.resize",n)),!e.viewOnly){const r=Pe(e,Fn,Hn),i=Pe(e,Vn,Ln);for(const c of["touchmove","mousemove"])o.push(B(document,c,r));for(const c of["touchend","mouseup"])o.push(B(document,c,i));const t=()=>e.dom.bounds.clear();o.push(B(document,"scroll",t,{capture:!0,passive:!0})),o.push(B(window,"resize",t,{passive:!0}))}return()=>o.forEach(r=>r())}function B(e,n,o,r){return e.addEventListener(n,o,r),()=>e.removeEventListener(n,o,r)}const po=e=>n=>{e.draggable.current?U(e):e.drawable.current?Ze(e):n.shiftKey||De(n)?e.drawable.enabled&&En(e,n):e.viewOnly||(e.dropmode.active?ao(e,n):Bn(e,n))},Pe=(e,n,o)=>r=>{e.drawable.current?e.drawable.enabled&&o(e,r):e.viewOnly||n(e,r)};function ho(e){const n=v(e),o=F(e.dom.bounds()),r=e.dom.elements.board,i=e.pieces,t=e.animation.current,c=t?t.plan.anims:new Map,l=t?t.plan.fadings:new Map,a=e.draggable.current,s=mo(e),p=new Set,d=new Set,b=new Map,T=new Map;let u,f,V,L,k,W,Q,S,X,Z;for(f=r.firstChild;f;){if(u=f.cgKey,Je(f))if(V=i.get(u),k=c.get(u),W=l.get(u),L=f.cgPiece,f.cgDragging&&(!a||a.orig!==u)&&(f.classList.remove("dragging"),q(f,o(g(u),n)),f.cgDragging=!1),!W&&f.cgFading&&(f.cgFading=!1,f.classList.remove("fading")),V){if(k&&f.cgAnimating&&L===j(V)){const h=g(u);h[0]+=k[2],h[1]+=k[3],f.classList.add("anim"),q(f,o(h,n))}else f.cgAnimating&&(f.cgAnimating=!1,f.classList.remove("anim"),q(f,o(g(u),n)),e.addPieceZIndex&&(f.style.zIndex=ee(g(u),n)));L===j(V)&&(!W||!f.cgFading)?p.add(u):W&&L===j(W)?(f.classList.add("fading"),f.cgFading=!0):ne(b,L,f)}else ne(b,L,f);else if(en(f)){const h=f.className;s.get(u)===h?d.add(u):ne(T,h,f)}f=f.nextSibling}for(const[h,_]of s)if(!d.has(h)){X=T.get(_),Z=X&&X.pop();const M=o(g(h),n);if(Z)Z.cgKey=h,q(Z,M);else{const C=x("square",_);C.cgKey=h,q(C,M),r.insertBefore(C,r.firstChild)}}for(const[h,_]of i)if(k=c.get(h),!p.has(h))if(Q=b.get(j(_)),S=Q&&Q.pop(),S){S.cgKey=h,S.cgFading&&(S.classList.remove("fading"),S.cgFading=!1);const M=g(h);e.addPieceZIndex&&(S.style.zIndex=ee(M,n)),k&&(S.cgAnimating=!0,S.classList.add("anim"),M[0]+=k[2],M[1]+=k[3]),q(S,o(M,n))}else{const M=j(_),C=x("piece",M),G=g(h);C.cgPiece=M,C.cgKey=h,k&&(C.cgAnimating=!0,G[0]+=k[2],G[1]+=k[3]),q(C,o(G,n)),e.addPieceZIndex&&(C.style.zIndex=ee(G,n)),r.appendChild(C)}for(const h of b.values())Me(e,h);for(const h of T.values())Me(e,h)}function go(e){const n=v(e),o=F(e.dom.bounds());let r=e.dom.elements.board.firstChild;for(;r;)(Je(r)&&!r.cgAnimating||en(r))&&q(r,o(g(r.cgKey),n)),r=r.nextSibling}function Se(e){var n,o;const r=e.dom.elements.wrap.getBoundingClientRect(),i=e.dom.elements.container,t=r.height/r.width,c=Math.floor(r.width*window.devicePixelRatio/8)*8/window.devicePixelRatio,l=c*t;i.style.width=c+"px",i.style.height=l+"px",e.dom.bounds.clear(),(n=e.addDimensionsCssVarsTo)===null||n===void 0||n.style.setProperty("--cg-width",c+"px"),(o=e.addDimensionsCssVarsTo)===null||o===void 0||o.style.setProperty("--cg-height",l+"px")}const Je=e=>e.tagName==="PIECE",en=e=>e.tagName==="SQUARE";function Me(e,n){for(const o of n)e.dom.elements.board.removeChild(o)}function ee(e,n){const r=e[1];return`${n?3+7-r:3+r}`}const j=e=>`${e.color} ${e.role}`;function mo(e){var n;const o=new Map;if(e.lastMove&&e.highlight.lastMove)for(const t of e.lastMove)D(o,t,"last-move");if(e.check&&e.highlight.check&&D(o,e.check,"check"),e.selected&&(D(o,e.selected,"selected"),e.movable.showDests)){const t=(n=e.movable.dests)===null||n===void 0?void 0:n.get(e.selected);if(t)for(const l of t)D(o,l,"move-dest"+(e.pieces.has(l)?" oc":""));const c=e.premovable.dests;if(c)for(const l of c)D(o,l,"premove-dest"+(e.pieces.has(l)?" oc":""))}const r=e.premovable.current;if(r)for(const t of r)D(o,t,"current-premove");else e.predroppable.current&&D(o,e.predroppable.current.key,"current-premove");const i=e.exploding;if(i)for(const t of i.keys)D(o,t,"exploding"+i.stage);return o}function D(e,n,o){const r=e.get(n);r?e.set(n,`${r} ${o}`):e.set(n,o)}function ne(e,n,o){const r=e.get(n);r?r.push(o):e.set(n,[o])}function vo(e,n){const r=e.drawable.autoShapes.filter(i=>i.piece).map(i=>({shape:i,hash:yo(i),current:!1}));ie(r,n,i=>wo(e,i,e.dom.bounds()))}function bo(e){var n;const o=v(e),r=F(e.dom.bounds());let i=(n=e.dom.elements.autoPieces)===null||n===void 0?void 0:n.firstChild;for(;i;)Ae(i,r(g(i.cgKey),o),i.cgScale),i=i.nextSibling}function wo(e,{shape:n,hash:o},r){var i,t,c;const l=n.orig,a=(i=n.piece)===null||i===void 0?void 0:i.role,s=(t=n.piece)===null||t===void 0?void 0:t.color,p=(c=n.piece)===null||c===void 0?void 0:c.scale,d=x("piece",`${a} ${s}`);return d.setAttribute("cgHash",o),d.cgKey=l,d.cgScale=p,Ae(d,F(r)(g(l),v(e)),p),d}const yo=e=>{var n,o,r;return[e.orig,(n=e.piece)===null||n===void 0?void 0:n.role,(o=e.piece)===null||o===void 0?void 0:o.color,(r=e.piece)===null||r===void 0?void 0:r.scale].join(",")};function ko(e,n){const o=Un();Ie(o,n||{});function r(){const i="dom"in o?o.dom.unbind:void 0,t=so(e,o),c=dn(()=>t.board.getBoundingClientRect()),l=p=>{ho(s),t.autoPieces&&vo(s,t.autoPieces),!p&&t.svg&&Yn(s,t.svg,t.customSvg)},a=()=>{Se(s),go(s),t.autoPieces&&bo(s)},s=o;return s.dom={elements:t,bounds:c,redraw:Po(l),redrawNow:l,unbind:i},s.drawable.prevSvgHash="",Se(s),l(!1),uo(s,a),i||(s.dom.unbind=fo(s,a)),s.events.insert&&s.events.insert(t),s}return Gn(r(),r)}function Po(e){let n=!1;return()=>{n||(n=!0,requestAnimationFrame(()=>{e(),n=!1}))}}const So=rn('<div class="is2d"><div> </div></div>'),Do=e=>{let[n,o]=nn(void 0,{equals:!1}),r;pe(he(()=>(n(),e.glyphs),c=>{r&&(c?r.setAutoShapes(c.map(l=>({orig:l.orig,customSvg:Mo[l.glyph]}))):r.setAutoShapes([]))}));let i=new Map;pe(he(()=>(n(),e.fen),c=>{if(!r||!c)return;i=new Map,new un(c).moves({verbose:!0}).forEach(a=>{i.get(a.from)||i.set(a.from,[]),i.get(a.from).push(a.to)}),r==null||r.set({fen:c,movable:{dests:i}})}));let t={viewOnly:!e.onUserMove,orientation:e.isBlack?"black":"white",movable:{free:!1,dests:i},events:{move(c,l){var a;(a=e.onUserMove)==null||a.call(e,c+l)}}};return(()=>{const c=So.cloneNode(!0),l=c.firstChild;return on(a=>setTimeout(()=>{r=ko(a,t),o()}),l),c})()},R=e=>`
<defs>
  <filter id="shadow">
    <feDropShadow dx="4" dy="7" stdDeviation="5" flood-opacity="0.5" />
  </filter>
</defs>`+e,Mo={"?!":R(`
<g transform="translate(77 -18) scale(0.4)">
  <circle style="fill:#56b4e9;filter:url(#shadow)" cx="50" cy="50" r="50" />
  <path fill="#fff" d="M37.734 21.947c-3.714 0-7.128.464-10.242 1.393-3.113.928-6.009 2.13-8.685 3.605l4.343 8.766c2.35-1.202 4.644-2.157 6.883-2.867a22.366 22.366 0 0 1 6.799-1.065c2.294 0 4.07.464 5.326 1.393 1.311.874 1.967 2.186 1.967 3.933 0 1.748-.546 3.277-1.639 4.588-1.038 1.257-2.786 2.758-5.244 4.506-2.786 2.021-4.751 3.961-5.898 5.819-1.147 1.857-1.721 4.15-1.721 6.88v2.952h10.568v-2.377c0-1.147.137-2.103.41-2.868.328-.764.93-1.557 1.803-2.376.874-.82 2.104-1.803 3.688-2.95 2.13-1.584 3.906-3.058 5.326-4.424 1.42-1.42 2.485-2.95 3.195-4.59.71-1.638 1.065-3.576 1.065-5.816 0-4.206-1.584-7.675-4.752-10.406-3.114-2.731-7.51-4.096-13.192-4.096zm24.745.819l2.048 39.084h9.75l2.047-39.084zM35.357 68.73c-1.966 0-3.632.52-4.998 1.557-1.365.983-2.047 2.732-2.047 5.244 0 2.404.682 4.152 2.047 5.244 1.366 1.038 3.032 1.557 4.998 1.557 1.912 0 3.55-.519 4.916-1.557 1.366-1.092 2.05-2.84 2.05-5.244 0-2.512-.684-4.26-2.05-5.244-1.365-1.038-3.004-1.557-4.916-1.557zm34.004 0c-1.966 0-3.632.52-4.998 1.557-1.365.983-2.049 2.732-2.049 5.244 0 2.404.684 4.152 2.05 5.244 1.365 1.038 3.03 1.557 4.997 1.557 1.912 0 3.55-.519 4.916-1.557 1.366-1.092 2.047-2.84 2.047-5.244 0-2.512-.681-4.26-2.047-5.244-1.365-1.038-3.004-1.557-4.916-1.557z"/>
</g>
`),"?":R(`
<g transform="translate(77 -18) scale(0.4)">
  <circle style="fill:#e69f00;filter:url(#shadow)" cx="50" cy="50" r="50" />
  <path fill="#fff" d="M40.436 60.851q0-4.66 1.957-7.83 1.958-3.17 6.712-6.619 4.195-2.983 5.967-5.127 1.864-2.237 1.864-5.22 0-2.983-2.237-4.475-2.144-1.585-6.06-1.585-3.915 0-7.737 1.212t-7.83 3.263l-4.941-9.975q4.568-2.517 9.881-4.101 5.314-1.585 11.653-1.585 9.695 0 15.008 4.661 5.407 4.661 5.407 11.839 0 3.822-1.212 6.619-1.212 2.796-3.635 5.22-2.424 2.33-6.06 5.034-2.703 1.958-4.195 3.356-1.491 1.398-2.05 2.703-.467 1.305-.467 3.263v2.703H40.436zm-1.492 18.924q0-4.288 2.33-5.966 2.331-1.771 5.687-1.771 3.263 0 5.594 1.771 2.33 1.678 2.33 5.966 0 4.102-2.33 5.966-2.331 1.772-5.594 1.772-3.356 0-5.686-1.772-2.33-1.864-2.33-5.966z"/>
</g>
`),"??":R(`
<g transform="translate(77 -18) scale(0.4)">
  <circle style="fill:#df5353;filter:url(#shadow)" cx="50" cy="50" r="50" />
  <path fill="#fff" d="M31.8 22.22c-3.675 0-7.052.46-10.132 1.38-3.08.918-5.945 2.106-8.593 3.565l4.298 8.674c2.323-1.189 4.592-2.136 6.808-2.838a22.138 22.138 0 0 1 6.728-1.053c2.27 0 4.025.46 5.268 1.378 1.297.865 1.946 2.16 1.946 3.89s-.541 3.242-1.622 4.539c-1.027 1.243-2.756 2.73-5.188 4.458-2.756 2-4.7 3.918-5.836 5.755-1.134 1.837-1.702 4.107-1.702 6.808v2.92h10.457v-2.35c0-1.135.135-2.082.406-2.839.324-.756.918-1.54 1.783-2.35.864-.81 2.079-1.784 3.646-2.918 2.107-1.568 3.863-3.026 5.268-4.376 1.405-1.405 2.46-2.92 3.162-4.541.703-1.621 1.054-3.54 1.054-5.755 0-4.161-1.568-7.592-4.702-10.294-3.08-2.702-7.43-4.052-13.05-4.052zm38.664 0c-3.675 0-7.053.46-10.133 1.38-3.08.918-5.944 2.106-8.591 3.565l4.295 8.674c2.324-1.189 4.593-2.136 6.808-2.838a22.138 22.138 0 0 1 6.728-1.053c2.27 0 4.026.46 5.269 1.378 1.297.865 1.946 2.16 1.946 3.89s-.54 3.242-1.62 4.539c-1.027 1.243-2.757 2.73-5.189 4.458-2.756 2-4.7 3.918-5.835 5.755-1.135 1.837-1.703 4.107-1.703 6.808v2.92h10.457v-2.35c0-1.135.134-2.082.404-2.839.324-.756.918-1.54 1.783-2.35.865-.81 2.081-1.784 3.648-2.918 2.108-1.568 3.864-3.026 5.269-4.376 1.405-1.405 2.46-2.92 3.162-4.541.702-1.621 1.053-3.54 1.053-5.755 0-4.161-1.567-7.592-4.702-10.294-3.08-2.702-7.43-4.052-13.05-4.052zM29.449 68.504c-1.945 0-3.593.513-4.944 1.54-1.351.973-2.027 2.703-2.027 5.188 0 2.378.676 4.108 2.027 5.188 1.35 1.027 3 1.54 4.944 1.54 1.892 0 3.512-.513 4.863-1.54 1.35-1.08 2.026-2.81 2.026-5.188 0-2.485-.675-4.215-2.026-5.188-1.351-1.027-2.971-1.54-4.863-1.54zm38.663 0c-1.945 0-3.592.513-4.943 1.54-1.35.973-2.026 2.703-2.026 5.188 0 2.378.675 4.108 2.026 5.188 1.351 1.027 2.998 1.54 4.943 1.54 1.891 0 3.513-.513 4.864-1.54 1.351-1.08 2.027-2.81 2.027-5.188 0-2.485-.676-4.215-2.027-5.188-1.35-1.027-2.973-1.54-4.864-1.54z"/>
</g>
`),"!?":R(`
<g transform="translate(77 -18) scale(0.4)">
  <circle style="fill:#ea45d8;filter:url(#shadow)" cx="50" cy="50" r="50"/>
    <path fill="#fff" d="M60.823 58.9q0-4.098 1.72-6.883 1.721-2.786 5.9-5.818 3.687-2.622 5.243-4.506 1.64-1.966 1.64-4.588t-1.967-3.933q-1.885-1.393-5.326-1.393t-6.8 1.065q-3.36 1.065-6.883 2.868l-4.343-8.767q4.015-2.212 8.685-3.605 4.67-1.393 10.242-1.393 8.521 0 13.192 4.097 4.752 4.096 4.752 10.405 0 3.36-1.065 5.818-1.066 2.458-3.196 4.588-2.13 2.048-5.326 4.424-2.376 1.72-3.687 2.95-1.31 1.229-1.802 2.376-.41 1.147-.41 2.868v2.376h-10.57zm-1.311 16.632q0-3.77 2.048-5.244 2.049-1.557 4.998-1.557 2.868 0 4.916 1.557 2.049 1.475 2.049 5.244 0 3.605-2.049 5.244-2.048 1.556-4.916 1.556-2.95 0-4.998-1.556-2.048-1.64-2.048-5.244zM36.967 61.849h-9.75l-2.049-39.083h13.847zM25.004 75.532q0-3.77 2.049-5.244 2.048-1.557 4.998-1.557 2.867 0 4.916 1.557 2.048 1.475 2.048 5.244 0 3.605-2.048 5.244-2.049 1.556-4.916 1.556-2.95 0-4.998-1.556-2.049-1.64-2.049-5.244z" vector-effect="non-scaling-stroke"/>
</g>
`),"!":R(`
<g transform="translate(77 -18) scale(0.4)">
  <circle style="fill:#22ac38;filter:url(#shadow)" cx="50" cy="50" r="50" />
  <path fill="#fff" d="M54.967 62.349h-9.75l-2.049-39.083h13.847zM43.004 76.032q0-3.77 2.049-5.244 2.048-1.557 4.998-1.557 2.867 0 4.916 1.557 2.048 1.475 2.048 5.244 0 3.605-2.048 5.244-2.049 1.556-4.916 1.556-2.95 0-4.998-1.556-2.049-1.64-2.049-5.244z" vector-effect="non-scaling-stroke"/>
</g>
`),"!!":R(`
<g transform="translate(77 -18) scale(0.4)">
  <circle style="fill:#168226;filter:url(#shadow)" cx="50" cy="50" r="50" />
  <path fill="#fff" d="M71.967 62.349h-9.75l-2.049-39.083h13.847zM60.004 76.032q0-3.77 2.049-5.244 2.048-1.557 4.998-1.557 2.867 0 4.916 1.557 2.048 1.475 2.048 5.244 0 3.605-2.048 5.244-2.049 1.556-4.916 1.556-2.95 0-4.998-1.556-2.049-1.64-2.049-5.244zM37.967 62.349h-9.75l-2.049-39.083h13.847zM26.004 76.032q0-3.77 2.049-5.244 2.048-1.557 4.998-1.557 2.867 0 4.916 1.557 2.048 1.475 2.048 5.244 0 3.605-2.048 5.244-2.049 1.556-4.916 1.556-2.95 0-4.998-1.556-2.049-1.64-2.049-5.244z" vector-effect="non-scaling-stroke"/>
</g>
`)};export{Do as G};
