import{g as X,a as x,b as u,h as S,o as j,c as h,T as Y,i as d,j as Z,S as q,t as f,F as A,f as ee}from"./index-8dd89830.js";import{C as te,G as ne}from"./ctrl-c87021e3.js";import{c as N}from"./store-00e80bbf.js";import{C as se}from"./challenges-ef4b4201.js";const re=f(`<div class="result-wrap"><div class="result"></div>Eval dropped below 2. Game's over.</div>`),le=f('<button class="fbt">Analyse on Lichess</button>'),oe=f('<button class="fbt">Rematch</button>'),ce=f('<div class="hardcore"><div class="board"></div><div class="table"><div class="ceval"></div><div class="replay"></div><div class="rcontrols"><div class="follow-up"></div></div></div></div>'),ae=f('<span class="index"></span>'),ie=f('<div class="move"></div>'),B=r=>50+50*(2/(1+Math.exp(- -.00368208*r))-1),D=r=>{if(r!==void 0)return Math.abs(r)<10?"!":r<-30?"??":r<-20?"?!":r<-10?"?":void 0},H=(r,m)=>r.move(m,{sloppy:!0})||r.move("O-O")||r.move("O-O-O"),me=()=>{let[r,m]=X();const o=r.color==="black",l=parseInt(r.level),c=o?"black":"white",_={level:l,color:c},L=c==="white"?"black":"white",O=c[0];let[$,C]=x(new N.Chess,{equals:!1}),[v,T]=x(!1),b;const P=u(()=>$().turn()),w=u(()=>$().fen()),R=u(()=>$().pgn()),p=u(()=>{let e=new N.Chess;return $().history({verbose:!0}).map((t,s)=>{const n=e.move(t.san);return{ply:s,fen:e.fen(),turn:e.turn(),uci:n.from+n.to,san:n.san}})});u(()=>{let e=p();if(e.length>1)return e[e.length-2].fen});const[E,U]=x(new Map,{equals:!1});let I=new te({emit(e){e.depth>=l&&U(t=>(t.set(e.fen,e),t))}});S(j(w,e=>{I.start("",p())})),S(()=>{p(),v(),b&&b.scrollTo(0,b.scrollHeight)});const k=e=>{const t=E().get(e);if(!(!t||!t.cp||t.depth<l))return t.cp/100},M=u(()=>k(w())||0),F=(e,t)=>{const s=k(e),n=k(t);if(!(s===void 0||n===void 0))return(B(s*100)-B(n*100))*(o?-1:1)},z=u(()=>{let e=p();if(e.length>=3){let[t,s,n]=e.slice(-3),i=D(F(s.fen,t.fen)),y=D(F(n.fen,s.fen)),g=[];return t.turn===O&&i&&g.push({orig:s.uci.slice(2),glyph:i}),s.turn===O&&y&&g.push({orig:n.uci.slice(2),glyph:y}),g}return[]});function G(){const e=E().get(w());if(!v()&&e&&P()===L[0]&&e.depth>=l)if((o?M():-M())<-2.1)T(!0);else{let s=e.pvs[0].moves[0];C(n=>(H(n,s),n))}setTimeout(G,500)}setTimeout(G,500);const J=u(()=>Math.floor(p().length/2)),K=e=>{C(t=>(H(t,e),t))},Q=()=>{let e=R(),t=new FormData;t.append("pgn",e);let s="white";fetch("https://lichess.org/api/import",{method:"post",body:t}).then(n=>n.json()).then(n=>{let i=n.url;window.open(`${i}/${s}#${p().length}`,"_blank")})},V=()=>{T(!1),C(new N.Chess)};return S(j(v,e=>{if(e){let t={moves:p().map(s=>s.uci),color:c};se.check_challenge_game(t,_)}})),[h(Y,{children:" aidchess.com - Hardcore Chess "}),(()=>{const e=ce.cloneNode(!0),t=e.firstChild,s=t.nextSibling,n=s.firstChild,i=n.nextSibling,y=i.nextSibling,g=y.firstChild;return d(t,h(ne,{get glyphs(){return z()},get fen(){return w()},isBlack:o,onUserMove:K})),d(n,()=>-M()),Z(a=>b=a,i),d(i,h(ue,{get steps(){return p()}}),null),d(i,h(q,{get when(){return v()},get children(){const a=re.cloneNode(!0),W=a.firstChild;return d(W,J),a}}),null),d(g,h(q,{get when(){return v()},get children(){return[(()=>{const a=le.cloneNode(!0);return a.$$click=()=>Q(),a})(),(()=>{const a=oe.cloneNode(!0);return a.$$click=()=>V(),a})()]}})),e})()]},ue=r=>{let m=u(()=>{let o=r.steps,l=[],c=[];return o.forEach(_=>{l.push(_),_.ply%2===1&&(c.push(l),l=[])}),c});return h(A,{get each(){return m()},children:o=>[(()=>{const l=ae.cloneNode(!0);return d(l,()=>o[0].ply/2+1),l})(),h(A,{each:o,children:l=>(()=>{const c=ie.cloneNode(!0);return d(c,()=>l.san),c})()})]})};ee(["click"]);export{me as default};
