var Gt=Object.defineProperty;var Vt=(e,t,n)=>t in e?Gt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var W=(e,t,n)=>(Vt(e,typeof t!="symbol"?t+"":t,n),n);import{a as Te,g as Ie,o as $e,h as vt,t as ve,j as Zt,b as re,c as me,T as Yt,i as ae,S as tt,F as nt,f as Xt}from"./index-01031dfe.js";const Jt=["white","black"],Fe=["a","b","c","d","e","f","g","h"],Ue=["1","2","3","4","5","6","7","8"],en=[...Ue].reverse(),xe=Array.prototype.concat(...Fe.map(e=>Ue.map(t=>e+t))),X=e=>xe[8*e[0]+e[1]],D=e=>[e.charCodeAt(0)-97,e.charCodeAt(1)-49],bt=xe.map(D);function tn(e){let t;const n=()=>(t===void 0&&(t=e()),t);return n.clear=()=>{t=void 0},n}const nn=()=>{let e;return{start(){e=performance.now()},cancel(){e=void 0},stop(){if(!e)return 0;const t=performance.now()-e;return e=void 0,t}}},ze=e=>e==="white"?"black":"white",Me=(e,t)=>{const n=e[0]-t[0],i=e[1]-t[1];return n*n+i*i},Be=(e,t)=>e.role===t.role&&e.color===t.color,Ee=e=>(t,n)=>[(n?t[0]:7-t[0])*e.width/8,(n?7-t[1]:t[1])*e.height/8],ne=(e,t)=>{e.style.transform=`translate(${t[0]}px,${t[1]}px)`},_t=(e,t,n=1)=>{e.style.transform=`translate(${t[0]}px,${t[1]}px) scale(${n})`},je=(e,t)=>{e.style.visibility=t?"visible":"hidden"},be=e=>{var t;if(e.clientX||e.clientX===0)return[e.clientX,e.clientY];if(!((t=e.targetTouches)===null||t===void 0)&&t[0])return[e.targetTouches[0].clientX,e.targetTouches[0].clientY]},wt=e=>e.buttons===2||e.button===2,oe=(e,t)=>{const n=document.createElement(e);return t&&(n.className=t),n};function kt(e,t,n){const i=D(e);return t||(i[0]=7-i[0],i[1]=7-i[1]),[n.left+n.width*i[0]/8+n.width/16,n.top+n.height*(7-i[1])/8+n.height/16]}const ge=(e,t)=>Math.abs(e-t),rn=e=>(t,n,i,r)=>ge(t,i)<2&&(e==="white"?r===n+1||n<=1&&r===n+2&&t===i:r===n-1||n>=6&&r===n-2&&t===i),yt=(e,t,n,i)=>{const r=ge(e,n),s=ge(t,i);return r===1&&s===2||r===2&&s===1},St=(e,t,n,i)=>ge(e,n)===ge(t,i),Pt=(e,t,n,i)=>e===n||t===i,Ct=(e,t,n,i)=>St(e,t,n,i)||Pt(e,t,n,i),on=(e,t,n)=>(i,r,s,a)=>ge(i,s)<2&&ge(r,a)<2||n&&r===a&&r===(e==="white"?0:7)&&(i===4&&(s===2&&t.includes(0)||s===6&&t.includes(7))||t.includes(s));function sn(e,t){const n=t==="white"?"1":"8",i=[];for(const[r,s]of e)r[1]===n&&s.color===t&&s.role==="rook"&&i.push(D(r)[0]);return i}function Mt(e,t,n){const i=e.get(t);if(!i)return[];const r=D(t),s=i.role,a=s==="pawn"?rn(i.color):s==="knight"?yt:s==="bishop"?St:s==="rook"?Pt:s==="queen"?Ct:on(i.color,sn(e,i.color),n);return bt.filter(d=>(r[0]!==d[0]||r[1]!==d[1])&&a(r[0],r[1],d[0],d[1])).map(X)}function Q(e,...t){e&&setTimeout(()=>e(...t),1)}function ln(e){e.orientation=ze(e.orientation),e.animation.current=e.draggable.current=e.selected=void 0}function cn(e,t){for(const[n,i]of t)i?e.pieces.set(n,i):e.pieces.delete(n)}function an(e,t){if(e.check=void 0,t===!0&&(t=e.turnColor),t)for(const[n,i]of e.pieces)i.role==="king"&&i.color===t&&(e.check=n)}function fn(e,t,n,i){he(e),e.premovable.current=[t,n],Q(e.premovable.events.set,t,n,i)}function de(e){e.premovable.current&&(e.premovable.current=void 0,Q(e.premovable.events.unset))}function un(e,t,n){de(e),e.predroppable.current={role:t,key:n},Q(e.predroppable.events.set,t,n)}function he(e){const t=e.predroppable;t.current&&(t.current=void 0,Q(t.events.unset))}function dn(e,t,n){if(!e.autoCastle)return!1;const i=e.pieces.get(t);if(!i||i.role!=="king")return!1;const r=D(t),s=D(n);if(r[1]!==0&&r[1]!==7||r[1]!==s[1])return!1;r[0]===4&&!e.pieces.has(n)&&(s[0]===6?n=X([7,s[1]]):s[0]===2&&(n=X([0,s[1]])));const a=e.pieces.get(n);return!a||a.color!==i.color||a.role!=="rook"?!1:(e.pieces.delete(t),e.pieces.delete(n),r[0]<s[0]?(e.pieces.set(X([6,s[1]]),i),e.pieces.set(X([5,s[1]]),a)):(e.pieces.set(X([2,s[1]]),i),e.pieces.set(X([3,s[1]]),a)),!0)}function Et(e,t,n){const i=e.pieces.get(t),r=e.pieces.get(n);if(t===n||!i)return!1;const s=r&&r.color!==i.color?r:void 0;return n===e.selected&&J(e),Q(e.events.move,t,n,s),dn(e,t,n)||(e.pieces.set(n,i),e.pieces.delete(t)),e.lastMove=[t,n],e.check=void 0,Q(e.events.change),s||!0}function Qe(e,t,n,i){if(e.pieces.has(n))if(i)e.pieces.delete(n);else return!1;return Q(e.events.dropNewPiece,t,n),e.pieces.set(n,t),e.lastMove=[n],e.check=void 0,Q(e.events.change),e.movable.dests=void 0,e.turnColor=ze(e.turnColor),!0}function At(e,t,n){const i=Et(e,t,n);return i&&(e.movable.dests=void 0,e.turnColor=ze(e.turnColor),e.animation.current=void 0),i}function Nt(e,t,n){if(Ge(e,t,n)){const i=At(e,t,n);if(i){const r=e.hold.stop();J(e);const s={premove:!1,ctrlKey:e.stats.ctrlKey,holdTime:r};return i!==!0&&(s.captured=i),Q(e.movable.events.after,t,n,s),!0}}else if(pn(e,t,n))return fn(e,t,n,{ctrlKey:e.stats.ctrlKey}),J(e),!0;return J(e),!1}function Tt(e,t,n,i){const r=e.pieces.get(t);r&&(hn(e,t,n)||i)?(e.pieces.delete(t),Qe(e,r,n,i),Q(e.movable.events.afterNewPiece,r.role,n,{premove:!1,predrop:!1})):r&&mn(e,t,n)?un(e,r.role,n):(de(e),he(e)),e.pieces.delete(t),J(e)}function He(e,t,n){if(Q(e.events.select,t),e.selected){if(e.selected===t&&!e.draggable.enabled){J(e),e.hold.cancel();return}else if((e.selectable.enabled||n)&&e.selected!==t&&Nt(e,e.selected,t)){e.stats.dragged=!1;return}}(e.selectable.enabled||e.draggable.enabled)&&(Ot(e,t)||Ve(e,t))&&(It(e,t),e.hold.start())}function It(e,t){e.selected=t,Ve(e,t)?e.premovable.dests=Mt(e.pieces,t,e.premovable.castle):e.premovable.dests=void 0}function J(e){e.selected=void 0,e.premovable.dests=void 0,e.hold.cancel()}function Ot(e,t){const n=e.pieces.get(t);return!!n&&(e.movable.color==="both"||e.movable.color===n.color&&e.turnColor===n.color)}const Ge=(e,t,n)=>{var i,r;return t!==n&&Ot(e,t)&&(e.movable.free||!!(!((r=(i=e.movable.dests)===null||i===void 0?void 0:i.get(t))===null||r===void 0)&&r.includes(n)))};function hn(e,t,n){const i=e.pieces.get(t);return!!i&&(t===n||!e.pieces.has(n))&&(e.movable.color==="both"||e.movable.color===i.color&&e.turnColor===i.color)}function Ve(e,t){const n=e.pieces.get(t);return!!n&&e.premovable.enabled&&e.movable.color===n.color&&e.turnColor!==n.color}const pn=(e,t,n)=>t!==n&&Ve(e,t)&&Mt(e.pieces,t,e.premovable.castle).includes(n);function mn(e,t,n){const i=e.pieces.get(t),r=e.pieces.get(n);return!!i&&(!r||r.color!==e.movable.color)&&e.predroppable.enabled&&(i.role!=="pawn"||n[1]!=="1"&&n[1]!=="8")&&e.movable.color===i.color&&e.turnColor!==i.color}function gn(e,t){const n=e.pieces.get(t);return!!n&&e.draggable.enabled&&(e.movable.color==="both"||e.movable.color===n.color&&(e.turnColor===n.color||e.premovable.enabled))}function vn(e){const t=e.premovable.current;if(!t)return!1;const n=t[0],i=t[1];let r=!1;if(Ge(e,n,i)){const s=At(e,n,i);if(s){const a={premove:!0};s!==!0&&(a.captured=s),Q(e.movable.events.after,n,i,a),r=!0}}return de(e),r}function bn(e,t){const n=e.predroppable.current;let i=!1;if(!n)return!1;if(t(n)){const r={role:n.role,color:e.movable.color};Qe(e,r,n.key)&&(Q(e.movable.events.afterNewPiece,n.role,n.key,{premove:!1,predrop:!0}),i=!0)}return he(e),i}function Ze(e){de(e),he(e),J(e)}function it(e){e.movable.color=e.movable.dests=e.animation.current=void 0,Ze(e)}function _e(e,t,n){let i=Math.floor(8*(e[0]-n.left)/n.width);t||(i=7-i);let r=7-Math.floor(8*(e[1]-n.top)/n.height);return t||(r=7-r),i>=0&&i<8&&r>=0&&r<8?X([i,r]):void 0}function _n(e,t,n,i){const r=D(e),s=bt.filter(p=>Ct(r[0],r[1],p[0],p[1])||yt(r[0],r[1],p[0],p[1])),d=s.map(p=>kt(X(p),n,i)).map(p=>Me(t,p)),[,v]=d.reduce((p,M,_)=>p[0]<M?p:[M,_],[d[0],0]);return X(s[v])}const G=e=>e.orientation==="white",Kt="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",wn={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king"},kn={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};function qt(e){e==="start"&&(e=Kt);const t=new Map;let n=7,i=0;for(const r of e)switch(r){case" ":case"[":return t;case"/":if(--n,n<0)return t;i=0;break;case"~":{const s=t.get(X([i-1,n]));s&&(s.promoted=!0);break}default:{const s=r.charCodeAt(0);if(s<57)i+=s-48;else{const a=r.toLowerCase();t.set(X([i,n]),{role:wn[a],color:r===a?"black":"white"}),++i}}}return t}function yn(e){return en.map(t=>Fe.map(n=>{const i=e.get(n+t);if(i){let r=kn[i.role];return i.color==="white"&&(r=r.toUpperCase()),i.promoted&&(r+="~"),r}else return"1"}).join("")).join("/").replace(/1{2,}/g,t=>t.length.toString())}function Rt(e,t){t.animation&&(Ye(e.animation,t.animation),(e.animation.duration||0)<70&&(e.animation.enabled=!1))}function Dt(e,t){var n,i;if(!((n=t.movable)===null||n===void 0)&&n.dests&&(e.movable.dests=void 0),!((i=t.drawable)===null||i===void 0)&&i.autoShapes&&(e.drawable.autoShapes=[]),Ye(e,t),t.fen&&(e.pieces=qt(t.fen),e.drawable.shapes=[]),"check"in t&&an(e,t.check||!1),"lastMove"in t&&!t.lastMove?e.lastMove=void 0:t.lastMove&&(e.lastMove=t.lastMove),e.selected&&It(e,e.selected),Rt(e,t),!e.movable.rookCastle&&e.movable.dests){const r=e.movable.color==="white"?"1":"8",s="e"+r,a=e.movable.dests.get(s),d=e.pieces.get(s);if(!a||!d||d.role!=="king")return;e.movable.dests.set(s,a.filter(v=>!(v==="a"+r&&a.includes("c"+r))&&!(v==="h"+r&&a.includes("g"+r))))}}function Ye(e,t){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(Object.prototype.hasOwnProperty.call(e,n)&&rt(e[n])&&rt(t[n])?Ye(e[n],t[n]):e[n]=t[n])}function rt(e){if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return t===Object.prototype||t===null}const pe=(e,t)=>t.animation.enabled?Cn(e,t):ce(e,t);function ce(e,t){const n=e(t);return t.dom.redraw(),n}const Re=(e,t)=>({key:e,pos:D(e),piece:t}),Sn=(e,t)=>t.sort((n,i)=>Me(e.pos,n.pos)-Me(e.pos,i.pos))[0];function Pn(e,t){const n=new Map,i=[],r=new Map,s=[],a=[],d=new Map;let v,p,M;for(const[_,L]of e)d.set(_,Re(_,L));for(const _ of xe)v=t.pieces.get(_),p=d.get(_),v?p?Be(v,p.piece)||(s.push(p),a.push(Re(_,v))):a.push(Re(_,v)):p&&s.push(p);for(const _ of a)p=Sn(_,s.filter(L=>Be(_.piece,L.piece))),p&&(M=[p.pos[0]-_.pos[0],p.pos[1]-_.pos[1]],n.set(_.key,M.concat(M)),i.push(p.key));for(const _ of s)i.includes(_.key)||r.set(_.key,_.piece);return{anims:n,fadings:r}}function Lt(e,t){const n=e.animation.current;if(n===void 0){e.dom.destroyed||e.dom.redrawNow();return}const i=1-(t-n.start)*n.frequency;if(i<=0)e.animation.current=void 0,e.dom.redrawNow();else{const r=Mn(i);for(const s of n.plan.anims.values())s[2]=s[0]*r,s[3]=s[1]*r;e.dom.redrawNow(!0),requestAnimationFrame((s=performance.now())=>Lt(e,s))}}function Cn(e,t){const n=new Map(t.pieces),i=e(t),r=Pn(n,t);if(r.anims.size||r.fadings.size){const s=t.animation.current&&t.animation.current.start;t.animation.current={start:performance.now(),frequency:1/t.animation.duration,plan:r},s||Lt(t,performance.now())}else t.dom.redraw();return i}const Mn=e=>e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1,En=["green","red","blue","yellow"];function An(e,t){if(t.touches&&t.touches.length>1)return;t.stopPropagation(),t.preventDefault(),t.ctrlKey?J(e):Ze(e);const n=be(t),i=_e(n,G(e),e.dom.bounds());i&&(e.drawable.current={orig:i,pos:n,brush:On(t),snapToValidMove:e.drawable.defaultSnapToValidMove},$t(e))}function $t(e){requestAnimationFrame(()=>{const t=e.drawable.current;if(t){const n=_e(t.pos,G(e),e.dom.bounds());n||(t.snapToValidMove=!1);const i=t.snapToValidMove?_n(t.orig,t.pos,G(e),e.dom.bounds()):n;i!==t.mouseSq&&(t.mouseSq=i,t.dest=i!==t.orig?i:void 0,e.dom.redrawNow()),$t(e)}})}function Nn(e,t){e.drawable.current&&(e.drawable.current.pos=be(t))}function Tn(e){const t=e.drawable.current;t&&(t.mouseSq&&Kn(e.drawable,t),Bt(e))}function Bt(e){e.drawable.current&&(e.drawable.current=void 0,e.dom.redraw())}function In(e){e.drawable.shapes.length&&(e.drawable.shapes=[],e.dom.redraw(),Ht(e.drawable))}function On(e){var t;const n=(e.shiftKey||e.ctrlKey)&&wt(e),i=e.altKey||e.metaKey||((t=e.getModifierState)===null||t===void 0?void 0:t.call(e,"AltGraph"));return En[(n?1:0)+(i?2:0)]}function Kn(e,t){const n=r=>r.orig===t.orig&&r.dest===t.dest,i=e.shapes.find(n);i&&(e.shapes=e.shapes.filter(r=>!n(r))),(!i||i.brush!==t.brush)&&e.shapes.push({orig:t.orig,dest:t.dest,brush:t.brush}),Ht(e)}function Ht(e){e.onChange&&e.onChange(e.shapes)}function qn(e,t){if(!t.isTrusted||t.button!==void 0&&t.button!==0||t.touches&&t.touches.length>1)return;const n=e.dom.bounds(),i=be(t),r=_e(i,G(e),n);if(!r)return;const s=e.pieces.get(r),a=e.selected;!a&&e.drawable.enabled&&(e.drawable.eraseOnClick||!s||s.color!==e.turnColor)&&In(e),t.cancelable!==!1&&(!t.touches||e.blockTouchScroll||s||a||Rn(e,i))&&t.preventDefault();const d=!!e.premovable.current,v=!!e.predroppable.current;e.stats.ctrlKey=t.ctrlKey,e.selected&&Ge(e,e.selected,r)?pe(_=>He(_,r),e):He(e,r);const p=e.selected===r,M=Ft(e,r);if(s&&M&&p&&gn(e,r)){e.draggable.current={orig:r,piece:s,origPos:i,pos:i,started:e.draggable.autoDistance&&e.stats.dragged,element:M,previouslySelected:a,originTarget:t.target,keyHasChanged:!1},M.cgDragging=!0,M.classList.add("dragging");const _=e.dom.elements.ghost;_&&(_.className=`ghost ${s.color} ${s.role}`,ne(_,Ee(n)(D(r),G(e))),je(_,!0)),Xe(e)}else d&&de(e),v&&he(e);e.dom.redraw()}function Rn(e,t){const n=G(e),i=e.dom.bounds(),r=Math.pow(i.width/8,2);for(const s of e.pieces.keys()){const a=kt(s,n,i);if(Me(a,t)<=r)return!0}return!1}function Dn(e,t,n,i){const r="a0";e.pieces.set(r,t),e.dom.redraw();const s=be(n);e.draggable.current={orig:r,piece:t,origPos:s,pos:s,started:!0,element:()=>Ft(e,r),originTarget:n.target,newPiece:!0,force:!!i,keyHasChanged:!1},Xe(e)}function Xe(e){requestAnimationFrame(()=>{var t;const n=e.draggable.current;if(!n)return;!((t=e.animation.current)===null||t===void 0)&&t.plan.anims.has(n.orig)&&(e.animation.current=void 0);const i=e.pieces.get(n.orig);if(!i||!Be(i,n.piece))Oe(e);else if(!n.started&&Me(n.pos,n.origPos)>=Math.pow(e.draggable.distance,2)&&(n.started=!0),n.started){if(typeof n.element=="function"){const s=n.element();if(!s)return;s.cgDragging=!0,s.classList.add("dragging"),n.element=s}const r=e.dom.bounds();ne(n.element,[n.pos[0]-r.left-r.width/16,n.pos[1]-r.top-r.height/16]),n.keyHasChanged||(n.keyHasChanged=n.orig!==_e(n.pos,G(e),r))}Xe(e)})}function Ln(e,t){e.draggable.current&&(!t.touches||t.touches.length<2)&&(e.draggable.current.pos=be(t))}function $n(e,t){const n=e.draggable.current;if(!n)return;if(t.type==="touchend"&&t.cancelable!==!1&&t.preventDefault(),t.type==="touchend"&&n.originTarget!==t.target&&!n.newPiece){e.draggable.current=void 0;return}de(e),he(e);const i=be(t)||n.pos,r=_e(i,G(e),e.dom.bounds());r&&n.started&&n.orig!==r?n.newPiece?Tt(e,n.orig,r,n.force):(e.stats.ctrlKey=t.ctrlKey,Nt(e,n.orig,r)&&(e.stats.dragged=!0)):n.newPiece?e.pieces.delete(n.orig):e.draggable.deleteOnDropOff&&!r&&(e.pieces.delete(n.orig),Q(e.events.change)),(n.orig===n.previouslySelected||n.keyHasChanged)&&(n.orig===r||!r)?J(e):e.selectable.enabled||J(e),Wt(e),e.draggable.current=void 0,e.dom.redraw()}function Oe(e){const t=e.draggable.current;t&&(t.newPiece&&e.pieces.delete(t.orig),e.draggable.current=void 0,J(e),Wt(e),e.dom.redraw())}function Wt(e){const t=e.dom.elements;t.ghost&&je(t.ghost,!1)}function Ft(e,t){let n=e.dom.elements.board.firstChild;for(;n;){if(n.cgKey===t&&n.tagName==="PIECE")return n;n=n.nextSibling}}function Bn(e,t){e.exploding={stage:1,keys:t},e.dom.redraw(),setTimeout(()=>{ot(e,2),setTimeout(()=>ot(e,void 0),120)},120)}function ot(e,t){e.exploding&&(t?e.exploding.stage=t:e.exploding=void 0,e.dom.redraw())}function Hn(e,t){function n(){ln(e),t()}return{set(i){i.orientation&&i.orientation!==e.orientation&&n(),Rt(e,i),(i.fen?pe:ce)(r=>Dt(r,i),e)},state:e,getFen:()=>yn(e.pieces),toggleOrientation:n,setPieces(i){pe(r=>cn(r,i),e)},selectSquare(i,r){i?pe(s=>He(s,i,r),e):e.selected&&(J(e),e.dom.redraw())},move(i,r){pe(s=>Et(s,i,r),e)},newPiece(i,r){pe(s=>Qe(s,i,r),e)},playPremove(){if(e.premovable.current){if(pe(vn,e))return!0;e.dom.redraw()}return!1},playPredrop(i){if(e.predroppable.current){const r=bn(e,i);return e.dom.redraw(),r}return!1},cancelPremove(){ce(de,e)},cancelPredrop(){ce(he,e)},cancelMove(){ce(i=>{Ze(i),Oe(i)},e)},stop(){ce(i=>{it(i),Oe(i)},e)},explode(i){Bn(e,i)},setAutoShapes(i){ce(r=>r.drawable.autoShapes=i,e)},setShapes(i){ce(r=>r.drawable.shapes=i,e)},getKeyAtDomPos(i){return _e(i,G(e),e.dom.bounds())},redrawAll:t,dragNewPiece(i,r,s){Dn(e,i,r,s)},destroy(){it(e),e.dom.unbind&&e.dom.unbind(),e.dom.destroyed=!0}}}function Wn(){return{pieces:qt(Kt),orientation:"white",turnColor:"white",coordinates:!0,ranksPosition:"right",autoCastle:!0,viewOnly:!1,disableContextMenu:!1,addPieceZIndex:!1,blockTouchScroll:!1,pieceKey:!1,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200},movable:{free:!0,color:"both",showDests:!0,events:{},rookCastle:!0},premovable:{enabled:!0,showDests:!0,castle:!0,events:{}},predroppable:{enabled:!1,events:{}},draggable:{enabled:!0,distance:3,autoDistance:!0,showGhost:!0,deleteOnDropOff:!1},dropmode:{active:!1},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{},drawable:{enabled:!0,visible:!0,defaultSnapToValidMove:!0,eraseOnClick:!0,shapes:[],autoShapes:[],brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15}},prevSvgHash:""},hold:nn()}}function We(e,t,n){const i=new Map,r=[];for(const d of e)i.set(d.hash,!1);let s=t.firstChild,a;for(;s;)a=s.getAttribute("cgHash"),i.has(a)?i.set(a,!0):r.push(s),s=s.nextSibling;for(const d of r)t.removeChild(d);for(const d of e)i.get(d.hash)||t.appendChild(n(d))}function ee(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function Fn(e,t,n){const i=e.drawable,r=i.current,s=r&&r.mouseSq?r:void 0,a=new Map,d=e.dom.bounds(),v=i.autoShapes.filter(S=>!S.piece);for(const S of i.shapes.concat(v).concat(s?[s]:[]))S.dest&&a.set(S.dest,(a.get(S.dest)||0)+1);const p=i.shapes.concat(v).map(S=>({shape:S,current:!1,hash:st(S,a,!1,d)}));s&&p.push({shape:s,current:!0,hash:st(s,a,!0,d)});const M=p.map(S=>S.hash).join(";");if(M===e.drawable.prevSvgHash)return;e.drawable.prevSvgHash=M;const _=t.querySelector("defs"),L=t.querySelector("g"),F=n.querySelector("g");Un(i,p,_),We(p.filter(S=>!S.shape.customSvg),L,S=>lt(e,S,i.brushes,a,d)),We(p.filter(S=>S.shape.customSvg),F,S=>lt(e,S,i.brushes,a,d))}function Un(e,t,n){const i=new Map;let r;for(const d of t)d.shape.dest&&(r=e.brushes[d.shape.brush],d.shape.modifiers&&(r=Ut(r,d.shape.modifiers)),i.set(r.key,r));const s=new Set;let a=n.firstChild;for(;a;)s.add(a.getAttribute("cgKey")),a=a.nextSibling;for(const[d,v]of i.entries())s.has(d)||n.appendChild(Zn(v))}function st({orig:e,dest:t,brush:n,piece:i,modifiers:r,customSvg:s},a,d,v){return[v.width,v.height,d,e,t,n,t&&(a.get(t)||0)>1,i&&xn(i),r&&zn(r),s&&jn(s)].filter(p=>p).join(",")}function xn(e){return[e.color,e.role,e.scale].filter(t=>t).join(",")}function zn(e){return""+(e.lineWidth||"")}function jn(e){let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n)>>>0;return"custom-"+t.toString()}function lt(e,{shape:t,current:n,hash:i},r,s,a){let d;const v=ct(D(t.orig),e.orientation);if(t.customSvg)d=Qn(t.customSvg,v,a);else if(t.dest){let p=r[t.brush];t.modifiers&&(p=Ut(p,t.modifiers)),d=Vn(p,v,ct(D(t.dest),e.orientation),n,(s.get(t.dest)||0)>1,a)}else d=Gn(r[t.brush],v,n,a);return d.setAttribute("cgHash",i),d}function Qn(e,t,n){const[i,r]=Ke(t,n),s=ue(ee("g"),{transform:`translate(${i},${r})`}),a=ue(ee("svg"),{width:1,height:1,viewBox:"0 0 100 100"});return s.appendChild(a),a.innerHTML=e,s}function Gn(e,t,n,i){const r=Ke(t,i),s=Yn(),a=(i.width+i.height)/(4*Math.max(i.width,i.height));return ue(ee("circle"),{stroke:e.color,"stroke-width":s[n?0:1],fill:"none",opacity:xt(e,n),cx:r[0],cy:r[1],r:a-s[1]/2})}function Vn(e,t,n,i,r,s){const a=Jn(r&&!i),d=Ke(t,s),v=Ke(n,s),p=v[0]-d[0],M=v[1]-d[1],_=Math.atan2(M,p),L=Math.cos(_)*a,F=Math.sin(_)*a;return ue(ee("line"),{stroke:e.color,"stroke-width":Xn(e,i),"stroke-linecap":"round","marker-end":"url(#arrowhead-"+e.key+")",opacity:xt(e,i),x1:d[0],y1:d[1],x2:v[0]-L,y2:v[1]-F})}function Zn(e){const t=ue(ee("marker"),{id:"arrowhead-"+e.key,orient:"auto",markerWidth:4,markerHeight:8,refX:2.05,refY:2.01});return t.appendChild(ue(ee("path"),{d:"M0,0 V4 L3,2 Z",fill:e.color})),t.setAttribute("cgKey",e.key),t}function ue(e,t){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.setAttribute(n,t[n]);return e}function ct(e,t){return t==="white"?e:[7-e[0],7-e[1]]}function Ut(e,t){return{color:e.color,opacity:Math.round(e.opacity*10)/10,lineWidth:Math.round(t.lineWidth||e.lineWidth),key:[e.key,t.lineWidth].filter(n=>n).join("")}}function Yn(){return[3/64,4/64]}function Xn(e,t){return(e.lineWidth||10)*(t?.85:1)/64}function xt(e,t){return(e.opacity||1)*(t?.9:1)}function Jn(e){return(e?20:10)/64}function Ke(e,t){const n=Math.min(1,t.width/t.height),i=Math.min(1,t.height/t.width);return[(e[0]-3.5)*n,(3.5-e[1])*i]}function ei(e,t){e.innerHTML="",e.classList.add("cg-wrap");for(const v of Jt)e.classList.toggle("orientation-"+v,t.orientation===v);e.classList.toggle("manipulable",!t.viewOnly);const n=oe("cg-container");e.appendChild(n);const i=oe("cg-board");n.appendChild(i);let r,s,a;if(t.drawable.visible&&(r=ue(ee("svg"),{class:"cg-shapes",viewBox:"-4 -4 8 8",preserveAspectRatio:"xMidYMid slice"}),r.appendChild(ee("defs")),r.appendChild(ee("g")),s=ue(ee("svg"),{class:"cg-custom-svgs",viewBox:"-3.5 -3.5 8 8",preserveAspectRatio:"xMidYMid slice"}),s.appendChild(ee("g")),a=oe("cg-auto-pieces"),n.appendChild(r),n.appendChild(s),n.appendChild(a)),t.coordinates){const v=t.orientation==="black"?" black":"",p=t.ranksPosition==="left"?" left":"";n.appendChild(at(Ue,"ranks"+v+p)),n.appendChild(at(Fe,"files"+v))}let d;return t.draggable.enabled&&t.draggable.showGhost&&(d=oe("piece","ghost"),je(d,!1),n.appendChild(d)),{board:i,container:n,wrap:e,ghost:d,svg:r,customSvg:s,autoPieces:a}}function at(e,t){const n=oe("coords",t);let i;for(const r of e)i=oe("coord"),i.textContent=r,n.appendChild(i);return n}function ti(e,t){if(!e.dropmode.active)return;de(e),he(e);const n=e.dropmode.piece;if(n){e.pieces.set("a0",n);const i=be(t),r=i&&_e(i,G(e),e.dom.bounds());r&&Tt(e,"a0",r)}e.dom.redraw()}function ni(e,t){const n=e.dom.elements.board;if("ResizeObserver"in window&&new ResizeObserver(t).observe(e.dom.elements.wrap),e.viewOnly)return;const i=ri(e);n.addEventListener("touchstart",i,{passive:!1}),n.addEventListener("mousedown",i,{passive:!1}),(e.disableContextMenu||e.drawable.enabled)&&n.addEventListener("contextmenu",r=>r.preventDefault())}function ii(e,t){const n=[];if("ResizeObserver"in window||n.push(Se(document.body,"chessground.resize",t)),!e.viewOnly){const i=ft(e,Ln,Nn),r=ft(e,$n,Tn);for(const a of["touchmove","mousemove"])n.push(Se(document,a,i));for(const a of["touchend","mouseup"])n.push(Se(document,a,r));const s=()=>e.dom.bounds.clear();n.push(Se(document,"scroll",s,{capture:!0,passive:!0})),n.push(Se(window,"resize",s,{passive:!0}))}return()=>n.forEach(i=>i())}function Se(e,t,n,i){return e.addEventListener(t,n,i),()=>e.removeEventListener(t,n,i)}const ri=e=>t=>{e.draggable.current?Oe(e):e.drawable.current?Bt(e):t.shiftKey||wt(t)?e.drawable.enabled&&An(e,t):e.viewOnly||(e.dropmode.active?ti(e,t):qn(e,t))},ft=(e,t,n)=>i=>{e.drawable.current?e.drawable.enabled&&n(e,i):e.viewOnly||t(e,i)};function oi(e){const t=G(e),n=Ee(e.dom.bounds()),i=e.dom.elements.board,r=e.pieces,s=e.animation.current,a=s?s.plan.anims:new Map,d=s?s.plan.fadings:new Map,v=e.draggable.current,p=li(e),M=new Set,_=new Set,L=new Map,F=new Map;let S,k,A,te,x,B,V,U,$,Z;for(k=i.firstChild;k;){if(S=k.cgKey,zt(k))if(A=r.get(S),x=a.get(S),B=d.get(S),te=k.cgPiece,k.cgDragging&&(!v||v.orig!==S)&&(k.classList.remove("dragging"),ne(k,n(D(S),t)),k.cgDragging=!1),!B&&k.cgFading&&(k.cgFading=!1,k.classList.remove("fading")),A){if(x&&k.cgAnimating&&te===Pe(A)){const T=D(S);T[0]+=x[2],T[1]+=x[3],k.classList.add("anim"),ne(k,n(T,t))}else k.cgAnimating&&(k.cgAnimating=!1,k.classList.remove("anim"),ne(k,n(D(S),t)),e.addPieceZIndex&&(k.style.zIndex=De(D(S),t)));te===Pe(A)&&(!B||!k.cgFading)?M.add(S):B&&te===Pe(B)?(k.classList.add("fading"),k.cgFading=!0):Le(L,te,k)}else Le(L,te,k);else if(jt(k)){const T=k.className;p.get(S)===T?_.add(S):Le(F,T,k)}k=k.nextSibling}for(const[T,ie]of p)if(!_.has(T)){$=F.get(ie),Z=$&&$.pop();const R=n(D(T),t);if(Z)Z.cgKey=T,ne(Z,R);else{const z=oe("square",ie);z.cgKey=T,ne(z,R),i.insertBefore(z,i.firstChild)}}for(const[T,ie]of r)if(x=a.get(T),!M.has(T))if(V=L.get(Pe(ie)),U=V&&V.pop(),U){U.cgKey=T,U.cgFading&&(U.classList.remove("fading"),U.cgFading=!1);const R=D(T);e.addPieceZIndex&&(U.style.zIndex=De(R,t)),x&&(U.cgAnimating=!0,U.classList.add("anim"),R[0]+=x[2],R[1]+=x[3]),ne(U,n(R,t))}else{const R=Pe(ie),z=oe("piece",R),C=D(T);z.cgPiece=R,z.cgKey=T,x&&(z.cgAnimating=!0,C[0]+=x[2],C[1]+=x[3]),ne(z,n(C,t)),e.addPieceZIndex&&(z.style.zIndex=De(C,t)),i.appendChild(z)}for(const T of L.values())dt(e,T);for(const T of F.values())dt(e,T)}function si(e){const t=G(e),n=Ee(e.dom.bounds());let i=e.dom.elements.board.firstChild;for(;i;)(zt(i)&&!i.cgAnimating||jt(i))&&ne(i,n(D(i.cgKey),t)),i=i.nextSibling}function ut(e){var t,n;const i=e.dom.elements.wrap.getBoundingClientRect(),r=e.dom.elements.container,s=i.height/i.width,a=Math.floor(i.width*window.devicePixelRatio/8)*8/window.devicePixelRatio,d=a*s;r.style.width=a+"px",r.style.height=d+"px",e.dom.bounds.clear(),(t=e.addDimensionsCssVarsTo)===null||t===void 0||t.style.setProperty("--cg-width",a+"px"),(n=e.addDimensionsCssVarsTo)===null||n===void 0||n.style.setProperty("--cg-height",d+"px")}const zt=e=>e.tagName==="PIECE",jt=e=>e.tagName==="SQUARE";function dt(e,t){for(const n of t)e.dom.elements.board.removeChild(n)}function De(e,t){const i=e[1];return`${t?3+7-i:3+i}`}const Pe=e=>`${e.color} ${e.role}`;function li(e){var t;const n=new Map;if(e.lastMove&&e.highlight.lastMove)for(const s of e.lastMove)le(n,s,"last-move");if(e.check&&e.highlight.check&&le(n,e.check,"check"),e.selected&&(le(n,e.selected,"selected"),e.movable.showDests)){const s=(t=e.movable.dests)===null||t===void 0?void 0:t.get(e.selected);if(s)for(const d of s)le(n,d,"move-dest"+(e.pieces.has(d)?" oc":""));const a=e.premovable.dests;if(a)for(const d of a)le(n,d,"premove-dest"+(e.pieces.has(d)?" oc":""))}const i=e.premovable.current;if(i)for(const s of i)le(n,s,"current-premove");else e.predroppable.current&&le(n,e.predroppable.current.key,"current-premove");const r=e.exploding;if(r)for(const s of r.keys)le(n,s,"exploding"+r.stage);return n}function le(e,t,n){const i=e.get(t);i?e.set(t,`${i} ${n}`):e.set(t,n)}function Le(e,t,n){const i=e.get(t);i?i.push(n):e.set(t,[n])}function ci(e,t){const i=e.drawable.autoShapes.filter(r=>r.piece).map(r=>({shape:r,hash:ui(r),current:!1}));We(i,t,r=>fi(e,r,e.dom.bounds()))}function ai(e){var t;const n=G(e),i=Ee(e.dom.bounds());let r=(t=e.dom.elements.autoPieces)===null||t===void 0?void 0:t.firstChild;for(;r;)_t(r,i(D(r.cgKey),n),r.cgScale),r=r.nextSibling}function fi(e,{shape:t,hash:n},i){var r,s,a;const d=t.orig,v=(r=t.piece)===null||r===void 0?void 0:r.role,p=(s=t.piece)===null||s===void 0?void 0:s.color,M=(a=t.piece)===null||a===void 0?void 0:a.scale,_=oe("piece",`${v} ${p}`);return _.setAttribute("cgHash",n),_.cgKey=d,_.cgScale=M,_t(_,Ee(i)(D(d),G(e)),M),_}const ui=e=>{var t,n,i;return[e.orig,(t=e.piece)===null||t===void 0?void 0:t.role,(n=e.piece)===null||n===void 0?void 0:n.color,(i=e.piece)===null||i===void 0?void 0:i.scale].join(",")};function di(e,t){const n=Wn();Dt(n,t||{});function i(){const r="dom"in n?n.dom.unbind:void 0,s=ei(e,n),a=tn(()=>s.board.getBoundingClientRect()),d=M=>{oi(p),s.autoPieces&&ci(p,s.autoPieces),!M&&s.svg&&Fn(p,s.svg,s.customSvg)},v=()=>{ut(p),si(p),s.autoPieces&&ai(p)},p=n;return p.dom={elements:s,bounds:a,redraw:hi(d),redrawNow:d,unbind:r},p.drawable.prevSvgHash="",ut(p),d(!1),ni(p,v),r||(p.dom.unbind=ii(p,v)),p.events.insert&&p.events.insert(s),p}return Hn(i(),i)}function hi(e){let t=!1;return()=>{t||(t=!0,requestAnimationFrame(()=>{e(),t=!1}))}}var Ce={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Chess=e.validateFen=e.SQUARES=e.DEFAULT_POSITION=e.KING=e.QUEEN=e.ROOK=e.BISHOP=e.KNIGHT=e.PAWN=e.BLACK=e.WHITE=void 0,e.WHITE="w",e.BLACK="b",e.PAWN="p",e.KNIGHT="n",e.BISHOP="b",e.ROOK="r",e.QUEEN="q",e.KING="k",e.DEFAULT_POSITION="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1";const t=-1,n={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"};e.SQUARES=["a8","b8","c8","d8","e8","f8","g8","h8","a7","b7","c7","d7","e7","f7","g7","h7","a6","b6","c6","d6","e6","f6","g6","h6","a5","b5","c5","d5","e5","f5","g5","h5","a4","b4","c4","d4","e4","f4","g4","h4","a3","b3","c3","d3","e3","f3","g3","h3","a2","b2","c2","d2","e2","f2","g2","h2","a1","b1","c1","d1","e1","f1","g1","h1"];const i={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},r={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},s={b:[16,32,17,15],w:[-16,-32,-17,-15]},a={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},d=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],v=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],p={p:1,n:2,b:4,r:8,q:16,k:32},M="pnbrqkPNBRQK",_=[e.KNIGHT,e.BISHOP,e.ROOK,e.QUEEN],L=7,F=6,S=1,k=0,A={w:[{square:r.a1,flag:i.QSIDE_CASTLE},{square:r.h1,flag:i.KSIDE_CASTLE}],b:[{square:r.a8,flag:i.QSIDE_CASTLE},{square:r.h8,flag:i.KSIDE_CASTLE}]},te={b:S,w:F},x=["1-0","0-1","1/2-1/2","*"];function B(y){return y>>4}function V(y){return y&15}function U(y){return"0123456789".indexOf(y)!==-1}function $(y){const o=V(y),l=B(y);return"abcdefgh".substring(o,o+1)+"87654321".substring(l,l+1)}function Z(y){return y===e.WHITE?e.BLACK:e.WHITE}function T(y){const o=[];o[0]="No errors.",o[1]="FEN string must contain six space-delimited fields.",o[2]="6th field (move number) must be a positive integer.",o[3]="5th field (half move counter) must be a non-negative integer.",o[4]="4th field (en-passant square) is invalid.",o[5]="3rd field (castling availability) is invalid.",o[6]="2nd field (side to move) is invalid.",o[7]="1st field (piece positions) does not contain 8 '/'-delimited rows.",o[8]="1st field (piece positions) is invalid [consecutive numbers].",o[9]="1st field (piece positions) is invalid [invalid piece].",o[10]="1st field (piece positions) is invalid [row too large].",o[11]="Illegal en-passant square";const l=y.split(/\s+/);if(l.length!==6)return{valid:!1,errorNumber:1,error:o[1]};const c=parseInt(l[5],10);if(isNaN(c)||c<=0)return{valid:!1,errorNumber:2,error:o[2]};const u=parseInt(l[4],10);if(isNaN(u)||u<0)return{valid:!1,errorNumber:3,error:o[3]};if(!/^(-|[abcdefgh][36])$/.test(l[3]))return{valid:!1,errorNumber:4,error:o[4]};if(!/^(KQ?k?q?|Qk?q?|kq?|q|-)$/.test(l[2]))return{valid:!1,errorNumber:5,error:o[5]};if(!/^(w|b)$/.test(l[1]))return{valid:!1,errorNumber:6,error:o[6]};const f=l[0].split("/");if(f.length!==8)return{valid:!1,errorNumber:7,error:o[7]};for(let g=0;g<f.length;g++){let h=0,m=!1;for(let P=0;P<f[g].length;P++)if(U(f[g][P])){if(m)return{valid:!1,errorNumber:8,error:o[8]};h+=parseInt(f[g][P],10),m=!0}else{if(!/^[prnbqkPRNBQK]$/.test(f[g][P]))return{valid:!1,errorNumber:9,error:o[9]};h+=1,m=!1}if(h!==8)return{valid:!1,errorNumber:10,error:o[10]}}return l[3][1]=="3"&&l[1]=="w"||l[3][1]=="6"&&l[1]=="b"?{valid:!1,errorNumber:11,error:o[11]}:{valid:!0,errorNumber:0,error:o[0]}}e.validateFen=T;function ie(y,o){const l=y.from,c=y.to,u=y.piece;let f=0,g=0,h=0;for(let m=0,P=o.length;m<P;m++){const K=o[m].from,q=o[m].to,b=o[m].piece;u===b&&l!==K&&c===q&&(f++,B(l)===B(K)&&g++,V(l)===V(K)&&h++)}return f>0?g>0&&h>0?$(l):h>0?$(l).charAt(1):$(l).charAt(0):""}function R(y,o,l,c,u,f=void 0,g=i.NORMAL){const h=B(c);if(u===e.PAWN&&(h===L||h===k))for(let m=0;m<_.length;m++){const P=_[m];y.push({color:o,from:l,to:c,piece:u,captured:f,promotion:P,flags:g|i.PROMOTION})}else y.push({color:o,from:l,to:c,piece:u,captured:f,promotion:void 0,flags:g})}function z(y){let o=y.charAt(0);return o>="a"&&o<="h"?y.match(/[a-h]\d.*[a-h]\d/)?void 0:e.PAWN:(o=o.toLowerCase(),o==="o"?e.KING:o)}function C(y){return y.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}class I{constructor(o=e.DEFAULT_POSITION){this._board=new Array(128),this._turn=e.WHITE,this._header={},this._kings={w:t,b:t},this._epSquare=-1,this._halfMoves=0,this._moveNumber=0,this._history=[],this._comments={},this._castling={w:0,b:0},this.load(o)}clear(o=!1){this._board=new Array(128),this._kings={w:t,b:t},this._turn=e.WHITE,this._castling={w:0,b:0},this._epSquare=t,this._halfMoves=0,this._moveNumber=1,this._history=[],this._comments={},this._header=o?this._header:{},this._updateSetup(this.fen())}load(o,l=!1){const c=o.split(/\s+/),u=c[0];let f=0;if(!T(o).valid)return!1;this.clear(l);for(let g=0;g<u.length;g++){const h=u.charAt(g);if(h==="/")f+=8;else if(U(h))f+=parseInt(h,10);else{const m=h<"a"?e.WHITE:e.BLACK;this.put({type:h.toLowerCase(),color:m},$(f)),f++}}return this._turn=c[1],c[2].indexOf("K")>-1&&(this._castling.w|=i.KSIDE_CASTLE),c[2].indexOf("Q")>-1&&(this._castling.w|=i.QSIDE_CASTLE),c[2].indexOf("k")>-1&&(this._castling.b|=i.KSIDE_CASTLE),c[2].indexOf("q")>-1&&(this._castling.b|=i.QSIDE_CASTLE),this._epSquare=c[3]==="-"?t:r[c[3]],this._halfMoves=parseInt(c[4],10),this._moveNumber=parseInt(c[5],10),this._updateSetup(this.fen()),!0}fen(){let o=0,l="";for(let f=r.a8;f<=r.h1;f++){if(this._board[f]){o>0&&(l+=o,o=0);const{color:g,type:h}=this._board[f];l+=g===e.WHITE?h.toUpperCase():h.toLowerCase()}else o++;f+1&136&&(o>0&&(l+=o),f!==r.h1&&(l+="/"),o=0,f+=8)}let c="";this._castling[e.WHITE]&i.KSIDE_CASTLE&&(c+="K"),this._castling[e.WHITE]&i.QSIDE_CASTLE&&(c+="Q"),this._castling[e.BLACK]&i.KSIDE_CASTLE&&(c+="k"),this._castling[e.BLACK]&i.QSIDE_CASTLE&&(c+="q"),c=c||"-";const u=this._epSquare===t?"-":$(this._epSquare);return[l,this._turn,c,u,this._halfMoves,this._moveNumber].join(" ")}_updateSetup(o){this._history.length>0||(o!==e.DEFAULT_POSITION?(this._header.SetUp="1",this._header.FEN=o):(delete this._header.SetUp,delete this._header.FEN))}reset(){this.load(e.DEFAULT_POSITION)}get(o){return this._board[r[o]]||!1}put({type:o,color:l},c){if(M.indexOf(o.toLowerCase())===-1||!(c in r))return!1;const u=r[c];return o==e.KING&&!(this._kings[l]==t||this._kings[l]==u)?!1:(this._board[u]={type:o,color:l},o===e.KING&&(this._kings[l]=u),this._updateSetup(this.fen()),!0)}remove(o){const l=this.get(o);return delete this._board[r[o]],l&&l.type===e.KING&&(this._kings[l.color]=t),this._updateSetup(this.fen()),l}_attacked(o,l){for(let c=r.a8;c<=r.h1;c++){if(c&136){c+=7;continue}if(this._board[c]===void 0||this._board[c].color!==o)continue;const u=this._board[c],f=c-l,g=f+119;if(d[g]&p[u.type]){if(u.type===e.PAWN){if(f>0){if(u.color===e.WHITE)return!0}else if(u.color===e.BLACK)return!0;continue}if(u.type==="n"||u.type==="k")return!0;const h=v[g];let m=c+h,P=!1;for(;m!==l;){if(this._board[m]!=null){P=!0;break}m+=h}if(!P)return!0}}return!1}_isKingAttacked(o){return this._attacked(Z(o),this._kings[o])}isCheck(){return this._isKingAttacked(this._turn)}inCheck(){return this.isCheck()}isCheckmate(){return this.isCheck()&&this._moves().length===0}isStalemate(){return!this.isCheck()&&this._moves().length===0}isInsufficientMaterial(){const o={b:0,n:0,r:0,q:0,k:0,p:0},l=[];let c=0,u=0;for(let f=r.a8;f<=r.h1;f++){if(u=(u+1)%2,f&136){f+=7;continue}const g=this._board[f];g&&(o[g.type]=g.type in o?o[g.type]+1:1,g.type===e.BISHOP&&l.push(u),c++)}if(c===2)return!0;if(c===3&&(o[e.BISHOP]===1||o[e.KNIGHT]===1))return!0;if(c===o[e.BISHOP]+2){let f=0;const g=l.length;for(let h=0;h<g;h++)f+=l[h];if(f===0||f===g)return!0}return!1}isThreefoldRepetition(){const o=[],l={};let c=!1;for(;;){const u=this._undoMove();if(!u)break;o.push(u)}for(;;){const u=this.fen().split(" ").slice(0,4).join(" ");l[u]=u in l?l[u]+1:1,l[u]>=3&&(c=!0);const f=o.pop();if(f)this._makeMove(f);else break}return c}isDraw(){return this._halfMoves>=100||this.isStalemate()||this.isInsufficientMaterial()||this.isThreefoldRepetition()}isGameOver(){return this.isCheckmate()||this.isStalemate()||this.isDraw()}moves({verbose:o=!1,square:l=void 0}={}){const c=this._moves({square:l});return o?c.map(u=>this._makePretty(u)):c.map(u=>this._moveToSan(u,c))}_moves({legal:o=!0,piece:l=void 0,square:c=void 0}={}){var u;const f=c?c.toLowerCase():void 0,g=l==null?void 0:l.toLowerCase(),h=[],m=this._turn,P=Z(m);let K=r.a8,q=r.h1,b=!1;if(f)if(f in r)K=q=r[f],b=!0;else return[];for(let w=K;w<=q;w++){if(w&136){w+=7;continue}if(!this._board[w]||this._board[w].color===P)continue;const{type:N}=this._board[w];let O;if(N===e.PAWN){if(g&&g!==N)continue;O=w+s[m][0],this._board[O]||(R(h,m,w,O,e.PAWN),O=w+s[m][1],te[m]===B(w)&&!this._board[O]&&R(h,m,w,O,e.PAWN,void 0,i.BIG_PAWN));for(let j=2;j<4;j++)O=w+s[m][j],!(O&136)&&(((u=this._board[O])===null||u===void 0?void 0:u.color)===P?R(h,m,w,O,e.PAWN,this._board[O].type,i.CAPTURE):O===this._epSquare&&R(h,m,w,O,e.PAWN,e.PAWN,i.EP_CAPTURE))}else{if(g&&g!==N)continue;for(let j=0,we=a[N].length;j<we;j++){const E=a[N][j];for(O=w;O+=E,!(O&136);){if(!this._board[O])R(h,m,w,O,N);else{if(this._board[O].color===m)break;R(h,m,w,O,N,this._board[O].type,i.CAPTURE);break}if(N===e.KNIGHT||N===e.KING)break}}}}if((g===void 0||g===e.KING)&&(!b||q===this._kings[m])){if(this._castling[m]&i.KSIDE_CASTLE){const w=this._kings[m],N=w+2;!this._board[w+1]&&!this._board[N]&&!this._attacked(P,this._kings[m])&&!this._attacked(P,w+1)&&!this._attacked(P,N)&&R(h,m,this._kings[m],N,e.KING,void 0,i.KSIDE_CASTLE)}if(this._castling[m]&i.QSIDE_CASTLE){const w=this._kings[m],N=w-2;!this._board[w-1]&&!this._board[w-2]&&!this._board[w-3]&&!this._attacked(P,this._kings[m])&&!this._attacked(P,w-1)&&!this._attacked(P,N)&&R(h,m,this._kings[m],N,e.KING,void 0,i.QSIDE_CASTLE)}}if(!o)return h;const H=[];for(let w=0,N=h.length;w<N;w++)this._makeMove(h[w]),this._isKingAttacked(m)||H.push(h[w]),this._undoMove();return H}move(o,{sloppy:l=!1}={}){let c=null;if(typeof o=="string")c=this._moveFromSan(o,l);else if(typeof o=="object"){const f=this._moves();for(let g=0,h=f.length;g<h;g++)if(o.from===$(f[g].from)&&o.to===$(f[g].to)&&(!("promotion"in f[g])||o.promotion===f[g].promotion)){c=f[g];break}}if(!c)return null;const u=this._makePretty(c);return this._makeMove(c),u}_push(o){this._history.push({move:o,kings:{b:this._kings.b,w:this._kings.w},turn:this._turn,castling:{b:this._castling.b,w:this._castling.w},epSquare:this._epSquare,halfMoves:this._halfMoves,moveNumber:this._moveNumber})}_makeMove(o){const l=this._turn,c=Z(l);if(this._push(o),this._board[o.to]=this._board[o.from],delete this._board[o.from],o.flags&i.EP_CAPTURE&&(this._turn===e.BLACK?delete this._board[o.to-16]:delete this._board[o.to+16]),o.promotion&&(this._board[o.to]={type:o.promotion,color:l}),this._board[o.to].type===e.KING){if(this._kings[l]=o.to,o.flags&i.KSIDE_CASTLE){const u=o.to-1,f=o.to+1;this._board[u]=this._board[f],delete this._board[f]}else if(o.flags&i.QSIDE_CASTLE){const u=o.to+1,f=o.to-2;this._board[u]=this._board[f],delete this._board[f]}this._castling[l]=0}if(this._castling[l]){for(let u=0,f=A[l].length;u<f;u++)if(o.from===A[l][u].square&&this._castling[l]&A[l][u].flag){this._castling[l]^=A[l][u].flag;break}}if(this._castling[c]){for(let u=0,f=A[c].length;u<f;u++)if(o.to===A[c][u].square&&this._castling[c]&A[c][u].flag){this._castling[c]^=A[c][u].flag;break}}o.flags&i.BIG_PAWN?l===e.BLACK?this._epSquare=o.to-16:this._epSquare=o.to+16:this._epSquare=t,o.piece===e.PAWN?this._halfMoves=0:o.flags&(i.CAPTURE|i.EP_CAPTURE)?this._halfMoves=0:this._halfMoves++,l===e.BLACK&&this._moveNumber++,this._turn=c}undo(){const o=this._undoMove();return o?this._makePretty(o):null}_undoMove(){const o=this._history.pop();if(o===void 0)return null;const l=o.move;this._kings=o.kings,this._turn=o.turn,this._castling=o.castling,this._epSquare=o.epSquare,this._halfMoves=o.halfMoves,this._moveNumber=o.moveNumber;const c=this._turn,u=Z(c);if(this._board[l.from]=this._board[l.to],this._board[l.from].type=l.piece,delete this._board[l.to],l.captured)if(l.flags&i.EP_CAPTURE){let f;c===e.BLACK?f=l.to-16:f=l.to+16,this._board[f]={type:e.PAWN,color:u}}else this._board[l.to]={type:l.captured,color:u};if(l.flags&(i.KSIDE_CASTLE|i.QSIDE_CASTLE)){let f,g;l.flags&i.KSIDE_CASTLE?(f=l.to+1,g=l.to-1):(f=l.to-2,g=l.to+1),this._board[f]=this._board[g],delete this._board[g]}return l}pgn({newline:o=`
`,maxWidth:l=0}={}){const c=[];let u=!1;for(const b in this._header)c.push("["+b+' "'+this._header[b]+'"]'+o),u=!0;u&&this._history.length&&c.push(o);const f=b=>{const H=this._comments[this.fen()];if(typeof H<"u"){const w=b.length>0?" ":"";b=`${b}${w}{${H}}`}return b},g=[];for(;this._history.length>0;)g.push(this._undoMove());const h=[];let m="";for(g.length===0&&h.push(f(""));g.length>0;){m=f(m);const b=g.pop();if(!b)break;if(!this._history.length&&b.color==="b"){const H=`${this._moveNumber}. ...`;m=m?`${m} ${H}`:H}else b.color==="w"&&(m.length&&h.push(m),m=this._moveNumber+".");m=m+" "+this._moveToSan(b,this._moves({legal:!0})),this._makeMove(b)}if(m.length&&h.push(f(m)),typeof this._header.Result<"u"&&h.push(this._header.Result),l===0)return c.join("")+h.join(" ");const P=function(){return c.length>0&&c[c.length-1]===" "?(c.pop(),!0):!1},K=function(b,H){for(const w of H.split(" "))if(w){if(b+w.length>l){for(;P();)b--;c.push(o),b=0}c.push(w),b+=w.length,c.push(" "),b++}return P()&&b--,b};let q=0;for(let b=0;b<h.length;b++){if(q+h[b].length>l&&h[b].includes("{")){q=K(q,h[b]);continue}q+h[b].length>l&&b!==0?(c[c.length-1]===" "&&c.pop(),c.push(o),q=0):b!==0&&(c.push(" "),q++),c.push(h[b]),q+=h[b].length}return c.join("")}header(...o){for(let l=0;l<o.length;l+=2)typeof o[l]=="string"&&typeof o[l+1]=="string"&&(this._header[o[l]]=o[l+1]);return this._header}loadPgn(o,{sloppy:l=!1,newlineChar:c=`\r?
`}={}){function u(E){return E.replace(/\\/g,"\\")}function f(E){const Y={},se=E.split(new RegExp(u(c)));let qe="",Je="";for(let Ae=0;Ae<se.length;Ae++){const et=/^\s*\[([A-Za-z]+)\s*"(.*)"\s*\]\s*$/;qe=se[Ae].replace(et,"$1"),Je=se[Ae].replace(et,"$2"),qe.trim().length>0&&(Y[qe]=Je)}return Y}o=o.trim();const h=new RegExp("^(\\[((?:"+u(c)+")|.)*\\])(?:\\s*"+u(c)+"){2}").exec(o),m=h&&h.length>=2?h[1]:"";this.reset();const P=f(m);let K="";for(const E in P)E.toLowerCase()==="fen"&&(K=P[E]),this.header(E,P[E]);if(l){if(K&&!this.load(K,!0))return!1}else if(P.SetUp==="1"&&!("FEN"in P&&this.load(P.FEN,!0)))return!1;function q(E){return Array.from(E).map(function(Y){return Y.charCodeAt(0)<128?Y.charCodeAt(0).toString(16):encodeURIComponent(Y).replace(/%/g,"").toLowerCase()}).join("")}function b(E){return E.length==0?"":decodeURIComponent("%"+(E.match(/.{1,2}/g)||[]).join("%"))}const H=function(E){return E=E.replace(new RegExp(u(c),"g")," "),`{${q(E.slice(1,E.length-1))}}`},w=function(E){if(E.startsWith("{")&&E.endsWith("}"))return b(E.slice(1,E.length-1))};let N=o.replace(m,"").replace(new RegExp(`({[^}]*})+?|;([^${u(c)}]*)`,"g"),function(E,Y,se){return Y!==void 0?H(Y):" "+H(`{${se.slice(1)}}`)}).replace(new RegExp(u(c),"g")," ");const O=/(\([^()]+\))+?/g;for(;O.test(N);)N=N.replace(O,"");N=N.replace(/\d+\.(\.\.)?/g,""),N=N.replace(/\.\.\./g,""),N=N.replace(/\$\d+/g,"");let j=N.trim().split(new RegExp(/\s+/));j=j.join(",").replace(/,,+/g,",").split(",");let we="";for(let E=0;E<j.length;E++){const Y=w(j[E]);if(Y!==void 0){this._comments[this.fen()]=Y;continue}const se=this._moveFromSan(j[E],l);if(se==null)if(x.indexOf(j[E])>-1)we=j[E];else return!1;else we="",this._makeMove(se)}return we&&Object.keys(this._header).length&&!this._header.Result&&this.header("Result",we),!0}_moveToSan(o,l){let c="";if(o.flags&i.KSIDE_CASTLE)c="O-O";else if(o.flags&i.QSIDE_CASTLE)c="O-O-O";else{if(o.piece!==e.PAWN){const u=ie(o,l);c+=o.piece.toUpperCase()+u}o.flags&(i.CAPTURE|i.EP_CAPTURE)&&(o.piece===e.PAWN&&(c+=$(o.from)[0]),c+="x"),c+=$(o.to),o.promotion&&(c+="="+o.promotion.toUpperCase())}return this._makeMove(o),this.isCheck()&&(this.isCheckmate()?c+="#":c+="+"),this._undoMove(),c}_moveFromSan(o,l=!1){const c=C(o);let u=z(c),f=this._moves({legal:!0,piece:u});for(let b=0,H=f.length;b<H;b++)if(c===C(this._moveToSan(f[b],f)))return f[b];if(!l)return null;let g,h,m,P,K,q=!1;h=c.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/),h?(g=h[1],m=h[2],P=h[3],K=h[4],m.length==1&&(q=!0)):(h=c.match(/([pnbrqkPNBRQK])?([a-h]?[1-8]?)x?-?([a-h][1-8])([qrbnQRBN])?/),h&&(g=h[1],m=h[2],P=h[3],K=h[4],m.length==1&&(q=!0))),u=z(c),f=this._moves({legal:!0,piece:g||u});for(let b=0,H=f.length;b<H;b++)if(m&&P){if((!g||g.toLowerCase()==f[b].piece)&&r[m]==f[b].from&&r[P]==f[b].to&&(!K||K.toLowerCase()==f[b].promotion))return f[b];if(q){const w=$(f[b].from);if((!g||g.toLowerCase()==f[b].piece)&&r[P]==f[b].to&&(m==w[0]||m==w[1])&&(!K||K.toLowerCase()==f[b].promotion))return f[b]}}return null}ascii(){let o=`   +------------------------+
`;for(let l=r.a8;l<=r.h1;l++){if(V(l)===0&&(o+=" "+"87654321"[B(l)]+" |"),this._board[l]){const c=this._board[l].type,f=this._board[l].color===e.WHITE?c.toUpperCase():c.toLowerCase();o+=" "+f+" "}else o+=" . ";l+1&136&&(o+=`|
`,l+=8)}return o+=`   +------------------------+
`,o+="     a  b  c  d  e  f  g  h",o}perft(o){const l=this._moves({legal:!1});let c=0;const u=this._turn;for(let f=0,g=l.length;f<g;f++)this._makeMove(l[f]),this._isKingAttacked(u)||(o-1>0?c+=this.perft(o-1):c++),this._undoMove();return c}_makePretty(o){const{color:l,piece:c,from:u,to:f,flags:g,captured:h,promotion:m}=o;let P="";for(const q in i)i[q]&g&&(P+=n[q]);const K={color:l,piece:c,from:$(u),to:$(f),san:this._moveToSan(o,this._moves({legal:!0})),flags:P};return h&&(K.captured=h),m&&(K.promotion=m),K}turn(){return this._turn}board(){const o=[];let l=[];for(let c=r.a8;c<=r.h1;c++)this._board[c]==null?l.push(null):l.push({square:$(c),type:this._board[c].type,color:this._board[c].color}),c+1&136&&(o.push(l),l=[],c+=8);return o}squareColor(o){if(o in r){const l=r[o];return(B(l)+V(l))%2===0?"light":"dark"}return null}history({verbose:o=!1}={}){const l=[],c=[];for(;this._history.length>0;)l.push(this._undoMove());for(;;){const u=l.pop();if(!u)break;o?c.push(this._makePretty(u)):c.push(this._moveToSan(u,this._moves())),this._makeMove(u)}return c}_pruneComments(){const o=[],l={},c=u=>{u in this._comments&&(l[u]=this._comments[u])};for(;this._history.length>0;)o.push(this._undoMove());for(c(this.fen());;){const u=o.pop();if(!u)break;this._makeMove(u),c(this.fen())}this._comments=l}getComment(){return this._comments[this.fen()]}setComment(o){this._comments[this.fen()]=o.replace("{","[").replace("}","]")}deleteComment(){const o=this._comments[this.fen()];return delete this._comments[this.fen()],o}getComments(){return this._pruneComments(),Object.keys(this._comments).map(o=>({fen:o,comment:this._comments[o]}))}deleteComments(){return this._pruneComments(),Object.keys(this._comments).map(o=>{const l=this._comments[o];return delete this._comments[o],{fen:o,comment:l}})}}e.Chess=I})(Ce);const pi=ve('<div class="is2d"><div> </div></div>'),mi=e=>{let[t,n]=Te(void 0,{equals:!1}),i;Ie($e(()=>(t(),e.glyphs),a=>{i&&(a?i.setAutoShapes(a.map(d=>({orig:d.orig,customSvg:gi[d.glyph]}))):i.setAutoShapes([]))}));let r=new Map;Ie($e(()=>(t(),e.fen),a=>{if(!a)return;r=new Map,new Ce.Chess(a).moves({verbose:!0}).forEach(v=>{r.get(v.from)||r.set(v.from,[]),r.get(v.from).push(v.to)}),i==null||i.set({fen:a,movable:{dests:r}})}));let s={orientation:e.isBlack?"black":"white",movable:{free:!1,dests:r},events:{move(a,d){e.onUserMove(a+d)}}};return(()=>{const a=pi.cloneNode(!0),d=a.firstChild;return vt(v=>setTimeout(()=>{i=di(v,s),n()}),d),a})()},ke=e=>`
<defs>
  <filter id="shadow">
    <feDropShadow dx="4" dy="7" stdDeviation="5" flood-opacity="0.5" />
  </filter>
</defs>`+e,gi={"?!":ke(`
<g transform="translate(77 -18) scale(0.4)">
  <circle style="fill:#56b4e9;filter:url(#shadow)" cx="50" cy="50" r="50" />
  <path fill="#fff" d="M37.734 21.947c-3.714 0-7.128.464-10.242 1.393-3.113.928-6.009 2.13-8.685 3.605l4.343 8.766c2.35-1.202 4.644-2.157 6.883-2.867a22.366 22.366 0 0 1 6.799-1.065c2.294 0 4.07.464 5.326 1.393 1.311.874 1.967 2.186 1.967 3.933 0 1.748-.546 3.277-1.639 4.588-1.038 1.257-2.786 2.758-5.244 4.506-2.786 2.021-4.751 3.961-5.898 5.819-1.147 1.857-1.721 4.15-1.721 6.88v2.952h10.568v-2.377c0-1.147.137-2.103.41-2.868.328-.764.93-1.557 1.803-2.376.874-.82 2.104-1.803 3.688-2.95 2.13-1.584 3.906-3.058 5.326-4.424 1.42-1.42 2.485-2.95 3.195-4.59.71-1.638 1.065-3.576 1.065-5.816 0-4.206-1.584-7.675-4.752-10.406-3.114-2.731-7.51-4.096-13.192-4.096zm24.745.819l2.048 39.084h9.75l2.047-39.084zM35.357 68.73c-1.966 0-3.632.52-4.998 1.557-1.365.983-2.047 2.732-2.047 5.244 0 2.404.682 4.152 2.047 5.244 1.366 1.038 3.032 1.557 4.998 1.557 1.912 0 3.55-.519 4.916-1.557 1.366-1.092 2.05-2.84 2.05-5.244 0-2.512-.684-4.26-2.05-5.244-1.365-1.038-3.004-1.557-4.916-1.557zm34.004 0c-1.966 0-3.632.52-4.998 1.557-1.365.983-2.049 2.732-2.049 5.244 0 2.404.684 4.152 2.05 5.244 1.365 1.038 3.03 1.557 4.997 1.557 1.912 0 3.55-.519 4.916-1.557 1.366-1.092 2.047-2.84 2.047-5.244 0-2.512-.681-4.26-2.047-5.244-1.365-1.038-3.004-1.557-4.916-1.557z"/>
</g>
`),"?":ke(`
<g transform="translate(77 -18) scale(0.4)">
  <circle style="fill:#e69f00;filter:url(#shadow)" cx="50" cy="50" r="50" />
  <path fill="#fff" d="M40.436 60.851q0-4.66 1.957-7.83 1.958-3.17 6.712-6.619 4.195-2.983 5.967-5.127 1.864-2.237 1.864-5.22 0-2.983-2.237-4.475-2.144-1.585-6.06-1.585-3.915 0-7.737 1.212t-7.83 3.263l-4.941-9.975q4.568-2.517 9.881-4.101 5.314-1.585 11.653-1.585 9.695 0 15.008 4.661 5.407 4.661 5.407 11.839 0 3.822-1.212 6.619-1.212 2.796-3.635 5.22-2.424 2.33-6.06 5.034-2.703 1.958-4.195 3.356-1.491 1.398-2.05 2.703-.467 1.305-.467 3.263v2.703H40.436zm-1.492 18.924q0-4.288 2.33-5.966 2.331-1.771 5.687-1.771 3.263 0 5.594 1.771 2.33 1.678 2.33 5.966 0 4.102-2.33 5.966-2.331 1.772-5.594 1.772-3.356 0-5.686-1.772-2.33-1.864-2.33-5.966z"/>
</g>
`),"??":ke(`
<g transform="translate(77 -18) scale(0.4)">
  <circle style="fill:#df5353;filter:url(#shadow)" cx="50" cy="50" r="50" />
  <path fill="#fff" d="M31.8 22.22c-3.675 0-7.052.46-10.132 1.38-3.08.918-5.945 2.106-8.593 3.565l4.298 8.674c2.323-1.189 4.592-2.136 6.808-2.838a22.138 22.138 0 0 1 6.728-1.053c2.27 0 4.025.46 5.268 1.378 1.297.865 1.946 2.16 1.946 3.89s-.541 3.242-1.622 4.539c-1.027 1.243-2.756 2.73-5.188 4.458-2.756 2-4.7 3.918-5.836 5.755-1.134 1.837-1.702 4.107-1.702 6.808v2.92h10.457v-2.35c0-1.135.135-2.082.406-2.839.324-.756.918-1.54 1.783-2.35.864-.81 2.079-1.784 3.646-2.918 2.107-1.568 3.863-3.026 5.268-4.376 1.405-1.405 2.46-2.92 3.162-4.541.703-1.621 1.054-3.54 1.054-5.755 0-4.161-1.568-7.592-4.702-10.294-3.08-2.702-7.43-4.052-13.05-4.052zm38.664 0c-3.675 0-7.053.46-10.133 1.38-3.08.918-5.944 2.106-8.591 3.565l4.295 8.674c2.324-1.189 4.593-2.136 6.808-2.838a22.138 22.138 0 0 1 6.728-1.053c2.27 0 4.026.46 5.269 1.378 1.297.865 1.946 2.16 1.946 3.89s-.54 3.242-1.62 4.539c-1.027 1.243-2.757 2.73-5.189 4.458-2.756 2-4.7 3.918-5.835 5.755-1.135 1.837-1.703 4.107-1.703 6.808v2.92h10.457v-2.35c0-1.135.134-2.082.404-2.839.324-.756.918-1.54 1.783-2.35.865-.81 2.081-1.784 3.648-2.918 2.108-1.568 3.864-3.026 5.269-4.376 1.405-1.405 2.46-2.92 3.162-4.541.702-1.621 1.053-3.54 1.053-5.755 0-4.161-1.567-7.592-4.702-10.294-3.08-2.702-7.43-4.052-13.05-4.052zM29.449 68.504c-1.945 0-3.593.513-4.944 1.54-1.351.973-2.027 2.703-2.027 5.188 0 2.378.676 4.108 2.027 5.188 1.35 1.027 3 1.54 4.944 1.54 1.892 0 3.512-.513 4.863-1.54 1.35-1.08 2.026-2.81 2.026-5.188 0-2.485-.675-4.215-2.026-5.188-1.351-1.027-2.971-1.54-4.863-1.54zm38.663 0c-1.945 0-3.592.513-4.943 1.54-1.35.973-2.026 2.703-2.026 5.188 0 2.378.675 4.108 2.026 5.188 1.351 1.027 2.998 1.54 4.943 1.54 1.891 0 3.513-.513 4.864-1.54 1.351-1.08 2.027-2.81 2.027-5.188 0-2.485-.676-4.215-2.027-5.188-1.35-1.027-2.973-1.54-4.864-1.54z"/>
</g>
`),"!?":ke(`
<g transform="translate(77 -18) scale(0.4)">
  <circle style="fill:#ea45d8;filter:url(#shadow)" cx="50" cy="50" r="50"/>
    <path fill="#fff" d="M60.823 58.9q0-4.098 1.72-6.883 1.721-2.786 5.9-5.818 3.687-2.622 5.243-4.506 1.64-1.966 1.64-4.588t-1.967-3.933q-1.885-1.393-5.326-1.393t-6.8 1.065q-3.36 1.065-6.883 2.868l-4.343-8.767q4.015-2.212 8.685-3.605 4.67-1.393 10.242-1.393 8.521 0 13.192 4.097 4.752 4.096 4.752 10.405 0 3.36-1.065 5.818-1.066 2.458-3.196 4.588-2.13 2.048-5.326 4.424-2.376 1.72-3.687 2.95-1.31 1.229-1.802 2.376-.41 1.147-.41 2.868v2.376h-10.57zm-1.311 16.632q0-3.77 2.048-5.244 2.049-1.557 4.998-1.557 2.868 0 4.916 1.557 2.049 1.475 2.049 5.244 0 3.605-2.049 5.244-2.048 1.556-4.916 1.556-2.95 0-4.998-1.556-2.048-1.64-2.048-5.244zM36.967 61.849h-9.75l-2.049-39.083h13.847zM25.004 75.532q0-3.77 2.049-5.244 2.048-1.557 4.998-1.557 2.867 0 4.916 1.557 2.048 1.475 2.048 5.244 0 3.605-2.048 5.244-2.049 1.556-4.916 1.556-2.95 0-4.998-1.556-2.049-1.64-2.049-5.244z" vector-effect="non-scaling-stroke"/>
</g>
`),"!":ke(`
<g transform="translate(77 -18) scale(0.4)">
  <circle style="fill:#22ac38;filter:url(#shadow)" cx="50" cy="50" r="50" />
  <path fill="#fff" d="M54.967 62.349h-9.75l-2.049-39.083h13.847zM43.004 76.032q0-3.77 2.049-5.244 2.048-1.557 4.998-1.557 2.867 0 4.916 1.557 2.048 1.475 2.048 5.244 0 3.605-2.048 5.244-2.049 1.556-4.916 1.556-2.95 0-4.998-1.556-2.049-1.64-2.049-5.244z" vector-effect="non-scaling-stroke"/>
</g>
`),"!!":ke(`
<g transform="translate(77 -18) scale(0.4)">
  <circle style="fill:#168226;filter:url(#shadow)" cx="50" cy="50" r="50" />
  <path fill="#fff" d="M71.967 62.349h-9.75l-2.049-39.083h13.847zM60.004 76.032q0-3.77 2.049-5.244 2.048-1.557 4.998-1.557 2.867 0 4.916 1.557 2.048 1.475 2.048 5.244 0 3.605-2.048 5.244-2.049 1.556-4.916 1.556-2.95 0-4.998-1.556-2.049-1.64-2.049-5.244zM37.967 62.349h-9.75l-2.049-39.083h13.847zM26.004 76.032q0-3.77 2.049-5.244 2.048-1.557 4.998-1.557 2.867 0 4.916 1.557 2.048 1.475 2.048 5.244 0 3.605-2.048 5.244-2.049 1.556-4.916 1.556-2.95 0-4.998-1.556-2.049-1.64-2.049-5.244z" vector-effect="non-scaling-stroke"/>
</g>
`)},Ne=e=>e!==void 0,vi=6,bi=245;class _i{constructor(){W(this,"engineName");W(this,"work");W(this,"currentEval");W(this,"expectedPvs",1);W(this,"nextWork");W(this,"send");W(this,"options",new Map)}connected(t){this.send=t,this.options=new Map([["Threads","1"],["Hash","16"],["MultiPV","1"],["UCI_Variant","chess"]]),this.send("uci")}setOption(t,n){n=n.toString(),this.send&&this.options.get(t)!==n&&(this.send(`setoption name ${t} value ${n}`),this.options.set(t,n))}disconnected(){this.work&&this.currentEval&&this.work.emit(this.currentEval),this.work=void 0,this.send=void 0}received(t){var i,r;const n=t.trim().split(/\s+/g);if(n[0]==="uciok")this.setOption("UCI_AnalyseMode","true"),this.setOption("Analysis Contempt","Off"),this.setOption("UCI_Chess960","true"),(i=this.send)==null||i.call(this,"ucinewgame"),(r=this.send)==null||r.call(this,"isready");else if(n[0]==="readyok")this.swapWork();else if(n[0]==="id"&&n[1]==="name")this.engineName=n.slice(2).join(" ");else if(n[0]==="bestmove"){this.work&&this.currentEval&&this.work.emit(this.currentEval),this.work=void 0,this.swapWork();return}else if(this.work&&!this.work.stopRequested&&n[0]==="info"){let s=0,a,d=1,v,p,M=!1,_,L=[];for(let A=1;A<n.length;A++)switch(n[A]){case"depth":s=parseInt(n[++A]);break;case"nodes":a=parseInt(n[++A]);break;case"multipv":d=parseInt(n[++A]);break;case"time":v=parseInt(n[++A]);break;case"score":M=n[++A]==="mate",_=parseInt(n[++A]),(n[A+1]==="lowerbound"||n[A+1]==="upperbound")&&(p=n[++A]);break;case"pv":L=n.slice(++A),A=n.length;break}if(M&&!_||(this.expectedPvs<d&&(this.expectedPvs=d),s<vi||!Ne(a)||!Ne(v)||!Ne(M)||!Ne(_)))return;const F=this.work.threatMode?0:1,S=this.work.ply%2===F?-_:_;if(p&&d===1)return;const k={moves:L,cp:M?void 0:S,mate:M?S:void 0,depth:s};d===1?this.currentEval={fen:this.work.currentFen,maxDepth:this.work.maxDepth,depth:s,knps:a/v,nodes:a,cp:M?void 0:S,mate:M?S:void 0,pvs:[k],millis:v}:this.currentEval&&(this.currentEval.pvs.push(k),this.currentEval.depth=Math.min(this.currentEval.depth,s)),d===this.expectedPvs&&this.currentEval&&(this.work.emit(this.currentEval),s>=this.work.maxDepth&&v>8e3&&a>4e3*Math.exp(this.work.maxDepth*.3)&&this.stop())}}stop(){var t;this.work&&!this.work.stopRequested&&(this.work.stopRequested=!0,(t=this.send)==null||t.call(this,"stop"))}swapWork(){!this.send||this.work||(this.work=this.nextWork,this.nextWork=void 0,this.work&&(this.currentEval=void 0,this.expectedPvs=1,this.setOption("Threads",this.work.threads),this.setOption("Hash",this.work.hashSize||16),this.setOption("MultiPV",Math.max(1,this.work.multiPv)),this.send(["position fen",this.work.initialFen,"moves",...this.work.moves].join(" ")),this.send(this.work.maxDepth>=99?`go depth ${bi}`:"go movetime 90000")))}compute(t){this.nextWork=t,this.stop(),this.swapWork()}isComputing(){return!!this.work&&!this.work.stopRequested}}const wi=e=>e,ki=e=>new Promise((t,n)=>{let i=document.createElement("script");i.onload=()=>{t(void 0)},i.onerror=r=>{n(r)},i.src=e,document.head.append(i)}),fe=class{constructor(t){this.opts=t}getState(){return fe.sf.Stockfish?fe.failed.Stockfish?4:this.getProtocol().engineName?this.getProtocol().isComputing()?3:2:1:0}getProtocol(){return fe.protocols.Stockfish}async boot(){let t="http://"+window.location.host+"/vendor/stockfish-nnue.wasm/";t="https://"+window.location.host+"/vendor/stockfish-nnue.wasm/";const n=t+"stockfish.wasm";let i;i=await new Promise((a,d)=>{fetch(n).then(v=>v.arrayBuffer()).then(v=>a(v))}),await ki(t+"stockfish.js");const r=await window.Stockfish({wasmBinary:i,locateFile:a=>wi(t+a),wasmMemory:this.opts.wasmMemory}),s=this.getProtocol();return r.addMessageListener(s.received.bind(s)),s.connected(a=>r.postMessage(a)),r}start(t){this.getProtocol().compute(t),fe.sf.Stockfish||(fe.sf.Stockfish=this.boot().then(()=>{},n=>{console.error(n),fe.failed.Stockfish=!0}))}stop(){this.getProtocol().compute(void 0)}destroy(){this.stop()}};let ye=fe;W(ye,"failed",{Stockfish:!1}),W(ye,"protocols",{Stockfish:new _i}),W(ye,"sf",{});const ht="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1";function yi(e){return!!(e.startsWith("O-O")||e.includes("x")||e.toLowerCase()===e)}const Qt=(e,t)=>{for(;;)try{return new WebAssembly.Memory({shared:!0,initial:e,maximum:t})}catch(n){if(n instanceof RangeError){if(e===t)throw n;t=Math.max(e,Math.floor(t/2))}else throw n}},Si=()=>{let e="wasm";Pi(1,2);const t=1,n=()=>128;return{technology:e,growableSharedMem:!1,supportsNnue:!1,maxThreads:t,maxWasmPages:i=>Math.max(i,32768),maxHashSize:()=>n()}};function Pi(e,t){if(typeof SharedArrayBuffer!="function")return;const n=Qt(e,t);if(n.buffer instanceof SharedArrayBuffer){try{window.postMessage(n.buffer,"*")}catch{return}return n}}class Ci{constructor(t){W(this,"worker");W(this,"platform");W(this,"start",(t,n)=>{this.doStart(t,n)});W(this,"doStart",(t,n)=>{var a;const i=n[n.length-1],r=8,s={threads:1,hashSize:this.hashSize(),stopRequested:!1,initialFen:((a=n[0])==null?void 0:a.fen)||ht,moves:[],currentFen:(i==null?void 0:i.fen)||ht,path:t,ply:(i==null?void 0:i.ply)||0,maxDepth:r,multiPv:2,threatMode:!1,emit:d=>{this.opts.emit(d,s)}};for(let d=1;d<n.length;d++){const v=n[d];yi(v.san)?(s.moves=[],s.initialFen=v.fen):s.moves.push(v.uci)}this.worker||(this.worker=new ye({wasmMemory:Qt(2048,this.platform.maxWasmPages(2048))})),this.worker.start(s)});W(this,"stop",()=>{var t;(t=this.worker)==null||t.stop()});W(this,"hashSize",()=>this.platform.maxHashSize());this.opts=t,this.platform=Si()}}const Mi=ve(`<div class="result-wrap"><div class="result"></div>Eval dropped below 2. Game's over.</div>`),Ei=ve('<button class="fbt">Analyse on Lichess</button>'),Ai=ve('<button class="fbt">Rematch</button>'),Ni=ve('<div class="hardcore"><div class="board"></div><div class="table"><div class="ceval"></div><div class="replay"></div><div class="rcontrols"><div class="follow-up"></div></div></div></div>'),Ti=ve('<span class="index"></span>'),Ii=ve('<div class="move"></div>'),pt=e=>50+50*(2/(1+Math.exp(- -.00368208*e))-1),mt=e=>{if(e!==void 0)return Math.abs(e)<10?"!":e<-30?"??":e<-20?"?!":e<-10?"?":void 0},gt=(e,t)=>e.move(t,{sloppy:!0})||e.move("O-O")||e.move("O-O-O"),Ri=()=>{let[e,t]=Zt();const n=e.color==="black",i=parseInt(e.level),r=n?"black":"white",s=r==="white"?"black":"white",a=r[0];let[d,v]=Te(new Ce.Chess,{equals:!1}),[p,M]=Te(!1),_;const L=re(()=>d().turn()),F=re(()=>d().fen()),S=re(()=>d().pgn()),k=re(()=>{let C=new Ce.Chess;return d().history({verbose:!0}).map((I,y)=>{const o=C.move(I.san);return{ply:y,fen:C.fen(),turn:C.turn(),uci:o.from+o.to,san:o.san}})});re(()=>{let C=k();if(C.length>1)return C[C.length-2].fen});const[A,te]=Te(new Map,{equals:!1});let x=new Ci({emit(C){C.depth>=i&&te(I=>(I.set(C.fen,C),I))}});Ie($e(F,C=>{x.start("",k())})),Ie(()=>{k(),p(),_&&_.scrollTo(0,_.scrollHeight)});const B=C=>{const I=A().get(C);if(!(!I||!I.cp||I.depth<i))return I.cp/100},V=re(()=>B(F())||0),U=(C,I)=>{const y=B(C),o=B(I);if(!(y===void 0||o===void 0))return(pt(y*100)-pt(o*100))*(n?-1:1)},$=re(()=>{let C=k();if(C.length>=3){let[I,y,o]=C.slice(-3),l=mt(U(y.fen,I.fen)),c=mt(U(o.fen,y.fen)),u=[];return I.turn===a&&l&&u.push({orig:y.uci.slice(2),glyph:l}),y.turn===a&&c&&u.push({orig:o.uci.slice(2),glyph:c}),u}return[]});function Z(){const C=A().get(F());if(!p()&&C&&L()===s[0]&&C.depth>=i)if((n?V():-V())<-2.1)M(!0);else{let y=C.pvs[0].moves[0];v(o=>(gt(o,y),o))}setTimeout(Z,500)}setTimeout(Z,500);const T=re(()=>Math.floor(k().length/2)),ie=C=>{v(I=>(gt(I,C),I))},R=()=>{let C=S(),I=new FormData;I.append("pgn",C);let y="white";fetch("https://lichess.org/api/import",{method:"post",body:I}).then(o=>o.json()).then(o=>{let l=o.url;window.open(`${l}/${y}#${k().length}`,"_blank")})},z=()=>{M(!1),v(new Ce.Chess)};return[me(Yt,{children:" aidchess.com - Hardcore Chess "}),(()=>{const C=Ni.cloneNode(!0),I=C.firstChild,y=I.nextSibling,o=y.firstChild,l=o.nextSibling,c=l.nextSibling,u=c.firstChild;return ae(I,me(mi,{get glyphs(){return $()},get fen(){return F()},isBlack:n,onUserMove:ie})),ae(o,()=>-V()),vt(f=>_=f,l),ae(l,me(Oi,{get steps(){return k()}}),null),ae(l,me(tt,{get when(){return p()},get children(){const f=Mi.cloneNode(!0),g=f.firstChild;return ae(g,T),f}}),null),ae(u,me(tt,{get when(){return p()},get children(){return[(()=>{const f=Ei.cloneNode(!0);return f.$$click=()=>R(),f})(),(()=>{const f=Ai.cloneNode(!0);return f.$$click=()=>z(),f})()]}})),C})()]},Oi=e=>{let t=re(()=>{let n=e.steps,i=[],r=[];return n.forEach(s=>{i.push(s),s.ply%2===1&&(r.push(i),i=[])}),r});return me(nt,{get each(){return t()},children:n=>[(()=>{const i=Ti.cloneNode(!0);return ae(i,()=>n[0].ply/2+1),i})(),me(nt,{each:n,children:i=>(()=>{const r=Ii.cloneNode(!0);return ae(r,()=>i.san),r})()})]})};Xt(["click"]);export{Ri as default};
