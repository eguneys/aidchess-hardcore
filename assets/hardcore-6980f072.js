var Ut=Object.defineProperty;var jt=(e,t,n)=>t in e?Ut(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var F=(e,t,n)=>(jt(e,typeof t!="symbol"?t+"":t,n),n);import{a as ut,o as xt,b as ft,t as _e,e as Ee,f as Ae,i as re,c as be,S as Ye,g as Qt,F as Xe,d as Gt}from"./index-3e9e866b.js";const zt=["white","black"],$e=["a","b","c","d","e","f","g","h"],We=["1","2","3","4","5","6","7","8"],Vt=[...We].reverse(),He=Array.prototype.concat(...$e.map(e=>We.map(t=>e+t))),Y=e=>He[8*e[0]+e[1]],q=e=>[e.charCodeAt(0)-97,e.charCodeAt(1)-49],dt=He.map(q);function Zt(e){let t;const n=()=>(t===void 0&&(t=e()),t);return n.clear=()=>{t=void 0},n}const Yt=()=>{let e;return{start(){e=performance.now()},cancel(){e=void 0},stop(){if(!e)return 0;const t=performance.now()-e;return e=void 0,t}}},Be=e=>e==="white"?"black":"white",ye=(e,t)=>{const n=e[0]-t[0],i=e[1]-t[1];return n*n+i*i},qe=(e,t)=>e.role===t.role&&e.color===t.color,Pe=e=>(t,n)=>[(n?t[0]:7-t[0])*e.width/8,(n?7-t[1]:t[1])*e.height/8],ee=(e,t)=>{e.style.transform=`translate(${t[0]}px,${t[1]}px)`},ht=(e,t,n=1)=>{e.style.transform=`translate(${t[0]}px,${t[1]}px) scale(${n})`},Fe=(e,t)=>{e.style.visibility=t?"visible":"hidden"},pe=e=>{var t;if(e.clientX||e.clientX===0)return[e.clientX,e.clientY];if(!((t=e.targetTouches)===null||t===void 0)&&t[0])return[e.targetTouches[0].clientX,e.targetTouches[0].clientY]},pt=e=>e.buttons===2||e.button===2,te=(e,t)=>{const n=document.createElement(e);return t&&(n.className=t),n};function mt(e,t,n){const i=q(e);return t||(i[0]=7-i[0],i[1]=7-i[1]),[n.left+n.width*i[0]/8+n.width/16,n.top+n.height*(7-i[1])/8+n.height/16]}const he=(e,t)=>Math.abs(e-t),Xt=e=>(t,n,i,o)=>he(t,i)<2&&(e==="white"?o===n+1||n<=1&&o===n+2&&t===i:o===n-1||n>=6&&o===n-2&&t===i),gt=(e,t,n,i)=>{const o=he(e,n),s=he(t,i);return o===1&&s===2||o===2&&s===1},vt=(e,t,n,i)=>he(e,n)===he(t,i),bt=(e,t,n,i)=>e===n||t===i,_t=(e,t,n,i)=>vt(e,t,n,i)||bt(e,t,n,i),Jt=(e,t,n)=>(i,o,s,a)=>he(i,s)<2&&he(o,a)<2||n&&o===a&&o===(e==="white"?0:7)&&(i===4&&(s===2&&t.includes(0)||s===6&&t.includes(7))||t.includes(s));function en(e,t){const n=t==="white"?"1":"8",i=[];for(const[o,s]of e)o[1]===n&&s.color===t&&s.role==="rook"&&i.push(q(o)[0]);return i}function wt(e,t,n){const i=e.get(t);if(!i)return[];const o=q(t),s=i.role,a=s==="pawn"?Xt(i.color):s==="knight"?gt:s==="bishop"?vt:s==="rook"?bt:s==="queen"?_t:Jt(i.color,en(e,i.color),n);return dt.filter(d=>(o[0]!==d[0]||o[1]!==d[1])&&a(o[0],o[1],d[0],d[1])).map(Y)}function Q(e,...t){e&&setTimeout(()=>e(...t),1)}function tn(e){e.orientation=Be(e.orientation),e.animation.current=e.draggable.current=e.selected=void 0}function nn(e,t){for(const[n,i]of t)i?e.pieces.set(n,i):e.pieces.delete(n)}function on(e,t){if(e.check=void 0,t===!0&&(t=e.turnColor),t)for(const[n,i]of e.pieces)i.role==="king"&&i.color===t&&(e.check=n)}function rn(e,t,n,i){ae(e),e.premovable.current=[t,n],Q(e.premovable.events.set,t,n,i)}function le(e){e.premovable.current&&(e.premovable.current=void 0,Q(e.premovable.events.unset))}function sn(e,t,n){le(e),e.predroppable.current={role:t,key:n},Q(e.predroppable.events.set,t,n)}function ae(e){const t=e.predroppable;t.current&&(t.current=void 0,Q(t.events.unset))}function cn(e,t,n){if(!e.autoCastle)return!1;const i=e.pieces.get(t);if(!i||i.role!=="king")return!1;const o=q(t),s=q(n);if(o[1]!==0&&o[1]!==7||o[1]!==s[1])return!1;o[0]===4&&!e.pieces.has(n)&&(s[0]===6?n=Y([7,s[1]]):s[0]===2&&(n=Y([0,s[1]])));const a=e.pieces.get(n);return!a||a.color!==i.color||a.role!=="rook"?!1:(e.pieces.delete(t),e.pieces.delete(n),o[0]<s[0]?(e.pieces.set(Y([6,s[1]]),i),e.pieces.set(Y([5,s[1]]),a)):(e.pieces.set(Y([2,s[1]]),i),e.pieces.set(Y([3,s[1]]),a)),!0)}function kt(e,t,n){const i=e.pieces.get(t),o=e.pieces.get(n);if(t===n||!i)return!1;const s=o&&o.color!==i.color?o:void 0;return n===e.selected&&X(e),Q(e.events.move,t,n,s),cn(e,t,n)||(e.pieces.set(n,i),e.pieces.delete(t)),e.lastMove=[t,n],e.check=void 0,Q(e.events.change),s||!0}function Ue(e,t,n,i){if(e.pieces.has(n))if(i)e.pieces.delete(n);else return!1;return Q(e.events.dropNewPiece,t,n),e.pieces.set(n,t),e.lastMove=[n],e.check=void 0,Q(e.events.change),e.movable.dests=void 0,e.turnColor=Be(e.turnColor),!0}function St(e,t,n){const i=kt(e,t,n);return i&&(e.movable.dests=void 0,e.turnColor=Be(e.turnColor),e.animation.current=void 0),i}function yt(e,t,n){if(je(e,t,n)){const i=St(e,t,n);if(i){const o=e.hold.stop();X(e);const s={premove:!1,ctrlKey:e.stats.ctrlKey,holdTime:o};return i!==!0&&(s.captured=i),Q(e.movable.events.after,t,n,s),!0}}else if(an(e,t,n))return rn(e,t,n,{ctrlKey:e.stats.ctrlKey}),X(e),!0;return X(e),!1}function Pt(e,t,n,i){const o=e.pieces.get(t);o&&(ln(e,t,n)||i)?(e.pieces.delete(t),Ue(e,o,n,i),Q(e.movable.events.afterNewPiece,o.role,n,{premove:!1,predrop:!1})):o&&un(e,t,n)?sn(e,o.role,n):(le(e),ae(e)),e.pieces.delete(t),X(e)}function De(e,t,n){if(Q(e.events.select,t),e.selected){if(e.selected===t&&!e.draggable.enabled){X(e),e.hold.cancel();return}else if((e.selectable.enabled||n)&&e.selected!==t&&yt(e,e.selected,t)){e.stats.dragged=!1;return}}(e.selectable.enabled||e.draggable.enabled)&&(Et(e,t)||xe(e,t))&&(Ct(e,t),e.hold.start())}function Ct(e,t){e.selected=t,xe(e,t)?e.premovable.dests=wt(e.pieces,t,e.premovable.castle):e.premovable.dests=void 0}function X(e){e.selected=void 0,e.premovable.dests=void 0,e.hold.cancel()}function Et(e,t){const n=e.pieces.get(t);return!!n&&(e.movable.color==="both"||e.movable.color===n.color&&e.turnColor===n.color)}const je=(e,t,n)=>{var i,o;return t!==n&&Et(e,t)&&(e.movable.free||!!(!((o=(i=e.movable.dests)===null||i===void 0?void 0:i.get(t))===null||o===void 0)&&o.includes(n)))};function ln(e,t,n){const i=e.pieces.get(t);return!!i&&(t===n||!e.pieces.has(n))&&(e.movable.color==="both"||e.movable.color===i.color&&e.turnColor===i.color)}function xe(e,t){const n=e.pieces.get(t);return!!n&&e.premovable.enabled&&e.movable.color===n.color&&e.turnColor!==n.color}const an=(e,t,n)=>t!==n&&xe(e,t)&&wt(e.pieces,t,e.premovable.castle).includes(n);function un(e,t,n){const i=e.pieces.get(t),o=e.pieces.get(n);return!!i&&(!o||o.color!==e.movable.color)&&e.predroppable.enabled&&(i.role!=="pawn"||n[1]!=="1"&&n[1]!=="8")&&e.movable.color===i.color&&e.turnColor!==i.color}function fn(e,t){const n=e.pieces.get(t);return!!n&&e.draggable.enabled&&(e.movable.color==="both"||e.movable.color===n.color&&(e.turnColor===n.color||e.premovable.enabled))}function dn(e){const t=e.premovable.current;if(!t)return!1;const n=t[0],i=t[1];let o=!1;if(je(e,n,i)){const s=St(e,n,i);if(s){const a={premove:!0};s!==!0&&(a.captured=s),Q(e.movable.events.after,n,i,a),o=!0}}return le(e),o}function hn(e,t){const n=e.predroppable.current;let i=!1;if(!n)return!1;if(t(n)){const o={role:n.role,color:e.movable.color};Ue(e,o,n.key)&&(Q(e.movable.events.afterNewPiece,n.role,n.key,{premove:!1,predrop:!0}),i=!0)}return ae(e),i}function Qe(e){le(e),ae(e),X(e)}function Je(e){e.movable.color=e.movable.dests=e.animation.current=void 0,Qe(e)}function me(e,t,n){let i=Math.floor(8*(e[0]-n.left)/n.width);t||(i=7-i);let o=7-Math.floor(8*(e[1]-n.top)/n.height);return t||(o=7-o),i>=0&&i<8&&o>=0&&o<8?Y([i,o]):void 0}function pn(e,t,n,i){const o=q(e),s=dt.filter(m=>_t(o[0],o[1],m[0],m[1])||gt(o[0],o[1],m[0],m[1])),d=s.map(m=>mt(Y(m),n,i)).map(m=>ye(t,m)),[,v]=d.reduce((m,C,_)=>m[0]<C?m:[C,_],[d[0],0]);return Y(s[v])}const G=e=>e.orientation==="white",Mt="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",mn={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king"},gn={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};function At(e){e==="start"&&(e=Mt);const t=new Map;let n=7,i=0;for(const o of e)switch(o){case" ":case"[":return t;case"/":if(--n,n<0)return t;i=0;break;case"~":{const s=t.get(Y([i-1,n]));s&&(s.promoted=!0);break}default:{const s=o.charCodeAt(0);if(s<57)i+=s-48;else{const a=o.toLowerCase();t.set(Y([i,n]),{role:mn[a],color:o===a?"black":"white"}),++i}}}return t}function vn(e){return Vt.map(t=>$e.map(n=>{const i=e.get(n+t);if(i){let o=gn[i.role];return i.color==="white"&&(o=o.toUpperCase()),i.promoted&&(o+="~"),o}else return"1"}).join("")).join("/").replace(/1{2,}/g,t=>t.length.toString())}function Nt(e,t){t.animation&&(Ge(e.animation,t.animation),(e.animation.duration||0)<70&&(e.animation.enabled=!1))}function Tt(e,t){var n,i;if(!((n=t.movable)===null||n===void 0)&&n.dests&&(e.movable.dests=void 0),!((i=t.drawable)===null||i===void 0)&&i.autoShapes&&(e.drawable.autoShapes=[]),Ge(e,t),t.fen&&(e.pieces=At(t.fen),e.drawable.shapes=[]),"check"in t&&on(e,t.check||!1),"lastMove"in t&&!t.lastMove?e.lastMove=void 0:t.lastMove&&(e.lastMove=t.lastMove),e.selected&&Ct(e,e.selected),Nt(e,t),!e.movable.rookCastle&&e.movable.dests){const o=e.movable.color==="white"?"1":"8",s="e"+o,a=e.movable.dests.get(s),d=e.pieces.get(s);if(!a||!d||d.role!=="king")return;e.movable.dests.set(s,a.filter(v=>!(v==="a"+o&&a.includes("c"+o))&&!(v==="h"+o&&a.includes("g"+o))))}}function Ge(e,t){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(Object.prototype.hasOwnProperty.call(e,n)&&et(e[n])&&et(t[n])?Ge(e[n],t[n]):e[n]=t[n])}function et(e){if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return t===Object.prototype||t===null}const de=(e,t)=>t.animation.enabled?wn(e,t):oe(e,t);function oe(e,t){const n=e(t);return t.dom.redraw(),n}const Oe=(e,t)=>({key:e,pos:q(e),piece:t}),bn=(e,t)=>t.sort((n,i)=>ye(e.pos,n.pos)-ye(e.pos,i.pos))[0];function _n(e,t){const n=new Map,i=[],o=new Map,s=[],a=[],d=new Map;let v,m,C;for(const[_,K]of e)d.set(_,Oe(_,K));for(const _ of He)v=t.pieces.get(_),m=d.get(_),v?m?qe(v,m.piece)||(s.push(m),a.push(Oe(_,v))):a.push(Oe(_,v)):m&&s.push(m);for(const _ of a)m=bn(_,s.filter(K=>qe(_.piece,K.piece))),m&&(C=[m.pos[0]-_.pos[0],m.pos[1]-_.pos[1]],n.set(_.key,C.concat(C)),i.push(m.key));for(const _ of s)i.includes(_.key)||o.set(_.key,_.piece);return{anims:n,fadings:o}}function It(e,t){const n=e.animation.current;if(n===void 0){e.dom.destroyed||e.dom.redrawNow();return}const i=1-(t-n.start)*n.frequency;if(i<=0)e.animation.current=void 0,e.dom.redrawNow();else{const o=kn(i);for(const s of n.plan.anims.values())s[2]=s[0]*o,s[3]=s[1]*o;e.dom.redrawNow(!0),requestAnimationFrame((s=performance.now())=>It(e,s))}}function wn(e,t){const n=new Map(t.pieces),i=e(t),o=_n(n,t);if(o.anims.size||o.fadings.size){const s=t.animation.current&&t.animation.current.start;t.animation.current={start:performance.now(),frequency:1/t.animation.duration,plan:o},s||It(t,performance.now())}else t.dom.redraw();return i}const kn=e=>e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1,Sn=["green","red","blue","yellow"];function yn(e,t){if(t.touches&&t.touches.length>1)return;t.stopPropagation(),t.preventDefault(),t.ctrlKey?X(e):Qe(e);const n=pe(t),i=me(n,G(e),e.dom.bounds());i&&(e.drawable.current={orig:i,pos:n,brush:Mn(t),snapToValidMove:e.drawable.defaultSnapToValidMove},Ot(e))}function Ot(e){requestAnimationFrame(()=>{const t=e.drawable.current;if(t){const n=me(t.pos,G(e),e.dom.bounds());n||(t.snapToValidMove=!1);const i=t.snapToValidMove?pn(t.orig,t.pos,G(e),e.dom.bounds()):n;i!==t.mouseSq&&(t.mouseSq=i,t.dest=i!==t.orig?i:void 0,e.dom.redrawNow()),Ot(e)}})}function Pn(e,t){e.drawable.current&&(e.drawable.current.pos=pe(t))}function Cn(e){const t=e.drawable.current;t&&(t.mouseSq&&An(e.drawable,t),Kt(e))}function Kt(e){e.drawable.current&&(e.drawable.current=void 0,e.dom.redraw())}function En(e){e.drawable.shapes.length&&(e.drawable.shapes=[],e.dom.redraw(),Rt(e.drawable))}function Mn(e){var t;const n=(e.shiftKey||e.ctrlKey)&&pt(e),i=e.altKey||e.metaKey||((t=e.getModifierState)===null||t===void 0?void 0:t.call(e,"AltGraph"));return Sn[(n?1:0)+(i?2:0)]}function An(e,t){const n=o=>o.orig===t.orig&&o.dest===t.dest,i=e.shapes.find(n);i&&(e.shapes=e.shapes.filter(o=>!n(o))),(!i||i.brush!==t.brush)&&e.shapes.push({orig:t.orig,dest:t.dest,brush:t.brush}),Rt(e)}function Rt(e){e.onChange&&e.onChange(e.shapes)}function Nn(e,t){if(!t.isTrusted||t.button!==void 0&&t.button!==0||t.touches&&t.touches.length>1)return;const n=e.dom.bounds(),i=pe(t),o=me(i,G(e),n);if(!o)return;const s=e.pieces.get(o),a=e.selected;!a&&e.drawable.enabled&&(e.drawable.eraseOnClick||!s||s.color!==e.turnColor)&&En(e),t.cancelable!==!1&&(!t.touches||e.blockTouchScroll||s||a||Tn(e,i))&&t.preventDefault();const d=!!e.premovable.current,v=!!e.predroppable.current;e.stats.ctrlKey=t.ctrlKey,e.selected&&je(e,e.selected,o)?de(_=>De(_,o),e):De(e,o);const m=e.selected===o,C=Dt(e,o);if(s&&C&&m&&fn(e,o)){e.draggable.current={orig:o,piece:s,origPos:i,pos:i,started:e.draggable.autoDistance&&e.stats.dragged,element:C,previouslySelected:a,originTarget:t.target,keyHasChanged:!1},C.cgDragging=!0,C.classList.add("dragging");const _=e.dom.elements.ghost;_&&(_.className=`ghost ${s.color} ${s.role}`,ee(_,Pe(n)(q(o),G(e))),Fe(_,!0)),ze(e)}else d&&le(e),v&&ae(e);e.dom.redraw()}function Tn(e,t){const n=G(e),i=e.dom.bounds(),o=Math.pow(i.width/8,2);for(const s of e.pieces.keys()){const a=mt(s,n,i);if(ye(a,t)<=o)return!0}return!1}function In(e,t,n,i){const o="a0";e.pieces.set(o,t),e.dom.redraw();const s=pe(n);e.draggable.current={orig:o,piece:t,origPos:s,pos:s,started:!0,element:()=>Dt(e,o),originTarget:n.target,newPiece:!0,force:!!i,keyHasChanged:!1},ze(e)}function ze(e){requestAnimationFrame(()=>{var t;const n=e.draggable.current;if(!n)return;!((t=e.animation.current)===null||t===void 0)&&t.plan.anims.has(n.orig)&&(e.animation.current=void 0);const i=e.pieces.get(n.orig);if(!i||!qe(i,n.piece))Ne(e);else if(!n.started&&ye(n.pos,n.origPos)>=Math.pow(e.draggable.distance,2)&&(n.started=!0),n.started){if(typeof n.element=="function"){const s=n.element();if(!s)return;s.cgDragging=!0,s.classList.add("dragging"),n.element=s}const o=e.dom.bounds();ee(n.element,[n.pos[0]-o.left-o.width/16,n.pos[1]-o.top-o.height/16]),n.keyHasChanged||(n.keyHasChanged=n.orig!==me(n.pos,G(e),o))}ze(e)})}function On(e,t){e.draggable.current&&(!t.touches||t.touches.length<2)&&(e.draggable.current.pos=pe(t))}function Kn(e,t){const n=e.draggable.current;if(!n)return;if(t.type==="touchend"&&t.cancelable!==!1&&t.preventDefault(),t.type==="touchend"&&n.originTarget!==t.target&&!n.newPiece){e.draggable.current=void 0;return}le(e),ae(e);const i=pe(t)||n.pos,o=me(i,G(e),e.dom.bounds());o&&n.started&&n.orig!==o?n.newPiece?Pt(e,n.orig,o,n.force):(e.stats.ctrlKey=t.ctrlKey,yt(e,n.orig,o)&&(e.stats.dragged=!0)):n.newPiece?e.pieces.delete(n.orig):e.draggable.deleteOnDropOff&&!o&&(e.pieces.delete(n.orig),Q(e.events.change)),(n.orig===n.previouslySelected||n.keyHasChanged)&&(n.orig===o||!o)?X(e):e.selectable.enabled||X(e),qt(e),e.draggable.current=void 0,e.dom.redraw()}function Ne(e){const t=e.draggable.current;t&&(t.newPiece&&e.pieces.delete(t.orig),e.draggable.current=void 0,X(e),qt(e),e.dom.redraw())}function qt(e){const t=e.dom.elements;t.ghost&&Fe(t.ghost,!1)}function Dt(e,t){let n=e.dom.elements.board.firstChild;for(;n;){if(n.cgKey===t&&n.tagName==="PIECE")return n;n=n.nextSibling}}function Rn(e,t){e.exploding={stage:1,keys:t},e.dom.redraw(),setTimeout(()=>{tt(e,2),setTimeout(()=>tt(e,void 0),120)},120)}function tt(e,t){e.exploding&&(t?e.exploding.stage=t:e.exploding=void 0,e.dom.redraw())}function qn(e,t){function n(){tn(e),t()}return{set(i){i.orientation&&i.orientation!==e.orientation&&n(),Nt(e,i),(i.fen?de:oe)(o=>Tt(o,i),e)},state:e,getFen:()=>vn(e.pieces),toggleOrientation:n,setPieces(i){de(o=>nn(o,i),e)},selectSquare(i,o){i?de(s=>De(s,i,o),e):e.selected&&(X(e),e.dom.redraw())},move(i,o){de(s=>kt(s,i,o),e)},newPiece(i,o){de(s=>Ue(s,i,o),e)},playPremove(){if(e.premovable.current){if(de(dn,e))return!0;e.dom.redraw()}return!1},playPredrop(i){if(e.predroppable.current){const o=hn(e,i);return e.dom.redraw(),o}return!1},cancelPremove(){oe(le,e)},cancelPredrop(){oe(ae,e)},cancelMove(){oe(i=>{Qe(i),Ne(i)},e)},stop(){oe(i=>{Je(i),Ne(i)},e)},explode(i){Rn(e,i)},setAutoShapes(i){oe(o=>o.drawable.autoShapes=i,e)},setShapes(i){oe(o=>o.drawable.shapes=i,e)},getKeyAtDomPos(i){return me(i,G(e),e.dom.bounds())},redrawAll:t,dragNewPiece(i,o,s){In(e,i,o,s)},destroy(){Je(e),e.dom.unbind&&e.dom.unbind(),e.dom.destroyed=!0}}}function Dn(){return{pieces:At(Mt),orientation:"white",turnColor:"white",coordinates:!0,ranksPosition:"right",autoCastle:!0,viewOnly:!1,disableContextMenu:!1,addPieceZIndex:!1,blockTouchScroll:!1,pieceKey:!1,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200},movable:{free:!0,color:"both",showDests:!0,events:{},rookCastle:!0},premovable:{enabled:!0,showDests:!0,castle:!0,events:{}},predroppable:{enabled:!1,events:{}},draggable:{enabled:!0,distance:3,autoDistance:!0,showGhost:!0,deleteOnDropOff:!1},dropmode:{active:!1},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{},drawable:{enabled:!0,visible:!0,defaultSnapToValidMove:!0,eraseOnClick:!0,shapes:[],autoShapes:[],brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15}},prevSvgHash:""},hold:Yt()}}function Le(e,t,n){const i=new Map,o=[];for(const d of e)i.set(d.hash,!1);let s=t.firstChild,a;for(;s;)a=s.getAttribute("cgHash"),i.has(a)?i.set(a,!0):o.push(s),s=s.nextSibling;for(const d of o)t.removeChild(d);for(const d of e)i.get(d.hash)||t.appendChild(n(d))}function J(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function Ln(e,t,n){const i=e.drawable,o=i.current,s=o&&o.mouseSq?o:void 0,a=new Map,d=e.dom.bounds(),v=i.autoShapes.filter(S=>!S.piece);for(const S of i.shapes.concat(v).concat(s?[s]:[]))S.dest&&a.set(S.dest,(a.get(S.dest)||0)+1);const m=i.shapes.concat(v).map(S=>({shape:S,current:!1,hash:nt(S,a,!1,d)}));s&&m.push({shape:s,current:!0,hash:nt(s,a,!0,d)});const C=m.map(S=>S.hash).join(";");if(C===e.drawable.prevSvgHash)return;e.drawable.prevSvgHash=C;const _=t.querySelector("defs"),K=t.querySelector("g"),z=n.querySelector("g");$n(i,m,_),Le(m.filter(S=>!S.shape.customSvg),K,S=>it(e,S,i.brushes,a,d)),Le(m.filter(S=>S.shape.customSvg),z,S=>it(e,S,i.brushes,a,d))}function $n(e,t,n){const i=new Map;let o;for(const d of t)d.shape.dest&&(o=e.brushes[d.shape.brush],d.shape.modifiers&&(o=Lt(o,d.shape.modifiers)),i.set(o.key,o));const s=new Set;let a=n.firstChild;for(;a;)s.add(a.getAttribute("cgKey")),a=a.nextSibling;for(const[d,v]of i.entries())s.has(d)||n.appendChild(xn(v))}function nt({orig:e,dest:t,brush:n,piece:i,modifiers:o,customSvg:s},a,d,v){return[v.width,v.height,d,e,t,n,t&&(a.get(t)||0)>1,i&&Wn(i),o&&Hn(o),s&&Bn(s)].filter(m=>m).join(",")}function Wn(e){return[e.color,e.role,e.scale].filter(t=>t).join(",")}function Hn(e){return""+(e.lineWidth||"")}function Bn(e){let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n)>>>0;return"custom-"+t.toString()}function it(e,{shape:t,current:n,hash:i},o,s,a){let d;const v=ot(q(t.orig),e.orientation);if(t.customSvg)d=Fn(t.customSvg,v,a);else if(t.dest){let m=o[t.brush];t.modifiers&&(m=Lt(m,t.modifiers)),d=jn(m,v,ot(q(t.dest),e.orientation),n,(s.get(t.dest)||0)>1,a)}else d=Un(o[t.brush],v,n,a);return d.setAttribute("cgHash",i),d}function Fn(e,t,n){const[i,o]=Te(t,n),s=ce(J("g"),{transform:`translate(${i},${o})`}),a=ce(J("svg"),{width:1,height:1,viewBox:"0 0 100 100"});return s.appendChild(a),a.innerHTML=e,s}function Un(e,t,n,i){const o=Te(t,i),s=Qn(),a=(i.width+i.height)/(4*Math.max(i.width,i.height));return ce(J("circle"),{stroke:e.color,"stroke-width":s[n?0:1],fill:"none",opacity:$t(e,n),cx:o[0],cy:o[1],r:a-s[1]/2})}function jn(e,t,n,i,o,s){const a=zn(o&&!i),d=Te(t,s),v=Te(n,s),m=v[0]-d[0],C=v[1]-d[1],_=Math.atan2(C,m),K=Math.cos(_)*a,z=Math.sin(_)*a;return ce(J("line"),{stroke:e.color,"stroke-width":Gn(e,i),"stroke-linecap":"round","marker-end":"url(#arrowhead-"+e.key+")",opacity:$t(e,i),x1:d[0],y1:d[1],x2:v[0]-K,y2:v[1]-z})}function xn(e){const t=ce(J("marker"),{id:"arrowhead-"+e.key,orient:"auto",markerWidth:4,markerHeight:8,refX:2.05,refY:2.01});return t.appendChild(ce(J("path"),{d:"M0,0 V4 L3,2 Z",fill:e.color})),t.setAttribute("cgKey",e.key),t}function ce(e,t){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.setAttribute(n,t[n]);return e}function ot(e,t){return t==="white"?e:[7-e[0],7-e[1]]}function Lt(e,t){return{color:e.color,opacity:Math.round(e.opacity*10)/10,lineWidth:Math.round(t.lineWidth||e.lineWidth),key:[e.key,t.lineWidth].filter(n=>n).join("")}}function Qn(){return[3/64,4/64]}function Gn(e,t){return(e.lineWidth||10)*(t?.85:1)/64}function $t(e,t){return(e.opacity||1)*(t?.9:1)}function zn(e){return(e?20:10)/64}function Te(e,t){const n=Math.min(1,t.width/t.height),i=Math.min(1,t.height/t.width);return[(e[0]-3.5)*n,(3.5-e[1])*i]}function Vn(e,t){e.innerHTML="",e.classList.add("cg-wrap");for(const v of zt)e.classList.toggle("orientation-"+v,t.orientation===v);e.classList.toggle("manipulable",!t.viewOnly);const n=te("cg-container");e.appendChild(n);const i=te("cg-board");n.appendChild(i);let o,s,a;if(t.drawable.visible&&(o=ce(J("svg"),{class:"cg-shapes",viewBox:"-4 -4 8 8",preserveAspectRatio:"xMidYMid slice"}),o.appendChild(J("defs")),o.appendChild(J("g")),s=ce(J("svg"),{class:"cg-custom-svgs",viewBox:"-3.5 -3.5 8 8",preserveAspectRatio:"xMidYMid slice"}),s.appendChild(J("g")),a=te("cg-auto-pieces"),n.appendChild(o),n.appendChild(s),n.appendChild(a)),t.coordinates){const v=t.orientation==="black"?" black":"",m=t.ranksPosition==="left"?" left":"";n.appendChild(rt(We,"ranks"+v+m)),n.appendChild(rt($e,"files"+v))}let d;return t.draggable.enabled&&t.draggable.showGhost&&(d=te("piece","ghost"),Fe(d,!1),n.appendChild(d)),{board:i,container:n,wrap:e,ghost:d,svg:o,customSvg:s,autoPieces:a}}function rt(e,t){const n=te("coords",t);let i;for(const o of e)i=te("coord"),i.textContent=o,n.appendChild(i);return n}function Zn(e,t){if(!e.dropmode.active)return;le(e),ae(e);const n=e.dropmode.piece;if(n){e.pieces.set("a0",n);const i=pe(t),o=i&&me(i,G(e),e.dom.bounds());o&&Pt(e,"a0",o)}e.dom.redraw()}function Yn(e,t){const n=e.dom.elements.board;if("ResizeObserver"in window&&new ResizeObserver(t).observe(e.dom.elements.wrap),e.viewOnly)return;const i=Jn(e);n.addEventListener("touchstart",i,{passive:!1}),n.addEventListener("mousedown",i,{passive:!1}),(e.disableContextMenu||e.drawable.enabled)&&n.addEventListener("contextmenu",o=>o.preventDefault())}function Xn(e,t){const n=[];if("ResizeObserver"in window||n.push(we(document.body,"chessground.resize",t)),!e.viewOnly){const i=st(e,On,Pn),o=st(e,Kn,Cn);for(const a of["touchmove","mousemove"])n.push(we(document,a,i));for(const a of["touchend","mouseup"])n.push(we(document,a,o));const s=()=>e.dom.bounds.clear();n.push(we(document,"scroll",s,{capture:!0,passive:!0})),n.push(we(window,"resize",s,{passive:!0}))}return()=>n.forEach(i=>i())}function we(e,t,n,i){return e.addEventListener(t,n,i),()=>e.removeEventListener(t,n,i)}const Jn=e=>t=>{e.draggable.current?Ne(e):e.drawable.current?Kt(e):t.shiftKey||pt(t)?e.drawable.enabled&&yn(e,t):e.viewOnly||(e.dropmode.active?Zn(e,t):Nn(e,t))},st=(e,t,n)=>i=>{e.drawable.current?e.drawable.enabled&&n(e,i):e.viewOnly||t(e,i)};function ei(e){const t=G(e),n=Pe(e.dom.bounds()),i=e.dom.elements.board,o=e.pieces,s=e.animation.current,a=s?s.plan.anims:new Map,d=s?s.plan.fadings:new Map,v=e.draggable.current,m=ni(e),C=new Set,_=new Set,K=new Map,z=new Map;let S,P,w,R,D,W,x,U,L,H;for(P=i.firstChild;P;){if(S=P.cgKey,Wt(P))if(w=o.get(S),D=a.get(S),W=d.get(S),R=P.cgPiece,P.cgDragging&&(!v||v.orig!==S)&&(P.classList.remove("dragging"),ee(P,n(q(S),t)),P.cgDragging=!1),!W&&P.cgFading&&(P.cgFading=!1,P.classList.remove("fading")),w){if(D&&P.cgAnimating&&R===ke(w)){const A=q(S);A[0]+=D[2],A[1]+=D[3],P.classList.add("anim"),ee(P,n(A,t))}else P.cgAnimating&&(P.cgAnimating=!1,P.classList.remove("anim"),ee(P,n(q(S),t)),e.addPieceZIndex&&(P.style.zIndex=Ke(q(S),t)));R===ke(w)&&(!W||!P.cgFading)?C.add(S):W&&R===ke(W)?(P.classList.add("fading"),P.cgFading=!0):Re(K,R,P)}else Re(K,R,P);else if(Ht(P)){const A=P.className;m.get(S)===A?_.add(S):Re(z,A,P)}P=P.nextSibling}for(const[A,ue]of m)if(!_.has(A)){L=z.get(ue),H=L&&L.pop();const $=n(q(A),t);if(H)H.cgKey=A,ee(H,$);else{const V=te("square",ue);V.cgKey=A,ee(V,$),i.insertBefore(V,i.firstChild)}}for(const[A,ue]of o)if(D=a.get(A),!C.has(A))if(x=K.get(ke(ue)),U=x&&x.pop(),U){U.cgKey=A,U.cgFading&&(U.classList.remove("fading"),U.cgFading=!1);const $=q(A);e.addPieceZIndex&&(U.style.zIndex=Ke($,t)),D&&(U.cgAnimating=!0,U.classList.add("anim"),$[0]+=D[2],$[1]+=D[3]),ee(U,n($,t))}else{const $=ke(ue),V=te("piece",$),fe=q(A);V.cgPiece=$,V.cgKey=A,D&&(V.cgAnimating=!0,fe[0]+=D[2],fe[1]+=D[3]),ee(V,n(fe,t)),e.addPieceZIndex&&(V.style.zIndex=Ke(fe,t)),i.appendChild(V)}for(const A of K.values())lt(e,A);for(const A of z.values())lt(e,A)}function ti(e){const t=G(e),n=Pe(e.dom.bounds());let i=e.dom.elements.board.firstChild;for(;i;)(Wt(i)&&!i.cgAnimating||Ht(i))&&ee(i,n(q(i.cgKey),t)),i=i.nextSibling}function ct(e){var t,n;const i=e.dom.elements.wrap.getBoundingClientRect(),o=e.dom.elements.container,s=i.height/i.width,a=Math.floor(i.width*window.devicePixelRatio/8)*8/window.devicePixelRatio,d=a*s;o.style.width=a+"px",o.style.height=d+"px",e.dom.bounds.clear(),(t=e.addDimensionsCssVarsTo)===null||t===void 0||t.style.setProperty("--cg-width",a+"px"),(n=e.addDimensionsCssVarsTo)===null||n===void 0||n.style.setProperty("--cg-height",d+"px")}const Wt=e=>e.tagName==="PIECE",Ht=e=>e.tagName==="SQUARE";function lt(e,t){for(const n of t)e.dom.elements.board.removeChild(n)}function Ke(e,t){const i=e[1];return`${t?3+7-i:3+i}`}const ke=e=>`${e.color} ${e.role}`;function ni(e){var t;const n=new Map;if(e.lastMove&&e.highlight.lastMove)for(const s of e.lastMove)ie(n,s,"last-move");if(e.check&&e.highlight.check&&ie(n,e.check,"check"),e.selected&&(ie(n,e.selected,"selected"),e.movable.showDests)){const s=(t=e.movable.dests)===null||t===void 0?void 0:t.get(e.selected);if(s)for(const d of s)ie(n,d,"move-dest"+(e.pieces.has(d)?" oc":""));const a=e.premovable.dests;if(a)for(const d of a)ie(n,d,"premove-dest"+(e.pieces.has(d)?" oc":""))}const i=e.premovable.current;if(i)for(const s of i)ie(n,s,"current-premove");else e.predroppable.current&&ie(n,e.predroppable.current.key,"current-premove");const o=e.exploding;if(o)for(const s of o.keys)ie(n,s,"exploding"+o.stage);return n}function ie(e,t,n){const i=e.get(t);i?e.set(t,`${i} ${n}`):e.set(t,n)}function Re(e,t,n){const i=e.get(t);i?i.push(n):e.set(t,[n])}function ii(e,t){const i=e.drawable.autoShapes.filter(o=>o.piece).map(o=>({shape:o,hash:si(o),current:!1}));Le(i,t,o=>ri(e,o,e.dom.bounds()))}function oi(e){var t;const n=G(e),i=Pe(e.dom.bounds());let o=(t=e.dom.elements.autoPieces)===null||t===void 0?void 0:t.firstChild;for(;o;)ht(o,i(q(o.cgKey),n),o.cgScale),o=o.nextSibling}function ri(e,{shape:t,hash:n},i){var o,s,a;const d=t.orig,v=(o=t.piece)===null||o===void 0?void 0:o.role,m=(s=t.piece)===null||s===void 0?void 0:s.color,C=(a=t.piece)===null||a===void 0?void 0:a.scale,_=te("piece",`${v} ${m}`);return _.setAttribute("cgHash",n),_.cgKey=d,_.cgScale=C,ht(_,Pe(i)(q(d),G(e)),C),_}const si=e=>{var t,n,i;return[e.orig,(t=e.piece)===null||t===void 0?void 0:t.role,(n=e.piece)===null||n===void 0?void 0:n.color,(i=e.piece)===null||i===void 0?void 0:i.scale].join(",")};function ci(e,t){const n=Dn();Tt(n,t||{});function i(){const o="dom"in n?n.dom.unbind:void 0,s=Vn(e,n),a=Zt(()=>s.board.getBoundingClientRect()),d=C=>{ei(m),s.autoPieces&&ii(m,s.autoPieces),!C&&s.svg&&Ln(m,s.svg,s.customSvg)},v=()=>{ct(m),ti(m),s.autoPieces&&oi(m)},m=n;return m.dom={elements:s,bounds:a,redraw:li(d),redrawNow:d,unbind:o},m.drawable.prevSvgHash="",ct(m),d(!1),Yn(m,v),o||(m.dom.unbind=Xn(m,v)),m.events.insert&&m.events.insert(s),m}return qn(i(),i)}function li(e){let t=!1;return()=>{t||(t=!0,requestAnimationFrame(()=>{e(),t=!1}))}}var Se={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Chess=e.validateFen=e.SQUARES=e.DEFAULT_POSITION=e.KING=e.QUEEN=e.ROOK=e.BISHOP=e.KNIGHT=e.PAWN=e.BLACK=e.WHITE=void 0,e.WHITE="w",e.BLACK="b",e.PAWN="p",e.KNIGHT="n",e.BISHOP="b",e.ROOK="r",e.QUEEN="q",e.KING="k",e.DEFAULT_POSITION="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1";const t=-1,n={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"};e.SQUARES=["a8","b8","c8","d8","e8","f8","g8","h8","a7","b7","c7","d7","e7","f7","g7","h7","a6","b6","c6","d6","e6","f6","g6","h6","a5","b5","c5","d5","e5","f5","g5","h5","a4","b4","c4","d4","e4","f4","g4","h4","a3","b3","c3","d3","e3","f3","g3","h3","a2","b2","c2","d2","e2","f2","g2","h2","a1","b1","c1","d1","e1","f1","g1","h1"];const i={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},o={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},s={b:[16,32,17,15],w:[-16,-32,-17,-15]},a={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},d=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],v=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],m={p:1,n:2,b:4,r:8,q:16,k:32},C="pnbrqkPNBRQK",_=[e.KNIGHT,e.BISHOP,e.ROOK,e.QUEEN],K=7,z=6,S=1,P=0,w={w:[{square:o.a1,flag:i.QSIDE_CASTLE},{square:o.h1,flag:i.KSIDE_CASTLE}],b:[{square:o.a8,flag:i.QSIDE_CASTLE},{square:o.h8,flag:i.KSIDE_CASTLE}]},R={b:S,w:z},D=["1-0","0-1","1/2-1/2","*"];function W(N){return N>>4}function x(N){return N&15}function U(N){return"0123456789".indexOf(N)!==-1}function L(N){const r=x(N),c=W(N);return"abcdefgh".substring(r,r+1)+"87654321".substring(c,c+1)}function H(N){return N===e.WHITE?e.BLACK:e.WHITE}function A(N){const r=[];r[0]="No errors.",r[1]="FEN string must contain six space-delimited fields.",r[2]="6th field (move number) must be a positive integer.",r[3]="5th field (half move counter) must be a non-negative integer.",r[4]="4th field (en-passant square) is invalid.",r[5]="3rd field (castling availability) is invalid.",r[6]="2nd field (side to move) is invalid.",r[7]="1st field (piece positions) does not contain 8 '/'-delimited rows.",r[8]="1st field (piece positions) is invalid [consecutive numbers].",r[9]="1st field (piece positions) is invalid [invalid piece].",r[10]="1st field (piece positions) is invalid [row too large].",r[11]="Illegal en-passant square";const c=N.split(/\s+/);if(c.length!==6)return{valid:!1,errorNumber:1,error:r[1]};const l=parseInt(c[5],10);if(isNaN(l)||l<=0)return{valid:!1,errorNumber:2,error:r[2]};const f=parseInt(c[4],10);if(isNaN(f)||f<0)return{valid:!1,errorNumber:3,error:r[3]};if(!/^(-|[abcdefgh][36])$/.test(c[3]))return{valid:!1,errorNumber:4,error:r[4]};if(!/^(KQ?k?q?|Qk?q?|kq?|q|-)$/.test(c[2]))return{valid:!1,errorNumber:5,error:r[5]};if(!/^(w|b)$/.test(c[1]))return{valid:!1,errorNumber:6,error:r[6]};const u=c[0].split("/");if(u.length!==8)return{valid:!1,errorNumber:7,error:r[7]};for(let g=0;g<u.length;g++){let h=0,p=!1;for(let y=0;y<u[g].length;y++)if(U(u[g][y])){if(p)return{valid:!1,errorNumber:8,error:r[8]};h+=parseInt(u[g][y],10),p=!0}else{if(!/^[prnbqkPRNBQK]$/.test(u[g][y]))return{valid:!1,errorNumber:9,error:r[9]};h+=1,p=!1}if(h!==8)return{valid:!1,errorNumber:10,error:r[10]}}return c[3][1]=="3"&&c[1]=="w"||c[3][1]=="6"&&c[1]=="b"?{valid:!1,errorNumber:11,error:r[11]}:{valid:!0,errorNumber:0,error:r[0]}}e.validateFen=A;function ue(N,r){const c=N.from,l=N.to,f=N.piece;let u=0,g=0,h=0;for(let p=0,y=r.length;p<y;p++){const I=r[p].from,O=r[p].to,b=r[p].piece;f===b&&c!==I&&l===O&&(u++,W(c)===W(I)&&g++,x(c)===x(I)&&h++)}return u>0?g>0&&h>0?L(c):h>0?L(c).charAt(1):L(c).charAt(0):""}function $(N,r,c,l,f,u=void 0,g=i.NORMAL){const h=W(l);if(f===e.PAWN&&(h===K||h===P))for(let p=0;p<_.length;p++){const y=_[p];N.push({color:r,from:c,to:l,piece:f,captured:u,promotion:y,flags:g|i.PROMOTION})}else N.push({color:r,from:c,to:l,piece:f,captured:u,promotion:void 0,flags:g})}function V(N){let r=N.charAt(0);return r>="a"&&r<="h"?N.match(/[a-h]\d.*[a-h]\d/)?void 0:e.PAWN:(r=r.toLowerCase(),r==="o"?e.KING:r)}function fe(N){return N.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}class Ft{constructor(r=e.DEFAULT_POSITION){this._board=new Array(128),this._turn=e.WHITE,this._header={},this._kings={w:t,b:t},this._epSquare=-1,this._halfMoves=0,this._moveNumber=0,this._history=[],this._comments={},this._castling={w:0,b:0},this.load(r)}clear(r=!1){this._board=new Array(128),this._kings={w:t,b:t},this._turn=e.WHITE,this._castling={w:0,b:0},this._epSquare=t,this._halfMoves=0,this._moveNumber=1,this._history=[],this._comments={},this._header=r?this._header:{},this._updateSetup(this.fen())}load(r,c=!1){const l=r.split(/\s+/),f=l[0];let u=0;if(!A(r).valid)return!1;this.clear(c);for(let g=0;g<f.length;g++){const h=f.charAt(g);if(h==="/")u+=8;else if(U(h))u+=parseInt(h,10);else{const p=h<"a"?e.WHITE:e.BLACK;this.put({type:h.toLowerCase(),color:p},L(u)),u++}}return this._turn=l[1],l[2].indexOf("K")>-1&&(this._castling.w|=i.KSIDE_CASTLE),l[2].indexOf("Q")>-1&&(this._castling.w|=i.QSIDE_CASTLE),l[2].indexOf("k")>-1&&(this._castling.b|=i.KSIDE_CASTLE),l[2].indexOf("q")>-1&&(this._castling.b|=i.QSIDE_CASTLE),this._epSquare=l[3]==="-"?t:o[l[3]],this._halfMoves=parseInt(l[4],10),this._moveNumber=parseInt(l[5],10),this._updateSetup(this.fen()),!0}fen(){let r=0,c="";for(let u=o.a8;u<=o.h1;u++){if(this._board[u]){r>0&&(c+=r,r=0);const{color:g,type:h}=this._board[u];c+=g===e.WHITE?h.toUpperCase():h.toLowerCase()}else r++;u+1&136&&(r>0&&(c+=r),u!==o.h1&&(c+="/"),r=0,u+=8)}let l="";this._castling[e.WHITE]&i.KSIDE_CASTLE&&(l+="K"),this._castling[e.WHITE]&i.QSIDE_CASTLE&&(l+="Q"),this._castling[e.BLACK]&i.KSIDE_CASTLE&&(l+="k"),this._castling[e.BLACK]&i.QSIDE_CASTLE&&(l+="q"),l=l||"-";const f=this._epSquare===t?"-":L(this._epSquare);return[c,this._turn,l,f,this._halfMoves,this._moveNumber].join(" ")}_updateSetup(r){this._history.length>0||(r!==e.DEFAULT_POSITION?(this._header.SetUp="1",this._header.FEN=r):(delete this._header.SetUp,delete this._header.FEN))}reset(){this.load(e.DEFAULT_POSITION)}get(r){return this._board[o[r]]||!1}put({type:r,color:c},l){if(C.indexOf(r.toLowerCase())===-1||!(l in o))return!1;const f=o[l];return r==e.KING&&!(this._kings[c]==t||this._kings[c]==f)?!1:(this._board[f]={type:r,color:c},r===e.KING&&(this._kings[c]=f),this._updateSetup(this.fen()),!0)}remove(r){const c=this.get(r);return delete this._board[o[r]],c&&c.type===e.KING&&(this._kings[c.color]=t),this._updateSetup(this.fen()),c}_attacked(r,c){for(let l=o.a8;l<=o.h1;l++){if(l&136){l+=7;continue}if(this._board[l]===void 0||this._board[l].color!==r)continue;const f=this._board[l],u=l-c,g=u+119;if(d[g]&m[f.type]){if(f.type===e.PAWN){if(u>0){if(f.color===e.WHITE)return!0}else if(f.color===e.BLACK)return!0;continue}if(f.type==="n"||f.type==="k")return!0;const h=v[g];let p=l+h,y=!1;for(;p!==c;){if(this._board[p]!=null){y=!0;break}p+=h}if(!y)return!0}}return!1}_isKingAttacked(r){return this._attacked(H(r),this._kings[r])}isCheck(){return this._isKingAttacked(this._turn)}inCheck(){return this.isCheck()}isCheckmate(){return this.isCheck()&&this._moves().length===0}isStalemate(){return!this.isCheck()&&this._moves().length===0}isInsufficientMaterial(){const r={b:0,n:0,r:0,q:0,k:0,p:0},c=[];let l=0,f=0;for(let u=o.a8;u<=o.h1;u++){if(f=(f+1)%2,u&136){u+=7;continue}const g=this._board[u];g&&(r[g.type]=g.type in r?r[g.type]+1:1,g.type===e.BISHOP&&c.push(f),l++)}if(l===2)return!0;if(l===3&&(r[e.BISHOP]===1||r[e.KNIGHT]===1))return!0;if(l===r[e.BISHOP]+2){let u=0;const g=c.length;for(let h=0;h<g;h++)u+=c[h];if(u===0||u===g)return!0}return!1}isThreefoldRepetition(){const r=[],c={};let l=!1;for(;;){const f=this._undoMove();if(!f)break;r.push(f)}for(;;){const f=this.fen().split(" ").slice(0,4).join(" ");c[f]=f in c?c[f]+1:1,c[f]>=3&&(l=!0);const u=r.pop();if(u)this._makeMove(u);else break}return l}isDraw(){return this._halfMoves>=100||this.isStalemate()||this.isInsufficientMaterial()||this.isThreefoldRepetition()}isGameOver(){return this.isCheckmate()||this.isStalemate()||this.isDraw()}moves({verbose:r=!1,square:c=void 0}={}){const l=this._moves({square:c});return r?l.map(f=>this._makePretty(f)):l.map(f=>this._moveToSan(f,l))}_moves({legal:r=!0,piece:c=void 0,square:l=void 0}={}){var f;const u=l?l.toLowerCase():void 0,g=c==null?void 0:c.toLowerCase(),h=[],p=this._turn,y=H(p);let I=o.a8,O=o.h1,b=!1;if(u)if(u in o)I=O=o[u],b=!0;else return[];for(let k=I;k<=O;k++){if(k&136){k+=7;continue}if(!this._board[k]||this._board[k].color===y)continue;const{type:M}=this._board[k];let T;if(M===e.PAWN){if(g&&g!==M)continue;T=k+s[p][0],this._board[T]||($(h,p,k,T,e.PAWN),T=k+s[p][1],R[p]===W(k)&&!this._board[T]&&$(h,p,k,T,e.PAWN,void 0,i.BIG_PAWN));for(let j=2;j<4;j++)T=k+s[p][j],!(T&136)&&(((f=this._board[T])===null||f===void 0?void 0:f.color)===y?$(h,p,k,T,e.PAWN,this._board[T].type,i.CAPTURE):T===this._epSquare&&$(h,p,k,T,e.PAWN,e.PAWN,i.EP_CAPTURE))}else{if(g&&g!==M)continue;for(let j=0,ge=a[M].length;j<ge;j++){const E=a[M][j];for(T=k;T+=E,!(T&136);){if(!this._board[T])$(h,p,k,T,M);else{if(this._board[T].color===p)break;$(h,p,k,T,M,this._board[T].type,i.CAPTURE);break}if(M===e.KNIGHT||M===e.KING)break}}}}if((g===void 0||g===e.KING)&&(!b||O===this._kings[p])){if(this._castling[p]&i.KSIDE_CASTLE){const k=this._kings[p],M=k+2;!this._board[k+1]&&!this._board[M]&&!this._attacked(y,this._kings[p])&&!this._attacked(y,k+1)&&!this._attacked(y,M)&&$(h,p,this._kings[p],M,e.KING,void 0,i.KSIDE_CASTLE)}if(this._castling[p]&i.QSIDE_CASTLE){const k=this._kings[p],M=k-2;!this._board[k-1]&&!this._board[k-2]&&!this._board[k-3]&&!this._attacked(y,this._kings[p])&&!this._attacked(y,k-1)&&!this._attacked(y,M)&&$(h,p,this._kings[p],M,e.KING,void 0,i.QSIDE_CASTLE)}}if(!r)return h;const B=[];for(let k=0,M=h.length;k<M;k++)this._makeMove(h[k]),this._isKingAttacked(p)||B.push(h[k]),this._undoMove();return B}move(r,{sloppy:c=!1}={}){let l=null;if(typeof r=="string")l=this._moveFromSan(r,c);else if(typeof r=="object"){const u=this._moves();for(let g=0,h=u.length;g<h;g++)if(r.from===L(u[g].from)&&r.to===L(u[g].to)&&(!("promotion"in u[g])||r.promotion===u[g].promotion)){l=u[g];break}}if(!l)return null;const f=this._makePretty(l);return this._makeMove(l),f}_push(r){this._history.push({move:r,kings:{b:this._kings.b,w:this._kings.w},turn:this._turn,castling:{b:this._castling.b,w:this._castling.w},epSquare:this._epSquare,halfMoves:this._halfMoves,moveNumber:this._moveNumber})}_makeMove(r){const c=this._turn,l=H(c);if(this._push(r),this._board[r.to]=this._board[r.from],delete this._board[r.from],r.flags&i.EP_CAPTURE&&(this._turn===e.BLACK?delete this._board[r.to-16]:delete this._board[r.to+16]),r.promotion&&(this._board[r.to]={type:r.promotion,color:c}),this._board[r.to].type===e.KING){if(this._kings[c]=r.to,r.flags&i.KSIDE_CASTLE){const f=r.to-1,u=r.to+1;this._board[f]=this._board[u],delete this._board[u]}else if(r.flags&i.QSIDE_CASTLE){const f=r.to+1,u=r.to-2;this._board[f]=this._board[u],delete this._board[u]}this._castling[c]=0}if(this._castling[c]){for(let f=0,u=w[c].length;f<u;f++)if(r.from===w[c][f].square&&this._castling[c]&w[c][f].flag){this._castling[c]^=w[c][f].flag;break}}if(this._castling[l]){for(let f=0,u=w[l].length;f<u;f++)if(r.to===w[l][f].square&&this._castling[l]&w[l][f].flag){this._castling[l]^=w[l][f].flag;break}}r.flags&i.BIG_PAWN?c===e.BLACK?this._epSquare=r.to-16:this._epSquare=r.to+16:this._epSquare=t,r.piece===e.PAWN?this._halfMoves=0:r.flags&(i.CAPTURE|i.EP_CAPTURE)?this._halfMoves=0:this._halfMoves++,c===e.BLACK&&this._moveNumber++,this._turn=l}undo(){const r=this._undoMove();return r?this._makePretty(r):null}_undoMove(){const r=this._history.pop();if(r===void 0)return null;const c=r.move;this._kings=r.kings,this._turn=r.turn,this._castling=r.castling,this._epSquare=r.epSquare,this._halfMoves=r.halfMoves,this._moveNumber=r.moveNumber;const l=this._turn,f=H(l);if(this._board[c.from]=this._board[c.to],this._board[c.from].type=c.piece,delete this._board[c.to],c.captured)if(c.flags&i.EP_CAPTURE){let u;l===e.BLACK?u=c.to-16:u=c.to+16,this._board[u]={type:e.PAWN,color:f}}else this._board[c.to]={type:c.captured,color:f};if(c.flags&(i.KSIDE_CASTLE|i.QSIDE_CASTLE)){let u,g;c.flags&i.KSIDE_CASTLE?(u=c.to+1,g=c.to-1):(u=c.to-2,g=c.to+1),this._board[u]=this._board[g],delete this._board[g]}return c}pgn({newline:r=`
`,maxWidth:c=0}={}){const l=[];let f=!1;for(const b in this._header)l.push("["+b+' "'+this._header[b]+'"]'+r),f=!0;f&&this._history.length&&l.push(r);const u=b=>{const B=this._comments[this.fen()];if(typeof B<"u"){const k=b.length>0?" ":"";b=`${b}${k}{${B}}`}return b},g=[];for(;this._history.length>0;)g.push(this._undoMove());const h=[];let p="";for(g.length===0&&h.push(u(""));g.length>0;){p=u(p);const b=g.pop();if(!b)break;if(!this._history.length&&b.color==="b"){const B=`${this._moveNumber}. ...`;p=p?`${p} ${B}`:B}else b.color==="w"&&(p.length&&h.push(p),p=this._moveNumber+".");p=p+" "+this._moveToSan(b,this._moves({legal:!0})),this._makeMove(b)}if(p.length&&h.push(u(p)),typeof this._header.Result<"u"&&h.push(this._header.Result),c===0)return l.join("")+h.join(" ");const y=function(){return l.length>0&&l[l.length-1]===" "?(l.pop(),!0):!1},I=function(b,B){for(const k of B.split(" "))if(k){if(b+k.length>c){for(;y();)b--;l.push(r),b=0}l.push(k),b+=k.length,l.push(" "),b++}return y()&&b--,b};let O=0;for(let b=0;b<h.length;b++){if(O+h[b].length>c&&h[b].includes("{")){O=I(O,h[b]);continue}O+h[b].length>c&&b!==0?(l[l.length-1]===" "&&l.pop(),l.push(r),O=0):b!==0&&(l.push(" "),O++),l.push(h[b]),O+=h[b].length}return l.join("")}header(...r){for(let c=0;c<r.length;c+=2)typeof r[c]=="string"&&typeof r[c+1]=="string"&&(this._header[r[c]]=r[c+1]);return this._header}loadPgn(r,{sloppy:c=!1,newlineChar:l=`\r?
`}={}){function f(E){return E.replace(/\\/g,"\\")}function u(E){const Z={},ne=E.split(new RegExp(f(l)));let Ie="",Ve="";for(let Ce=0;Ce<ne.length;Ce++){const Ze=/^\s*\[([A-Za-z]+)\s*"(.*)"\s*\]\s*$/;Ie=ne[Ce].replace(Ze,"$1"),Ve=ne[Ce].replace(Ze,"$2"),Ie.trim().length>0&&(Z[Ie]=Ve)}return Z}r=r.trim();const h=new RegExp("^(\\[((?:"+f(l)+")|.)*\\])(?:\\s*"+f(l)+"){2}").exec(r),p=h&&h.length>=2?h[1]:"";this.reset();const y=u(p);let I="";for(const E in y)E.toLowerCase()==="fen"&&(I=y[E]),this.header(E,y[E]);if(c){if(I&&!this.load(I,!0))return!1}else if(y.SetUp==="1"&&!("FEN"in y&&this.load(y.FEN,!0)))return!1;function O(E){return Array.from(E).map(function(Z){return Z.charCodeAt(0)<128?Z.charCodeAt(0).toString(16):encodeURIComponent(Z).replace(/%/g,"").toLowerCase()}).join("")}function b(E){return E.length==0?"":decodeURIComponent("%"+(E.match(/.{1,2}/g)||[]).join("%"))}const B=function(E){return E=E.replace(new RegExp(f(l),"g")," "),`{${O(E.slice(1,E.length-1))}}`},k=function(E){if(E.startsWith("{")&&E.endsWith("}"))return b(E.slice(1,E.length-1))};let M=r.replace(p,"").replace(new RegExp(`({[^}]*})+?|;([^${f(l)}]*)`,"g"),function(E,Z,ne){return Z!==void 0?B(Z):" "+B(`{${ne.slice(1)}}`)}).replace(new RegExp(f(l),"g")," ");const T=/(\([^()]+\))+?/g;for(;T.test(M);)M=M.replace(T,"");M=M.replace(/\d+\.(\.\.)?/g,""),M=M.replace(/\.\.\./g,""),M=M.replace(/\$\d+/g,"");let j=M.trim().split(new RegExp(/\s+/));j=j.join(",").replace(/,,+/g,",").split(",");let ge="";for(let E=0;E<j.length;E++){const Z=k(j[E]);if(Z!==void 0){this._comments[this.fen()]=Z;continue}const ne=this._moveFromSan(j[E],c);if(ne==null)if(D.indexOf(j[E])>-1)ge=j[E];else return!1;else ge="",this._makeMove(ne)}return ge&&Object.keys(this._header).length&&!this._header.Result&&this.header("Result",ge),!0}_moveToSan(r,c){let l="";if(r.flags&i.KSIDE_CASTLE)l="O-O";else if(r.flags&i.QSIDE_CASTLE)l="O-O-O";else{if(r.piece!==e.PAWN){const f=ue(r,c);l+=r.piece.toUpperCase()+f}r.flags&(i.CAPTURE|i.EP_CAPTURE)&&(r.piece===e.PAWN&&(l+=L(r.from)[0]),l+="x"),l+=L(r.to),r.promotion&&(l+="="+r.promotion.toUpperCase())}return this._makeMove(r),this.isCheck()&&(this.isCheckmate()?l+="#":l+="+"),this._undoMove(),l}_moveFromSan(r,c=!1){const l=fe(r);let f=V(l),u=this._moves({legal:!0,piece:f});for(let b=0,B=u.length;b<B;b++)if(l===fe(this._moveToSan(u[b],u)))return u[b];if(!c)return null;let g,h,p,y,I,O=!1;h=l.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/),h?(g=h[1],p=h[2],y=h[3],I=h[4],p.length==1&&(O=!0)):(h=l.match(/([pnbrqkPNBRQK])?([a-h]?[1-8]?)x?-?([a-h][1-8])([qrbnQRBN])?/),h&&(g=h[1],p=h[2],y=h[3],I=h[4],p.length==1&&(O=!0))),f=V(l),u=this._moves({legal:!0,piece:g||f});for(let b=0,B=u.length;b<B;b++)if(p&&y){if((!g||g.toLowerCase()==u[b].piece)&&o[p]==u[b].from&&o[y]==u[b].to&&(!I||I.toLowerCase()==u[b].promotion))return u[b];if(O){const k=L(u[b].from);if((!g||g.toLowerCase()==u[b].piece)&&o[y]==u[b].to&&(p==k[0]||p==k[1])&&(!I||I.toLowerCase()==u[b].promotion))return u[b]}}return null}ascii(){let r=`   +------------------------+
`;for(let c=o.a8;c<=o.h1;c++){if(x(c)===0&&(r+=" "+"87654321"[W(c)]+" |"),this._board[c]){const l=this._board[c].type,u=this._board[c].color===e.WHITE?l.toUpperCase():l.toLowerCase();r+=" "+u+" "}else r+=" . ";c+1&136&&(r+=`|
`,c+=8)}return r+=`   +------------------------+
`,r+="     a  b  c  d  e  f  g  h",r}perft(r){const c=this._moves({legal:!1});let l=0;const f=this._turn;for(let u=0,g=c.length;u<g;u++)this._makeMove(c[u]),this._isKingAttacked(f)||(r-1>0?l+=this.perft(r-1):l++),this._undoMove();return l}_makePretty(r){const{color:c,piece:l,from:f,to:u,flags:g,captured:h,promotion:p}=r;let y="";for(const O in i)i[O]&g&&(y+=n[O]);const I={color:c,piece:l,from:L(f),to:L(u),san:this._moveToSan(r,this._moves({legal:!0})),flags:y};return h&&(I.captured=h),p&&(I.promotion=p),I}turn(){return this._turn}board(){const r=[];let c=[];for(let l=o.a8;l<=o.h1;l++)this._board[l]==null?c.push(null):c.push({square:L(l),type:this._board[l].type,color:this._board[l].color}),l+1&136&&(r.push(c),c=[],l+=8);return r}squareColor(r){if(r in o){const c=o[r];return(W(c)+x(c))%2===0?"light":"dark"}return null}history({verbose:r=!1}={}){const c=[],l=[];for(;this._history.length>0;)c.push(this._undoMove());for(;;){const f=c.pop();if(!f)break;r?l.push(this._makePretty(f)):l.push(this._moveToSan(f,this._moves())),this._makeMove(f)}return l}_pruneComments(){const r=[],c={},l=f=>{f in this._comments&&(c[f]=this._comments[f])};for(;this._history.length>0;)r.push(this._undoMove());for(l(this.fen());;){const f=r.pop();if(!f)break;this._makeMove(f),l(this.fen())}this._comments=c}getComment(){return this._comments[this.fen()]}setComment(r){this._comments[this.fen()]=r.replace("{","[").replace("}","]")}deleteComment(){const r=this._comments[this.fen()];return delete this._comments[this.fen()],r}getComments(){return this._pruneComments(),Object.keys(this._comments).map(r=>({fen:r,comment:this._comments[r]}))}deleteComments(){return this._pruneComments(),Object.keys(this._comments).map(r=>{const c=this._comments[r];return delete this._comments[r],{fen:r,comment:c}})}}e.Chess=Ft})(Se);const ai=_e('<div class="is2d"><div> </div></div>'),ui=e=>{let t,n=new Map;ut(xt(()=>e.fen,o=>{n=new Map,new Se.Chess(o).moves({verbose:!0}).forEach(a=>{n.get(a.from)||n.set(a.from,[]),n.get(a.from).push(a.to)}),t==null||t.set({fen:o,movable:{dests:n}})}));let i={movable:{free:!1,dests:n},events:{move(o,s){e.onUserMove(o+s)}}};return(()=>{const o=ai.cloneNode(!0),s=o.firstChild;return ft(a=>t=ci(a,i),s),o})()},Me=e=>e!==void 0,fi=6,di=245;class hi{constructor(){F(this,"engineName");F(this,"work");F(this,"currentEval");F(this,"expectedPvs",1);F(this,"nextWork");F(this,"send");F(this,"options",new Map)}connected(t){this.send=t,this.options=new Map([["Threads","1"],["Hash","16"],["MultiPV","1"],["UCI_Variant","chess"]]),this.send("uci")}setOption(t,n){n=n.toString(),this.send&&this.options.get(t)!==n&&(this.send(`setoption name ${t} value ${n}`),this.options.set(t,n))}disconnected(){this.work&&this.currentEval&&this.work.emit(this.currentEval),this.work=void 0,this.send=void 0}received(t){var i,o;const n=t.trim().split(/\s+/g);if(n[0]==="uciok")this.setOption("UCI_AnalyseMode","true"),this.setOption("Analysis Contempt","Off"),this.setOption("UCI_Chess960","true"),(i=this.send)==null||i.call(this,"ucinewgame"),(o=this.send)==null||o.call(this,"isready");else if(n[0]==="readyok")this.swapWork();else if(n[0]==="id"&&n[1]==="name")this.engineName=n.slice(2).join(" ");else if(n[0]==="bestmove"){this.work&&this.currentEval&&this.work.emit(this.currentEval),this.work=void 0,this.swapWork();return}else if(this.work&&!this.work.stopRequested&&n[0]==="info"){let s=0,a,d=1,v,m,C=!1,_,K=[];for(let w=1;w<n.length;w++)switch(n[w]){case"depth":s=parseInt(n[++w]);break;case"nodes":a=parseInt(n[++w]);break;case"multipv":d=parseInt(n[++w]);break;case"time":v=parseInt(n[++w]);break;case"score":C=n[++w]==="mate",_=parseInt(n[++w]),(n[w+1]==="lowerbound"||n[w+1]==="upperbound")&&(m=n[++w]);break;case"pv":K=n.slice(++w),w=n.length;break}if(C&&!_||(this.expectedPvs<d&&(this.expectedPvs=d),s<fi||!Me(a)||!Me(v)||!Me(C)||!Me(_)))return;const z=this.work.threatMode?0:1,S=this.work.ply%2===z?-_:_;if(m&&d===1)return;const P={moves:K,cp:C?void 0:S,mate:C?S:void 0,depth:s};d===1?this.currentEval={fen:this.work.currentFen,maxDepth:this.work.maxDepth,depth:s,knps:a/v,nodes:a,cp:C?void 0:S,mate:C?S:void 0,pvs:[P],millis:v}:this.currentEval&&(this.currentEval.pvs.push(P),this.currentEval.depth=Math.min(this.currentEval.depth,s)),d===this.expectedPvs&&this.currentEval&&(this.work.emit(this.currentEval),s>=this.work.maxDepth&&v>8e3&&a>4e3*Math.exp(this.work.maxDepth*.3)&&this.stop())}}stop(){var t;this.work&&!this.work.stopRequested&&(this.work.stopRequested=!0,(t=this.send)==null||t.call(this,"stop"))}swapWork(){!this.send||this.work||(this.work=this.nextWork,this.nextWork=void 0,this.work&&(this.currentEval=void 0,this.expectedPvs=1,this.setOption("Threads",this.work.threads),this.setOption("Hash",this.work.hashSize||16),this.setOption("MultiPV",Math.max(1,this.work.multiPv)),this.send(["position fen",this.work.initialFen,"moves",...this.work.moves].join(" ")),this.send(this.work.maxDepth>=99?`go depth ${di}`:"go movetime 90000")))}compute(t){this.nextWork=t,this.stop(),this.swapWork()}isComputing(){return!!this.work&&!this.work.stopRequested}}const pi=e=>e,mi=e=>new Promise((t,n)=>{let i=document.createElement("script");i.onload=()=>{t(void 0)},i.onerror=o=>{n(o)},i.src=e,document.head.append(i)}),se=class{constructor(t){this.opts=t}getState(){return se.sf.Stockfish?se.failed.Stockfish?4:this.getProtocol().engineName?this.getProtocol().isComputing()?3:2:1:0}getProtocol(){return se.protocols.Stockfish}async boot(){let t="http://"+window.location.host+"/vendor/stockfish.wasm/";const n=t+"stockfish.wasm";let i;i=await new Promise((a,d)=>{fetch(n).then(v=>v.arrayBuffer()).then(v=>a(v))}),await mi(t+"stockfish.js");const o=await window.Stockfish({wasmBinary:i,locateFile:a=>pi(t+a),wasmMemory:this.opts.wasmMemory}),s=this.getProtocol();return o.addMessageListener(s.received.bind(s)),s.connected(a=>o.postMessage(a)),o}start(t){this.getProtocol().compute(t),se.sf.Stockfish||(se.sf.Stockfish=this.boot().then(()=>{},n=>{console.error(n),se.failed.Stockfish=!0}))}stop(){this.getProtocol().compute(void 0)}destroy(){this.stop()}};let ve=se;F(ve,"failed",{Stockfish:!1}),F(ve,"protocols",{Stockfish:new hi}),F(ve,"sf",{});function gi(e){return!!(e.startsWith("O-O")||e.includes("x")||e.toLowerCase()===e)}const Bt=(e,t)=>{for(;;)try{return new WebAssembly.Memory({shared:!0,initial:e,maximum:t})}catch(n){if(n instanceof RangeError){if(e===t)throw n;t=Math.max(e,Math.floor(t/2))}else throw n}},vi=()=>{let e="wasm";bi(1,2);const t=1,n=()=>128;return{technology:e,growableSharedMem:!1,supportsNnue:!1,maxThreads:t,maxWasmPages:i=>Math.max(i,32768),maxHashSize:()=>n()}};function bi(e,t){if(typeof SharedArrayBuffer!="function")return;const n=Bt(e,t);if(n.buffer instanceof SharedArrayBuffer){try{window.postMessage(n.buffer,"*")}catch{return}return n}}class _i{constructor(t){F(this,"worker");F(this,"platform");F(this,"start",(t,n)=>{this.doStart(t,n)});F(this,"doStart",(t,n)=>{const i=n[n.length-1],o=8,s={threads:1,hashSize:this.hashSize(),stopRequested:!1,initialFen:n[0].fen,moves:[],currentFen:i.fen,path:t,ply:i.ply,maxDepth:o,multiPv:2,threatMode:!1,emit:a=>{this.opts.emit(a,s)}};for(let a=1;a<n.length;a++){const d=n[a];gi(d.san)?(s.moves=[],s.initialFen=d.fen):s.moves.push(d.uci)}this.worker||(this.worker=new ve({wasmMemory:Bt(1024,this.platform.maxWasmPages(1088))})),this.worker.start(s)});F(this,"stop",()=>{var t;(t=this.worker)==null||t.stop()});F(this,"hashSize",()=>this.platform.maxHashSize());this.opts=t,this.platform=vi()}}const wi=_e(`<div class="result-wrap"><div class="result"></div>Eval dropped below 1. Game's over.</div>`),ki=_e('<button class="fbt"> Rematch </button>'),Si=_e('<div class="hardcore"><div class="board"></div><div class="table"><div class="ceval"></div><div class="replay"></div><div class="rcontrols"><div class="follow-up"></div></div></div></div>'),yi=_e('<span class="index"></span>'),Pi=_e('<div class="move"></div>'),at=(e,t)=>e.move(t,{sloppy:!0})||e.move("O-O")||e.move("O-O-O"),Ai=()=>{let[e,t]=Ee(!1),n,[i,o]=Ee([],{equals:!1}),[s,a]=Ee(!1),[d,v]=Ee(0),m=new _i({emit(w){if(!s()&&w.depth>=10){a(!0),m.stop();let R=w.pvs[0].moves[0];o(D=>(D.push(R),D)),n&&n.scrollTo(0,n.scrollHeight),w.cp&&v(w.cp/100)}}});new Se.Chess().fen();const _=Ae(()=>{let w=new Se.Chess;return i().forEach(R=>at(w,R)),w.fen()}),K=Ae(()=>{let w=new Se.Chess;return i().map((R,D)=>{let W=at(w,R).san;return{ply:D,fen:w.fen(),uci:R,san:W}})}),z=Ae(()=>Math.floor(K().length/2)),S=w=>{o(R=>(R.push(w),R)),a(!1),m.start("",K())};ut(()=>{let w=d();Math.abs(w)>1&&t(!0)});const P=()=>{Qt(()=>{t(!1),o([]),a(!1),v(0)})};return(()=>{const w=Si.cloneNode(!0),R=w.firstChild,D=R.nextSibling,W=D.firstChild,x=W.nextSibling,U=x.nextSibling,L=U.firstChild;return re(R,be(ui,{get fen(){return _()},onUserMove:S})),re(W,d),ft(H=>n=H,x),re(x,be(Ci,{get steps(){return K()}}),null),re(x,be(Ye,{get when(){return e()},get children(){const H=wi.cloneNode(!0),A=H.firstChild;return re(A,z),H}}),null),re(L,be(Ye,{get when(){return e()},get children(){const H=ki.cloneNode(!0);return H.$$click=()=>P(),H}})),w})()},Ci=e=>{let t=Ae(()=>{let n=e.steps,i=[],o=[];return n.forEach(s=>{i.push(s),s.ply%2===1&&(o.push(i),i=[])}),o});return be(Xe,{get each(){return t()},children:n=>[(()=>{const i=yi.cloneNode(!0);return re(i,()=>n[0].ply/2+1),i})(),be(Xe,{each:n,children:i=>(()=>{const o=Pi.cloneNode(!0);return re(o,()=>i.san),o})()})]})};Gt(["click"]);export{Ai as default};
