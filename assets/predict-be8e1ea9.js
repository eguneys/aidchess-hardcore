var qt=Object.defineProperty;var jt=(t,e,s)=>e in t?qt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var j=(t,e,s)=>(jt(t,typeof e!="symbol"?e+"":e,s),s);import{f as bt,a as S,h as nt,i as M,c as v,m as X,b as m,F as dt,S as Q,t as q,d as tt,e as P,o as Ft,k as Tt,T as zt,j as H}from"./index-ba79d2ba.js";import{C as Gt,G as xt}from"./ctrl-388f7078.js";import{N as Bt,F as Ot,R as _t,a as et,i as R}from"./store-d6d26c65.js";const Ut=q('<div class="chessreplay"><div class="moves"></div></div>'),Wt=q('<div class="lines"></div>'),Yt=q('<div class="line"></div>'),Pt=q('<div class="index"></div>'),pt=q("<div></div>");function $t(t){const[e,s]=S(),i=h=>s(h),[n,r]=S(""),l=h=>{var u;r(h),(u=t.on_click)==null||u.call(t,h)};return nt(()=>r(t.on_path)),(()=>{const h=Ut.cloneNode(!0),u=h.firstChild;return M(u,v(kt,X({path:""},t,{on_click:l,on_hover:i,get hover_path(){return e()},get on_path(){return n()}}))),h})()}function vt(t){let e=t.move.split(" ")[0];return[v(At,t),v(kt,X(t,{path:e}))]}function kt(t){let e=()=>t.moves.filter(i=>{let n=i.split(" ")[0];return n.startsWith(t.path)&&n.length===t.path.length+2});const s=m(()=>e().length>1);return v(Q,{get when(){return s()},get fallback(){return v(dt,{get each(){return e()},children:i=>v(vt,X(t,{get is_branch(){return s()},move:i}))})},get children(){const i=Wt.cloneNode(!0);return M(i,v(dt,{get each(){return e()},children:n=>(()=>{const r=Yt.cloneNode(!0);return M(r,v(vt,X(t,{get is_branch(){return s()},move:n}))),r})()})),i}})}const At=t=>{let e=t.move,s=e.match(/([^ ]*) ([^ ]*) \{([^\}]*)\}/),i,n,r,l;if(s){n=s[1],r=s[2];let[a,o,p]=s[3].match(/^(__[^\_]*__)?(.*)$/);i=p,l=(o==null?void 0:o.substring(2,o.length-2))||""}else[n,r]=e.split(" "),l="";n.length===2||n.slice(0,-2);let h=n.length/2,u=h%2===0,k=Math.ceil(h/2)+(u?"...":"."),y=t.is_branch||!u,w=m(()=>t.on_path),E=m(()=>t.hover_path),_=m(()=>w()===n),C=m(()=>{var a;return((a=w())==null?void 0:a.slice(0,n.length))===n}),F=m(()=>E()===n),T=m(()=>{var a;return((a=E())==null?void 0:a.slice(0,n.length))===n}),b=m(()=>["move",_()?"on_hi":"",C()?"on_hi_sub":"",F()?"hi":"",T()?"hi_sub":""].join(" "));return[(()=>{const a=pt.cloneNode(!0);return a.$$mouseover=o=>t.on_hover(n),a.addEventListener("mouseleave",o=>t.on_hover(void 0)),a.$$click=o=>t.on_click(n),M(a,v(Q,{when:y,get children(){const o=Pt.cloneNode(!0);return M(o,k),o}}),null),M(a,r,null),tt(()=>P(a,b()+l)),a})(),(()=>{const a=pt.cloneNode(!0);return M(a,i),tt(()=>P(a,["comment",l].join(" "))),a})()]};bt(["click","mouseover"]);var Rt=Object.defineProperty,Vt=(t,e,s)=>e in t?Rt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,d=(t,e,s)=>(Vt(t,typeof e!="symbol"?e+"":e,s),s);const mt=t=>t[0](),ft=(t,e)=>typeof e=="function"?t[1](e):t[1](s=>e),g=class{constructor(t,e){d(this,"x"),d(this,"y"),this.x=t,this.y=e}static get unit(){return new g(1,1)}static get zero(){return new g(0,0)}get vs(){return[this.x,this.y]}get mul_inverse(){return new g(1/this.x,1/this.y)}get inverse(){return new g(-this.x,-this.y)}get half(){return new g(this.x/2,this.y/2)}get length_squared(){return this.x*this.x+this.y*this.y}get length(){return Math.sqrt(this.length_squared)}get normalize(){return this.length===0?g.zero:this.scale(1/this.length)}get perpendicular(){return new g(-this.y,this.x)}get clone(){return new g(this.x,this.y)}get angle(){return Math.atan2(this.y,this.x)}get round(){return g.make(Math.round(this.x),Math.round(this.y))}get floor(){return g.make(Math.floor(this.x),Math.floor(this.y))}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}project_to(t){let e=t.length_squared,s=this.dot(t);return g.make(s*t.x/e,s*t.y/e)}distance(t){return this.sub(t).length}addy(t){return g.make(this.x,this.y+t)}add_angle(t){return g.from_angle(this.angle+t)}scale(t){let{clone:e}=this;return e.scale_in(t)}scale_in(t){return this.x*=t,this.y*=t,this}add(t){let{clone:e}=this;return e.add_in(t)}add_in(t){return this.x+=t.x,this.y+=t.y,this}sub(t){let{clone:e}=this;return e.sub_in(t)}sub_in(t){return this.x-=t.x,this.y-=t.y,this}mul(t){let{clone:e}=this;return e.mul_in(t)}mul_in(t){return this.x*=t.x,this.y*=t.y,this}div(t){let{clone:e}=this;return e.div_in(t)}div_in(t){return this.x/=t.x,this.y/=t.y,this}set_in(t,e=this.y){return this.x=t,this.y=e,this}};let f=g;d(f,"from_angle",t=>new g(Math.cos(t),Math.sin(t))),d(f,"make",(t,e)=>new g(t,e));const z=class{constructor(t,e,s,i,n,r){d(this,"array_t"),d(this,"a"),d(this,"b"),d(this,"c"),d(this,"d"),d(this,"tx"),d(this,"ty"),this.a=t,this.b=e,this.c=s,this.d=i,this.tx=n,this.ty=r,this.array_t=new Float32Array([t,e,0,s,i,0,n,r,1])}static get identity(){return new z(1,0,0,1,0,0)}static get unit(){return z.identity}get clone(){let{a:t,b:e,c:s,d:i,tx:n,ty:r}=this;return new z(t,e,s,i,n,r)}get inverse(){let{a:t,b:e,c:s,d:i,tx:n,ty:r}=this,l=t*i-e*s,h=i/l,u=-e/l,k=-s/l,y=t/l,w=(s*r-i*n)/l,E=-(t*r-e*n)/l;return new z(h,u,k,y,w,E)}rotate_in(t){let e=Math.cos(t),s=Math.sin(t),i=this.a*e-this.b*s,n=this.a*s+this.b*e,r=this.c*e-this.d*s,l=this.c*s+this.d*e,h=this.tx*e-this.ty*s,u=this.tx*s+this.ty*e;return this.a=i,this.b=n,this.c=r,this.d=l,this.tx=h,this.ty=u,this}rotate(t){let{clone:e}=this;return e.rotate_in(t),e}scale(t,e){let s=this.a*t,i=this.b,n=this.c,r=this.d*e,l=this.tx,h=this.ty;return new z(s,i,n,r,l,h)}translate_in(t,e){this.a,this.b,this.c,this.d;let s=t+this.tx,i=e+this.ty;return this.tx=s,this.ty=i,this}translate(t,e){let{clone:s}=this;return s.translate_in(t,e),s}scale_in(t,e){return this.a=t,this.d=e,this}mVec2(t){let e=this.a,s=this.b,i=this.c,n=this.d,r=this.tx,l=this.ty,h=e*t.x+i*t.y+r,u=s*t.x+n*t.y+l;return f.make(h,u)}mul_in(t){let{a:e,b:s,c:i,d:n,tx:r,ty:l}=this;this.a=t.a*e+t.b*i,this.b=t.a*s+t.b*n,this.c=t.c*e+t.d*i,this.d=t.c*s+t.d*n,this.tx=t.tx*e+t.ty*i+r,this.ty=t.tx*s+t.ty*n+l}set_in(t){let{a:e,b:s,c:i,d:n,tx:r,ty:l}=t;this.a=e,this.b=s,this.c=i,this.d=n,this.tx=r,this.ty=l}transform_in(t,e,s,i=f.unit.half){this.a=Math.cos(e)*t.x,this.b=Math.sin(e)*t.x,this.c=-Math.sin(e)*t.y,this.d=Math.cos(e)*t.y,this.tx=s.x-(i.x*this.a+i.y*this.c),this.ty=s.y-(i.x*this.b+i.y*this.d)}};let Xt=z;d(Xt,"projection",(t,e)=>{let s=0,i=0,n=1/t*2,r=-1/e*2,l=-1,h=1;return new z(n,s,i,r,l,h)});const I=class{constructor(t,e){d(this,"o"),d(this,"r"),this.o=t,this.r=e}static get unit(){return I.make(0,0,1)}scale(t){return I.make(this.o.x,this.o.y,this.r*t)}copy_in(t){return this.r=t.r,this.o=t.o,this}add_o_in(t){return this.o.add_in(t),this}};let Ht=I;d(Ht,"make",(t,e,s)=>new I(f.make(t,e),s));const wt=class{constructor(t,e){this.a=t,this.b=e}get center(){return this.b.add(this.a).half}get parallel(){return this.b.sub(this.a).normalize}get normal(){return this.parallel.perpendicular}get angle(){return this.b.sub(this.a).angle}get radius(){return this.length/2}get length(){return this.b.sub(this.a).length}segments(t,e){return t.map((s,i)=>this.a.add(this.normal.scale(e[i]).add(this.parallel.scale(this.length*s))))}};let It=wt;d(It,"make",(t,e,s,i)=>new wt(f.make(t,e),f.make(s,i)));const A=class{constructor(t){this.vertices=t}static get unit(){return A.make(0,0,1,1)}get vs(){let{x:t,y:e,w:s,h:i}=this;return[t,e,s,i]}get x1(){return this.vertices[0].x}get y1(){return this.vertices[0].y}get x2(){return this.vertices[2].x}get y2(){return this.vertices[2].y}get x(){return this.x1}get y(){return this.y1}get w(){return this.x2-this.x1}get h(){return this.y2-this.y1}get center(){return f.make(this.x+this.w/2,this.y+this.h/2)}get vertexData(){return new Float32Array(this.vertices.flatMap(t=>t.vs))}get indices(){return new Uint16Array([0,1,2,0,2,3])}larger(t){return A.make(this.x-t,this.y-t,this.w+t,this.h+t)}transform(t){return new A(this.vertices.map(e=>t.mVec2(e)))}};let Jt=A;d(Jt,"make",(t,e,s,i)=>new A([f.make(t,e),f.make(t+s,e),f.make(t+s,e+i),f.make(t,e+i)]));class U{constructor(){d(this,"m_rect"),d(this,"_$ref"),d(this,"_$clear_bounds"),this._$clear_bounds=S(void 0,{equals:!1}),this._$ref=S(),this.m_rect=m(()=>{var e;return mt(this._$clear_bounds),(e=this.$ref)==null?void 0:e.getBoundingClientRect()})}static get make(){return new U}get $ref(){return mt(this._$ref)}set $ref(e){ft(this._$ref,e)}get_normal_at_abs_pos(e){let{size:s,orig:i}=this;if(s&&i)return e.sub(i).div(s)}get size(){let{rect:e}=this;if(e)return f.make(e.width,e.height)}get orig(){let{rect:e}=this;if(e)return f.make(e.x,e.y)}get rect(){return this.m_rect()}$clear_bounds(){ft(this._$clear_bounds,void 0)}}function Kt(t){var e;return t.clientX!==void 0&&t.clientY!==void 0?[t.clientX,t.clientY]:(e=t.targetTouches)!=null&&e[0]?[t.targetTouches[0].clientX,t.targetTouches[0].clientY]:[0,0]}class Mt{}d(Mt,"init",(t,e=document)=>{const s=_=>{let C=Kt(_);return C?f.make(C[0],C[1]):f.zero};let{_onDragStart:i,_onDragMove:n,_onDragEnd:r,_onContextMenu:l,_onWheel:h}=t;const u=_=>{i==null||i(s(_),_.buttons===2||_.button===2)},k=_=>{n==null||n(s(_))},y=_=>{r==null||r(s(_))},w=_=>{l&&(_.preventDefault(),l())},E=_=>{h&&(h(Math.sign(_.deltaY)),_.preventDefault())};return e.addEventListener("wheel",E,{passive:!1}),e.addEventListener("touchstart",u,{capture:!0,passive:!1}),e.addEventListener("mousedown",u,{capture:!0,passive:!1}),e.addEventListener("contextmenu",w),document.addEventListener("mousemove",k),document.addEventListener("mouseup",y),document.addEventListener("touchmove",k),document.addEventListener("touchend",y),()=>{e.removeEventListener("wheel",E),e.removeEventListener("touchstart",u),e.removeEventListener("mousedown",u),e.removeEventListener("contextmenu",w),document.removeEventListener("mousemove",k),document.removeEventListener("mouseup",y),document.removeEventListener("touchmove",k),document.removeEventListener("touchend",y)}});const st=(t,e)=>{nt(Ft(()=>e.$ref,s=>{s&&Tt(Qt(t,s))}))},Qt=(t,e)=>{let{on_wheel:s}=t;return Mt.init({_onWheel(i){s(i)}},e)},J=t=>e=>setTimeout(()=>t.$ref=e),Et="abcdefgh".split(""),it="87654321".split("");it.slice(0).reverse();const Zt="wb".split(""),te="rkqbnp".split("");Zt.flatMap(t=>te.map(e=>`${t}${e}`));const rt=Et.flatMap(t=>it.map(e=>`${t}${e}`)),ee=new Map(rt.map(t=>{let[e,s]=t.split(""),i=Et.indexOf(e),n=it.indexOf(s);return[t,f.make(i,n)]})),St=t=>{let e=ee.get(t);return(e.x+e.y)%2===0},se=t=>!St(t);rt.filter(St);rt.filter(se);const Ct=class{constructor(t){d(this,"released_positions"),this.free=t,this.released_positions=new Map}acquire_pos(t,e,s=!1){let i=this.released_positions.get(t);if(!s&&i&&i.length>0)return i.sort((n,r)=>r.distance(e)-n.distance(e)),i.pop();{let n=this.free.pop();return n.x=e.x,n.y=e.y,n}}reset_fix_all(){for(let t of this.released_positions.values())t.forEach(e=>this.free.push(e));this.released_positions=new Map}release_pos(t,e){let s=this.released_positions.get(t);s||(s=[],this.released_positions.set(t,s)),s.push(e)}};let ne=Ct;d(ne,"make",t=>new Ct(t));let gt=new Gt({emit(t){G.ai.local_eval(t),t.depth>=V&&G.ai.crunch_one()}}),yt=10,V=16;const ie=(t,e)=>{let[s,i]=Ot.apply(t);return s.fen===e?[""]:i.filter(([n,r])=>r.fen===e).map(n=>n[0])},K=class{constructor(){j(this,"path_depths");j(this,"root");j(this,"nb_crunch");j(this,"on_root_changed");j(this,"on_crunch_done")}local_eval(e){ie(this.root.root,e.fen).forEach(i=>{this.path_depths.set(i,e.depth),e.pvs.forEach(n=>{let r=i;n.cp/100,n.depth;let l=n.moves.slice(0,4);for(let h of l){if(this.root.node_at_path(r).children.find(y=>y.uci===h))break;r=this.root.add_move(r,h,void 0)}})}),this.on_root_changed()}crunch_one(){if(this.nb_crunch++,this.nb_crunch===yt&&(gt.stop(),this.on_crunch_done()),this.nb_crunch>yt)return;let e=!1;Bt.breadfirst(this.root.root,(s,i)=>{let n=this.path_depths.get(s);if(!n||n<V){let l=this.root.root.node_list(s).map((h,u)=>({ply:u,uci:h.uci,fen:h.fen,san:""}));return e=!0,gt.start("",l),!0}return!1}),e||(console.log("here"),setTimeout(()=>this.on_crunch_done()))}};let G=K;j(G,"ai",new K),j(G,"make",(e,s,i)=>{let{ai:n}=K;n.root=e,n.nb_crunch=0,n.path_depths=new Map;let r=e.flat_export[1].map(l=>l[0]);return r.forEach(l=>n.path_depths.set(l,V)),e.root.child_paths.filter(l=>l.length%4===2).forEach(l=>n.path_depths.delete(l)),r.length>0&&n.path_depths.set("",V),n.on_root_changed=s,n.on_crunch_done=i,n.crunch_one(),n});const re=q('<div class="guess-app"></div>'),ae=q('<div class="opening-prep-scene"><div class="board"></div><div class="table"><div class="info"></div><div class="replay"></div><div class="controls"><button>Delete move</button><button>Delete Siblings</button></div><div class="action"></div></div></div>'),le=q('<button class="primary">Compare AI</button>'),oe=q('<div class="opening-prep-scene"><div class="board"></div><div class="table"><div class="info">1. Build your opening repertoire as a preset</div><div class="replay"></div><div class="controls"><button>Delete variation</button></div><div class="action"><div>2. Create a challenge</div><h3> Select a color </h3><div class="packs colors"><div class="pack"><span> White </span></div><div class="pack"><span> Black </span></div><div class="pack"><span> Random </span></div></div><button class="primary">Start Game</button></div></div></div>'),ve=()=>[v(zt,{children:" aidchess.com - Guess Lines "}),(()=>{const t=re.cloneNode(!0);return M(t,v(Q,{when:!0,get fallback(){return v(ce,{on_start:e=>{}})},get children(){return v(he,{})}})),t})()],he=()=>{const[t,e]=S(""),[s,i]=S(_t.make(),{equals:!1}),[n,r]=S(et.get_replay(),{equals:!1}),[l,h]=S(!1),u=()=>{h(!0);const a=G.make(s(),()=>{},()=>{let[o,p]=_t.diff_trees(n(),a.root),x=o.filter(c=>c.length%4===2),$=o.filter(c=>c.length%4===0),L=p.filter(c=>c.length%4===0);r(c=>($.forEach(N=>c.delete_path(N)),c)),r(c=>(L.forEach(N=>{let W=a.root.node_at_path(N);c.add_move(R(N),W.uci)}),c)),i(n().clone),i(c=>(x.forEach(N=>c.delete_children(N)),c)),h(!1)})},k=m(()=>n().node_at_path(t())),y=m(()=>{let a=n().root.child_paths,o=s().moves().map(x=>{let[$,L,c]=x.split(" ");return a.includes($)?c="{__base child__}":c="{__base__}",[$,L,c].join(" ")}),p=n().moves().filter(x=>!o.find($=>$.split(" ")[0]===x.split(" ")[0])).map(x=>{let[$,L,c]=x.split(" ");return c="{__ghost__}",[$,L,c].join(" ")});return[...o,...p]});m(()=>n().chess(t()));const w=m(()=>n().fen(t())),E=a=>{let o;r(p=>(o=p.add_move(t(),a),p)),o&&e(o)},_=()=>{let a=t();i(o=>(o.delete_path(t()),o)),r(o=>(o.delete_path(t()),o)),e(R(a))},C=()=>{t(),i(a=>(a.delete_siblings(t()),a)),r(a=>(a.delete_siblings(t()),a))};let F=U.make,T=U.make;return st({on_wheel:a=>{var o;if(a<0)e(p=>R(p));else{const p=(o=k())==null?void 0:o.children[0];p&&e(x=>x+p.id)}}},F),(()=>{const a=ae.cloneNode(!0),o=a.firstChild,p=o.nextSibling,x=p.firstChild,$=x.nextSibling,L=$.nextSibling,c=L.firstChild,N=c.nextSibling,W=L.nextSibling,Y=J(F);typeof Y=="function"&&H(Y,o),M(o,v(xt,{glyphs:[],get fen(){return w()},isBlack:!1,onUserMove:E}));const B=J(T);return typeof B=="function"&&H(B,$),M($,v($t,{get moves(){return y()},get on_path(){return t()},on_click:O=>e(O)})),c.$$click=_,N.$$click=C,M(W,v(Q,{get when(){return l()},get fallback(){return(()=>{const O=le.cloneNode(!0);return O.$$click=u,O})()},children:"Comparing..."})),a})()},ce=t=>{const[e,s]=S(""),[i,n]=S(et.get_replay(),{equals:!1});nt(()=>{et.set_replay(i())});const r=m(()=>i().node_at_path(e())),l=m(()=>i().moves());m(()=>i().chess(e()));const h=m(()=>i().fen(e())),u=b=>{let a;n(o=>(a=o.add_move(e(),b),o)),a&&s(a)},k=()=>{let b;n(a=>(b=a.delete_variation(e()),a)),b!==void 0&&s(b)},[y,w]=S(),E=()=>{t.on_start(y())};let _=U.make,C=U.make;const F=b=>{var a;if(b<0)s(o=>R(o));else{const o=(a=r())==null?void 0:a.children[0];o&&s(p=>p+o.id)}};st({on_wheel:F},_),st({on_wheel:F},C);const T=b=>y()===b?"primary selected":"primary";return(()=>{const b=oe.cloneNode(!0),a=b.firstChild,o=a.nextSibling,p=o.firstChild,x=p.nextSibling,$=x.nextSibling,L=$.firstChild,c=$.nextSibling,N=c.firstChild,W=N.nextSibling,Y=W.nextSibling,B=Y.firstChild,O=B.firstChild,Z=B.nextSibling,Lt=Z.firstChild,at=Z.nextSibling,Nt=at.firstChild,Dt=Y.nextSibling,lt=J(_);typeof lt=="function"&&H(lt,a),M(a,v(xt,{glyphs:[],get fen(){return h()},isBlack:!1,onUserMove:u}));const ot=J(C);return typeof ot=="function"&&H(ot,x),M(x,v($t,{get moves(){return l()},get on_path(){return e()},on_click:D=>s(D)})),L.$$click=k,B.$$click=()=>w("w"),Z.$$click=()=>w("b"),at.$$click=()=>w(),Dt.$$click=E,tt(D=>{const ht=T("w"),ct=T("b"),ut=T(void 0);return ht!==D._v$&&P(O,D._v$=ht),ct!==D._v$2&&P(Lt,D._v$2=ct),ut!==D._v$3&&P(Nt,D._v$3=ut),D},{_v$:void 0,_v$2:void 0,_v$3:void 0}),b})()};bt(["click"]);export{ve as default};
