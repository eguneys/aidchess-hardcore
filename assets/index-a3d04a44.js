var ws=Object.defineProperty;var ks=(e,t,n)=>t in e?ws(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var F=(e,t,n)=>(ks(e,typeof t!="symbol"?t+"":t,n),n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerpolicy&&(s.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?s.credentials="include":i.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();const te={};function Ss(e){te.context=e}const Cs=(e,t)=>e===t,Bt=Symbol("solid-proxy"),$s=Symbol("solid-track"),jt={equals:Cs};let Dr=Hr;const qe=1,Wt=2,Br={owned:null,cleanups:null,context:null,owner:null};var V=null;let Fe=null,Q=null,se=null,Ee=null,xn=0;function dt(e,t){const n=Q,r=V,i=e.length===0,s=i?Br:{owned:null,cleanups:null,context:null,owner:t||r},l=i?e:()=>e(()=>we(()=>Jt(s)));V=s,Q=null;try{return Xe(l,!0)}finally{Q=n,V=r}}function X(e,t){t=t?Object.assign({},jt,t):jt;const n={value:e,observers:null,observerSlots:null,comparator:t.equals||void 0},r=i=>(typeof i=="function"&&(i=i(n.value)),Wr(n,i));return[jr.bind(n),r]}function ae(e,t,n){const r=Tn(e,t,!1,qe);$t(r)}function be(e,t,n){Dr=Ns;const r=Tn(e,t,!1,qe);r.user=!0,Ee?Ee.push(r):$t(r)}function I(e,t,n){n=n?Object.assign({},jt,n):jt;const r=Tn(e,t,!0,0);return r.observers=null,r.observerSlots=null,r.comparator=n.equals||void 0,$t(r),jr.bind(r)}function we(e){const t=Q;Q=null;try{return e()}finally{Q=t}}function Qe(e,t,n){const r=Array.isArray(e);let i,s=n&&n.defer;return l=>{let o;if(r){o=Array(e.length);for(let u=0;u<e.length;u++)o[u]=e[u]()}else o=e();if(s){s=!1;return}const c=we(()=>t(o,i,l));return i=o,c}}function St(e){return V===null||(V.cleanups===null?V.cleanups=[e]:V.cleanups.push(e)),e}function Ps(){return V}function Es(e,t){const n=V,r=Q;V=e,Q=null;try{return Xe(t,!0)}catch(i){On(i)}finally{V=n,Q=r}}function As(e){const t=Q,n=V;return Promise.resolve().then(()=>{Q=t,V=n;let r;return Xe(e,!1),Q=V=null,r?r.done:void 0})}function Mn(e,t){const n=Symbol("context");return{id:n,Provider:Os(n),defaultValue:e}}function Ct(e){let t;return(t=Ur(V,e.id))!==void 0?t:e.defaultValue}function Nn(e){const t=I(e),n=I(()=>yn(t()));return n.toArray=()=>{const r=n();return Array.isArray(r)?r:r!=null?[r]:[]},n}function jr(){const e=Fe;if(this.sources&&(this.state||e))if(this.state===qe||e)$t(this);else{const t=se;se=null,Xe(()=>Ft(this),!1),se=t}if(Q){const t=this.observers?this.observers.length:0;Q.sources?(Q.sources.push(this),Q.sourceSlots.push(t)):(Q.sources=[this],Q.sourceSlots=[t]),this.observers?(this.observers.push(Q),this.observerSlots.push(Q.sources.length-1)):(this.observers=[Q],this.observerSlots=[Q.sources.length-1])}return this.value}function Wr(e,t,n){let r=e.value;return(!e.comparator||!e.comparator(r,t))&&(e.value=t,e.observers&&e.observers.length&&Xe(()=>{for(let i=0;i<e.observers.length;i+=1){const s=e.observers[i],l=Fe&&Fe.running;l&&Fe.disposed.has(s),(l&&!s.tState||!l&&!s.state)&&(s.pure?se.push(s):Ee.push(s),s.observers&&Fr(s)),l||(s.state=qe)}if(se.length>1e6)throw se=[],new Error},!1)),t}function $t(e){if(!e.fn)return;Jt(e);const t=V,n=Q,r=xn;Q=V=e,xs(e,e.value,r),Q=n,V=t}function xs(e,t,n){let r;try{r=e.fn(t)}catch(i){e.pure&&(e.state=qe,e.owned&&e.owned.forEach(Jt),e.owned=null),On(i)}(!e.updatedAt||e.updatedAt<=n)&&(e.updatedAt!=null&&"observers"in e?Wr(e,r):e.value=r,e.updatedAt=n)}function Tn(e,t,n,r=qe,i){const s={fn:e,state:r,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:V,context:null,pure:n};return V===null||V!==Br&&(V.owned?V.owned.push(s):V.owned=[s]),s}function Ht(e){const t=Fe;if(e.state===0||t)return;if(e.state===Wt||t)return Ft(e);if(e.suspense&&we(e.suspense.inFallback))return e.suspense.effects.push(e);const n=[e];for(;(e=e.owner)&&(!e.updatedAt||e.updatedAt<xn);)(e.state||t)&&n.push(e);for(let r=n.length-1;r>=0;r--)if(e=n[r],e.state===qe||t)$t(e);else if(e.state===Wt||t){const i=se;se=null,Xe(()=>Ft(e,n[0]),!1),se=i}}function Xe(e,t){if(se)return e();let n=!1;t||(se=[]),Ee?n=!0:Ee=[],xn++;try{const r=e();return Ms(n),r}catch(r){se||(Ee=null),se=null,On(r)}}function Ms(e){if(se&&(Hr(se),se=null),e)return;const t=Ee;Ee=null,t.length&&Xe(()=>Dr(t),!1)}function Hr(e){for(let t=0;t<e.length;t++)Ht(e[t])}function Ns(e){let t,n=0;for(t=0;t<e.length;t++){const r=e[t];r.user?e[n++]=r:Ht(r)}for(te.context&&Ss(),t=0;t<n;t++)Ht(e[t])}function Ft(e,t){const n=Fe;e.state=0;for(let r=0;r<e.sources.length;r+=1){const i=e.sources[r];i.sources&&(i.state===qe||n?i!==t&&Ht(i):(i.state===Wt||n)&&Ft(i,t))}}function Fr(e){const t=Fe;for(let n=0;n<e.observers.length;n+=1){const r=e.observers[n];(!r.state||t)&&(r.state=Wt,r.pure?se.push(r):Ee.push(r),r.observers&&Fr(r))}}function Jt(e){let t;if(e.sources)for(;e.sources.length;){const n=e.sources.pop(),r=e.sourceSlots.pop(),i=n.observers;if(i&&i.length){const s=i.pop(),l=n.observerSlots.pop();r<i.length&&(s.sourceSlots[l]=r,i[r]=s,n.observerSlots[r]=l)}}if(e.owned){for(t=0;t<e.owned.length;t++)Jt(e.owned[t]);e.owned=null}if(e.cleanups){for(t=0;t<e.cleanups.length;t++)e.cleanups[t]();e.cleanups=null}e.state=0,e.context=null}function Ts(e){return e instanceof Error||typeof e=="string"?e:new Error("Unknown error")}function On(e){throw e=Ts(e),e}function Ur(e,t){return e?e.context&&e.context[t]!==void 0?e.context[t]:Ur(e.owner,t):void 0}function yn(e){if(typeof e=="function"&&!e.length)return yn(e());if(Array.isArray(e)){const t=[];for(let n=0;n<e.length;n++){const r=yn(e[n]);Array.isArray(r)?t.push.apply(t,r):t.push(r)}return t}return e}function Os(e,t){return function(r){let i;return ae(()=>i=we(()=>(V.context={[e]:r.value},Nn(()=>r.children))),void 0),i}}const Ls=Symbol("fallback");function lr(e){for(let t=0;t<e.length;t++)e[t]()}function zr(e,t,n={}){let r=[],i=[],s=[],l=0,o=t.length>1?[]:null;return St(()=>lr(s)),()=>{let c=e()||[],u,h;return c[$s],we(()=>{let b=c.length,k,v,P,E,x,S,$,q,T;if(b===0)l!==0&&(lr(s),s=[],r=[],i=[],l=0,o&&(o=[])),n.fallback&&(r=[Ls],i[0]=dt(B=>(s[0]=B,n.fallback())),l=1);else if(l===0){for(i=new Array(b),h=0;h<b;h++)r[h]=c[h],i[h]=dt(p);l=b}else{for(P=new Array(b),E=new Array(b),o&&(x=new Array(b)),S=0,$=Math.min(l,b);S<$&&r[S]===c[S];S++);for($=l-1,q=b-1;$>=S&&q>=S&&r[$]===c[q];$--,q--)P[q]=i[$],E[q]=s[$],o&&(x[q]=o[$]);for(k=new Map,v=new Array(q+1),h=q;h>=S;h--)T=c[h],u=k.get(T),v[h]=u===void 0?-1:u,k.set(T,h);for(u=S;u<=$;u++)T=r[u],h=k.get(T),h!==void 0&&h!==-1?(P[h]=i[u],E[h]=s[u],o&&(x[h]=o[u]),h=v[h],k.set(T,h)):s[u]();for(h=S;h<b;h++)h in P?(i[h]=P[h],s[h]=E[h],o&&(o[h]=x[h],o[h](h))):i[h]=dt(p);i=i.slice(0,l=b),r=c.slice(0)}return i});function p(b){if(s[h]=b,o){const[k,v]=X(h);return o[h]=v,t(c[h],k)}return t(c[h])}}}function O(e,t){return we(()=>e(t||{}))}function Nt(){return!0}const wn={get(e,t,n){return t===Bt?n:e.get(t)},has(e,t){return t===Bt?!0:e.has(t)},set:Nt,deleteProperty:Nt,getOwnPropertyDescriptor(e,t){return{configurable:!0,enumerable:!0,get(){return e.get(t)},set:Nt,deleteProperty:Nt}},ownKeys(e){return e.keys()}};function pn(e){return(e=typeof e=="function"?e():e)?e:{}}function Ue(...e){let t=!1;for(let r=0;r<e.length;r++){const i=e[r];t=t||!!i&&Bt in i,e[r]=typeof i=="function"?(t=!0,I(i)):i}if(t)return new Proxy({get(r){for(let i=e.length-1;i>=0;i--){const s=pn(e[i])[r];if(s!==void 0)return s}},has(r){for(let i=e.length-1;i>=0;i--)if(r in pn(e[i]))return!0;return!1},keys(){const r=[];for(let i=0;i<e.length;i++)r.push(...Object.keys(pn(e[i])));return[...new Set(r)]}},wn);const n={};for(let r=e.length-1;r>=0;r--)if(e[r]){const i=Object.getOwnPropertyDescriptors(e[r]);for(const s in i)s in n||Object.defineProperty(n,s,{enumerable:!0,get(){for(let l=e.length-1;l>=0;l--){const o=(e[l]||{})[s];if(o!==void 0)return o}}})}return n}function qs(e,...t){const n=new Set(t.flat());if(Bt in e){const i=t.map(s=>new Proxy({get(l){return s.includes(l)?e[l]:void 0},has(l){return s.includes(l)&&l in e},keys(){return s.filter(l=>l in e)}},wn));return i.push(new Proxy({get(s){return n.has(s)?void 0:e[s]},has(s){return n.has(s)?!1:s in e},keys(){return Object.keys(e).filter(s=>!n.has(s))}},wn)),i}const r=Object.getOwnPropertyDescriptors(e);return t.push(Object.keys(r).filter(i=>!n.has(i))),t.map(i=>{const s={};for(let l=0;l<i.length;l++){const o=i[l];o in e&&Object.defineProperty(s,o,r[o]?r[o]:{get(){return e[o]},set(){return!0},enumerable:!0})}return s})}let Is=0;function Rs(){const e=te.context;return e?`${e.id}${e.count++}`:`cl-${Is++}`}function ot(e){const t="fallback"in e&&{fallback:()=>e.fallback};return I(zr(()=>e.each,e.children,t||void 0))}function Ae(e){let t=!1;const n=e.keyed,r=I(()=>e.when,void 0,{equals:(i,s)=>t?i===s:!i==!s});return I(()=>{const i=r();if(i){const s=e.children,l=typeof s=="function"&&s.length>0;return t=n||l,l?we(()=>s(i)):s}return e.fallback},void 0,void 0)}const Ks=["allowfullscreen","async","autofocus","autoplay","checked","controls","default","disabled","formnovalidate","hidden","indeterminate","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","seamless","selected"],Ds=new Set(["className","value","readOnly","formNoValidate","isMap","noModule","playsInline",...Ks]),Bs=new Set(["innerHTML","textContent","innerText","children"]),js=Object.assign(Object.create(null),{className:"class",htmlFor:"for"}),ar=Object.assign(Object.create(null),{class:"className",formnovalidate:"formNoValidate",ismap:"isMap",nomodule:"noModule",playsinline:"playsInline",readonly:"readOnly"}),Ws=new Set(["beforeinput","click","dblclick","contextmenu","focusin","focusout","input","keydown","keyup","mousedown","mousemove","mouseout","mouseover","mouseup","pointerdown","pointermove","pointerout","pointerover","pointerup","touchend","touchmove","touchstart"]),Hs={xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace"};function Fs(e,t,n){let r=n.length,i=t.length,s=r,l=0,o=0,c=t[i-1].nextSibling,u=null;for(;l<i||o<s;){if(t[l]===n[o]){l++,o++;continue}for(;t[i-1]===n[s-1];)i--,s--;if(i===l){const h=s<r?o?n[o-1].nextSibling:n[s-o]:c;for(;o<s;)e.insertBefore(n[o++],h)}else if(s===o)for(;l<i;)(!u||!u.has(t[l]))&&t[l].remove(),l++;else if(t[l]===n[s-1]&&n[o]===t[i-1]){const h=t[--i].nextSibling;e.insertBefore(n[o++],t[l++].nextSibling),e.insertBefore(n[--s],h),t[i]=n[s]}else{if(!u){u=new Map;let p=o;for(;p<s;)u.set(n[p],p++)}const h=u.get(t[l]);if(h!=null)if(o<h&&h<s){let p=l,b=1,k;for(;++p<i&&p<s&&!((k=u.get(t[p]))==null||k!==h+b);)b++;if(b>h-o){const v=t[l];for(;o<h;)e.insertBefore(n[o++],v)}else e.replaceChild(n[o++],t[l++])}else l++;else t[l++].remove()}}}const cr="_$DX_DELEGATE";function Us(e,t,n,r={}){let i;return dt(s=>{i=s,t===document?e():G(t,e(),t.firstChild?null:void 0,n)},r.owner),()=>{i(),t.textContent=""}}function ne(e,t,n){const r=document.createElement("template");r.innerHTML=e;let i=r.content.firstChild;return n&&(i=i.firstChild),i}function Pt(e,t=window.document){const n=t[cr]||(t[cr]=new Set);for(let r=0,i=e.length;r<i;r++){const s=e[r];n.has(s)||(n.add(s),t.addEventListener(s,Zs))}}function Gr(e,t,n){n==null?e.removeAttribute(t):e.setAttribute(t,n)}function zs(e,t,n,r){r==null?e.removeAttributeNS(t,n):e.setAttributeNS(t,n,r)}function pt(e,t){t==null?e.removeAttribute("class"):e.className=t}function Gs(e,t,n,r){if(r)Array.isArray(n)?(e[`$$${t}`]=n[0],e[`$$${t}Data`]=n[1]):e[`$$${t}`]=n;else if(Array.isArray(n)){const i=n[0];e.addEventListener(t,n[0]=s=>i.call(e,n[1],s))}else e.addEventListener(t,n)}function Qs(e,t,n={}){const r=Object.keys(t||{}),i=Object.keys(n);let s,l;for(s=0,l=i.length;s<l;s++){const o=i[s];!o||o==="undefined"||t[o]||(ur(e,o,!1),delete n[o])}for(s=0,l=r.length;s<l;s++){const o=r[s],c=!!t[o];!o||o==="undefined"||n[o]===c||!c||(ur(e,o,!0),n[o]=c)}return n}function Vs(e,t,n){if(!t)return n?Gr(e,"style"):t;const r=e.style;if(typeof t=="string")return r.cssText=t;typeof n=="string"&&(r.cssText=n=void 0),n||(n={}),t||(t={});let i,s;for(s in n)t[s]==null&&r.removeProperty(s),delete n[s];for(s in t)i=t[s],i!==n[s]&&(r.setProperty(s,i),n[s]=i);return n}function kn(e,t={},n,r){const i={};return r||ae(()=>i.children=at(e,t.children,i.children)),ae(()=>t.ref&&t.ref(e)),ae(()=>Ys(e,t,n,!0,i,!0)),i}function lt(e,t,n){return we(()=>e(t,n))}function G(e,t,n,r){if(n!==void 0&&!r&&(r=[]),typeof t!="function")return at(e,t,r,n);ae(i=>at(e,t(),i,n),r)}function Ys(e,t,n,r,i={},s=!1){t||(t={});for(const l in i)if(!(l in t)){if(l==="children")continue;i[l]=hr(e,l,null,i[l],n,s)}for(const l in t){if(l==="children"){r||at(e,t.children);continue}const o=t[l];i[l]=hr(e,l,o,i[l],n,s)}}function Xs(e){return e.toLowerCase().replace(/-([a-z])/g,(t,n)=>n.toUpperCase())}function ur(e,t,n){const r=t.trim().split(/\s+/);for(let i=0,s=r.length;i<s;i++)e.classList.toggle(r[i],n)}function hr(e,t,n,r,i,s){let l,o,c;if(t==="style")return Vs(e,n,r);if(t==="classList")return Qs(e,n,r);if(n===r)return r;if(t==="ref")s||n(e);else if(t.slice(0,3)==="on:"){const u=t.slice(3);r&&e.removeEventListener(u,r),n&&e.addEventListener(u,n)}else if(t.slice(0,10)==="oncapture:"){const u=t.slice(10);r&&e.removeEventListener(u,r,!0),n&&e.addEventListener(u,n,!0)}else if(t.slice(0,2)==="on"){const u=t.slice(2).toLowerCase(),h=Ws.has(u);if(!h&&r){const p=Array.isArray(r)?r[0]:r;e.removeEventListener(u,p)}(h||n)&&(Gs(e,u,n,h),h&&Pt([u]))}else if((c=Bs.has(t))||!i&&(ar[t]||(o=Ds.has(t)))||(l=e.nodeName.includes("-")))t==="class"||t==="className"?pt(e,n):l&&!o&&!c?e[Xs(t)]=n:e[ar[t]||t]=n;else{const u=i&&t.indexOf(":")>-1&&Hs[t.split(":")[0]];u?zs(e,u,t,n):Gr(e,js[t]||t,n)}return n}function Zs(e){const t=`$$${e.type}`;let n=e.composedPath&&e.composedPath()[0]||e.target;for(e.target!==n&&Object.defineProperty(e,"target",{configurable:!0,value:n}),Object.defineProperty(e,"currentTarget",{configurable:!0,get(){return n||document}}),te.registry&&!te.done&&(te.done=!0,document.querySelectorAll("[id^=pl-]").forEach(r=>{for(;r&&r.nodeType!==8&&r.nodeValue!=="pl-"+e;){let i=r.nextSibling;r.remove(),r=i}r&&r.remove()}));n;){const r=n[t];if(r&&!n.disabled){const i=n[`${t}Data`];if(i!==void 0?r.call(n,i,e):r.call(n,e),e.cancelBubble)return}n=n._$host||n.parentNode||n.host}}function at(e,t,n,r,i){for(te.context&&!n&&(n=[...e.childNodes]);typeof n=="function";)n=n();if(t===n)return n;const s=typeof t,l=r!==void 0;if(e=l&&n[0]&&n[0].parentNode||e,s==="string"||s==="number"){if(te.context)return n;if(s==="number"&&(t=t.toString()),l){let o=n[0];o&&o.nodeType===3?o.data=t:o=document.createTextNode(t),n=tt(e,n,r,o)}else n!==""&&typeof n=="string"?n=e.firstChild.data=t:n=e.textContent=t}else if(t==null||s==="boolean"){if(te.context)return n;n=tt(e,n,r)}else{if(s==="function")return ae(()=>{let o=t();for(;typeof o=="function";)o=o();n=at(e,o,n,r)}),()=>n;if(Array.isArray(t)){const o=[],c=n&&Array.isArray(n);if(Sn(o,t,n,i))return ae(()=>n=at(e,o,n,r,!0)),()=>n;if(te.context){if(!o.length)return n;for(let u=0;u<o.length;u++)if(o[u].parentNode)return n=o}if(o.length===0){if(n=tt(e,n,r),l)return n}else c?n.length===0?fr(e,o,r):Fs(e,n,o):(n&&tt(e),fr(e,o));n=o}else if(t instanceof Node){if(te.context&&t.parentNode)return n=l?[t]:t;if(Array.isArray(n)){if(l)return n=tt(e,n,r,t);tt(e,n,null,t)}else n==null||n===""||!e.firstChild?e.appendChild(t):e.replaceChild(t,e.firstChild);n=t}}return n}function Sn(e,t,n,r){let i=!1;for(let s=0,l=t.length;s<l;s++){let o=t[s],c=n&&n[s];if(o instanceof Node)e.push(o);else if(!(o==null||o===!0||o===!1))if(Array.isArray(o))i=Sn(e,o,c)||i;else if(typeof o=="function")if(r){for(;typeof o=="function";)o=o();i=Sn(e,Array.isArray(o)?o:[o],Array.isArray(c)?c:[c])||i}else e.push(o),i=!0;else{const u=String(o);c&&c.nodeType===3&&c.data===u?e.push(c):e.push(document.createTextNode(u))}}return i}function fr(e,t,n=null){for(let r=0,i=t.length;r<i;r++)e.insertBefore(t[r],n)}function tt(e,t,n,r){if(n===void 0)return e.textContent="";const i=r||document.createTextNode("");if(t.length){let s=!1;for(let l=t.length-1;l>=0;l--){const o=t[l];if(i!==o){const c=o.parentNode===e;!s&&!l?c?e.replaceChild(i,o):e.insertBefore(i,n):c&&o.remove()}else s=!0}}else e.insertBefore(i,n);return[i]}const Js=!1;function Qr(e,t,n){return e.addEventListener(t,n),()=>e.removeEventListener(t,n)}function eo([e,t],n,r){return[n?()=>n(e()):e,r?i=>t(r(i)):t]}function to(e){try{return document.querySelector(e)}catch{return null}}function Vr(e,t){const n=to(`#${e}`);n?n.scrollIntoView():t&&window.scrollTo(0,0)}function Yr(e,t,n,r){let i=!1;const s=o=>typeof o=="string"?{value:o}:o,l=eo(X(s(e()),{equals:(o,c)=>o.value===c.value}),void 0,o=>(!i&&t(o),o));return n&&St(n((o=e())=>{i=!0,l[1](s(o)),i=!1})),{signal:l,utils:r}}function no(e){if(e){if(Array.isArray(e))return{signal:e}}else return{signal:X({value:""})};return e}function ro(){return Yr(()=>({value:window.location.pathname+window.location.search+window.location.hash,state:history.state}),({value:e,replace:t,scroll:n,state:r})=>{t?window.history.replaceState(r,"",e):window.history.pushState(r,"",e),Vr(window.location.hash.slice(1),n)},e=>Qr(window,"popstate",()=>e()),{go:e=>window.history.go(e)})}function io(){return Yr(()=>window.location.hash.slice(1),({value:e,replace:t,scroll:n,state:r})=>{t?window.history.replaceState(r,"","#"+e):window.location.hash=e;const i=e.indexOf("#"),s=i>=0?e.slice(i+1):"";Vr(s,n)},e=>Qr(window,"hashchange",()=>e()),{go:e=>window.history.go(e),renderPath:e=>`#${e}`,parsePath:e=>{const t=e.replace(/^.*?#/,"");if(!t.startsWith("/")){const[,n="/"]=window.location.hash.split("#",2);return`${n}#${t}`}return t}})}function so(){let e=new Set;function t(i){return e.add(i),()=>e.delete(i)}let n=!1;function r(i,s){if(n)return!(n=!1);const l={to:i,options:s,defaultPrevented:!1,preventDefault:()=>l.defaultPrevented=!0};for(const o of e)o.listener({...l,from:o.location,retry:c=>{c&&(n=!0),o.navigate(i,s)}});return!l.defaultPrevented}return{subscribe:t,confirm:r}}const oo=/^(?:[a-z0-9]+:)?\/\//i,lo=/^\/+|\/+$/g;function ze(e,t=!1){const n=e.replace(lo,"");return n?t||/^[?#]/.test(n)?n:"/"+n:""}function Lt(e,t,n){if(oo.test(t))return;const r=ze(e),i=n&&ze(n);let s="";return!i||t.startsWith("/")?s=r:i.toLowerCase().indexOf(r.toLowerCase())!==0?s=r+i:s=i,(s||"/")+ze(t,!s)}function ao(e,t){if(e==null)throw new Error(t);return e}function Xr(e,t){return ze(e).replace(/\/*(\*.*)?$/g,"")+ze(t)}function co(e){const t={};return e.searchParams.forEach((n,r)=>{t[r]=n}),t}function uo(e,t){const[n,r]=e.split("/*",2),i=n.split("/").filter(Boolean),s=i.length;return l=>{const o=l.split("/").filter(Boolean),c=o.length-s;if(c<0||c>0&&r===void 0&&!t)return null;const u={path:s?"":"/",params:{}};for(let h=0;h<s;h++){const p=i[h],b=o[h];if(p[0]===":")u.params[p.slice(1)]=b;else if(p.localeCompare(b,void 0,{sensitivity:"base"})!==0)return null;u.path+=`/${b}`}return r&&(u.params[r]=c?o.slice(-c).join("/"):""),u}}function ho(e){const[t,n]=e.pattern.split("/*",2),r=t.split("/").filter(Boolean);return r.reduce((i,s)=>i+(s.startsWith(":")?2:3),r.length-(n===void 0?0:1))}function Zr(e){const t=new Map,n=Ps();return new Proxy({},{get(r,i){return t.has(i)||Es(n,()=>t.set(i,I(()=>e()[i]))),t.get(i)()},getOwnPropertyDescriptor(){return{enumerable:!0,configurable:!0}},ownKeys(){return Reflect.ownKeys(e())}})}function fo(e,t){const n=new URLSearchParams(e);Object.entries(t).forEach(([i,s])=>{s==null||s===""?n.delete(i):n.set(i,String(s))});const r=n.toString();return r?`?${r}`:""}function Jr(e){let t=/(\/?\:[^\/]+)\?/.exec(e);if(!t)return[e];let n=e.slice(0,t.index),r=e.slice(t.index+t[0].length);const i=[n,n+=t[1]];for(;t=/^(\/\:[^\/]+)\?/.exec(r);)i.push(n+=t[1]),r=r.slice(t[0].length);return Jr(r).reduce((s,l)=>[...s,...i.map(o=>o+l)],[])}const po=100,ei=Mn(),en=Mn(),Et=()=>ao(Ct(ei),"Make sure your app is wrapped in a <Router />");let _t;const Ln=()=>_t||Ct(en)||Et().base,mo=e=>{const t=Ln();return I(()=>t.resolvePath(e()))},go=e=>{const t=Et();return I(()=>{const n=e();return n!==void 0?t.renderPath(n):n})},ti=()=>Et().navigatorFactory(),ni=()=>Et().location,vo=()=>{const e=ni(),t=ti(),n=(r,i)=>{const s=we(()=>fo(e.search,r));t(e.pathname+s+e.hash,{scroll:!1,resolve:!1,...i})};return[e.query,n]};function _o(e,t="",n){const{component:r,data:i,children:s}=e,l=!s||Array.isArray(s)&&!s.length,o={key:e,element:r?()=>O(r,{}):()=>{const{element:c}=e;return c===void 0&&n?O(n,{}):c},preload:e.component?r.preload:e.preload,data:i};return ri(e.path).reduce((c,u)=>{for(const h of Jr(u)){const p=Xr(t,h),b=l?p:p.split("/*",1)[0];c.push({...o,originalPath:h,pattern:b,matcher:uo(b,!l)})}return c},[])}function bo(e,t=0){return{routes:e,score:ho(e[e.length-1])*1e4-t,matcher(n){const r=[];for(let i=e.length-1;i>=0;i--){const s=e[i],l=s.matcher(n);if(!l)return null;r.unshift({...l,route:s})}return r}}}function ri(e){return Array.isArray(e)?e:[e]}function ii(e,t="",n,r=[],i=[]){const s=ri(e);for(let l=0,o=s.length;l<o;l++){const c=s[l];if(c&&typeof c=="object"&&c.hasOwnProperty("path")){const u=_o(c,t,n);for(const h of u){r.push(h);const p=Array.isArray(c.children)&&c.children.length===0;if(c.children&&!p)ii(c.children,h.pattern,n,r,i);else{const b=bo([...r],i.length);i.push(b)}r.pop()}}}return r.length?i:i.sort((l,o)=>o.score-l.score)}function yo(e,t){for(let n=0,r=e.length;n<r;n++){const i=e[n].matcher(t);if(i)return i}return[]}function wo(e,t){const n=new URL("http://sar"),r=I(c=>{const u=e();try{return new URL(u,n)}catch{return console.error(`Invalid path ${u}`),c}},n,{equals:(c,u)=>c.href===u.href}),i=I(()=>r().pathname),s=I(()=>r().search,!0),l=I(()=>r().hash),o=I(()=>"");return{get pathname(){return i()},get search(){return s()},get hash(){return l()},get state(){return t()},get key(){return o()},query:Zr(Qe(s,()=>co(r())))}}function ko(e,t="",n,r){const{signal:[i,s],utils:l={}}=no(e),o=l.parsePath||(A=>A),c=l.renderPath||(A=>A),u=l.beforeLeave||so(),h=Lt("",t),p=void 0;if(h===void 0)throw new Error(`${h} is not a valid base path`);h&&!i().value&&s({value:h,replace:!0,scroll:!1});const[b,k]=X(!1),v=async A=>{k(!0);try{await As(A)}finally{k(!1)}},[P,E]=X(i().value),[x,S]=X(i().state),$=wo(P,x),q=[],T={pattern:h,params:{},path:()=>h,outlet:()=>null,resolvePath(A){return Lt(h,A)}};if(n)try{_t=T,T.data=n({data:void 0,params:{},location:$,navigate:j(T)})}finally{_t=void 0}function B(A,N,W){we(()=>{if(typeof N=="number"){N&&(l.go?u.confirm(N,W)&&l.go(N):console.warn("Router integration does not support relative routing"));return}const{replace:L,resolve:C,scroll:a,state:f}={replace:!1,resolve:!0,scroll:!0,...W},d=C?A.resolvePath(N):Lt("",N);if(d===void 0)throw new Error(`Path '${N}' is not a routable path`);if(q.length>=po)throw new Error("Too many redirects");const g=P();if((d!==g||f!==x())&&!Js){if(u.confirm(d,W)){const m=q.push({value:g,replace:L,scroll:a,state:x()});v(()=>{E(d),S(f)}).then(()=>{q.length===m&&K({value:d,state:f})})}}})}function j(A){return A=A||Ct(en)||T,(N,W)=>B(A,N,W)}function K(A){const N=q[0];N&&((A.value!==N.value||A.state!==N.state)&&s({...A,replace:N.replace,scroll:N.scroll}),q.length=0)}ae(()=>{const{value:A,state:N}=i();we(()=>{A!==P()&&v(()=>{E(A),S(N)})})});{let A=function(N){if(N.defaultPrevented||N.button!==0||N.metaKey||N.altKey||N.ctrlKey||N.shiftKey)return;const W=N.composedPath().find(g=>g instanceof Node&&g.nodeName.toUpperCase()==="A");if(!W||!W.hasAttribute("link"))return;const L=W.href;if(W.target||!L&&!W.hasAttribute("state"))return;const C=(W.getAttribute("rel")||"").split(/\s+/);if(W.hasAttribute("download")||C&&C.includes("external"))return;const a=new URL(L);if(a.origin!==window.location.origin||h&&a.pathname&&!a.pathname.toLowerCase().startsWith(h.toLowerCase()))return;const f=o(a.pathname+a.search+a.hash),d=W.getAttribute("state");N.preventDefault(),B(T,f,{resolve:!1,replace:W.hasAttribute("replace"),scroll:!W.hasAttribute("noscroll"),state:d&&JSON.parse(d)})};var re=A;Pt(["click"]),document.addEventListener("click",A),St(()=>document.removeEventListener("click",A))}return{base:T,out:p,location:$,isRouting:b,renderPath:c,parsePath:o,navigatorFactory:j,beforeLeave:u}}function So(e,t,n,r){const{base:i,location:s,navigatorFactory:l}=e,{pattern:o,element:c,preload:u,data:h}=r().route,p=I(()=>r().path),b=Zr(()=>r().params);u&&u();const k={parent:t,pattern:o,get child(){return n()},path:p,params:b,data:t.data,outlet:c,resolvePath(v){return Lt(i.path(),v,p())}};if(h)try{_t=k,k.data=h({data:t.data,params:b,location:s,navigate:l(k)})}finally{_t=void 0}return k}const Co=ne("<a link></a>"),$o=e=>{const{source:t,url:n,base:r,data:i,out:s}=e,l=t||ro(),o=ko(l,r,i);return O(ei.Provider,{value:o,get children(){return e.children}})},Po=e=>{const t=Et(),n=Ln(),r=Nn(()=>e.children),i=I(()=>ii(r(),Xr(n.pattern,e.base||""),Eo)),s=I(()=>yo(i(),t.location.pathname));t.out&&t.out.matches.push(s().map(({route:u,path:h,params:p})=>({originalPath:u.originalPath,pattern:u.pattern,path:h,params:p})));const l=[];let o;const c=I(Qe(s,(u,h,p)=>{let b=h&&u.length===h.length;const k=[];for(let v=0,P=u.length;v<P;v++){const E=h&&h[v],x=u[v];p&&E&&x.route.key===E.route.key?k[v]=p[v]:(b=!1,l[v]&&l[v](),dt(S=>{l[v]=S,k[v]=So(t,k[v-1]||n,()=>c()[v+1],()=>s()[v])}))}return l.splice(u.length).forEach(v=>v()),p&&b?p:(o=k[0],k)}));return O(Ae,{get when(){return c()&&o},children:u=>O(en.Provider,{value:u,get children(){return u.outlet()}})})},Tt=e=>{const t=Nn(()=>e.children);return Ue(e,{get children(){return t()}})},Eo=()=>{const e=Ln();return O(Ae,{get when(){return e.child},children:t=>O(en.Provider,{value:t,get children(){return t.outlet()}})})};function si(e){e=Ue({inactiveClass:"inactive",activeClass:"active"},e);const[,t]=qs(e,["href","state","class","activeClass","inactiveClass","end"]),n=mo(()=>e.href),r=go(n),i=ni(),s=I(()=>{const l=n();if(l===void 0)return!1;const o=ze(l.split(/[?#]/,1)[0]).toLowerCase(),c=ze(i.pathname).toLowerCase();return e.end?o===c:c.startsWith(o)});return(()=>{const l=Co.cloneNode(!0);return kn(l,Ue(t,{get href(){return r()||e.href},get state(){return JSON.stringify(e.state)},get classList(){return{...e.class&&{[e.class]:!0},[e.inactiveClass]:!s(),[e.activeClass]:s(),...t.classList}},get["aria-current"](){return s()?"page":void 0}}),!1,!1),l})()}const qn=Mn(),Ao=["title","meta"],dr=e=>e.tag+(e.name?`.${e.name}"`:""),xo=e=>{if(!te.context){const i=document.head.querySelectorAll("[data-sm]");Array.prototype.forEach.call(i,s=>s.parentNode.removeChild(s))}const t=new Map;function n(i){if(i.ref)return i.ref;let s=document.querySelector(`[data-sm="${i.id}"]`);return s?(s.tagName.toLowerCase()!==i.tag&&(s.parentNode&&s.parentNode.removeChild(s),s=document.createElement(i.tag)),s.removeAttribute("data-sm")):s=document.createElement(i.tag),s}const r={addClientTag:i=>{let s=dr(i);if(Ao.indexOf(i.tag)!==-1){t.has(s)||t.set(s,[]);let o=t.get(s),c=o.length;o=[...o,i],t.set(s,o);{let u=n(i);i.ref=u,kn(u,i.props);let h=null;for(var l=c-1;l>=0;l--)if(o[l]!=null){h=o[l];break}u.parentNode!=document.head&&document.head.appendChild(u),h&&h.ref&&document.head.removeChild(h.ref)}return c}{let o=n(i);i.ref=o,kn(o,i.props),o.parentNode!=document.head&&document.head.appendChild(o)}return-1},removeClientTag:(i,s)=>{const l=dr(i);if(i.ref){const o=t.get(l);if(o){if(i.ref.parentNode){i.ref.parentNode.removeChild(i.ref);for(let c=s-1;c>=0;c--)o[c]!=null&&document.head.appendChild(o[c].ref)}o[s]=null,t.set(l,o)}else i.ref.parentNode&&i.ref.parentNode.removeChild(i.ref)}}};return O(qn.Provider,{value:r,get children(){return e.children}})},Mo=(e,t)=>{const n=Rs();if(!Ct(qn))throw new Error("<MetaProvider /> should be in the tree");return No({tag:e,props:t,id:n,get name(){return t.name||t.property}}),null};function No(e){const{addClientTag:t,removeClientTag:n,addServerTag:r}=Ct(qn);ae(()=>{{let i=t(e);St(()=>n(e,i))}})}const tn=e=>Mo("title",e);const To=ne('<div class="about"><h2> About </h2><p> aidchess.com is a website about chess.</p><p> It is entirely free, and open to anyone.</p><p> Feature requests are welcome and appreciated via <a href="https://github.com/eguneys/aidchess-hardcore">Github</a>. </p><p> Support the project by donating to my personal <a href="https://www.patreon.com/eguneys">Patreon</a>.</p></div>'),Oo=()=>[O(tn,{children:" aidchess.com - About "}),To.cloneNode(!0)];const Lo=e=>e!==void 0,qo=e=>{const t={get:n=>e.getItem(n),set:(n,r)=>e.setItem(n,r),remove:n=>e.removeItem(n),make:n=>({get:()=>t.get(n),set:r=>t.set(n,r),remove:()=>t.remove(n)}),makeBoolean:n=>({get:()=>t.get(n)=="1",set:r=>t.set(n,r?"1":"0"),toggle:()=>t.set(n,t.get(n)=="1"?"0":"1")})};return t},pr=qo(window.localStorage),oi=(e,t)=>n=>{if(Lo(n))return pr.set(e,JSON.stringify(n)),n;const r=JSON.parse(pr.get(e));return r!==null?r:t()};var Io=(e,t)=>{let n=[];for(let r in e)t(r,e[r])&&n.push(r);return n},In=(e,t)=>{for(let n in e)if(t(n,e[n]))return n},ue=(e,t)=>{let n={};for(let r in e){let i=e[r]&&t(r,e[r]);n[r]=i}return n},Rn=e=>{let t={};return e.forEach(n=>t[n]=n),t},Ro=(e,t)=>{let n={};return e.forEach(r=>{let i=t(r);i&&(n[r]=i)}),n},Ve=["a","b","c","d","e","f","g","h"],nn=["1","2","3","4","5","6","7","8"],Ko=["w","b"],Do=["r","q","b","n","p","k"],Bo=["q","n","r","b"],ct=Ve.flatMap(e=>nn.map(t=>`${e}${t}`)),jo=Ko.flatMap(e=>Do.map(t=>e+t));jo.flatMap(e=>ct.map(t=>[e,t].join("@")));var Wo=nn.slice(0).reverse();nn.flatMap(e=>Ve.map(t=>`${t}${e}`));Wo.flatMap(e=>Ve.map(t=>`${t}${e}`));ct.flatMap(e=>ct.map(t=>`${e}${t}`));var rn=Rn(Ve),sn=Rn(nn),on={a:"b",b:"c",c:"d",d:"e",e:"f",f:"g",g:"h",h:void 0},ln={h:"g",g:"f",f:"e",e:"d",d:"c",c:"b",b:"a",a:void 0},an={1:"2",2:"3",3:"4",4:"5",5:"6",6:"7",7:"8",8:void 0},cn={8:"7",7:"6",6:"5",5:"4",4:"3",3:"2",2:"1",1:void 0};function un(e,t){return ue(e,n=>{let r=t[n];if(r&&(r=t[r],r))return r})}var li=un(rn,on),ai=un(rn,ln),ci=un(sn,an),ui=un(sn,cn);function hn(e,t){return ue(e,n=>{let r={},i=n,s=[];for(;i=t[i];)r[i]=s.slice(0),s.push(i);return r})}var Kn=hn(rn,on),Dn=hn(rn,ln),Bn=hn(sn,an),jn=hn(sn,cn),ve=Rn(ct),Ho=e=>[e.slice(0,2),e.slice(2)],bt=e=>e.split("");function hi(e){return ue(ve,t=>{let[n,r]=bt(t),i={},s=e[n];return ue(s,(l,o)=>{let c=o.map(u=>u+r);i[l+r]=c}),i})}var fi=hi(Kn),di=hi(Dn);function pi(e){return ue(ve,t=>{let[n,r]=bt(t),i={},s=e[r];return ue(s,(l,o)=>{let c=o.map(u=>n+u);i[n+l]=c}),i})}var Wn=pi(Bn),Hn=pi(jn);function Fo(e,t){return e.map((n,r)=>n+t[r])}function fn(e,t){return ue(ve,n=>{let[r,i]=bt(n),s={},l=e[i],o=t[r];return ue(l,(c,u)=>{let h=In(o,(p,b)=>o[p].length===l[c].length);if(h){let p=Fo(o[h],l[c]);s[h+c]=p}}),s})}var mi=fn(Bn,Dn),gi=fn(Bn,Kn),vi=fn(jn,Dn),_i=fn(jn,Kn);function Ie(e,t){return ue(ve,n=>{let[r,i]=bt(n);return In(ve,s=>{let[l,o]=bt(s);return t[r]===l&&e[i]===o})})}var Uo=Ie(ci,ln),zo=Ie(ci,on),Go=Ie(an,ai),Qo=Ie(an,li),Vo=Ie(ui,ln),Yo=Ie(ui,on),Xo=Ie(cn,ai),Zo=Ie(cn,li);function bi(e,t){return ue(ve,n=>{const r=In(e[n],i=>e[n][i].length===t);if(r)return ue(ve,i=>{if(i===r)return e[n][r]})})}var yi=e=>bi(e,1),Re=e=>bi(e,0),Jo=yi(Wn),el=yi(Hn),wi=Re(Wn),ki=Re(Hn),Si=Re(mi),Ci=Re(gi),$i=Re(vi),Pi=Re(_i),tl=Re(fi),nl=Re(di);function rl(e){return ue(ve,t=>{let n=Io(ve,r=>!!e.map(i=>i[t]===r).find(Boolean));if(n.length>0)return n})}rl([Uo,zo,Vo,Yo,Go,Qo,Xo,Zo]);function ke(e){return ue(ve,t=>ue(ve,n=>{let r=e.find(i=>{var s;return(s=i[t])==null?void 0:s[n]});if(r){let i=r[t];if(i){let s=i[n];if(s)return s}}}))}var il=ke([wi,Si,Ci]),sl=ke([ki,$i,Pi]),ol=ke([nl,tl]),ll=ke([mi,gi,vi,_i]),al=ke([Wn,Hn,di,fi]);ke([il,sl,ol]);ke([ll,al]);var cl=e=>e.split("")[1]==="2",ul=e=>e.split("")[1]==="7",Ei=e=>e.split("")[1]!=="1",Ai=e=>e.split("")[1]!=="8";function ut(e,t){return ue(ve,n=>{if(t(n)&&e[n])return e[n]})}var hl=ut(Jo,cl),fl=ut(el,ul),dl=ut(wi,Ei),pl=ut(ki,Ai);ke([hl,dl]);ke([fl,pl]);ut(ke([Ci,Si]),Ei);ut(ke([Pi,$i]),Ai);Ve.slice(0).reverse(),Ve.slice(0);var xi="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",ml=e=>e.split("="),Mi=35,Ni=String.fromCharCode(33),gl=e=>ct.indexOf(e)+1,Ti=Ro(ct,e=>String.fromCharCode(gl(e)+Mi)),mn=e=>Ti[e]||Ni,vl=(()=>{let e={};return Bo.map((t,n)=>{Ve.map((r,i)=>{let s=t+r,l=String.fromCharCode(Mi+Object.keys(Ti).length+n*8+i-1);e[s]=l})}),e})(),_l=(e,t)=>vl[t+e]||Ni,bl=e=>{let[t,n]=ml(e),[r,i]=Ho(t);return n?mn(r)+_l(i[0],n):mn(r)+mn(i)},mr=e=>e.length/2,gr=e=>e.slice(0,2),vr=e=>e.slice(2),yt=e=>e.slice(0,-2),yl=e=>e.slice(-2),We=class{constructor(e,t,n,r,i){this.id=e,this.fen=t,this.children=n,this.uci=r,this.comment=i,this.child_by_id=s=>this.children.find(l=>l.id===s)}get clone(){let e=this.children.map(t=>t.clone);return new We(this.id,this.fen,e,this.uci,this.comment)}get child_paths(){let e=this.children.flatMap(t=>t.child_paths);return e.length===0?[this.id]:e.map(t=>`${this.id}${t}`)}get lines(){return this.child_paths.map(e=>this.node_list(e))}node_list(e){return We.collect(this,t=>{const n=gr(e);if(n!=="")return e=vr(e),t.child_by_id(n)})}map_comments(e){let t=this.children.map(r=>r.map_comments(e)),n=e(this);return new We(this.id,this.fen,t,this.uci,n)}merge_node(e,t){const n=`${t}${e.id}`,r=this.node_at_path_or_undefined(n);return this.update_at(t,i=>{if(r){let s=r.comment;s?e.comment&&(s+=" "+e.comment):s=e.comment;let l=new We(r.id,r.fen,r.children,r.uci,s);i.children.splice(i.children.indexOf(r),1,l)}else i.children.push(e)})?n:void 0}delete_children(e){this.update_at(e,t=>{t.children.splice(0,t.children.length)})}delete_after(e,t){this.update_at(e,n=>{n.children.splice(n.children.findIndex(r=>r.id===t),1)})}add_node(e,t){const n=`${t}${e.id}`;return this.node_at_path_or_undefined(n)||this.update_at(t,i=>{i.children.push(e)})?n:void 0}update_at(e,t){let n=this.node_at_path_or_undefined(e);if(n)return t(n),n}node_at_path_or_undefined(e){if(e==="")return this;const t=this.child_by_id(gr(e));return t?t.node_at_path_or_undefined(vr(e)):void 0}},$e=We;$e.collect=(e,t)=>{let n=[e],r=e,i;for(;i=t(r);)n.push(i),r=i;return n};$e.breadfirst=(e,t)=>{let n=[["",e]];for(;n.length>0;){let[r,i]=n.shift();if(t(r,i))break;for(let s=0;s<i.children.length;s++)n.push([r+i.children[s].id,i.children[s]])}};$e.make_root=(e,t)=>new We("",e,[],void 0,t);$e.make_branch=(e,t,n)=>new We(bl(t),e,[],t,n);var wt=class{},ye=wt;ye.write_root=e=>({fen:e.fen,comment:e.comment});ye.read_root=e=>$e.make_root(e.fen,e.comment);ye.write_node=e=>({fen:e.fen,uci:e.uci,comment:e.comment});ye.read_node=e=>$e.make_branch(e.fen,e.uci,e.comment);ye.read=e=>{let[t,n]=e;n.sort((i,s)=>mr(i[0])-mr(s[0]));let r=wt.read_root(t);return n.forEach(([i,s])=>r.add_node(wt.read_node(s),yt(i))),r};ye.apply=e=>{function t(n,r){let i=`${r}${n.id}`;return[...n.children.flatMap(s=>t(s,i)),[i,wt.write_node(n)]]}return[wt.write_root(e),e.children.flatMap(n=>t(n,""))]};var Ge={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Chess=e.validateFen=e.SQUARES=e.DEFAULT_POSITION=e.KING=e.QUEEN=e.ROOK=e.BISHOP=e.KNIGHT=e.PAWN=e.BLACK=e.WHITE=void 0,e.WHITE="w",e.BLACK="b",e.PAWN="p",e.KNIGHT="n",e.BISHOP="b",e.ROOK="r",e.QUEEN="q",e.KING="k",e.DEFAULT_POSITION="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1";const t=-1,n={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"};e.SQUARES=["a8","b8","c8","d8","e8","f8","g8","h8","a7","b7","c7","d7","e7","f7","g7","h7","a6","b6","c6","d6","e6","f6","g6","h6","a5","b5","c5","d5","e5","f5","g5","h5","a4","b4","c4","d4","e4","f4","g4","h4","a3","b3","c3","d3","e3","f3","g3","h3","a2","b2","c2","d2","e2","f2","g2","h2","a1","b1","c1","d1","e1","f1","g1","h1"];const r={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},i={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},s={b:[16,32,17,15],w:[-16,-32,-17,-15]},l={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},o=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],c=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],u={p:1,n:2,b:4,r:8,q:16,k:32},h="pnbrqkPNBRQK",p=[e.KNIGHT,e.BISHOP,e.ROOK,e.QUEEN],b=7,k=6,v=1,P=0,E={w:[{square:i.a1,flag:r.QSIDE_CASTLE},{square:i.h1,flag:r.KSIDE_CASTLE}],b:[{square:i.a8,flag:r.QSIDE_CASTLE},{square:i.h8,flag:r.KSIDE_CASTLE}]},x={b:v,w:k},S=["1-0","0-1","1/2-1/2","*"];function $(C){return C>>4}function q(C){return C&15}function T(C){return"0123456789".indexOf(C)!==-1}function B(C){const a=q(C),f=$(C);return"abcdefgh".substring(a,a+1)+"87654321".substring(f,f+1)}function j(C){return C===e.WHITE?e.BLACK:e.WHITE}function K(C){const a=[];a[0]="No errors.",a[1]="FEN string must contain six space-delimited fields.",a[2]="6th field (move number) must be a positive integer.",a[3]="5th field (half move counter) must be a non-negative integer.",a[4]="4th field (en-passant square) is invalid.",a[5]="3rd field (castling availability) is invalid.",a[6]="2nd field (side to move) is invalid.",a[7]="1st field (piece positions) does not contain 8 '/'-delimited rows.",a[8]="1st field (piece positions) is invalid [consecutive numbers].",a[9]="1st field (piece positions) is invalid [invalid piece].",a[10]="1st field (piece positions) is invalid [row too large].",a[11]="Illegal en-passant square";const f=C.split(/\s+/);if(f.length!==6)return{valid:!1,errorNumber:1,error:a[1]};const d=parseInt(f[5],10);if(isNaN(d)||d<=0)return{valid:!1,errorNumber:2,error:a[2]};const g=parseInt(f[4],10);if(isNaN(g)||g<0)return{valid:!1,errorNumber:3,error:a[3]};if(!/^(-|[abcdefgh][36])$/.test(f[3]))return{valid:!1,errorNumber:4,error:a[4]};if(!/^(KQ?k?q?|Qk?q?|kq?|q|-)$/.test(f[2]))return{valid:!1,errorNumber:5,error:a[5]};if(!/^(w|b)$/.test(f[1]))return{valid:!1,errorNumber:6,error:a[6]};const m=f[0].split("/");if(m.length!==8)return{valid:!1,errorNumber:7,error:a[7]};for(let y=0;y<m.length;y++){let _=0,w=!1;for(let D=0;D<m[y].length;D++)if(T(m[y][D])){if(w)return{valid:!1,errorNumber:8,error:a[8]};_+=parseInt(m[y][D],10),w=!0}else{if(!/^[prnbqkPRNBQK]$/.test(m[y][D]))return{valid:!1,errorNumber:9,error:a[9]};_+=1,w=!1}if(_!==8)return{valid:!1,errorNumber:10,error:a[10]}}return f[3][1]=="3"&&f[1]=="w"||f[3][1]=="6"&&f[1]=="b"?{valid:!1,errorNumber:11,error:a[11]}:{valid:!0,errorNumber:0,error:a[0]}}e.validateFen=K;function re(C,a){const f=C.from,d=C.to,g=C.piece;let m=0,y=0,_=0;for(let w=0,D=a.length;w<D;w++){const z=a[w].from,J=a[w].to,M=a[w].piece;g===M&&f!==z&&d===J&&(m++,$(f)===$(z)&&y++,q(f)===q(z)&&_++)}return m>0?y>0&&_>0?B(f):_>0?B(f).charAt(1):B(f).charAt(0):""}function A(C,a,f,d,g,m=void 0,y=r.NORMAL){const _=$(d);if(g===e.PAWN&&(_===b||_===P))for(let w=0;w<p.length;w++){const D=p[w];C.push({color:a,from:f,to:d,piece:g,captured:m,promotion:D,flags:y|r.PROMOTION})}else C.push({color:a,from:f,to:d,piece:g,captured:m,promotion:void 0,flags:y})}function N(C){let a=C.charAt(0);return a>="a"&&a<="h"?C.match(/[a-h]\d.*[a-h]\d/)?void 0:e.PAWN:(a=a.toLowerCase(),a==="o"?e.KING:a)}function W(C){return C.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}class L{constructor(a=e.DEFAULT_POSITION){this._board=new Array(128),this._turn=e.WHITE,this._header={},this._kings={w:t,b:t},this._epSquare=-1,this._halfMoves=0,this._moveNumber=0,this._history=[],this._comments={},this._castling={w:0,b:0},this.load(a)}clear(a=!1){this._board=new Array(128),this._kings={w:t,b:t},this._turn=e.WHITE,this._castling={w:0,b:0},this._epSquare=t,this._halfMoves=0,this._moveNumber=1,this._history=[],this._comments={},this._header=a?this._header:{},this._updateSetup(this.fen())}load(a,f=!1){const d=a.split(/\s+/),g=d[0];let m=0;if(!K(a).valid)return!1;this.clear(f);for(let y=0;y<g.length;y++){const _=g.charAt(y);if(_==="/")m+=8;else if(T(_))m+=parseInt(_,10);else{const w=_<"a"?e.WHITE:e.BLACK;this.put({type:_.toLowerCase(),color:w},B(m)),m++}}return this._turn=d[1],d[2].indexOf("K")>-1&&(this._castling.w|=r.KSIDE_CASTLE),d[2].indexOf("Q")>-1&&(this._castling.w|=r.QSIDE_CASTLE),d[2].indexOf("k")>-1&&(this._castling.b|=r.KSIDE_CASTLE),d[2].indexOf("q")>-1&&(this._castling.b|=r.QSIDE_CASTLE),this._epSquare=d[3]==="-"?t:i[d[3]],this._halfMoves=parseInt(d[4],10),this._moveNumber=parseInt(d[5],10),this._updateSetup(this.fen()),!0}fen(){let a=0,f="";for(let m=i.a8;m<=i.h1;m++){if(this._board[m]){a>0&&(f+=a,a=0);const{color:y,type:_}=this._board[m];f+=y===e.WHITE?_.toUpperCase():_.toLowerCase()}else a++;m+1&136&&(a>0&&(f+=a),m!==i.h1&&(f+="/"),a=0,m+=8)}let d="";this._castling[e.WHITE]&r.KSIDE_CASTLE&&(d+="K"),this._castling[e.WHITE]&r.QSIDE_CASTLE&&(d+="Q"),this._castling[e.BLACK]&r.KSIDE_CASTLE&&(d+="k"),this._castling[e.BLACK]&r.QSIDE_CASTLE&&(d+="q"),d=d||"-";const g=this._epSquare===t?"-":B(this._epSquare);return[f,this._turn,d,g,this._halfMoves,this._moveNumber].join(" ")}_updateSetup(a){this._history.length>0||(a!==e.DEFAULT_POSITION?(this._header.SetUp="1",this._header.FEN=a):(delete this._header.SetUp,delete this._header.FEN))}reset(){this.load(e.DEFAULT_POSITION)}get(a){return this._board[i[a]]||!1}put({type:a,color:f},d){if(h.indexOf(a.toLowerCase())===-1||!(d in i))return!1;const g=i[d];return a==e.KING&&!(this._kings[f]==t||this._kings[f]==g)?!1:(this._board[g]={type:a,color:f},a===e.KING&&(this._kings[f]=g),this._updateSetup(this.fen()),!0)}remove(a){const f=this.get(a);return delete this._board[i[a]],f&&f.type===e.KING&&(this._kings[f.color]=t),this._updateSetup(this.fen()),f}_attacked(a,f){for(let d=i.a8;d<=i.h1;d++){if(d&136){d+=7;continue}if(this._board[d]===void 0||this._board[d].color!==a)continue;const g=this._board[d],m=d-f,y=m+119;if(o[y]&u[g.type]){if(g.type===e.PAWN){if(m>0){if(g.color===e.WHITE)return!0}else if(g.color===e.BLACK)return!0;continue}if(g.type==="n"||g.type==="k")return!0;const _=c[y];let w=d+_,D=!1;for(;w!==f;){if(this._board[w]!=null){D=!0;break}w+=_}if(!D)return!0}}return!1}_isKingAttacked(a){return this._attacked(j(a),this._kings[a])}isCheck(){return this._isKingAttacked(this._turn)}inCheck(){return this.isCheck()}isCheckmate(){return this.isCheck()&&this._moves().length===0}isStalemate(){return!this.isCheck()&&this._moves().length===0}isInsufficientMaterial(){const a={b:0,n:0,r:0,q:0,k:0,p:0},f=[];let d=0,g=0;for(let m=i.a8;m<=i.h1;m++){if(g=(g+1)%2,m&136){m+=7;continue}const y=this._board[m];y&&(a[y.type]=y.type in a?a[y.type]+1:1,y.type===e.BISHOP&&f.push(g),d++)}if(d===2)return!0;if(d===3&&(a[e.BISHOP]===1||a[e.KNIGHT]===1))return!0;if(d===a[e.BISHOP]+2){let m=0;const y=f.length;for(let _=0;_<y;_++)m+=f[_];if(m===0||m===y)return!0}return!1}isThreefoldRepetition(){const a=[],f={};let d=!1;for(;;){const g=this._undoMove();if(!g)break;a.push(g)}for(;;){const g=this.fen().split(" ").slice(0,4).join(" ");f[g]=g in f?f[g]+1:1,f[g]>=3&&(d=!0);const m=a.pop();if(m)this._makeMove(m);else break}return d}isDraw(){return this._halfMoves>=100||this.isStalemate()||this.isInsufficientMaterial()||this.isThreefoldRepetition()}isGameOver(){return this.isCheckmate()||this.isStalemate()||this.isDraw()}moves({verbose:a=!1,square:f=void 0}={}){const d=this._moves({square:f});return a?d.map(g=>this._makePretty(g)):d.map(g=>this._moveToSan(g,d))}_moves({legal:a=!0,piece:f=void 0,square:d=void 0}={}){var g;const m=d?d.toLowerCase():void 0,y=f==null?void 0:f.toLowerCase(),_=[],w=this._turn,D=j(w);let z=i.a8,J=i.h1,M=!1;if(m)if(m in i)z=J=i[m],M=!0;else return[];for(let R=z;R<=J;R++){if(R&136){R+=7;continue}if(!this._board[R]||this._board[R].color===D)continue;const{type:U}=this._board[R];let Y;if(U===e.PAWN){if(y&&y!==U)continue;Y=R+s[w][0],this._board[Y]||(A(_,w,R,Y,e.PAWN),Y=R+s[w][1],x[w]===$(R)&&!this._board[Y]&&A(_,w,R,Y,e.PAWN,void 0,r.BIG_PAWN));for(let ce=2;ce<4;ce++)Y=R+s[w][ce],!(Y&136)&&(((g=this._board[Y])===null||g===void 0?void 0:g.color)===D?A(_,w,R,Y,e.PAWN,this._board[Y].type,r.CAPTURE):Y===this._epSquare&&A(_,w,R,Y,e.PAWN,e.PAWN,r.EP_CAPTURE))}else{if(y&&y!==U)continue;for(let ce=0,et=l[U].length;ce<et;ce++){const H=l[U][ce];for(Y=R;Y+=H,!(Y&136);){if(!this._board[Y])A(_,w,R,Y,U);else{if(this._board[Y].color===w)break;A(_,w,R,Y,U,this._board[Y].type,r.CAPTURE);break}if(U===e.KNIGHT||U===e.KING)break}}}}if((y===void 0||y===e.KING)&&(!M||J===this._kings[w])){if(this._castling[w]&r.KSIDE_CASTLE){const R=this._kings[w],U=R+2;!this._board[R+1]&&!this._board[U]&&!this._attacked(D,this._kings[w])&&!this._attacked(D,R+1)&&!this._attacked(D,U)&&A(_,w,this._kings[w],U,e.KING,void 0,r.KSIDE_CASTLE)}if(this._castling[w]&r.QSIDE_CASTLE){const R=this._kings[w],U=R-2;!this._board[R-1]&&!this._board[R-2]&&!this._board[R-3]&&!this._attacked(D,this._kings[w])&&!this._attacked(D,R-1)&&!this._attacked(D,U)&&A(_,w,this._kings[w],U,e.KING,void 0,r.QSIDE_CASTLE)}}if(!a)return _;const ie=[];for(let R=0,U=_.length;R<U;R++)this._makeMove(_[R]),this._isKingAttacked(w)||ie.push(_[R]),this._undoMove();return ie}move(a,{sloppy:f=!1}={}){let d=null;if(typeof a=="string")d=this._moveFromSan(a,f);else if(typeof a=="object"){const m=this._moves();for(let y=0,_=m.length;y<_;y++)if(a.from===B(m[y].from)&&a.to===B(m[y].to)&&(!("promotion"in m[y])||a.promotion===m[y].promotion)){d=m[y];break}}if(!d)return null;const g=this._makePretty(d);return this._makeMove(d),g}_push(a){this._history.push({move:a,kings:{b:this._kings.b,w:this._kings.w},turn:this._turn,castling:{b:this._castling.b,w:this._castling.w},epSquare:this._epSquare,halfMoves:this._halfMoves,moveNumber:this._moveNumber})}_makeMove(a){const f=this._turn,d=j(f);if(this._push(a),this._board[a.to]=this._board[a.from],delete this._board[a.from],a.flags&r.EP_CAPTURE&&(this._turn===e.BLACK?delete this._board[a.to-16]:delete this._board[a.to+16]),a.promotion&&(this._board[a.to]={type:a.promotion,color:f}),this._board[a.to].type===e.KING){if(this._kings[f]=a.to,a.flags&r.KSIDE_CASTLE){const g=a.to-1,m=a.to+1;this._board[g]=this._board[m],delete this._board[m]}else if(a.flags&r.QSIDE_CASTLE){const g=a.to+1,m=a.to-2;this._board[g]=this._board[m],delete this._board[m]}this._castling[f]=0}if(this._castling[f]){for(let g=0,m=E[f].length;g<m;g++)if(a.from===E[f][g].square&&this._castling[f]&E[f][g].flag){this._castling[f]^=E[f][g].flag;break}}if(this._castling[d]){for(let g=0,m=E[d].length;g<m;g++)if(a.to===E[d][g].square&&this._castling[d]&E[d][g].flag){this._castling[d]^=E[d][g].flag;break}}a.flags&r.BIG_PAWN?f===e.BLACK?this._epSquare=a.to-16:this._epSquare=a.to+16:this._epSquare=t,a.piece===e.PAWN?this._halfMoves=0:a.flags&(r.CAPTURE|r.EP_CAPTURE)?this._halfMoves=0:this._halfMoves++,f===e.BLACK&&this._moveNumber++,this._turn=d}undo(){const a=this._undoMove();return a?this._makePretty(a):null}_undoMove(){const a=this._history.pop();if(a===void 0)return null;const f=a.move;this._kings=a.kings,this._turn=a.turn,this._castling=a.castling,this._epSquare=a.epSquare,this._halfMoves=a.halfMoves,this._moveNumber=a.moveNumber;const d=this._turn,g=j(d);if(this._board[f.from]=this._board[f.to],this._board[f.from].type=f.piece,delete this._board[f.to],f.captured)if(f.flags&r.EP_CAPTURE){let m;d===e.BLACK?m=f.to-16:m=f.to+16,this._board[m]={type:e.PAWN,color:g}}else this._board[f.to]={type:f.captured,color:g};if(f.flags&(r.KSIDE_CASTLE|r.QSIDE_CASTLE)){let m,y;f.flags&r.KSIDE_CASTLE?(m=f.to+1,y=f.to-1):(m=f.to-2,y=f.to+1),this._board[m]=this._board[y],delete this._board[y]}return f}pgn({newline:a=`
`,maxWidth:f=0}={}){const d=[];let g=!1;for(const M in this._header)d.push("["+M+' "'+this._header[M]+'"]'+a),g=!0;g&&this._history.length&&d.push(a);const m=M=>{const ie=this._comments[this.fen()];if(typeof ie<"u"){const R=M.length>0?" ":"";M=`${M}${R}{${ie}}`}return M},y=[];for(;this._history.length>0;)y.push(this._undoMove());const _=[];let w="";for(y.length===0&&_.push(m(""));y.length>0;){w=m(w);const M=y.pop();if(!M)break;if(!this._history.length&&M.color==="b"){const ie=`${this._moveNumber}. ...`;w=w?`${w} ${ie}`:ie}else M.color==="w"&&(w.length&&_.push(w),w=this._moveNumber+".");w=w+" "+this._moveToSan(M,this._moves({legal:!0})),this._makeMove(M)}if(w.length&&_.push(m(w)),typeof this._header.Result<"u"&&_.push(this._header.Result),f===0)return d.join("")+_.join(" ");const D=function(){return d.length>0&&d[d.length-1]===" "?(d.pop(),!0):!1},z=function(M,ie){for(const R of ie.split(" "))if(R){if(M+R.length>f){for(;D();)M--;d.push(a),M=0}d.push(R),M+=R.length,d.push(" "),M++}return D()&&M--,M};let J=0;for(let M=0;M<_.length;M++){if(J+_[M].length>f&&_[M].includes("{")){J=z(J,_[M]);continue}J+_[M].length>f&&M!==0?(d[d.length-1]===" "&&d.pop(),d.push(a),J=0):M!==0&&(d.push(" "),J++),d.push(_[M]),J+=_[M].length}return d.join("")}header(...a){for(let f=0;f<a.length;f+=2)typeof a[f]=="string"&&typeof a[f+1]=="string"&&(this._header[a[f]]=a[f+1]);return this._header}loadPgn(a,{sloppy:f=!1,newlineChar:d=`\r?
`}={}){function g(H){return H.replace(/\\/g,"\\")}function m(H){const pe={},xe=H.split(new RegExp(g(d)));let dn="",sr="";for(let Mt=0;Mt<xe.length;Mt++){const or=/^\s*\[([A-Za-z]+)\s*"(.*)"\s*\]\s*$/;dn=xe[Mt].replace(or,"$1"),sr=xe[Mt].replace(or,"$2"),dn.trim().length>0&&(pe[dn]=sr)}return pe}a=a.trim();const _=new RegExp("^(\\[((?:"+g(d)+")|.)*\\])(?:\\s*"+g(d)+"){2}").exec(a),w=_&&_.length>=2?_[1]:"";this.reset();const D=m(w);let z="";for(const H in D)H.toLowerCase()==="fen"&&(z=D[H]),this.header(H,D[H]);if(f){if(z&&!this.load(z,!0))return!1}else if(D.SetUp==="1"&&!("FEN"in D&&this.load(D.FEN,!0)))return!1;function J(H){return Array.from(H).map(function(pe){return pe.charCodeAt(0)<128?pe.charCodeAt(0).toString(16):encodeURIComponent(pe).replace(/%/g,"").toLowerCase()}).join("")}function M(H){return H.length==0?"":decodeURIComponent("%"+(H.match(/.{1,2}/g)||[]).join("%"))}const ie=function(H){return H=H.replace(new RegExp(g(d),"g")," "),`{${J(H.slice(1,H.length-1))}}`},R=function(H){if(H.startsWith("{")&&H.endsWith("}"))return M(H.slice(1,H.length-1))};let U=a.replace(w,"").replace(new RegExp(`({[^}]*})+?|;([^${g(d)}]*)`,"g"),function(H,pe,xe){return pe!==void 0?ie(pe):" "+ie(`{${xe.slice(1)}}`)}).replace(new RegExp(g(d),"g")," ");const Y=/(\([^()]+\))+?/g;for(;Y.test(U);)U=U.replace(Y,"");U=U.replace(/\d+\.(\.\.)?/g,""),U=U.replace(/\.\.\./g,""),U=U.replace(/\$\d+/g,"");let ce=U.trim().split(new RegExp(/\s+/));ce=ce.join(",").replace(/,,+/g,",").split(",");let et="";for(let H=0;H<ce.length;H++){const pe=R(ce[H]);if(pe!==void 0){this._comments[this.fen()]=pe;continue}const xe=this._moveFromSan(ce[H],f);if(xe==null)if(S.indexOf(ce[H])>-1)et=ce[H];else return!1;else et="",this._makeMove(xe)}return et&&Object.keys(this._header).length&&!this._header.Result&&this.header("Result",et),!0}_moveToSan(a,f){let d="";if(a.flags&r.KSIDE_CASTLE)d="O-O";else if(a.flags&r.QSIDE_CASTLE)d="O-O-O";else{if(a.piece!==e.PAWN){const g=re(a,f);d+=a.piece.toUpperCase()+g}a.flags&(r.CAPTURE|r.EP_CAPTURE)&&(a.piece===e.PAWN&&(d+=B(a.from)[0]),d+="x"),d+=B(a.to),a.promotion&&(d+="="+a.promotion.toUpperCase())}return this._makeMove(a),this.isCheck()&&(this.isCheckmate()?d+="#":d+="+"),this._undoMove(),d}_moveFromSan(a,f=!1){const d=W(a);let g=N(d),m=this._moves({legal:!0,piece:g});for(let M=0,ie=m.length;M<ie;M++)if(d===W(this._moveToSan(m[M],m)))return m[M];if(!f)return null;let y,_,w,D,z,J=!1;_=d.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/),_?(y=_[1],w=_[2],D=_[3],z=_[4],w.length==1&&(J=!0)):(_=d.match(/([pnbrqkPNBRQK])?([a-h]?[1-8]?)x?-?([a-h][1-8])([qrbnQRBN])?/),_&&(y=_[1],w=_[2],D=_[3],z=_[4],w.length==1&&(J=!0))),g=N(d),m=this._moves({legal:!0,piece:y||g});for(let M=0,ie=m.length;M<ie;M++)if(w&&D){if((!y||y.toLowerCase()==m[M].piece)&&i[w]==m[M].from&&i[D]==m[M].to&&(!z||z.toLowerCase()==m[M].promotion))return m[M];if(J){const R=B(m[M].from);if((!y||y.toLowerCase()==m[M].piece)&&i[D]==m[M].to&&(w==R[0]||w==R[1])&&(!z||z.toLowerCase()==m[M].promotion))return m[M]}}return null}ascii(){let a=`   +------------------------+
`;for(let f=i.a8;f<=i.h1;f++){if(q(f)===0&&(a+=" "+"87654321"[$(f)]+" |"),this._board[f]){const d=this._board[f].type,m=this._board[f].color===e.WHITE?d.toUpperCase():d.toLowerCase();a+=" "+m+" "}else a+=" . ";f+1&136&&(a+=`|
`,f+=8)}return a+=`   +------------------------+
`,a+="     a  b  c  d  e  f  g  h",a}perft(a){const f=this._moves({legal:!1});let d=0;const g=this._turn;for(let m=0,y=f.length;m<y;m++)this._makeMove(f[m]),this._isKingAttacked(g)||(a-1>0?d+=this.perft(a-1):d++),this._undoMove();return d}_makePretty(a){const{color:f,piece:d,from:g,to:m,flags:y,captured:_,promotion:w}=a;let D="";for(const J in r)r[J]&y&&(D+=n[J]);const z={color:f,piece:d,from:B(g),to:B(m),san:this._moveToSan(a,this._moves({legal:!0})),flags:D};return _&&(z.captured=_),w&&(z.promotion=w),z}turn(){return this._turn}board(){const a=[];let f=[];for(let d=i.a8;d<=i.h1;d++)this._board[d]==null?f.push(null):f.push({square:B(d),type:this._board[d].type,color:this._board[d].color}),d+1&136&&(a.push(f),f=[],d+=8);return a}squareColor(a){if(a in i){const f=i[a];return($(f)+q(f))%2===0?"light":"dark"}return null}history({verbose:a=!1}={}){const f=[],d=[];for(;this._history.length>0;)f.push(this._undoMove());for(;;){const g=f.pop();if(!g)break;a?d.push(this._makePretty(g)):d.push(this._moveToSan(g,this._moves())),this._makeMove(g)}return d}_pruneComments(){const a=[],f={},d=g=>{g in this._comments&&(f[g]=this._comments[g])};for(;this._history.length>0;)a.push(this._undoMove());for(d(this.fen());;){const g=a.pop();if(!g)break;this._makeMove(g),d(this.fen())}this._comments=f}getComment(){return this._comments[this.fen()]}setComment(a){this._comments[this.fen()]=a.replace("{","[").replace("}","]")}deleteComment(){const a=this._comments[this.fen()];return delete this._comments[this.fen()],a}getComments(){return this._pruneComments(),Object.keys(this._comments).map(a=>({fen:a,comment:this._comments[a]}))}deleteComments(){return this._pruneComments(),Object.keys(this._comments).map(a=>{const f=this._comments[a];return delete this._comments[a],{fen:a,comment:f}})}}e.Chess=L})(Ge);const vt=class{constructor(){F(this,"root")}get flat_export(){return ye.apply(this.root)}get clone(){let t=new vt;return t.root=this.root.clone,t}node_at_path(t){return this.root.node_at_path_or_undefined(t)}moves(){let[t,n]=ye.apply(this.root);return n.map(([r,i])=>{let[s,...l]=this.root.node_list(r),o=new Ge.Chess(s.fen);l.forEach(h=>o.move(h.uci,{sloppy:!0}));let c=o.history(),u=c[c.length-1];return`${r} ${u} {${i.comment??""}}`})}chess(t){let[n,...r]=this.root.node_list(t),i=new Ge.Chess(n.fen);return r.forEach(s=>i.move(s.uci,{sloppy:!0})),i}fen(t){return this.chess(t).fen()}add_move(t,n,r){let i=this.chess(t);i.move(n,{sloppy:!0});let s=i.fen(),l=$e.make_branch(s,n,r);return this.root.add_node(l,t)}delete_children(t){this.root.delete_children(t)}delete_path(t){let n=yt(t),r=yl(t);this.root.delete_after(n,r)}delete_variation(t){let[n,...r]=this.root.node_list(t);if(r.length===0)return;let i=r[r.length-1].id;for(let o=r.length-2;o>=0;o--){let c=r[o];if(c.children.length>1)break;i=c.id+i}let s=t.slice(0,-i.length),l=i.slice(0,2);return this.root.delete_after(s,l),s}};let Oe=vt;F(Oe,"diff_trees",(t,n)=>{let[r,i]=t.flat_export,[s,l]=n.flat_export,o=[],c=[];i.forEach(([p,b])=>{l.find(k=>k[0]===p)||o.push(p)}),l.forEach(([p,b])=>{i.find(k=>k[0]===p)||c.push(p)});let u=[],h=[];return o.forEach(p=>{o.find(b=>b.length<p.length&&p.startsWith(b))||u.push(p)}),c.forEach(p=>{c.find(b=>b.length<p.length&&p.startsWith(b))||h.push(p)}),[u,h]}),F(Oe,"make",()=>{let t=new vt;return t.root=$e.make_root(xi),t}),F(Oe,"flat_doc",t=>{let n=new vt;return n.root=ye.read(t),n});class wl{constructor(){F(this,"_completed");this._completed=this._prop("completed",[])}_key(t){return["aidchess","challenges",t].join(".")}_prop(t,n){return oi(this._key(t),()=>n)}clear(){this._completed([])}complete(t){let n=this.completeds;n.push(t),this._completed(n)}get completeds(){return this._completed()}}const gn=new wl;class kl{constructor(){F(this,"_replay");this._replay=this._prop("replay",ye.apply($e.make_root(xi)))}_key(t){return["aidchess","replays",t].join(".")}_prop(t,n){return oi(this._key(t),()=>n)}set_replay(t){this._replay(t.flat_export)}get_replay(){return Oe.flat_doc(this._replay())}}const Cn=new kl,Sl=(e,t)=>e.color===t.color&&e.level===t.level,Cl=[{key:"20",description:"Get to 20 moves"},{key:"30",description:"Get to 30 moves"},{key:"40",description:"Get to 40 moves"}],ir=class{constructor(){F(this,"check_challenge_game",(t,n)=>{t.moves.length>=80?this.complete("40",n):t.moves.length>=60?this.complete("30",n):t.moves.length>=40&&this.complete("20",n)})}get challenges(){return Cl}complete(t,n){gn.complete({key:t,pack:n})}completed(t,n){return gn.completeds.filter(r=>r.key===t&&Sl(n,r.pack)).length}clear(){gn.clear()}};let qt=ir;F(qt,"make",()=>new ir);const It=qt.make(),$l=ne(`<div class="lobby"><div class="side"><div class="footer"></div></div><div class="app"><h2>Beat stockfish 8 the hard way.</h2><span>Play hardcore chess, where you can restart at your first mistake, and build an opening repertoire.</span><h3> Select a pack </h3><div class="packs"></div><h3 class="pack-name"></h3><h4> Select a generation </h4><small> You can select a generation when it's unlocked </small><div class="generations"><div class="generation"><span class="primary selected">G0 50/50</span></div><div class="generation"><span class="primary">G1 10/20</span></div><div class="generation"><span class="primary disabled">G2 1/5</span></div><div class="generation"><span class="primary disabled">G3 0/15</span></div></div><button class="fbt primary"> Start Game </button><div class="challenges"><h3> Challenges </h3><span class="clear"> Clear Progress </span></div></div></div>`),Pl=ne('<div class="pack"><span> <span class="color"></span> Stockfish </span></div>'),El=ne("<div></div>"),Al=ne('<span class="gray"> Uncompleted </span>'),xl=ne('<span class="green"> Completed <!> </span>'),_r=[{level:5,color:"white"},{level:5,color:"black"},{level:8,color:"white"},{level:8,color:"black"}],Ml=()=>{const e=ti(),t=()=>{let{level:h,color:p}=s();e(`/hardcore?level=${h}&color=${p}`,{replace:!0})},n=()=>{It.clear(),c(void 0)},[r,i]=X(0),s=I(()=>_r[r()]),l=I(()=>[s().color.toUpperCase(),"Stockfish",s().level].join(" ")),[o,c]=X(void 0,{equals:!1}),u=I(()=>(o(),It.challenges));return[O(tn,{children:" aidchess.com - Build an opening repertoire against Stockfish "}),(()=>{const h=$l.cloneNode(!0),p=h.firstChild,b=p.firstChild,k=p.nextSibling,v=k.firstChild,P=v.nextSibling,E=P.nextSibling,x=E.nextSibling,S=x.nextSibling,$=S.nextSibling,q=$.nextSibling,T=q.nextSibling,B=T.nextSibling,j=B.nextSibling,K=j.firstChild,re=K.nextSibling;return G(b,O(si,{href:"/about",children:"About"})),G(x,O(ot,{each:_r,children:(A,N)=>(()=>{const W=Pl.cloneNode(!0),L=W.firstChild,C=L.firstChild,a=C.nextSibling;return a.nextSibling,L.$$click=()=>{i(N())},G(a,()=>A.color),G(L,()=>A.level,null),ae(()=>pt(L,"primary"+(A===s()?" selected":""))),W})()})),G(S,l),B.$$click=()=>t(),G(j,O(ot,{get each(){return u()},children:A=>(()=>{const N=El.cloneNode(!0);return G(N,()=>A.description,null),G(N,O(Ae,{keyed:!0,get when(){return It.completed(A.key,s())},get fallback(){return Al.cloneNode(!0)},children:W=>(()=>{const L=xl.cloneNode(!0),C=L.firstChild,a=C.nextSibling;return a.nextSibling,G(L,W>1?`x${W}`:"",a),L})()}),null),N})()}),re),re.$$click=()=>n(),h})()]};Pt(["click"]);const Nl=["white","black"],Fn=["a","b","c","d","e","f","g","h"],Un=["1","2","3","4","5","6","7","8"],Tl=[...Un].reverse(),zn=Array.prototype.concat(...Fn.map(e=>Un.map(t=>e+t))),me=e=>zn[8*e[0]+e[1]],ee=e=>[e.charCodeAt(0)-97,e.charCodeAt(1)-49],Oi=zn.map(ee);function Ol(e){let t;const n=()=>(t===void 0&&(t=e()),t);return n.clear=()=>{t=void 0},n}const Ll=()=>{let e;return{start(){e=performance.now()},cancel(){e=void 0},stop(){if(!e)return 0;const t=performance.now()-e;return e=void 0,t}}},Gn=e=>e==="white"?"black":"white",kt=(e,t)=>{const n=e[0]-t[0],r=e[1]-t[1];return n*n+r*r},$n=(e,t)=>e.role===t.role&&e.color===t.color,At=e=>(t,n)=>[(n?t[0]:7-t[0])*e.width/8,(n?7-t[1]:t[1])*e.height/8],Se=(e,t)=>{e.style.transform=`translate(${t[0]}px,${t[1]}px)`},Li=(e,t,n=1)=>{e.style.transform=`translate(${t[0]}px,${t[1]}px) scale(${n})`},Qn=(e,t)=>{e.style.visibility=t?"visible":"hidden"},Ze=e=>{var t;if(e.clientX||e.clientX===0)return[e.clientX,e.clientY];if(!((t=e.targetTouches)===null||t===void 0)&&t[0])return[e.targetTouches[0].clientX,e.targetTouches[0].clientY]},qi=e=>e.buttons===2||e.button===2,Pe=(e,t)=>{const n=document.createElement(e);return t&&(n.className=t),n};function Ii(e,t,n){const r=ee(e);return t||(r[0]=7-r[0],r[1]=7-r[1]),[n.left+n.width*r[0]/8+n.width/16,n.top+n.height*(7-r[1])/8+n.height/16]}const Ye=(e,t)=>Math.abs(e-t),ql=e=>(t,n,r,i)=>Ye(t,r)<2&&(e==="white"?i===n+1||n<=1&&i===n+2&&t===r:i===n-1||n>=6&&i===n-2&&t===r),Ri=(e,t,n,r)=>{const i=Ye(e,n),s=Ye(t,r);return i===1&&s===2||i===2&&s===1},Ki=(e,t,n,r)=>Ye(e,n)===Ye(t,r),Di=(e,t,n,r)=>e===n||t===r,Bi=(e,t,n,r)=>Ki(e,t,n,r)||Di(e,t,n,r),Il=(e,t,n)=>(r,i,s,l)=>Ye(r,s)<2&&Ye(i,l)<2||n&&i===l&&i===(e==="white"?0:7)&&(r===4&&(s===2&&t.includes(0)||s===6&&t.includes(7))||t.includes(s));function Rl(e,t){const n=t==="white"?"1":"8",r=[];for(const[i,s]of e)i[1]===n&&s.color===t&&s.role==="rook"&&r.push(ee(i)[0]);return r}function ji(e,t,n){const r=e.get(t);if(!r)return[];const i=ee(t),s=r.role,l=s==="pawn"?ql(r.color):s==="knight"?Ri:s==="bishop"?Ki:s==="rook"?Di:s==="queen"?Bi:Il(r.color,Rl(e,r.color),n);return Oi.filter(o=>(i[0]!==o[0]||i[1]!==o[1])&&l(i[0],i[1],o[0],o[1])).map(me)}function he(e,...t){e&&setTimeout(()=>e(...t),1)}function Kl(e){e.orientation=Gn(e.orientation),e.animation.current=e.draggable.current=e.selected=void 0}function Dl(e,t){for(const[n,r]of t)r?e.pieces.set(n,r):e.pieces.delete(n)}function Bl(e,t){if(e.check=void 0,t===!0&&(t=e.turnColor),t)for(const[n,r]of e.pieces)r.role==="king"&&r.color===t&&(e.check=n)}function jl(e,t,n,r){De(e),e.premovable.current=[t,n],he(e.premovable.events.set,t,n,r)}function Ke(e){e.premovable.current&&(e.premovable.current=void 0,he(e.premovable.events.unset))}function Wl(e,t,n){Ke(e),e.predroppable.current={role:t,key:n},he(e.predroppable.events.set,t,n)}function De(e){const t=e.predroppable;t.current&&(t.current=void 0,he(t.events.unset))}function Hl(e,t,n){if(!e.autoCastle)return!1;const r=e.pieces.get(t);if(!r||r.role!=="king")return!1;const i=ee(t),s=ee(n);if(i[1]!==0&&i[1]!==7||i[1]!==s[1])return!1;i[0]===4&&!e.pieces.has(n)&&(s[0]===6?n=me([7,s[1]]):s[0]===2&&(n=me([0,s[1]])));const l=e.pieces.get(n);return!l||l.color!==r.color||l.role!=="rook"?!1:(e.pieces.delete(t),e.pieces.delete(n),i[0]<s[0]?(e.pieces.set(me([6,s[1]]),r),e.pieces.set(me([5,s[1]]),l)):(e.pieces.set(me([2,s[1]]),r),e.pieces.set(me([3,s[1]]),l)),!0)}function Wi(e,t,n){const r=e.pieces.get(t),i=e.pieces.get(n);if(t===n||!r)return!1;const s=i&&i.color!==r.color?i:void 0;return n===e.selected&&ge(e),he(e.events.move,t,n,s),Hl(e,t,n)||(e.pieces.set(n,r),e.pieces.delete(t)),e.lastMove=[t,n],e.check=void 0,he(e.events.change),s||!0}function Vn(e,t,n,r){if(e.pieces.has(n))if(r)e.pieces.delete(n);else return!1;return he(e.events.dropNewPiece,t,n),e.pieces.set(n,t),e.lastMove=[n],e.check=void 0,he(e.events.change),e.movable.dests=void 0,e.turnColor=Gn(e.turnColor),!0}function Hi(e,t,n){const r=Wi(e,t,n);return r&&(e.movable.dests=void 0,e.turnColor=Gn(e.turnColor),e.animation.current=void 0),r}function Fi(e,t,n){if(Yn(e,t,n)){const r=Hi(e,t,n);if(r){const i=e.hold.stop();ge(e);const s={premove:!1,ctrlKey:e.stats.ctrlKey,holdTime:i};return r!==!0&&(s.captured=r),he(e.movable.events.after,t,n,s),!0}}else if(Ul(e,t,n))return jl(e,t,n,{ctrlKey:e.stats.ctrlKey}),ge(e),!0;return ge(e),!1}function Ui(e,t,n,r){const i=e.pieces.get(t);i&&(Fl(e,t,n)||r)?(e.pieces.delete(t),Vn(e,i,n,r),he(e.movable.events.afterNewPiece,i.role,n,{premove:!1,predrop:!1})):i&&zl(e,t,n)?Wl(e,i.role,n):(Ke(e),De(e)),e.pieces.delete(t),ge(e)}function Pn(e,t,n){if(he(e.events.select,t),e.selected){if(e.selected===t&&!e.draggable.enabled){ge(e),e.hold.cancel();return}else if((e.selectable.enabled||n)&&e.selected!==t&&Fi(e,e.selected,t)){e.stats.dragged=!1;return}}(e.selectable.enabled||e.draggable.enabled)&&(Gi(e,t)||Xn(e,t))&&(zi(e,t),e.hold.start())}function zi(e,t){e.selected=t,Xn(e,t)?e.premovable.dests=ji(e.pieces,t,e.premovable.castle):e.premovable.dests=void 0}function ge(e){e.selected=void 0,e.premovable.dests=void 0,e.hold.cancel()}function Gi(e,t){const n=e.pieces.get(t);return!!n&&(e.movable.color==="both"||e.movable.color===n.color&&e.turnColor===n.color)}const Yn=(e,t,n)=>{var r,i;return t!==n&&Gi(e,t)&&(e.movable.free||!!(!((i=(r=e.movable.dests)===null||r===void 0?void 0:r.get(t))===null||i===void 0)&&i.includes(n)))};function Fl(e,t,n){const r=e.pieces.get(t);return!!r&&(t===n||!e.pieces.has(n))&&(e.movable.color==="both"||e.movable.color===r.color&&e.turnColor===r.color)}function Xn(e,t){const n=e.pieces.get(t);return!!n&&e.premovable.enabled&&e.movable.color===n.color&&e.turnColor!==n.color}const Ul=(e,t,n)=>t!==n&&Xn(e,t)&&ji(e.pieces,t,e.premovable.castle).includes(n);function zl(e,t,n){const r=e.pieces.get(t),i=e.pieces.get(n);return!!r&&(!i||i.color!==e.movable.color)&&e.predroppable.enabled&&(r.role!=="pawn"||n[1]!=="1"&&n[1]!=="8")&&e.movable.color===r.color&&e.turnColor!==r.color}function Gl(e,t){const n=e.pieces.get(t);return!!n&&e.draggable.enabled&&(e.movable.color==="both"||e.movable.color===n.color&&(e.turnColor===n.color||e.premovable.enabled))}function Ql(e){const t=e.premovable.current;if(!t)return!1;const n=t[0],r=t[1];let i=!1;if(Yn(e,n,r)){const s=Hi(e,n,r);if(s){const l={premove:!0};s!==!0&&(l.captured=s),he(e.movable.events.after,n,r,l),i=!0}}return Ke(e),i}function Vl(e,t){const n=e.predroppable.current;let r=!1;if(!n)return!1;if(t(n)){const i={role:n.role,color:e.movable.color};Vn(e,i,n.key)&&(he(e.movable.events.afterNewPiece,n.role,n.key,{premove:!1,predrop:!0}),r=!0)}return De(e),r}function Zn(e){Ke(e),De(e),ge(e)}function br(e){e.movable.color=e.movable.dests=e.animation.current=void 0,Zn(e)}function Je(e,t,n){let r=Math.floor(8*(e[0]-n.left)/n.width);t||(r=7-r);let i=7-Math.floor(8*(e[1]-n.top)/n.height);return t||(i=7-i),r>=0&&r<8&&i>=0&&i<8?me([r,i]):void 0}function Yl(e,t,n,r){const i=ee(e),s=Oi.filter(u=>Bi(i[0],i[1],u[0],u[1])||Ri(i[0],i[1],u[0],u[1])),o=s.map(u=>Ii(me(u),n,r)).map(u=>kt(t,u)),[,c]=o.reduce((u,h,p)=>u[0]<h?u:[h,p],[o[0],0]);return me(s[c])}const fe=e=>e.orientation==="white",Qi="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",Xl={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king"},Zl={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};function Vi(e){e==="start"&&(e=Qi);const t=new Map;let n=7,r=0;for(const i of e)switch(i){case" ":case"[":return t;case"/":if(--n,n<0)return t;r=0;break;case"~":{const s=t.get(me([r-1,n]));s&&(s.promoted=!0);break}default:{const s=i.charCodeAt(0);if(s<57)r+=s-48;else{const l=i.toLowerCase();t.set(me([r,n]),{role:Xl[l],color:i===l?"black":"white"}),++r}}}return t}function Jl(e){return Tl.map(t=>Fn.map(n=>{const r=e.get(n+t);if(r){let i=Zl[r.role];return r.color==="white"&&(i=i.toUpperCase()),r.promoted&&(i+="~"),i}else return"1"}).join("")).join("/").replace(/1{2,}/g,t=>t.length.toString())}function Yi(e,t){t.animation&&(Jn(e.animation,t.animation),(e.animation.duration||0)<70&&(e.animation.enabled=!1))}function Xi(e,t){var n,r,i;if(!((n=t.movable)===null||n===void 0)&&n.dests&&(e.movable.dests=void 0),!((r=t.drawable)===null||r===void 0)&&r.autoShapes&&(e.drawable.autoShapes=[]),Jn(e,t),t.fen&&(e.pieces=Vi(t.fen),e.drawable.shapes=((i=t.drawable)===null||i===void 0?void 0:i.shapes)||[]),"check"in t&&Bl(e,t.check||!1),"lastMove"in t&&!t.lastMove?e.lastMove=void 0:t.lastMove&&(e.lastMove=t.lastMove),e.selected&&zi(e,e.selected),Yi(e,t),!e.movable.rookCastle&&e.movable.dests){const s=e.movable.color==="white"?"1":"8",l="e"+s,o=e.movable.dests.get(l),c=e.pieces.get(l);if(!o||!c||c.role!=="king")return;e.movable.dests.set(l,o.filter(u=>!(u==="a"+s&&o.includes("c"+s))&&!(u==="h"+s&&o.includes("g"+s))))}}function Jn(e,t){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(Object.prototype.hasOwnProperty.call(e,n)&&yr(e[n])&&yr(t[n])?Jn(e[n],t[n]):e[n]=t[n])}function yr(e){if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return t===Object.prototype||t===null}const Be=(e,t)=>t.animation.enabled?na(e,t):Ne(e,t);function Ne(e,t){const n=e(t);return t.dom.redraw(),n}const vn=(e,t)=>({key:e,pos:ee(e),piece:t}),ea=(e,t)=>t.sort((n,r)=>kt(e.pos,n.pos)-kt(e.pos,r.pos))[0];function ta(e,t){const n=new Map,r=[],i=new Map,s=[],l=[],o=new Map;let c,u,h;for(const[p,b]of e)o.set(p,vn(p,b));for(const p of zn)c=t.pieces.get(p),u=o.get(p),c?u?$n(c,u.piece)||(s.push(u),l.push(vn(p,c))):l.push(vn(p,c)):u&&s.push(u);for(const p of l)u=ea(p,s.filter(b=>$n(p.piece,b.piece))),u&&(h=[u.pos[0]-p.pos[0],u.pos[1]-p.pos[1]],n.set(p.key,h.concat(h)),r.push(u.key));for(const p of s)r.includes(p.key)||i.set(p.key,p.piece);return{anims:n,fadings:i}}function Zi(e,t){const n=e.animation.current;if(n===void 0){e.dom.destroyed||e.dom.redrawNow();return}const r=1-(t-n.start)*n.frequency;if(r<=0)e.animation.current=void 0,e.dom.redrawNow();else{const i=ra(r);for(const s of n.plan.anims.values())s[2]=s[0]*i,s[3]=s[1]*i;e.dom.redrawNow(!0),requestAnimationFrame((s=performance.now())=>Zi(e,s))}}function na(e,t){const n=new Map(t.pieces),r=e(t),i=ta(n,t);if(i.anims.size||i.fadings.size){const s=t.animation.current&&t.animation.current.start;t.animation.current={start:performance.now(),frequency:1/t.animation.duration,plan:i},s||Zi(t,performance.now())}else t.dom.redraw();return r}const ra=e=>e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1,ia=["green","red","blue","yellow"];function sa(e,t){if(t.touches&&t.touches.length>1)return;t.stopPropagation(),t.preventDefault(),t.ctrlKey?ge(e):Zn(e);const n=Ze(t),r=Je(n,fe(e),e.dom.bounds());r&&(e.drawable.current={orig:r,pos:n,brush:ca(t),snapToValidMove:e.drawable.defaultSnapToValidMove},Ji(e))}function Ji(e){requestAnimationFrame(()=>{const t=e.drawable.current;if(t){const n=Je(t.pos,fe(e),e.dom.bounds());n||(t.snapToValidMove=!1);const r=t.snapToValidMove?Yl(t.orig,t.pos,fe(e),e.dom.bounds()):n;r!==t.mouseSq&&(t.mouseSq=r,t.dest=r!==t.orig?r:void 0,e.dom.redrawNow()),Ji(e)}})}function oa(e,t){e.drawable.current&&(e.drawable.current.pos=Ze(t))}function la(e){const t=e.drawable.current;t&&(t.mouseSq&&ua(e.drawable,t),es(e))}function es(e){e.drawable.current&&(e.drawable.current=void 0,e.dom.redraw())}function aa(e){e.drawable.shapes.length&&(e.drawable.shapes=[],e.dom.redraw(),ts(e.drawable))}function ca(e){var t;const n=(e.shiftKey||e.ctrlKey)&&qi(e),r=e.altKey||e.metaKey||((t=e.getModifierState)===null||t===void 0?void 0:t.call(e,"AltGraph"));return ia[(n?1:0)+(r?2:0)]}function ua(e,t){const n=i=>i.orig===t.orig&&i.dest===t.dest,r=e.shapes.find(n);r&&(e.shapes=e.shapes.filter(i=>!n(i))),(!r||r.brush!==t.brush)&&e.shapes.push({orig:t.orig,dest:t.dest,brush:t.brush}),ts(e)}function ts(e){e.onChange&&e.onChange(e.shapes)}function ha(e,t){if(!t.isTrusted||t.button!==void 0&&t.button!==0||t.touches&&t.touches.length>1)return;const n=e.dom.bounds(),r=Ze(t),i=Je(r,fe(e),n);if(!i)return;const s=e.pieces.get(i),l=e.selected;!l&&e.drawable.enabled&&(e.drawable.eraseOnClick||!s||s.color!==e.turnColor)&&aa(e),t.cancelable!==!1&&(!t.touches||e.blockTouchScroll||s||l||fa(e,r))&&t.preventDefault();const o=!!e.premovable.current,c=!!e.predroppable.current;e.stats.ctrlKey=t.ctrlKey,e.selected&&Yn(e,e.selected,i)?Be(p=>Pn(p,i),e):Pn(e,i);const u=e.selected===i,h=rs(e,i);if(s&&h&&u&&Gl(e,i)){e.draggable.current={orig:i,piece:s,origPos:r,pos:r,started:e.draggable.autoDistance&&e.stats.dragged,element:h,previouslySelected:l,originTarget:t.target,keyHasChanged:!1},h.cgDragging=!0,h.classList.add("dragging");const p=e.dom.elements.ghost;p&&(p.className=`ghost ${s.color} ${s.role}`,Se(p,At(n)(ee(i),fe(e))),Qn(p,!0)),er(e)}else o&&Ke(e),c&&De(e);e.dom.redraw()}function fa(e,t){const n=fe(e),r=e.dom.bounds(),i=Math.pow(r.width/8,2);for(const s of e.pieces.keys()){const l=Ii(s,n,r);if(kt(l,t)<=i)return!0}return!1}function da(e,t,n,r){const i="a0";e.pieces.set(i,t),e.dom.redraw();const s=Ze(n);e.draggable.current={orig:i,piece:t,origPos:s,pos:s,started:!0,element:()=>rs(e,i),originTarget:n.target,newPiece:!0,force:!!r,keyHasChanged:!1},er(e)}function er(e){requestAnimationFrame(()=>{var t;const n=e.draggable.current;if(!n)return;!((t=e.animation.current)===null||t===void 0)&&t.plan.anims.has(n.orig)&&(e.animation.current=void 0);const r=e.pieces.get(n.orig);if(!r||!$n(r,n.piece))Ut(e);else if(!n.started&&kt(n.pos,n.origPos)>=Math.pow(e.draggable.distance,2)&&(n.started=!0),n.started){if(typeof n.element=="function"){const s=n.element();if(!s)return;s.cgDragging=!0,s.classList.add("dragging"),n.element=s}const i=e.dom.bounds();Se(n.element,[n.pos[0]-i.left-i.width/16,n.pos[1]-i.top-i.height/16]),n.keyHasChanged||(n.keyHasChanged=n.orig!==Je(n.pos,fe(e),i))}er(e)})}function pa(e,t){e.draggable.current&&(!t.touches||t.touches.length<2)&&(e.draggable.current.pos=Ze(t))}function ma(e,t){const n=e.draggable.current;if(!n)return;if(t.type==="touchend"&&t.cancelable!==!1&&t.preventDefault(),t.type==="touchend"&&n.originTarget!==t.target&&!n.newPiece){e.draggable.current=void 0;return}Ke(e),De(e);const r=Ze(t)||n.pos,i=Je(r,fe(e),e.dom.bounds());i&&n.started&&n.orig!==i?n.newPiece?Ui(e,n.orig,i,n.force):(e.stats.ctrlKey=t.ctrlKey,Fi(e,n.orig,i)&&(e.stats.dragged=!0)):n.newPiece?e.pieces.delete(n.orig):e.draggable.deleteOnDropOff&&!i&&(e.pieces.delete(n.orig),he(e.events.change)),(n.orig===n.previouslySelected||n.keyHasChanged)&&(n.orig===i||!i)?ge(e):e.selectable.enabled||ge(e),ns(e),e.draggable.current=void 0,e.dom.redraw()}function Ut(e){const t=e.draggable.current;t&&(t.newPiece&&e.pieces.delete(t.orig),e.draggable.current=void 0,ge(e),ns(e),e.dom.redraw())}function ns(e){const t=e.dom.elements;t.ghost&&Qn(t.ghost,!1)}function rs(e,t){let n=e.dom.elements.board.firstChild;for(;n;){if(n.cgKey===t&&n.tagName==="PIECE")return n;n=n.nextSibling}}function ga(e,t){e.exploding={stage:1,keys:t},e.dom.redraw(),setTimeout(()=>{wr(e,2),setTimeout(()=>wr(e,void 0),120)},120)}function wr(e,t){e.exploding&&(t?e.exploding.stage=t:e.exploding=void 0,e.dom.redraw())}function va(e,t){function n(){Kl(e),t()}return{set(r){r.orientation&&r.orientation!==e.orientation&&n(),Yi(e,r),(r.fen?Be:Ne)(i=>Xi(i,r),e)},state:e,getFen:()=>Jl(e.pieces),toggleOrientation:n,setPieces(r){Be(i=>Dl(i,r),e)},selectSquare(r,i){r?Be(s=>Pn(s,r,i),e):e.selected&&(ge(e),e.dom.redraw())},move(r,i){Be(s=>Wi(s,r,i),e)},newPiece(r,i){Be(s=>Vn(s,r,i),e)},playPremove(){if(e.premovable.current){if(Be(Ql,e))return!0;e.dom.redraw()}return!1},playPredrop(r){if(e.predroppable.current){const i=Vl(e,r);return e.dom.redraw(),i}return!1},cancelPremove(){Ne(Ke,e)},cancelPredrop(){Ne(De,e)},cancelMove(){Ne(r=>{Zn(r),Ut(r)},e)},stop(){Ne(r=>{br(r),Ut(r)},e)},explode(r){ga(e,r)},setAutoShapes(r){Ne(i=>i.drawable.autoShapes=r,e)},setShapes(r){Ne(i=>i.drawable.shapes=r,e)},getKeyAtDomPos(r){return Je(r,fe(e),e.dom.bounds())},redrawAll:t,dragNewPiece(r,i,s){da(e,r,i,s)},destroy(){br(e),e.dom.unbind&&e.dom.unbind(),e.dom.destroyed=!0}}}function _a(){return{pieces:Vi(Qi),orientation:"white",turnColor:"white",coordinates:!0,ranksPosition:"right",autoCastle:!0,viewOnly:!1,disableContextMenu:!1,addPieceZIndex:!1,blockTouchScroll:!1,pieceKey:!1,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200},movable:{free:!0,color:"both",showDests:!0,events:{},rookCastle:!0},premovable:{enabled:!0,showDests:!0,castle:!0,events:{}},predroppable:{enabled:!1,events:{}},draggable:{enabled:!0,distance:3,autoDistance:!0,showGhost:!0,deleteOnDropOff:!1},dropmode:{active:!1},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{},drawable:{enabled:!0,visible:!0,defaultSnapToValidMove:!0,eraseOnClick:!0,shapes:[],autoShapes:[],brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15}},prevSvgHash:""},hold:Ll()}}function En(e,t,n){const r=new Map,i=[];for(const o of e)r.set(o.hash,!1);let s=t.firstChild,l;for(;s;)l=s.getAttribute("cgHash"),r.has(l)?r.set(l,!0):i.push(s),s=s.nextSibling;for(const o of i)t.removeChild(o);for(const o of e)r.get(o.hash)||t.appendChild(n(o))}function _e(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function ba(e,t,n){const r=e.drawable,i=r.current,s=i&&i.mouseSq?i:void 0,l=new Map,o=e.dom.bounds(),c=r.autoShapes.filter(v=>!v.piece);for(const v of r.shapes.concat(c).concat(s?[s]:[]))v.dest&&l.set(v.dest,(l.get(v.dest)||0)+1);const u=r.shapes.concat(c).map(v=>({shape:v,current:!1,hash:kr(v,l,!1,o)}));s&&u.push({shape:s,current:!0,hash:kr(s,l,!0,o)});const h=u.map(v=>v.hash).join(";");if(h===e.drawable.prevSvgHash)return;e.drawable.prevSvgHash=h;const p=t.querySelector("defs"),b=t.querySelector("g"),k=n.querySelector("g");ya(r,u,p),En(u.filter(v=>!v.shape.customSvg),b,v=>Sr(e,v,r.brushes,l,o)),En(u.filter(v=>v.shape.customSvg),k,v=>Sr(e,v,r.brushes,l,o))}function ya(e,t,n){const r=new Map;let i;for(const o of t)o.shape.dest&&(i=e.brushes[o.shape.brush],o.shape.modifiers&&(i=is(i,o.shape.modifiers)),r.set(i.key,i));const s=new Set;let l=n.firstChild;for(;l;)s.add(l.getAttribute("cgKey")),l=l.nextSibling;for(const[o,c]of r.entries())s.has(o)||n.appendChild(Ea(c))}function kr({orig:e,dest:t,brush:n,piece:r,modifiers:i,customSvg:s},l,o,c){return[c.width,c.height,o,e,t,n,t&&(l.get(t)||0)>1,r&&wa(r),i&&ka(i),s&&Sa(s)].filter(u=>u).join(",")}function wa(e){return[e.color,e.role,e.scale].filter(t=>t).join(",")}function ka(e){return""+(e.lineWidth||"")}function Sa(e){let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n)>>>0;return"custom-"+t.toString()}function Sr(e,{shape:t,current:n,hash:r},i,s,l){let o;const c=Cr(ee(t.orig),e.orientation);if(t.customSvg)o=Ca(t.customSvg,c,l);else if(t.dest){let u=i[t.brush];t.modifiers&&(u=is(u,t.modifiers)),o=Pa(u,c,Cr(ee(t.dest),e.orientation),n,(s.get(t.dest)||0)>1,l)}else o=$a(i[t.brush],c,n,l);return o.setAttribute("cgHash",r),o}function Ca(e,t,n){const[r,i]=zt(t,n),s=Le(_e("g"),{transform:`translate(${r},${i})`}),l=Le(_e("svg"),{width:1,height:1,viewBox:"0 0 100 100"});return s.appendChild(l),l.innerHTML=e,s}function $a(e,t,n,r){const i=zt(t,r),s=Aa(),l=(r.width+r.height)/(4*Math.max(r.width,r.height));return Le(_e("circle"),{stroke:e.color,"stroke-width":s[n?0:1],fill:"none",opacity:ss(e,n),cx:i[0],cy:i[1],r:l-s[1]/2})}function Pa(e,t,n,r,i,s){const l=Ma(i&&!r),o=zt(t,s),c=zt(n,s),u=c[0]-o[0],h=c[1]-o[1],p=Math.atan2(h,u),b=Math.cos(p)*l,k=Math.sin(p)*l;return Le(_e("line"),{stroke:e.color,"stroke-width":xa(e,r),"stroke-linecap":"round","marker-end":"url(#arrowhead-"+e.key+")",opacity:ss(e,r),x1:o[0],y1:o[1],x2:c[0]-b,y2:c[1]-k})}function Ea(e){const t=Le(_e("marker"),{id:"arrowhead-"+e.key,orient:"auto",markerWidth:4,markerHeight:8,refX:2.05,refY:2.01});return t.appendChild(Le(_e("path"),{d:"M0,0 V4 L3,2 Z",fill:e.color})),t.setAttribute("cgKey",e.key),t}function Le(e,t){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.setAttribute(n,t[n]);return e}function Cr(e,t){return t==="white"?e:[7-e[0],7-e[1]]}function is(e,t){return{color:e.color,opacity:Math.round(e.opacity*10)/10,lineWidth:Math.round(t.lineWidth||e.lineWidth),key:[e.key,t.lineWidth].filter(n=>n).join("")}}function Aa(){return[3/64,4/64]}function xa(e,t){return(e.lineWidth||10)*(t?.85:1)/64}function ss(e,t){return(e.opacity||1)*(t?.9:1)}function Ma(e){return(e?20:10)/64}function zt(e,t){const n=Math.min(1,t.width/t.height),r=Math.min(1,t.height/t.width);return[(e[0]-3.5)*n,(3.5-e[1])*r]}function Na(e,t){e.innerHTML="",e.classList.add("cg-wrap");for(const c of Nl)e.classList.toggle("orientation-"+c,t.orientation===c);e.classList.toggle("manipulable",!t.viewOnly);const n=Pe("cg-container");e.appendChild(n);const r=Pe("cg-board");n.appendChild(r);let i,s,l;if(t.drawable.visible&&(i=Le(_e("svg"),{class:"cg-shapes",viewBox:"-4 -4 8 8",preserveAspectRatio:"xMidYMid slice"}),i.appendChild(_e("defs")),i.appendChild(_e("g")),s=Le(_e("svg"),{class:"cg-custom-svgs",viewBox:"-3.5 -3.5 8 8",preserveAspectRatio:"xMidYMid slice"}),s.appendChild(_e("g")),l=Pe("cg-auto-pieces"),n.appendChild(i),n.appendChild(s),n.appendChild(l)),t.coordinates){const c=t.orientation==="black"?" black":"",u=t.ranksPosition==="left"?" left":"";n.appendChild($r(Un,"ranks"+c+u)),n.appendChild($r(Fn,"files"+c))}let o;return t.draggable.enabled&&t.draggable.showGhost&&(o=Pe("piece","ghost"),Qn(o,!1),n.appendChild(o)),{board:r,container:n,wrap:e,ghost:o,svg:i,customSvg:s,autoPieces:l}}function $r(e,t){const n=Pe("coords",t);let r;for(const i of e)r=Pe("coord"),r.textContent=i,n.appendChild(r);return n}function Ta(e,t){if(!e.dropmode.active)return;Ke(e),De(e);const n=e.dropmode.piece;if(n){e.pieces.set("a0",n);const r=Ze(t),i=r&&Je(r,fe(e),e.dom.bounds());i&&Ui(e,"a0",i)}e.dom.redraw()}function Oa(e,t){const n=e.dom.elements.board;if("ResizeObserver"in window&&new ResizeObserver(t).observe(e.dom.elements.wrap),(e.disableContextMenu||e.drawable.enabled)&&n.addEventListener("contextmenu",i=>i.preventDefault()),e.viewOnly)return;const r=qa(e);n.addEventListener("touchstart",r,{passive:!1}),n.addEventListener("mousedown",r,{passive:!1})}function La(e,t){const n=[];if("ResizeObserver"in window||n.push(ht(document.body,"chessground.resize",t)),!e.viewOnly){const r=Pr(e,pa,oa),i=Pr(e,ma,la);for(const l of["touchmove","mousemove"])n.push(ht(document,l,r));for(const l of["touchend","mouseup"])n.push(ht(document,l,i));const s=()=>e.dom.bounds.clear();n.push(ht(document,"scroll",s,{capture:!0,passive:!0})),n.push(ht(window,"resize",s,{passive:!0}))}return()=>n.forEach(r=>r())}function ht(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}const qa=e=>t=>{e.draggable.current?Ut(e):e.drawable.current?es(e):t.shiftKey||qi(t)?e.drawable.enabled&&sa(e,t):e.viewOnly||(e.dropmode.active?Ta(e,t):ha(e,t))},Pr=(e,t,n)=>r=>{e.drawable.current?e.drawable.enabled&&n(e,r):e.viewOnly||t(e,r)};function Ia(e){const t=fe(e),n=At(e.dom.bounds()),r=e.dom.elements.board,i=e.pieces,s=e.animation.current,l=s?s.plan.anims:new Map,o=s?s.plan.fadings:new Map,c=e.draggable.current,u=Ka(e),h=new Set,p=new Set,b=new Map,k=new Map;let v,P,E,x,S,$,q,T,B,j;for(P=r.firstChild;P;){if(v=P.cgKey,os(P))if(E=i.get(v),S=l.get(v),$=o.get(v),x=P.cgPiece,P.cgDragging&&(!c||c.orig!==v)&&(P.classList.remove("dragging"),Se(P,n(ee(v),t)),P.cgDragging=!1),!$&&P.cgFading&&(P.cgFading=!1,P.classList.remove("fading")),E){if(S&&P.cgAnimating&&x===ft(E)){const K=ee(v);K[0]+=S[2],K[1]+=S[3],P.classList.add("anim"),Se(P,n(K,t))}else P.cgAnimating&&(P.cgAnimating=!1,P.classList.remove("anim"),Se(P,n(ee(v),t)),e.addPieceZIndex&&(P.style.zIndex=_n(ee(v),t)));x===ft(E)&&(!$||!P.cgFading)?h.add(v):$&&x===ft($)?(P.classList.add("fading"),P.cgFading=!0):bn(b,x,P)}else bn(b,x,P);else if(ls(P)){const K=P.className;u.get(v)===K?p.add(v):bn(k,K,P)}P=P.nextSibling}for(const[K,re]of u)if(!p.has(K)){B=k.get(re),j=B&&B.pop();const A=n(ee(K),t);if(j)j.cgKey=K,Se(j,A);else{const N=Pe("square",re);N.cgKey=K,Se(N,A),r.insertBefore(N,r.firstChild)}}for(const[K,re]of i)if(S=l.get(K),!h.has(K))if(q=b.get(ft(re)),T=q&&q.pop(),T){T.cgKey=K,T.cgFading&&(T.classList.remove("fading"),T.cgFading=!1);const A=ee(K);e.addPieceZIndex&&(T.style.zIndex=_n(A,t)),S&&(T.cgAnimating=!0,T.classList.add("anim"),A[0]+=S[2],A[1]+=S[3]),Se(T,n(A,t))}else{const A=ft(re),N=Pe("piece",A),W=ee(K);N.cgPiece=A,N.cgKey=K,S&&(N.cgAnimating=!0,W[0]+=S[2],W[1]+=S[3]),Se(N,n(W,t)),e.addPieceZIndex&&(N.style.zIndex=_n(W,t)),r.appendChild(N)}for(const K of b.values())Ar(e,K);for(const K of k.values())Ar(e,K)}function Ra(e){const t=fe(e),n=At(e.dom.bounds());let r=e.dom.elements.board.firstChild;for(;r;)(os(r)&&!r.cgAnimating||ls(r))&&Se(r,n(ee(r.cgKey),t)),r=r.nextSibling}function Er(e){var t,n;const r=e.dom.elements.wrap.getBoundingClientRect(),i=e.dom.elements.container,s=r.height/r.width,l=Math.floor(r.width*window.devicePixelRatio/8)*8/window.devicePixelRatio,o=l*s;i.style.width=l+"px",i.style.height=o+"px",e.dom.bounds.clear(),(t=e.addDimensionsCssVarsTo)===null||t===void 0||t.style.setProperty("--cg-width",l+"px"),(n=e.addDimensionsCssVarsTo)===null||n===void 0||n.style.setProperty("--cg-height",o+"px")}const os=e=>e.tagName==="PIECE",ls=e=>e.tagName==="SQUARE";function Ar(e,t){for(const n of t)e.dom.elements.board.removeChild(n)}function _n(e,t){const r=e[1];return`${t?3+7-r:3+r}`}const ft=e=>`${e.color} ${e.role}`;function Ka(e){var t;const n=new Map;if(e.lastMove&&e.highlight.lastMove)for(const s of e.lastMove)Me(n,s,"last-move");if(e.check&&e.highlight.check&&Me(n,e.check,"check"),e.selected&&(Me(n,e.selected,"selected"),e.movable.showDests)){const s=(t=e.movable.dests)===null||t===void 0?void 0:t.get(e.selected);if(s)for(const o of s)Me(n,o,"move-dest"+(e.pieces.has(o)?" oc":""));const l=e.premovable.dests;if(l)for(const o of l)Me(n,o,"premove-dest"+(e.pieces.has(o)?" oc":""))}const r=e.premovable.current;if(r)for(const s of r)Me(n,s,"current-premove");else e.predroppable.current&&Me(n,e.predroppable.current.key,"current-premove");const i=e.exploding;if(i)for(const s of i.keys)Me(n,s,"exploding"+i.stage);return n}function Me(e,t,n){const r=e.get(t);r?e.set(t,`${r} ${n}`):e.set(t,n)}function bn(e,t,n){const r=e.get(t);r?r.push(n):e.set(t,[n])}function Da(e,t){const r=e.drawable.autoShapes.filter(i=>i.piece).map(i=>({shape:i,hash:Wa(i),current:!1}));En(r,t,i=>ja(e,i,e.dom.bounds()))}function Ba(e){var t;const n=fe(e),r=At(e.dom.bounds());let i=(t=e.dom.elements.autoPieces)===null||t===void 0?void 0:t.firstChild;for(;i;)Li(i,r(ee(i.cgKey),n),i.cgScale),i=i.nextSibling}function ja(e,{shape:t,hash:n},r){var i,s,l;const o=t.orig,c=(i=t.piece)===null||i===void 0?void 0:i.role,u=(s=t.piece)===null||s===void 0?void 0:s.color,h=(l=t.piece)===null||l===void 0?void 0:l.scale,p=Pe("piece",`${c} ${u}`);return p.setAttribute("cgHash",n),p.cgKey=o,p.cgScale=h,Li(p,At(r)(ee(o),fe(e)),h),p}const Wa=e=>{var t,n,r;return[e.orig,(t=e.piece)===null||t===void 0?void 0:t.role,(n=e.piece)===null||n===void 0?void 0:n.color,(r=e.piece)===null||r===void 0?void 0:r.scale].join(",")};function Ha(e,t){const n=_a();Xi(n,t||{});function r(){const i="dom"in n?n.dom.unbind:void 0,s=Na(e,n),l=Ol(()=>s.board.getBoundingClientRect()),o=h=>{Ia(u),s.autoPieces&&Da(u,s.autoPieces),!h&&s.svg&&ba(u,s.svg,s.customSvg)},c=()=>{Er(u),Ra(u),s.autoPieces&&Ba(u)},u=n;return u.dom={elements:s,bounds:l,redraw:Fa(o),redrawNow:o,unbind:i},u.drawable.prevSvgHash="",Er(u),o(!1),Oa(u,c),i||(u.dom.unbind=La(u,c)),u.events.insert&&u.events.insert(s),u}return va(r(),r)}function Fa(e){let t=!1;return()=>{t||(t=!0,requestAnimationFrame(()=>{e(),t=!1}))}}const Ua=ne('<div class="is2d"><div> </div></div>'),tr=e=>{let[t,n]=X(void 0,{equals:!1}),r;be(Qe(()=>(t(),e.glyphs),l=>{r&&(l?r.setAutoShapes(l.map(o=>({orig:o.orig,customSvg:za[o.glyph]}))):r.setAutoShapes([]))}));let i=new Map;be(Qe(()=>(t(),e.fen),l=>{if(!r||!l)return;i=new Map,new Ge.Chess(l).moves({verbose:!0}).forEach(c=>{i.get(c.from)||i.set(c.from,[]),i.get(c.from).push(c.to)}),r==null||r.set({fen:l,movable:{dests:i}})}));let s={viewOnly:!e.onUserMove,orientation:e.isBlack?"black":"white",movable:{free:!1,dests:i},events:{move(l,o){var c;(c=e.onUserMove)==null||c.call(e,l+o)}}};return(()=>{const l=Ua.cloneNode(!0),o=l.firstChild;return lt(c=>setTimeout(()=>{r=Ha(c,s),n()}),o),l})()},nt=e=>`
<defs>
  <filter id="shadow">
    <feDropShadow dx="4" dy="7" stdDeviation="5" flood-opacity="0.5" />
  </filter>
</defs>`+e,za={"?!":nt(`
<g transform="translate(77 -18) scale(0.4)">
  <circle style="fill:#56b4e9;filter:url(#shadow)" cx="50" cy="50" r="50" />
  <path fill="#fff" d="M37.734 21.947c-3.714 0-7.128.464-10.242 1.393-3.113.928-6.009 2.13-8.685 3.605l4.343 8.766c2.35-1.202 4.644-2.157 6.883-2.867a22.366 22.366 0 0 1 6.799-1.065c2.294 0 4.07.464 5.326 1.393 1.311.874 1.967 2.186 1.967 3.933 0 1.748-.546 3.277-1.639 4.588-1.038 1.257-2.786 2.758-5.244 4.506-2.786 2.021-4.751 3.961-5.898 5.819-1.147 1.857-1.721 4.15-1.721 6.88v2.952h10.568v-2.377c0-1.147.137-2.103.41-2.868.328-.764.93-1.557 1.803-2.376.874-.82 2.104-1.803 3.688-2.95 2.13-1.584 3.906-3.058 5.326-4.424 1.42-1.42 2.485-2.95 3.195-4.59.71-1.638 1.065-3.576 1.065-5.816 0-4.206-1.584-7.675-4.752-10.406-3.114-2.731-7.51-4.096-13.192-4.096zm24.745.819l2.048 39.084h9.75l2.047-39.084zM35.357 68.73c-1.966 0-3.632.52-4.998 1.557-1.365.983-2.047 2.732-2.047 5.244 0 2.404.682 4.152 2.047 5.244 1.366 1.038 3.032 1.557 4.998 1.557 1.912 0 3.55-.519 4.916-1.557 1.366-1.092 2.05-2.84 2.05-5.244 0-2.512-.684-4.26-2.05-5.244-1.365-1.038-3.004-1.557-4.916-1.557zm34.004 0c-1.966 0-3.632.52-4.998 1.557-1.365.983-2.049 2.732-2.049 5.244 0 2.404.684 4.152 2.05 5.244 1.365 1.038 3.03 1.557 4.997 1.557 1.912 0 3.55-.519 4.916-1.557 1.366-1.092 2.047-2.84 2.047-5.244 0-2.512-.681-4.26-2.047-5.244-1.365-1.038-3.004-1.557-4.916-1.557z"/>
</g>
`),"?":nt(`
<g transform="translate(77 -18) scale(0.4)">
  <circle style="fill:#e69f00;filter:url(#shadow)" cx="50" cy="50" r="50" />
  <path fill="#fff" d="M40.436 60.851q0-4.66 1.957-7.83 1.958-3.17 6.712-6.619 4.195-2.983 5.967-5.127 1.864-2.237 1.864-5.22 0-2.983-2.237-4.475-2.144-1.585-6.06-1.585-3.915 0-7.737 1.212t-7.83 3.263l-4.941-9.975q4.568-2.517 9.881-4.101 5.314-1.585 11.653-1.585 9.695 0 15.008 4.661 5.407 4.661 5.407 11.839 0 3.822-1.212 6.619-1.212 2.796-3.635 5.22-2.424 2.33-6.06 5.034-2.703 1.958-4.195 3.356-1.491 1.398-2.05 2.703-.467 1.305-.467 3.263v2.703H40.436zm-1.492 18.924q0-4.288 2.33-5.966 2.331-1.771 5.687-1.771 3.263 0 5.594 1.771 2.33 1.678 2.33 5.966 0 4.102-2.33 5.966-2.331 1.772-5.594 1.772-3.356 0-5.686-1.772-2.33-1.864-2.33-5.966z"/>
</g>
`),"??":nt(`
<g transform="translate(77 -18) scale(0.4)">
  <circle style="fill:#df5353;filter:url(#shadow)" cx="50" cy="50" r="50" />
  <path fill="#fff" d="M31.8 22.22c-3.675 0-7.052.46-10.132 1.38-3.08.918-5.945 2.106-8.593 3.565l4.298 8.674c2.323-1.189 4.592-2.136 6.808-2.838a22.138 22.138 0 0 1 6.728-1.053c2.27 0 4.025.46 5.268 1.378 1.297.865 1.946 2.16 1.946 3.89s-.541 3.242-1.622 4.539c-1.027 1.243-2.756 2.73-5.188 4.458-2.756 2-4.7 3.918-5.836 5.755-1.134 1.837-1.702 4.107-1.702 6.808v2.92h10.457v-2.35c0-1.135.135-2.082.406-2.839.324-.756.918-1.54 1.783-2.35.864-.81 2.079-1.784 3.646-2.918 2.107-1.568 3.863-3.026 5.268-4.376 1.405-1.405 2.46-2.92 3.162-4.541.703-1.621 1.054-3.54 1.054-5.755 0-4.161-1.568-7.592-4.702-10.294-3.08-2.702-7.43-4.052-13.05-4.052zm38.664 0c-3.675 0-7.053.46-10.133 1.38-3.08.918-5.944 2.106-8.591 3.565l4.295 8.674c2.324-1.189 4.593-2.136 6.808-2.838a22.138 22.138 0 0 1 6.728-1.053c2.27 0 4.026.46 5.269 1.378 1.297.865 1.946 2.16 1.946 3.89s-.54 3.242-1.62 4.539c-1.027 1.243-2.757 2.73-5.189 4.458-2.756 2-4.7 3.918-5.835 5.755-1.135 1.837-1.703 4.107-1.703 6.808v2.92h10.457v-2.35c0-1.135.134-2.082.404-2.839.324-.756.918-1.54 1.783-2.35.865-.81 2.081-1.784 3.648-2.918 2.108-1.568 3.864-3.026 5.269-4.376 1.405-1.405 2.46-2.92 3.162-4.541.702-1.621 1.053-3.54 1.053-5.755 0-4.161-1.567-7.592-4.702-10.294-3.08-2.702-7.43-4.052-13.05-4.052zM29.449 68.504c-1.945 0-3.593.513-4.944 1.54-1.351.973-2.027 2.703-2.027 5.188 0 2.378.676 4.108 2.027 5.188 1.35 1.027 3 1.54 4.944 1.54 1.892 0 3.512-.513 4.863-1.54 1.35-1.08 2.026-2.81 2.026-5.188 0-2.485-.675-4.215-2.026-5.188-1.351-1.027-2.971-1.54-4.863-1.54zm38.663 0c-1.945 0-3.592.513-4.943 1.54-1.35.973-2.026 2.703-2.026 5.188 0 2.378.675 4.108 2.026 5.188 1.351 1.027 2.998 1.54 4.943 1.54 1.891 0 3.513-.513 4.864-1.54 1.351-1.08 2.027-2.81 2.027-5.188 0-2.485-.676-4.215-2.027-5.188-1.35-1.027-2.973-1.54-4.864-1.54z"/>
</g>
`),"!?":nt(`
<g transform="translate(77 -18) scale(0.4)">
  <circle style="fill:#ea45d8;filter:url(#shadow)" cx="50" cy="50" r="50"/>
    <path fill="#fff" d="M60.823 58.9q0-4.098 1.72-6.883 1.721-2.786 5.9-5.818 3.687-2.622 5.243-4.506 1.64-1.966 1.64-4.588t-1.967-3.933q-1.885-1.393-5.326-1.393t-6.8 1.065q-3.36 1.065-6.883 2.868l-4.343-8.767q4.015-2.212 8.685-3.605 4.67-1.393 10.242-1.393 8.521 0 13.192 4.097 4.752 4.096 4.752 10.405 0 3.36-1.065 5.818-1.066 2.458-3.196 4.588-2.13 2.048-5.326 4.424-2.376 1.72-3.687 2.95-1.31 1.229-1.802 2.376-.41 1.147-.41 2.868v2.376h-10.57zm-1.311 16.632q0-3.77 2.048-5.244 2.049-1.557 4.998-1.557 2.868 0 4.916 1.557 2.049 1.475 2.049 5.244 0 3.605-2.049 5.244-2.048 1.556-4.916 1.556-2.95 0-4.998-1.556-2.048-1.64-2.048-5.244zM36.967 61.849h-9.75l-2.049-39.083h13.847zM25.004 75.532q0-3.77 2.049-5.244 2.048-1.557 4.998-1.557 2.867 0 4.916 1.557 2.048 1.475 2.048 5.244 0 3.605-2.048 5.244-2.049 1.556-4.916 1.556-2.95 0-4.998-1.556-2.049-1.64-2.049-5.244z" vector-effect="non-scaling-stroke"/>
</g>
`),"!":nt(`
<g transform="translate(77 -18) scale(0.4)">
  <circle style="fill:#22ac38;filter:url(#shadow)" cx="50" cy="50" r="50" />
  <path fill="#fff" d="M54.967 62.349h-9.75l-2.049-39.083h13.847zM43.004 76.032q0-3.77 2.049-5.244 2.048-1.557 4.998-1.557 2.867 0 4.916 1.557 2.048 1.475 2.048 5.244 0 3.605-2.048 5.244-2.049 1.556-4.916 1.556-2.95 0-4.998-1.556-2.049-1.64-2.049-5.244z" vector-effect="non-scaling-stroke"/>
</g>
`),"!!":nt(`
<g transform="translate(77 -18) scale(0.4)">
  <circle style="fill:#168226;filter:url(#shadow)" cx="50" cy="50" r="50" />
  <path fill="#fff" d="M71.967 62.349h-9.75l-2.049-39.083h13.847zM60.004 76.032q0-3.77 2.049-5.244 2.048-1.557 4.998-1.557 2.867 0 4.916 1.557 2.048 1.475 2.048 5.244 0 3.605-2.048 5.244-2.049 1.556-4.916 1.556-2.95 0-4.998-1.556-2.049-1.64-2.049-5.244zM37.967 62.349h-9.75l-2.049-39.083h13.847zM26.004 76.032q0-3.77 2.049-5.244 2.048-1.557 4.998-1.557 2.867 0 4.916 1.557 2.048 1.475 2.048 5.244 0 3.605-2.048 5.244-2.049 1.556-4.916 1.556-2.95 0-4.998-1.556-2.049-1.64-2.049-5.244z" vector-effect="non-scaling-stroke"/>
</g>
`)},Ot=e=>e!==void 0,Ga=6,Qa=245;class Va{constructor(){F(this,"engineName");F(this,"work");F(this,"currentEval");F(this,"expectedPvs",1);F(this,"nextWork");F(this,"send");F(this,"options",new Map)}connected(t){this.send=t,this.options=new Map([["Threads","1"],["Hash","16"],["MultiPV","1"],["UCI_Variant","chess"]]),this.send("uci")}setOption(t,n){n=n.toString(),this.send&&this.options.get(t)!==n&&(this.send(`setoption name ${t} value ${n}`),this.options.set(t,n))}disconnected(){this.work&&this.currentEval&&this.work.emit(this.currentEval),this.work=void 0,this.send=void 0}received(t){var r,i;const n=t.trim().split(/\s+/g);if(n[0]==="uciok")this.setOption("UCI_AnalyseMode","true"),this.setOption("Analysis Contempt","Off"),this.setOption("UCI_Chess960","true"),(r=this.send)==null||r.call(this,"ucinewgame"),(i=this.send)==null||i.call(this,"isready");else if(n[0]==="readyok")this.swapWork();else if(n[0]==="id"&&n[1]==="name")this.engineName=n.slice(2).join(" ");else if(n[0]==="bestmove"){this.work&&this.currentEval&&this.work.emit(this.currentEval),this.work=void 0,this.swapWork();return}else if(this.work&&!this.work.stopRequested&&n[0]==="info"){let s=0,l,o=1,c,u,h=!1,p,b=[];for(let E=1;E<n.length;E++)switch(n[E]){case"depth":s=parseInt(n[++E]);break;case"nodes":l=parseInt(n[++E]);break;case"multipv":o=parseInt(n[++E]);break;case"time":c=parseInt(n[++E]);break;case"score":h=n[++E]==="mate",p=parseInt(n[++E]),(n[E+1]==="lowerbound"||n[E+1]==="upperbound")&&(u=n[++E]);break;case"pv":b=n.slice(++E),E=n.length;break}if(h&&!p||(this.expectedPvs<o&&(this.expectedPvs=o),s<Ga||!Ot(l)||!Ot(c)||!Ot(h)||!Ot(p)))return;const k=this.work.threatMode?0:1,v=this.work.ply%2===k?-p:p;if(u&&o===1)return;const P={moves:b,cp:h?void 0:v,mate:h?v:void 0,depth:s};o===1?this.currentEval={fen:this.work.currentFen,maxDepth:this.work.maxDepth,depth:s,knps:l/c,nodes:l,cp:h?void 0:v,mate:h?v:void 0,pvs:[P],millis:c}:this.currentEval&&(this.currentEval.pvs.push(P),this.currentEval.depth=Math.min(this.currentEval.depth,s)),o===this.expectedPvs&&this.currentEval&&(this.work.emit(this.currentEval),s>=this.work.maxDepth&&c>8e3&&l>4e3*Math.exp(this.work.maxDepth*.3)&&this.stop())}}stop(){var t;this.work&&!this.work.stopRequested&&(this.work.stopRequested=!0,(t=this.send)==null||t.call(this,"stop"))}swapWork(){!this.send||this.work||(this.work=this.nextWork,this.nextWork=void 0,this.work&&(this.currentEval=void 0,this.expectedPvs=1,this.setOption("Threads",this.work.threads),this.setOption("Hash",this.work.hashSize||16),this.setOption("MultiPV",Math.max(1,this.work.multiPv)),this.send(["position fen",this.work.initialFen,"moves",...this.work.moves].join(" ")),this.send(this.work.maxDepth>=99?`go depth ${Qa}`:"go movetime 90000")))}compute(t){this.nextWork=t,this.stop(),this.swapWork()}isComputing(){return!!this.work&&!this.work.stopRequested}}const Ya=e=>e,Xa=e=>new Promise((t,n)=>{let r=document.createElement("script");r.onload=()=>{t(void 0)},r.onerror=i=>{n(i)},r.src=e,document.head.append(r)}),Te=class{constructor(t){this.opts=t}getState(){return Te.sf.Stockfish?Te.failed.Stockfish?4:this.getProtocol().engineName?this.getProtocol().isComputing()?3:2:1:0}getProtocol(){return Te.protocols.Stockfish}async boot(){let t="http://"+window.location.host+"/vendor/stockfish-nnue.wasm/";t="https://"+window.location.host+"/vendor/stockfish-nnue.wasm/";const n=t+"stockfish.wasm";let r;r=await new Promise((l,o)=>{fetch(n).then(c=>c.arrayBuffer()).then(c=>l(c))}),await Xa(t+"stockfish.js");const i=await window.Stockfish({wasmBinary:r,locateFile:l=>Ya(t+l),wasmMemory:this.opts.wasmMemory}),s=this.getProtocol();return i.addMessageListener(s.received.bind(s)),s.connected(l=>i.postMessage(l)),i}start(t){this.getProtocol().compute(t),Te.sf.Stockfish||(Te.sf.Stockfish=this.boot().then(()=>{},n=>{console.error(n),Te.failed.Stockfish=!0}))}stop(){this.getProtocol().compute(void 0)}destroy(){this.stop()}};let it=Te;F(it,"failed",{Stockfish:!1}),F(it,"protocols",{Stockfish:new Va}),F(it,"sf",{});const xr="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1";function Za(e){return!!(e.startsWith("O-O")||e.includes("x")||e.toLowerCase()===e)}const as=(e,t)=>{for(;;)try{return new WebAssembly.Memory({shared:!0,initial:e,maximum:t})}catch(n){if(n instanceof RangeError){if(e===t)throw n;t=Math.max(e,Math.floor(t/2))}else throw n}},Ja=()=>{let e="wasm";ec(1,2);const t=1,n=()=>128;return{technology:e,growableSharedMem:!1,supportsNnue:!1,maxThreads:t,maxWasmPages:r=>Math.max(r,32768),maxHashSize:()=>n()}};function ec(e,t){if(typeof SharedArrayBuffer!="function")return;const n=as(e,t);if(n.buffer instanceof SharedArrayBuffer){try{window.postMessage(n.buffer,"*")}catch{return}return n}}class cs{constructor(t){F(this,"worker");F(this,"platform");F(this,"start",(t,n)=>{this.doStart(t,n)});F(this,"doStart",(t,n)=>{var l;const r=n[n.length-1],i=8,s={threads:1,hashSize:this.hashSize(),stopRequested:!1,initialFen:((l=n[0])==null?void 0:l.fen)||xr,moves:[],currentFen:(r==null?void 0:r.fen)||xr,path:t,ply:(r==null?void 0:r.ply)||0,maxDepth:i,multiPv:2,threatMode:!1,emit:o=>{this.opts.emit(o,s)}};for(let o=1;o<n.length;o++){const c=n[o];Za(c.san)?(s.moves=[],s.initialFen=c.fen):s.moves.push(c.uci)}this.worker||(this.worker=new it({wasmMemory:as(2048,this.platform.maxWasmPages(2048))})),this.worker.start(s)});F(this,"stop",()=>{var t;(t=this.worker)==null||t.stop()});F(this,"hashSize",()=>this.platform.maxHashSize());this.opts=t,this.platform=Ja()}}const tc=ne(`<div class="result-wrap"><div class="result"></div>Eval dropped below 2. Game's over.</div>`),nc=ne('<button class="fbt">Analyse on Lichess</button>'),rc=ne('<button class="fbt">Rematch</button>'),ic=ne('<div class="hardcore"><div class="board"></div><div class="table"><div class="ceval"></div><div class="replay"></div><div class="rcontrols"><div class="follow-up"></div></div></div></div>'),sc=ne('<span class="index"></span>'),oc=ne('<div class="move"></div>'),Mr=e=>50+50*(2/(1+Math.exp(- -.00368208*e))-1),Nr=e=>{if(e!==void 0)return Math.abs(e)<10?"!":e<-30?"??":e<-20?"?!":e<-10?"?":void 0},Tr=(e,t)=>e.move(t,{sloppy:!0})||e.move("O-O")||e.move("O-O-O"),lc=()=>{let[e,t]=vo();const n=e.color==="black",r=parseInt(e.level),i=n?"black":"white",s={level:r,color:i},l=i==="white"?"black":"white",o=i[0];let[c,u]=X(new Ge.Chess,{equals:!1}),[h,p]=X(!1),b;const k=I(()=>c().turn()),v=I(()=>c().fen()),P=I(()=>c().pgn()),E=I(()=>{let L=new Ge.Chess;return c().history({verbose:!0}).map((C,a)=>{const f=L.move(C.san);return{ply:a,fen:L.fen(),turn:L.turn(),uci:f.from+f.to,san:f.san}})});I(()=>{let L=E();if(L.length>1)return L[L.length-2].fen});const[x,S]=X(new Map,{equals:!1});let $=new cs({emit(L){L.depth>=r&&S(C=>(C.set(L.fen,L),C))}});be(Qe(v,L=>{$.start("",E())})),be(()=>{E(),h(),b&&b.scrollTo(0,b.scrollHeight)});const q=L=>{const C=x().get(L);if(!(!C||!C.cp||C.depth<r))return C.cp/100},T=I(()=>q(v())||0),B=(L,C)=>{const a=q(L),f=q(C);if(!(a===void 0||f===void 0))return(Mr(a*100)-Mr(f*100))*(n?-1:1)},j=I(()=>{let L=E();if(L.length>=3){let[C,a,f]=L.slice(-3),d=Nr(B(a.fen,C.fen)),g=Nr(B(f.fen,a.fen)),m=[];return C.turn===o&&d&&m.push({orig:a.uci.slice(2),glyph:d}),a.turn===o&&g&&m.push({orig:f.uci.slice(2),glyph:g}),m}return[]});function K(){const L=x().get(v());if(!h()&&L&&k()===l[0]&&L.depth>=r)if((n?T():-T())<-2.1)p(!0);else{let a=L.pvs[0].moves[0];u(f=>(Tr(f,a),f))}setTimeout(K,500)}setTimeout(K,500);const re=I(()=>Math.floor(E().length/2)),A=L=>{u(C=>(Tr(C,L),C))},N=()=>{let L=P(),C=new FormData;C.append("pgn",L);let a="white";fetch("https://lichess.org/api/import",{method:"post",body:C}).then(f=>f.json()).then(f=>{let d=f.url;window.open(`${d}/${a}#${E().length}`,"_blank")})},W=()=>{p(!1),u(new Ge.Chess)};return be(Qe(h,L=>{if(L){let C={moves:E().map(a=>a.uci),color:i};It.check_challenge_game(C,s)}})),[O(tn,{children:" aidchess.com - Hardcore Chess "}),(()=>{const L=ic.cloneNode(!0),C=L.firstChild,a=C.nextSibling,f=a.firstChild,d=f.nextSibling,g=d.nextSibling,m=g.firstChild;return G(C,O(tr,{get glyphs(){return j()},get fen(){return v()},isBlack:n,onUserMove:A})),G(f,()=>-T()),lt(y=>b=y,d),G(d,O(ac,{get steps(){return E()}}),null),G(d,O(Ae,{get when(){return h()},get children(){const y=tc.cloneNode(!0),_=y.firstChild;return G(_,re),y}}),null),G(m,O(Ae,{get when(){return h()},get children(){return[(()=>{const y=nc.cloneNode(!0);return y.$$click=()=>N(),y})(),(()=>{const y=rc.cloneNode(!0);return y.$$click=()=>W(),y})()]}})),L})()]},ac=e=>{let t=I(()=>{let n=e.steps,r=[],i=[];return n.forEach(s=>{r.push(s),s.ply%2===1&&(i.push(r),r=[])}),i});return O(ot,{get each(){return t()},children:n=>[(()=>{const r=sc.cloneNode(!0);return G(r,()=>n[0].ply/2+1),r})(),O(ot,{each:n,children:r=>(()=>{const i=oc.cloneNode(!0);return G(i,()=>r.san),i})()})]})};Pt(["click"]);var cc=Object.defineProperty,uc=(e,t,n)=>t in e?cc(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Z=(e,t,n)=>(uc(e,typeof t!="symbol"?t+"":t,n),n);const st=e=>e[0](),mt=(e,t)=>typeof t=="function"?e[1](t):e[1](n=>t),le=class{constructor(e,t){Z(this,"x"),Z(this,"y"),this.x=e,this.y=t}static get unit(){return new le(1,1)}static get zero(){return new le(0,0)}get vs(){return[this.x,this.y]}get mul_inverse(){return new le(1/this.x,1/this.y)}get inverse(){return new le(-this.x,-this.y)}get half(){return new le(this.x/2,this.y/2)}get length_squared(){return this.x*this.x+this.y*this.y}get length(){return Math.sqrt(this.length_squared)}get normalize(){return this.length===0?le.zero:this.scale(1/this.length)}get perpendicular(){return new le(-this.y,this.x)}get clone(){return new le(this.x,this.y)}get angle(){return Math.atan2(this.y,this.x)}get round(){return le.make(Math.round(this.x),Math.round(this.y))}get floor(){return le.make(Math.floor(this.x),Math.floor(this.y))}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}project_to(e){let t=e.length_squared,n=this.dot(e);return le.make(n*e.x/t,n*e.y/t)}distance(e){return this.sub(e).length}addy(e){return le.make(this.x,this.y+e)}add_angle(e){return le.from_angle(this.angle+e)}scale(e){let{clone:t}=this;return t.scale_in(e)}scale_in(e){return this.x*=e,this.y*=e,this}add(e){let{clone:t}=this;return t.add_in(e)}add_in(e){return this.x+=e.x,this.y+=e.y,this}sub(e){let{clone:t}=this;return t.sub_in(e)}sub_in(e){return this.x-=e.x,this.y-=e.y,this}mul(e){let{clone:t}=this;return t.mul_in(e)}mul_in(e){return this.x*=e.x,this.y*=e.y,this}div(e){let{clone:t}=this;return t.div_in(e)}div_in(e){return this.x/=e.x,this.y/=e.y,this}set_in(e,t=this.y){return this.x=e,this.y=t,this}};let oe=le;Z(oe,"from_angle",e=>new le(Math.cos(e),Math.sin(e))),Z(oe,"make",(e,t)=>new le(e,t));const je=class{constructor(e,t,n,r,i,s){Z(this,"array_t"),Z(this,"a"),Z(this,"b"),Z(this,"c"),Z(this,"d"),Z(this,"tx"),Z(this,"ty"),this.a=e,this.b=t,this.c=n,this.d=r,this.tx=i,this.ty=s,this.array_t=new Float32Array([e,t,0,n,r,0,i,s,1])}static get identity(){return new je(1,0,0,1,0,0)}static get unit(){return je.identity}get clone(){let{a:e,b:t,c:n,d:r,tx:i,ty:s}=this;return new je(e,t,n,r,i,s)}get inverse(){let{a:e,b:t,c:n,d:r,tx:i,ty:s}=this,l=e*r-t*n,o=r/l,c=-t/l,u=-n/l,h=e/l,p=(n*s-r*i)/l,b=-(e*s-t*i)/l;return new je(o,c,u,h,p,b)}rotate_in(e){let t=Math.cos(e),n=Math.sin(e),r=this.a*t-this.b*n,i=this.a*n+this.b*t,s=this.c*t-this.d*n,l=this.c*n+this.d*t,o=this.tx*t-this.ty*n,c=this.tx*n+this.ty*t;return this.a=r,this.b=i,this.c=s,this.d=l,this.tx=o,this.ty=c,this}rotate(e){let{clone:t}=this;return t.rotate_in(e),t}scale(e,t){let n=this.a*e,r=this.b,i=this.c,s=this.d*t,l=this.tx,o=this.ty;return new je(n,r,i,s,l,o)}translate_in(e,t){this.a,this.b,this.c,this.d;let n=e+this.tx,r=t+this.ty;return this.tx=n,this.ty=r,this}translate(e,t){let{clone:n}=this;return n.translate_in(e,t),n}scale_in(e,t){return this.a=e,this.d=t,this}mVec2(e){let t=this.a,n=this.b,r=this.c,i=this.d,s=this.tx,l=this.ty,o=t*e.x+r*e.y+s,c=n*e.x+i*e.y+l;return oe.make(o,c)}mul_in(e){let{a:t,b:n,c:r,d:i,tx:s,ty:l}=this;this.a=e.a*t+e.b*r,this.b=e.a*n+e.b*i,this.c=e.c*t+e.d*r,this.d=e.c*n+e.d*i,this.tx=e.tx*t+e.ty*r+s,this.ty=e.tx*n+e.ty*i+l}set_in(e){let{a:t,b:n,c:r,d:i,tx:s,ty:l}=e;this.a=t,this.b=n,this.c=r,this.d=i,this.tx=s,this.ty=l}transform_in(e,t,n,r=oe.unit.half){this.a=Math.cos(t)*e.x,this.b=Math.sin(t)*e.x,this.c=-Math.sin(t)*e.y,this.d=Math.cos(t)*e.y,this.tx=n.x-(r.x*this.a+r.y*this.c),this.ty=n.y-(r.x*this.b+r.y*this.d)}};let hc=je;Z(hc,"projection",(e,t)=>{let n=0,r=0,i=1/e*2,s=-1/t*2,l=-1,o=1;return new je(i,n,r,s,l,o)});const Gt=class{constructor(e,t){Z(this,"o"),Z(this,"r"),this.o=e,this.r=t}static get unit(){return Gt.make(0,0,1)}scale(e){return Gt.make(this.o.x,this.o.y,this.r*e)}copy_in(e){return this.r=e.r,this.o=e.o,this}add_o_in(e){return this.o.add_in(e),this}};let fc=Gt;Z(fc,"make",(e,t,n)=>new Gt(oe.make(e,t),n));const us=class{constructor(t,n){this.a=t,this.b=n}get center(){return this.b.add(this.a).half}get parallel(){return this.b.sub(this.a).normalize}get normal(){return this.parallel.perpendicular}get angle(){return this.b.sub(this.a).angle}get radius(){return this.length/2}get length(){return this.b.sub(this.a).length}segments(t,n){return t.map((r,i)=>this.a.add(this.normal.scale(n[i]).add(this.parallel.scale(this.length*r))))}};let dc=us;Z(dc,"make",(e,t,n,r)=>new us(oe.make(e,t),oe.make(n,r)));const gt=class{constructor(e){this.vertices=e}static get unit(){return gt.make(0,0,1,1)}get vs(){let{x:e,y:t,w:n,h:r}=this;return[e,t,n,r]}get x1(){return this.vertices[0].x}get y1(){return this.vertices[0].y}get x2(){return this.vertices[2].x}get y2(){return this.vertices[2].y}get x(){return this.x1}get y(){return this.y1}get w(){return this.x2-this.x1}get h(){return this.y2-this.y1}get center(){return oe.make(this.x+this.w/2,this.y+this.h/2)}get vertexData(){return new Float32Array(this.vertices.flatMap(e=>e.vs))}get indices(){return new Uint16Array([0,1,2,0,2,3])}larger(e){return gt.make(this.x-e,this.y-e,this.w+e,this.h+e)}transform(e){return new gt(this.vertices.map(t=>e.mVec2(t)))}};let pc=gt;Z(pc,"make",(e,t,n,r)=>new gt([oe.make(e,t),oe.make(e+n,t),oe.make(e+n,t+r),oe.make(e,t+r)]));let Qt=class hs{constructor(){Z(this,"m_rect"),Z(this,"_$ref"),Z(this,"_$clear_bounds"),this._$clear_bounds=X(void 0,{equals:!1}),this._$ref=X(),this.m_rect=I(()=>{var t;return st(this._$clear_bounds),(t=this.$ref)==null?void 0:t.getBoundingClientRect()})}static get make(){return new hs}get $ref(){return st(this._$ref)}set $ref(t){mt(this._$ref,t)}get_normal_at_abs_pos(t){let{size:n,orig:r}=this;if(n&&r)return t.sub(r).div(n)}get size(){let{rect:t}=this;if(t)return oe.make(t.width,t.height)}get orig(){let{rect:t}=this;if(t)return oe.make(t.x,t.y)}get rect(){return this.m_rect()}$clear_bounds(){mt(this._$clear_bounds,void 0)}};function mc(e){var t;return e.clientX!==void 0&&e.clientY!==void 0?[e.clientX,e.clientY]:(t=e.targetTouches)!=null&&t[0]?[e.targetTouches[0].clientX,e.targetTouches[0].clientY]:[0,0]}class fs{}Z(fs,"init",(e,t=document)=>{const n=k=>{let v=mc(k);return v?oe.make(v[0],v[1]):oe.zero};let{_onDragStart:r,_onDragMove:i,_onDragEnd:s,_onContextMenu:l,_onWheel:o}=e;const c=k=>{r==null||r(n(k),k.buttons===2||k.button===2)},u=k=>{i==null||i(n(k))},h=k=>{s==null||s(n(k))},p=k=>{l&&(k.preventDefault(),l())},b=k=>{o&&(o(Math.sign(k.deltaY)),k.preventDefault())};return t.addEventListener("wheel",b,{passive:!1}),t.addEventListener("touchstart",c,{capture:!0,passive:!1}),t.addEventListener("mousedown",c,{capture:!0,passive:!1}),t.addEventListener("contextmenu",p),document.addEventListener("mousemove",u),document.addEventListener("mouseup",h),document.addEventListener("touchmove",u),document.addEventListener("touchend",h),()=>{t.removeEventListener("wheel",b),t.removeEventListener("touchstart",c),t.removeEventListener("mousedown",c),t.removeEventListener("contextmenu",p),document.removeEventListener("mousemove",u),document.removeEventListener("mouseup",h),document.removeEventListener("touchmove",u),document.removeEventListener("touchend",h)}});const Vt=(e,t)=>{be(Qe(()=>t.$ref,n=>{n&&St(gc(e,n))}))},gc=(e,t)=>{let{on_wheel:n}=e;return fs.init({_onWheel(r){n(r)}},t)},Yt=e=>t=>setTimeout(()=>e.$ref=t),ds="abcdefgh".split(""),nr="87654321".split("");nr.slice(0).reverse();const vc="wb".split(""),_c="rkqbnp".split("");vc.flatMap(e=>_c.map(t=>`${e}${t}`));const rr=ds.flatMap(e=>nr.map(t=>`${e}${t}`)),bc=new Map(rr.map(e=>{let[t,n]=e.split(""),r=ds.indexOf(t),i=nr.indexOf(n);return[e,oe.make(r,i)]})),ps=e=>{let t=bc.get(e);return(t.x+t.y)%2===0},yc=e=>!ps(e);rr.filter(ps);rr.filter(yc);const ms=class{constructor(t){Z(this,"released_positions"),this.free=t,this.released_positions=new Map}acquire_pos(t,n,r=!1){let i=this.released_positions.get(t);if(!r&&i&&i.length>0)return i.sort((s,l)=>l.distance(n)-s.distance(n)),i.pop();{let s=this.free.pop();return s.x=n.x,s.y=n.y,s}}reset_fix_all(){for(let t of this.released_positions.values())t.forEach(n=>this.free.push(n));this.released_positions=new Map}release_pos(t,n){let r=this.released_positions.get(t);r||(r=[],this.released_positions.set(t,r)),r.push(n)}};let wc=ms;Z(wc,"make",e=>new ms(e));var kc=Object.defineProperty,Sc=(e,t,n)=>t in e?kc(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,de=(e,t,n)=>(Sc(e,typeof t!="symbol"?t+"":t,n),n);function Cc(e,t,n){let r=n.length,i=t.length,s=r,l=0,o=0,c=t[i-1].nextSibling,u=null;for(;l<i||o<s;){if(t[l]===n[o]){l++,o++;continue}for(;t[i-1]===n[s-1];)i--,s--;if(i===l){const h=s<r?o?n[o-1].nextSibling:n[s-o]:c;for(;o<s;)e.insertBefore(n[o++],h)}else if(s===o)for(;l<i;)(!u||!u.has(t[l]))&&t[l].remove(),l++;else if(t[l]===n[s-1]&&n[o]===t[i-1]){const h=t[--i].nextSibling;e.insertBefore(n[o++],t[l++].nextSibling),e.insertBefore(n[--s],h),t[i]=n[s]}else{if(!u){u=new Map;let p=o;for(;p<s;)u.set(n[p],p++)}const h=u.get(t[l]);if(h!=null)if(o<h&&h<s){let p=l,b=1,k;for(;++p<i&&p<s&&!((k=u.get(t[p]))==null||k!==h+b);)b++;if(b>h-o){const v=t[l];for(;o<h;)e.insertBefore(n[o++],v)}else e.replaceChild(n[o++],t[l++])}else l++;else t[l++].remove()}}}const Or="_$DX_DELEGATE";function xt(e,t,n){const r=document.createElement("template");r.innerHTML=e;let i=r.content.firstChild;return n&&(i=i.firstChild),i}function $c(e,t=window.document){const n=t[Or]||(t[Or]=new Set);for(let r=0,i=e.length;r<i;r++){const s=e[r];n.has(s)||(n.add(s),t.addEventListener(s,Pc))}}function Lr(e,t){t==null?e.removeAttribute("class"):e.className=t}function Ce(e,t,n,r){if(n!==void 0&&!r&&(r=[]),typeof t!="function")return Xt(e,t,r,n);ae(i=>Xt(e,t(),i,n),r)}function Pc(e){const t=`$$${e.type}`;let n=e.composedPath&&e.composedPath()[0]||e.target;for(e.target!==n&&Object.defineProperty(e,"target",{configurable:!0,value:n}),Object.defineProperty(e,"currentTarget",{configurable:!0,get(){return n||document}}),te.registry&&!te.done&&(te.done=!0,document.querySelectorAll("[id^=pl-]").forEach(r=>r.remove()));n!==null;){const r=n[t];if(r&&!n.disabled){const i=n[`${t}Data`];if(i!==void 0?r.call(n,i,e):r.call(n,e),e.cancelBubble)return}n=n.host&&n.host!==n&&n.host instanceof Node?n.host:n.parentNode}}function Xt(e,t,n,r,i){for(te.context&&!n&&(n=[...e.childNodes]);typeof n=="function";)n=n();if(t===n)return n;const s=typeof t,l=r!==void 0;if(e=l&&n[0]&&n[0].parentNode||e,s==="string"||s==="number"){if(te.context)return n;if(s==="number"&&(t=t.toString()),l){let o=n[0];o&&o.nodeType===3?o.data=t:o=document.createTextNode(t),n=rt(e,n,r,o)}else n!==""&&typeof n=="string"?n=e.firstChild.data=t:n=e.textContent=t}else if(t==null||s==="boolean"){if(te.context)return n;n=rt(e,n,r)}else{if(s==="function")return ae(()=>{let o=t();for(;typeof o=="function";)o=o();n=Xt(e,o,n,r)}),()=>n;if(Array.isArray(t)){const o=[],c=n&&Array.isArray(n);if(An(o,t,n,i))return ae(()=>n=Xt(e,o,n,r,!0)),()=>n;if(te.context){if(!o.length)return n;for(let u=0;u<o.length;u++)if(o[u].parentNode)return n=o}if(o.length===0){if(n=rt(e,n,r),l)return n}else c?n.length===0?qr(e,o,r):Cc(e,n,o):(n&&rt(e),qr(e,o));n=o}else if(t instanceof Node){if(te.context&&t.parentNode)return n=l?[t]:t;if(Array.isArray(n)){if(l)return n=rt(e,n,r,t);rt(e,n,null,t)}else n==null||n===""||!e.firstChild?e.appendChild(t):e.replaceChild(t,e.firstChild);n=t}}return n}function An(e,t,n,r){let i=!1;for(let s=0,l=t.length;s<l;s++){let o=t[s],c=n&&n[s];if(o instanceof Node)e.push(o);else if(!(o==null||o===!0||o===!1))if(Array.isArray(o))i=An(e,o,c)||i;else if(typeof o=="function")if(r){for(;typeof o=="function";)o=o();i=An(e,Array.isArray(o)?o:[o],Array.isArray(c)?c:[c])||i}else e.push(o),i=!0;else{const u=String(o);c&&c.nodeType===3&&c.data===u?e.push(c):e.push(document.createTextNode(u))}}return i}function qr(e,t,n){for(let r=0,i=t.length;r<i;r++)e.insertBefore(t[r],n)}function rt(e,t,n,r){if(n===void 0)return e.textContent="";const i=r||document.createTextNode("");if(t.length){let s=!1;for(let l=t.length-1;l>=0;l--){const o=t[l];if(i!==o){const c=o.parentNode===e;!s&&!l?c?e.replaceChild(i,o):e.insertBefore(i,n):c&&o.remove()}else s=!0}}else e.insertBefore(i,n);return[i]}class Ec{constructor(){de(this,"a_moves"),this.a_moves=vs.make(this)}get tree(){return this.a_moves.tree}set moves(t){this.a_moves.moves=t}set on_path(t){this.a_moves.on_path=t}}const gs=class{constructor(e){de(this,"m_tree"),de(this,"_moves"),de(this,"_hover_path"),de(this,"_on_path"),this.replay=e;let t=X(void 0,{equals:!1});this._hover_path=t;let n=X(void 0,{equals:!1});this._on_path=n;let r=X([]);this._moves=r;let i=I(zr(r[0],bs.make));function s(o){return I(()=>{let c=i().filter(h=>h.base===o),u=c.length>1;return c.map(h=>{let p=s(h.path)(),b;p.length>0&&(b=[p[0],p.slice(1)]);let k=h.ply%2===0,v=Math.ceil(h.ply/2)+(k?"...":"."),P=u||!k,E=I(()=>st(n)===h.path),x=I(()=>{var T;return((T=st(n))==null?void 0:T.slice(0,h.path.length))===h.path}),S=I(()=>st(t)===h.path),$=I(()=>{var T;return((T=st(t))==null?void 0:T.slice(0,h.path.length))===h.path}),q=I(()=>["move",E()?"on_hi":"",x()?"on_hi_sub":"",S()?"hi":"",$()?"hi_sub":""].join(" "));return{get klass(){return q()},a_move:h,index:v,show_index:P,main_children_and_rest:b}})})}let l=s("");this.m_tree=l}set on_path(e){mt(this._on_path,e)}set hover_path(e){mt(this._hover_path,t=>e)}get tree(){return this.m_tree()}set moves(e){mt(this._moves,e)}};let vs=gs;de(vs,"make",e=>new gs(e));const _s=class{constructor(e){de(this,"ply"),de(this,"path"),de(this,"base"),de(this,"move"),de(this,"comments"),de(this,"klass");let t=e.match(/([^ ]*) ([^ ]*) \{([^\}]*)\}/),n,r,i,s;if(t){r=t[1],i=t[2];let[c,u,h]=t[3].match(/^(__[^\_]*__)?(.*)$/);n=h,s=(u==null?void 0:u.substring(2,u.length-2))||""}else[r,i]=e.split(" "),s="";let l=r.length===2?"":r.slice(0,-2),o=r.length/2;this.path=r,this.ply=o,this.base=l,this.move=i,this.comments=n,this.klass=s}};let bs=_s;de(bs,"make",e=>new _s(e));const Ac=xt('<div class="chessreplay"><div class="moves"></div></div>'),xc=xt('<div class="lines"><div class="line"></div></div>'),Mc=xt('<div class="line"></div>'),Nc=xt('<div class="index"></div>'),Ir=xt("<div></div>");function ys(e){let t=new Ec;be(()=>{t.moves=e.moves}),be(()=>{t.on_path=e.on_path});const n=i=>{t.a_moves.hover_path=i},r=i=>{var s;t.a_moves.on_path=i,(s=e.on_click)==null||s.call(e,i)};return(()=>{const i=Ac.cloneNode(!0),s=i.firstChild;return Ce(s,O(ot,{get each(){return t.tree},children:l=>[O(Kt,Ue({on_click:r,on_hover:n},l)),O(Rt,{on_click:r,on_hover:n,get mcr(){return l.main_children_and_rest}})]})),i})()}const Rt=e=>e.mcr?O(Ae,{get when(){return e.mcr[1].length},get fallback(){return[O(Kt,Ue({get on_click(){return e.on_click},get on_hover(){return e.on_hover}},()=>e.mcr[0])),O(Rt,{get on_click(){return e.on_click},get on_hover(){return e.on_hover},get mcr(){return e.mcr[0].main_children_and_rest}})]},get children(){const t=xc.cloneNode(!0),n=t.firstChild;return Ce(n,O(Kt,Ue({get on_click(){return e.on_click},get on_hover(){return e.on_hover}},()=>e.mcr[0])),null),Ce(n,O(Rt,{get on_click(){return e.on_click},get on_hover(){return e.on_hover},get mcr(){return e.mcr[0].main_children_and_rest}}),null),Ce(t,O(ot,{get each(){return e.mcr[1]},children:r=>(()=>{const i=Mc.cloneNode(!0);return Ce(i,O(Kt,Ue({get on_click(){return e.on_click},get on_hover(){return e.on_hover}},r)),null),Ce(i,O(Rt,{get on_click(){return e.on_click},get on_hover(){return e.on_hover},get mcr(){return r.main_children_and_rest}}),null),i})()}),null),t}}):[],Kt=e=>[(()=>{const t=Ir.cloneNode(!0);return t.$$mouseover=n=>e.on_hover(e.a_move.path),t.addEventListener("mouseleave",n=>e.on_hover(void 0)),t.$$click=n=>e.on_click(e.a_move.path),Ce(t,O(Ae,{get when(){return e.show_index},get children(){const n=Nc.cloneNode(!0);return Ce(n,()=>e.index),n}}),null),Ce(t,()=>e.a_move.move,null),ae(()=>Lr(t,e.klass+e.a_move.klass)),t})(),(()=>{const t=Ir.cloneNode(!0);return Ce(t,()=>e.a_move.comments),ae(()=>Lr(t,["comment",e.a_move.klass].join(" "))),t})()];$c(["click","mouseover"]);let Rr=new cs({emit(e){He.ai.local_eval(e),e.depth>=Dt&&He.ai.crunch_one()}}),Kr=10,Dt=16;const Tc=(e,t)=>{let[n,r]=ye.apply(e);return n.fen===t?[""]:r.filter(([i,s])=>s.fen===t).map(i=>i[0])},Zt=class{constructor(){F(this,"path_depths");F(this,"root");F(this,"nb_crunch");F(this,"on_root_changed");F(this,"on_crunch_done")}local_eval(t){Tc(this.root.root,t.fen).forEach(r=>{this.path_depths.set(r,t.depth),t.pvs.forEach(i=>{let s=r;i.cp/100,i.depth;let l=i.moves.slice(0,4);for(let o of l){if(this.root.node_at_path(s).children.find(h=>h.uci===o))break;s=this.root.add_move(s,o,void 0)}})}),this.on_root_changed()}crunch_one(){this.nb_crunch++,this.nb_crunch===Kr&&(Rr.stop(),this.on_crunch_done()),!(this.nb_crunch>Kr)&&$e.breadfirst(this.root.root,(t,n)=>{let r=this.path_depths.get(t);if(!r||r<Dt){let s=this.root.root.node_list(t).map((l,o)=>({ply:o,uci:l.uci,fen:l.fen,san:""}));return Rr.start("",s),!0}return!1})}};let He=Zt;F(He,"ai",new Zt),F(He,"make",(t,n,r)=>{let{ai:i}=Zt;i.root=t,i.nb_crunch=0,i.path_depths=new Map;let s=t.flat_export[1].map(l=>l[0]);return s.forEach(l=>i.path_depths.set(l,Dt)),t.root.child_paths.filter(l=>l.length%4===2).forEach(l=>i.path_depths.delete(l)),s.length>0&&i.path_depths.set("",Dt),i.on_root_changed=n,i.on_crunch_done=r,i.crunch_one(),i});const Oc=ne('<div class="guess-app"></div>'),Lc=ne('<div class="opening-prep-scene"><div class="board"></div><div class="table"><div class="info"></div><div class="replay"></div><div class="controls"><button>Delete variation</button></div><div class="action"></div></div></div>'),qc=ne('<button class="primary">Compare AI</button>'),Ic=ne('<div class="opening-prep-scene"><div class="board"></div><div class="table"><div class="info">1. Build your opening repertoire as a preset</div><div class="replay"></div><div class="controls"><button>Delete variation</button></div><div class="action"><div>2. Create a challenge</div><h3> Select a color </h3><div class="packs colors"><div class="pack"><span> White </span></div><div class="pack"><span> Black </span></div><div class="pack"><span> Random </span></div></div><button class="primary">Start Game</button></div></div></div>'),Rc=()=>[O(tn,{children:" aidchess.com - Guess Lines "}),(()=>{const e=Oc.cloneNode(!0);return G(e,O(Ae,{when:!0,get fallback(){return O(Dc,{on_start:t=>{}})},get children(){return O(Kc,{})}})),e})()],Kc=()=>{const[e,t]=X(""),[n,r]=X(Oe.make(),{equals:!1}),[i,s]=X(Cn.get_replay(),{equals:!1}),[l,o]=X(!1),c=()=>{o(!0);const x=He.make(n(),()=>{},()=>{let[S,$]=Oe.diff_trees(i(),x.root),q=S.filter(j=>j.length%4===2),T=S.filter(j=>j.length%4===0),B=$.filter(j=>j.length%4===0);s(j=>(T.forEach(K=>j.delete_path(K)),j)),s(j=>(B.forEach(K=>{let re=x.root.node_at_path(K);j.add_move(yt(K),re.uci)}),j)),r(i().clone),r(j=>(q.forEach(K=>j.delete_children(K)),j)),o(!1)})},u=I(()=>i().node_at_path(e())),h=I(()=>{let x=n().moves().map($=>{let[q,T,B]=$.split(" ");return B="{__base__}",[q,T,B].join(" ")}),S=i().moves().filter($=>!x.find(q=>q.split(" ")[0]===$.split(" ")[0])).map($=>{let[q,T,B]=$.split(" ");return B="{__ghost__}",[q,T,B].join(" ")});return[...x,...S]});be(()=>{console.log(h())}),I(()=>i().chess(e()));const p=I(()=>i().fen(e())),b=x=>{let S;s($=>(S=$.add_move(e(),x),$)),S&&t(S)},k=()=>{let x;s(S=>(x=S.delete_variation(e()),S)),x!==void 0&&t(x)};let v=Qt.make,P=Qt.make;const E=x=>{var S;if(x<0)t($=>yt($));else{const $=(S=u())==null?void 0:S.children[0];$&&t(q=>q+$.id)}};return Vt({on_wheel:E},v),Vt({on_wheel:E},P),be(()=>console.log(h())),(()=>{const x=Lc.cloneNode(!0),S=x.firstChild,$=S.nextSibling,q=$.firstChild,T=q.nextSibling,B=T.nextSibling,j=B.firstChild,K=B.nextSibling,re=Yt(v);typeof re=="function"&&lt(re,S),G(S,O(tr,{glyphs:[],get fen(){return p()},isBlack:!1,onUserMove:b}));const A=Yt(P);return typeof A=="function"&&lt(A,T),G(T,O(ys,{get moves(){return h()},get on_path(){return e()},on_click:N=>t(N)})),j.$$click=k,G(K,O(Ae,{get when(){return l()},get fallback(){return(()=>{const N=qc.cloneNode(!0);return N.$$click=c,N})()},children:"Comparing..."})),x})()},Dc=e=>{const[t,n]=X(""),[r,i]=X(Cn.get_replay(),{equals:!1});be(()=>{Cn.set_replay(r())});const s=I(()=>r().node_at_path(t())),l=I(()=>r().moves());I(()=>r().chess(t()));const o=I(()=>r().fen(t())),c=x=>{let S;i($=>(S=$.add_move(t(),x),$)),S&&n(S)},u=()=>{let x;i(S=>(x=S.delete_variation(t()),S)),x!==void 0&&n(x)},[h,p]=X(),b=()=>{e.on_start(h())};let k=Qt.make,v=Qt.make;const P=x=>{var S;if(x<0)n($=>yt($));else{const $=(S=s())==null?void 0:S.children[0];$&&n(q=>q+$.id)}};Vt({on_wheel:P},k),Vt({on_wheel:P},v);const E=x=>h()===x?"primary selected":"primary";return(()=>{const x=Ic.cloneNode(!0),S=x.firstChild,$=S.nextSibling,q=$.firstChild,T=q.nextSibling,B=T.nextSibling,j=B.firstChild,K=B.nextSibling,re=K.firstChild,A=re.nextSibling,N=A.nextSibling,W=N.firstChild,L=W.firstChild,C=W.nextSibling,a=C.firstChild,f=C.nextSibling,d=f.firstChild,g=N.nextSibling,m=Yt(k);typeof m=="function"&&lt(m,S),G(S,O(tr,{glyphs:[],get fen(){return o()},isBlack:!1,onUserMove:c}));const y=Yt(v);return typeof y=="function"&&lt(y,T),G(T,O(ys,{get moves(){return l()},get on_path(){return t()},on_click:_=>n(_)})),j.$$click=u,W.$$click=()=>p("w"),C.$$click=()=>p("b"),f.$$click=()=>p(),g.$$click=b,ae(_=>{const w=E("w"),D=E("b"),z=E(void 0);return w!==_._v$&&pt(L,_._v$=w),D!==_._v$2&&pt(a,_._v$2=D),z!==_._v$3&&pt(d,_._v$3=z),_},{_v$:void 0,_v$2:void 0,_v$3:void 0}),x})()};Pt(["click"]);const Bc=ne("<span>.com</span>"),jc=ne('<div class="liheadsup"><div class="navbar"><div class="title"></div><div class="dasher"></div></div><div class="main"></div></div>'),Wc=()=>O($o,{get source(){return io()},get children(){return O(xo,{get children(){return O(Hc,{})}})}}),Hc=()=>(()=>{const e=jc.cloneNode(!0),t=e.firstChild,n=t.firstChild,r=t.nextSibling;return G(n,O(si,{href:"/",get children(){return[" aidchess",Bc.cloneNode(!0)]}})),G(r,O(Po,{get children(){return[O(Tt,{path:"/",component:Ml}),O(Tt,{path:"/about",component:Oo}),O(Tt,{path:"/hardcore",component:lc}),O(Tt,{path:"/predict",component:Rc})]}})),e})();function Fc(e){Us(Wc,e)}Fc(document.getElementById("app"));
